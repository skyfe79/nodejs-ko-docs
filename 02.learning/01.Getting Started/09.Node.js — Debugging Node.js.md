# Table of Contents

- [Node.js 디버깅](#nodejs-디버깅)
  - [Inspector 활성화](#inspector-활성화)
  - [보안 관련 사항](#보안-관련-사항)
    - [디버그 포트를 공개적으로 노출하는 것은 안전하지 않음](#디버그-포트를-공개적으로-노출하는-것은-안전하지-않음)
    - [로컬 애플리케이션은 인스펙터에 완전한 접근 권한을 가짐](#로컬-애플리케이션은-인스펙터에-완전한-접근-권한을-가짐)
    - [브라우저, WebSocket, 그리고 동일 출처 정책](#브라우저-websocket-그리고-동일-출처-정책)
  - [Inspector Clients](#inspector-clients)
    - [Chrome DevTools 55+, Microsoft Edge](#chrome-devtools-55-microsoft-edge)
    - [Visual Studio Code 1.10+](#visual-studio-code-110)
    - [Visual Studio 2017+](#visual-studio-2017)
    - [JetBrains WebStorm 및 기타 JetBrains IDE](#jetbrains-webstorm-및-기타-jetbrains-ide)
    - [chrome-remote-interface](#chrome-remote-interface)
    - [Gitpod](#gitpod)
    - [Eclipse IDE와 Eclipse Wild Web Developer 확장 프로그램 사용하기](#eclipse-ide와-eclipse-wild-web-developer-확장-프로그램-사용하기)
  - [커맨드라인 옵션](#커맨드라인-옵션)
  - [원격 디버깅 시나리오 활성화](#원격-디버깅-시나리오-활성화)
  - [레거시 디버거](#레거시-디버거)
    - [내장 디버거](#내장-디버거)
    - [node-inspector](#node-inspector)

# [Node.js 디버깅](https://nodejs.org/ko/learn/getting-started/ecmascript-2015-es6-and-beyond#debugging-nodejs)

이 가이드는 여러분이 Node.js 앱과 스크립트를 디버깅하는 데 도움을 줄 것입니다.


## [Inspector 활성화](https://nodejs.org/ko/learn/getting-started/ecmascript-2015-es6-and-beyond#enable-inspector)

Node.js 프로세스를 `--inspect` 스위치와 함께 시작하면, 디버깅 클라이언트를 기다리는 상태가 됩니다. 기본적으로 호스트와 포트 127.0.0.1:9229에서 대기합니다. 각 프로세스에는 고유한 [UUID](https://tools.ietf.org/html/rfc4122)가 할당됩니다.

Inspector 클라이언트는 연결을 위해 호스트 주소, 포트, UUID를 알고 지정해야 합니다. 전체 URL은 `ws://127.0.0.1:9229/0f2c936f-b1cd-4ac9-aab3-f63b0f33d55e`와 같은 형태입니다.

Node.js는 `SIGUSR1` 신호를 받으면 디버깅 메시지를 수신하기 시작합니다. (`SIGUSR1`은 윈도우에서 사용할 수 없습니다.) Node.js 7 이전 버전에서는 이 신호가 레거시 Debugger API를 활성화합니다. Node.js 8 이상에서는 Inspector API를 활성화합니다.


## 보안 관련 사항

디버거는 Node.js 실행 환경에 완전한 접근 권한을 가지고 있습니다. 따라서 이 포트에 연결할 수 있는 악의적인 사용자는 Node.js 프로세스를 대신해 임의의 코드를 실행할 수 있습니다. 공개 및 사설 네트워크에서 디버거 포트를 노출할 때 발생할 수 있는 보안 문제를 이해하는 것이 중요합니다.


### [디버그 포트를 공개적으로 노출하는 것은 안전하지 않음](https://nodejs.org/ko/learn/getting-started/ecmascript-2015-es6-and-beyond#exposing-the-debug-port-publicly-is-unsafe)

디버거가 공개 IP 주소나 0.0.0.0에 바인딩된 경우, 여러분의 IP 주소에 접근할 수 있는 모든 클라이언트가 제한 없이 디버거에 연결할 수 있으며 임의의 코드를 실행할 수 있습니다.

기본적으로 `node --inspect`는 127.0.0.1에 바인딩됩니다. 외부 연결을 허용하려면 공개 IP 주소나 0.0.0.0 등을 명시적으로 제공해야 합니다. 이렇게 하면 잠재적으로 심각한 보안 위협에 노출될 수 있습니다. 보안 노출을 방지하기 위해 적절한 방화벽과 접근 제어를 설정하는 것을 권장합니다.

안전하게 원격 디버거 클라이언트를 연결하는 방법에 대한 조언은 '[원격 디버깅 시나리오 활성화](https://nodejs.org/ko/learn/getting-started/ecmascript-2015-es6-and-beyond#enabling-remote-debugging-scenarios)' 섹션을 참고하세요.


### [로컬 애플리케이션은 인스펙터에 완전한 접근 권한을 가짐](https://nodejs.org/ko/learn/getting-started/ecmascript-2015-es6-and-beyond#local-applications-have-full-access-to-the-inspector)

인스펙터 포트를 127.0.0.1(기본값)에 바인딩하더라도, 여러분의 컴퓨터에서 실행 중인 모든 로컬 애플리케이션은 제한 없이 접근할 수 있습니다. 이는 로컬 디버거가 편리하게 연결할 수 있도록 설계된 것입니다.


### [브라우저, WebSocket, 그리고 동일 출처 정책](https://nodejs.org/ko/learn/getting-started/ecmascript-2015-es6-and-beyond#browsers-websockets-and-same-origin-policy)

웹 브라우저에서 열린 웹사이트는 브라우저 보안 모델 아래에서 WebSocket 및 HTTP 요청을 할 수 있습니다. 고유한 디버거 세션 ID를 얻기 위해서는 초기 HTTP 연결이 필요합니다. 동일 출처 정책(same-origin-policy)은 웹사이트가 이 HTTP 연결을 시도하는 것을 방지합니다. [DNS 리바인딩 공격](https://en.wikipedia.org/wiki/DNS_rebinding)에 대한 추가 보안을 위해, Node.js는 연결에 대한 'Host' 헤더가 정확히 IP 주소나 `localhost`를 지정하는지 확인합니다.

이러한 보안 정책으로 인해 호스트 이름을 지정하여 원격 디버그 서버에 연결하는 것이 금지됩니다. 이 제한을 우회하려면 IP 주소를 지정하거나 아래에 설명된 ssh 터널을 사용할 수 있습니다.


## [Inspector Clients](https://nodejs.org/ko/learn/getting-started/ecmascript-2015-es6-and-beyond#inspector-clients)

`node inspect myscript.js` 명령어를 사용하면 간단한 CLI 디버거를 이용할 수 있습니다. 여러 상용 및 오픈소스 도구들도 Node.js Inspector에 연결할 수 있습니다.


### [Chrome DevTools 55+, Microsoft Edge](https://nodejs.org/ko/learn/getting-started/ecmascript-2015-es6-and-beyond#chrome-devtools-55-microsoft-edge)

- **옵션 1**: 크로미움 기반 브라우저에서 `chrome://inspect`를 열거나 Edge에서 `edge://inspect`를 엽니다. Configure 버튼을 클릭하고 대상 호스트와 포트가 목록에 있는지 확인하세요.
- **옵션 2**: `/json/list`의 출력 결과나 --inspect 힌트 텍스트에서 `devtoolsFrontendUrl`을 복사한 후 Chrome에 붙여넣으세요.

더 많은 정보는 [https://github.com/ChromeDevTools/devtools-frontend](https://github.com/ChromeDevTools/devtools-frontend)와 [https://www.microsoftedgeinsider.com](https://www.microsoftedgeinsider.com)를 참고하세요.


### [Visual Studio Code 1.10+](https://nodejs.org/ko/learn/getting-started/ecmascript-2015-es6-and-beyond#visual-studio-code-110)

- 디버그 패널에서 설정 아이콘을 클릭해 `.vscode/launch.json` 파일을 엽니다. 초기 설정을 위해 "Node.js"를 선택하세요.

더 많은 정보는 [https://github.com/microsoft/vscode](https://github.com/microsoft/vscode)에서 확인할 수 있습니다.


### [Visual Studio 2017+](https://nodejs.org/ko/learn/getting-started/ecmascript-2015-es6-and-beyond#visual-studio-2017)

- 메뉴에서 "디버그 > 디버깅 시작"을 선택하거나 F5 키를 누릅니다.
- [자세한 설명](https://github.com/Microsoft/nodejstools/wiki/Debugging)을 참고하세요.


### [JetBrains WebStorm 및 기타 JetBrains IDE](https://nodejs.org/ko/learn/getting-started/ecmascript-2015-es6-and-beyond#jetbrains-webstorm-and-other-jetbrains-ides)

-   새로운 Node.js 디버그 설정을 생성하고 디버그를 실행하세요. Node.js 7 이상에서는 기본적으로 `--inspect`가 사용됩니다. 이를 비활성화하려면 IDE 레지스트리에서 `js.debugger.node.use.inspect`를 체크 해제하세요. WebStorm 및 기타 JetBrains IDE에서 Node.js를 실행하고 디버깅하는 방법에 대해 더 알아보려면 [WebStorm 온라인 도움말](https://www.jetbrains.com/help/webstorm/running-and-debugging-node-js.html)을 참고하세요.


### [chrome-remote-interface](https://nodejs.org/ko/learn/getting-started/ecmascript-2015-es6-and-beyond#chrome-remote-interface)

- [Inspector Protocol](https://chromedevtools.github.io/debugger-protocol-viewer/v8/) 엔드포인트에 쉽게 연결할 수 있도록 도와주는 라이브러리입니다.

자세한 내용은 [https://github.com/cyrus-and/chrome-remote-interface](https://github.com/cyrus-and/chrome-remote-interface)를 참고하세요.


### [Gitpod](https://nodejs.org/ko/learn/getting-started/ecmascript-2015-es6-and-beyond#gitpod)

- `Debug` 뷰에서 Node.js 디버그 설정을 시작하거나 `F5` 키를 누르세요. [자세한 안내](https://medium.com/gitpod/debugging-node-js-applications-in-theia-76c94c76f0a1)

더 많은 정보는 [https://www.gitpod.io](https://www.gitpod.io)를 참고하세요.


### [Eclipse IDE와 Eclipse Wild Web Developer 확장 프로그램 사용하기](https://nodejs.org/ko/learn/getting-started/ecmascript-2015-es6-and-beyond#eclipse-ide-with-eclipse-wild-web-developer-extension)

- `.js` 파일에서 "Debug As... > Node program"을 선택하거나,
- 실행 중인 Node.js 애플리케이션에 디버거를 연결하기 위해 디버그 설정을 생성합니다. (이미 `--inspect`로 시작된 경우)

더 자세한 정보는 [https://eclipse.org/eclipseide](https://eclipse.org/eclipseide)를 참고하세요.


## [커맨드라인 옵션](https://nodejs.org/ko/learn/getting-started/ecmascript-2015-es6-and-beyond#command-line-options)

다음 표는 디버깅에 영향을 미치는 다양한 런타임 플래그를 정리한 것입니다:

| 플래그 | 의미 |
| --- | --- |
| \--inspect | 인스펙터 에이전트 활성화; 기본 주소와 포트(127.0.0.1:9229)에서 대기 |
| \--inspect=\[host:port\] | 인스펙터 에이전트 활성화; 주소 또는 호스트명(기본값: 127.0.0.1)에 바인딩; 포트(기본값: 9229)에서 대기 |
| \--inspect-brk | 인스펙터 에이전트 활성화; 기본 주소와 포트(127.0.0.1:9229)에서 대기; 사용자 코드 시작 전에 중단 |
| \--inspect-brk=\[host:port\] | 인스펙터 에이전트 활성화; 주소 또는 호스트명(기본값: 127.0.0.1)에 바인딩; 포트(기본값: 9229)에서 대기; 사용자 코드 시작 전에 중단 |
| \--inspect-wait | 인스펙터 에이전트 활성화; 기본 주소와 포트(127.0.0.1:9229)에서 대기; 디버거가 연결될 때까지 대기 |
| \--inspect-wait=\[host:port\] | 인스펙터 에이전트 활성화; 주소 또는 호스트명(기본값: 127.0.0.1)에 바인딩; 포트(기본값: 9229)에서 대기; 디버거가 연결될 때까지 대기 |
| node inspect script.js | \--inspect 플래그로 사용자 스크립트를 실행하는 자식 프로세스 생성; 메인 프로세스로 CLI 디버거 실행 |
| node inspect --port=xxxx script.js | \--inspect 플래그로 사용자 스크립트를 실행하는 자식 프로세스 생성; 메인 프로세스로 CLI 디버거 실행; 포트(기본값: 9229)에서 대기 |


## 원격 디버깅 시나리오 활성화

디버거가 공용 IP 주소에서 대기하도록 설정하는 것은 권장하지 않습니다. 원격 디버깅 연결을 허용해야 한다면, SSH 터널을 사용하는 것을 추천합니다. 아래 예제는 설명을 위한 목적으로만 제공됩니다. 원격 접근을 허용하는 것이 가지는 보안 위험을 충분히 이해한 후 진행하세요.

예를 들어, 여러분이 디버깅하고 싶은 Node.js 애플리케이션이 `remote.example.com`이라는 원격 머신에서 실행 중이라고 가정해 보겠습니다. 해당 머신에서 Node 프로세스를 시작할 때, inspector가 localhost에서만 대기하도록 설정해야 합니다(기본값).

```javascript
node --inspect server.js
```

이제, 디버그 클라이언트 연결을 시작할 로컬 머신에서 SSH 터널을 설정할 수 있습니다.

```bash
ssh -L 9221:localhost:9229 user@remote.example.com
```

이 명령어는 SSH 터널 세션을 시작하며, 로컬 머신의 9221 포트로의 연결이 `remote.example.com`의 9229 포트로 전달됩니다. 이제 Chrome DevTools나 Visual Studio Code와 같은 디버거를 `localhost:9221`에 연결하면, Node.js 애플리케이션이 로컬에서 실행 중인 것처럼 디버깅할 수 있습니다.


## [레거시 디버거](https://nodejs.org/ko/learn/getting-started/ecmascript-2015-es6-and-beyond#legacy-debugger)

**레거시 디버거는 Node.js 7.7.0 버전부터 더 이상 사용되지 않습니다. 대신 `--inspect`와 Inspector를 사용하세요.**

Node.js 7 버전 이전에서 **\--debug** 또는 **\--debug-brk** 스위치와 함께 실행하면, Node.js는 중단된 V8 디버깅 프로토콜에 정의된 디버깅 명령을 기본적으로 `5858` TCP 포트에서 수신합니다. 이 프로토콜을 지원하는 모든 디버거 클라이언트는 실행 중인 프로세스에 연결하여 디버깅할 수 있습니다. 아래는 몇 가지 인기 있는 디버거 클라이언트 목록입니다.

V8 디버깅 프로토콜은 더 이상 유지보수되거나 문서화되지 않습니다.


### [내장 디버거](https://nodejs.org/ko/learn/getting-started/ecmascript-2015-es6-and-beyond#built-in-debugger)

`node debug script_name.js` 명령어를 실행하면 내장 커맨드라인 디버거를 통해 스크립트를 시작할 수 있습니다. 이때 스크립트는 `--debug-brk` 옵션과 함께 다른 Node.js 프로세스에서 시작됩니다. 초기 Node.js 프로세스는 `_debugger.js` 스크립트를 실행하고 타겟에 연결합니다. 더 자세한 정보는 [공식 문서](https://nodejs.org/dist/latest/docs/api/debugger.html)를 참고하세요.


### [node-inspector](https://nodejs.org/ko/learn/getting-started/ecmascript-2015-es6-and-beyond#node-inspector)

Chrome DevTools를 사용해 Node.js 애플리케이션을 디버깅할 수 있습니다. node-inspector는 Chromium에서 사용하는 [Inspector Protocol](https://chromedevtools.github.io/debugger-protocol-viewer/v8/)을 Node.js의 V8 디버거 프로토콜로 변환하는 중간 프로세스 역할을 합니다. 더 자세한 정보는 [https://github.com/node-inspector/node-inspector](https://github.com/node-inspector/node-inspector)에서 확인할 수 있습니다.


