# [Node.js와 WebAssembly](https://nodejs.org/ko/learn/getting-started/ecmascript-2015-es6-and-beyond#nodejs-with-webassembly)

**[WebAssembly](https://webassembly.org)**는 C/C++, Rust, AssemblyScript 등 다양한 언어로부터 컴파일될 수 있는 고성능 어셈블리 언어입니다. 현재 Chrome, Firefox, Safari, Edge, 그리고 Node.js에서 지원됩니다!

WebAssembly 스펙은 두 가지 파일 형식을 정의합니다. `.wasm` 확장자를 가진 WebAssembly Module이라는 바이너리 형식과, `.wat` 확장자를 가진 WebAssembly Text 형식이 그것입니다.


## 주요 개념

- **모듈(Module)**: 컴파일된 WebAssembly 바이너리 파일, 즉 `.wasm` 파일을 의미한다.
- **메모리(Memory)**: 크기를 조절할 수 있는 ArrayBuffer이다.
- **테이블(Table)**: 메모리에 저장되지 않은 참조를 담는 크기 조절 가능한 타입 배열이다.
- **인스턴스(Instance)**: 모듈을 메모리, 테이블, 변수와 함께 인스턴스화한 것이다.

WebAssembly를 사용하려면 `.wasm` 바이너리 파일과 WebAssembly와 통신할 수 있는 API 세트가 필요하다. Node.js는 전역 `WebAssembly` 객체를 통해 필요한 API를 제공한다.

```javascript
console.log(WebAssembly);
/*
Object [WebAssembly] {
  compile: [Function: compile],
  validate: [Function: validate],
  instantiate: [Function: instantiate]
}
*/
```


## WebAssembly 모듈 생성하기

WebAssembly 바이너리 파일을 생성하는 방법은 여러 가지가 있습니다. 주요 방법은 다음과 같습니다:

- WebAssembly(`.wat`)를 직접 작성한 후 [wabt](https://github.com/webassembly/wabt)와 같은 도구를 사용해 바이너리 형식으로 변환
- C/C++ 애플리케이션과 함께 [emscripten](https://emscripten.org/) 사용
- Rust 애플리케이션과 함께 [wasm-pack](https://rustwasm.github.io/wasm-pack/book/) 사용
- TypeScript와 비슷한 경험을 원한다면 [AssemblyScript](https://www.assemblyscript.org/) 사용

> 이 도구들 중 일부는 바이너리 파일뿐만 아니라 브라우저에서 실행할 수 있는 JavaScript "접착" 코드와 해당 HTML 파일도 함께 생성합니다.


## [사용 방법](https://nodejs.org/ko/learn/getting-started/ecmascript-2015-es6-and-beyond#how-to-use-it)

WebAssembly 모듈을 준비했다면, Node.js의 `WebAssembly` 객체를 사용해 모듈을 인스턴스화할 수 있습니다.

```javascript
// add.wasm 파일이 존재한다고 가정합니다. 이 파일은 두 개의 인자를 더하는 단일 함수를 포함합니다.
const fs = require('node:fs');

// readFileSync 함수를 사용해 "add.wasm" 파일의 내용을 읽습니다.
const wasmBuffer = fs.readFileSync('/path/to/add.wasm');

// WebAssembly.instantiate 메서드를 사용해 WebAssembly 모듈을 인스턴스화합니다.
WebAssembly.instantiate(wasmBuffer).then(wasmModule => {
  // 내보낸 함수는 instance.exports 객체 아래에 있습니다.
  const { add } = wasmModule.instance.exports;
  const sum = add(5, 6);
  console.log(sum); // 출력: 11
});
```


## 운영체제와 상호작용하기

WebAssembly 모듈은 자체적으로 운영체제 기능에 직접 접근할 수 없습니다. 이 기능을 사용하려면 [Wasmtime](https://docs.wasmtime.dev/)과 같은 서드파티 도구를 활용할 수 있습니다. `Wasmtime`은 [WASI](https://wasi.dev/) API를 사용해 운영체제 기능에 접근합니다.


## [리소스](https://nodejs.org/ko/learn/getting-started/ecmascript-2015-es6-and-beyond#resources)

-   [WebAssembly 일반 정보](https://webassembly.org/)
-   [MDN 문서](https://developer.mozilla.org/en-US/docs/WebAssembly)
-   [WebAssembly 직접 작성하기](https://webassembly.github.io/spec/core/text/index.html)


