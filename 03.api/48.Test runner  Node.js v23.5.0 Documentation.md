# 테스트 러너

**소스 코드:** [lib/test.js](https://github.com/nodejs/node/blob/v23.5.0/lib/test.js)

`node:test` 모듈은 자바스크립트 테스트 작성을 도와줍니다. 이 모듈을 사용하려면 다음과 같이 임포트합니다:

```js
import test from 'node:test';
```

이 모듈은 `node:` 스키마에서만 사용할 수 있습니다.

`test` 모듈을 통해 생성된 테스트는 세 가지 방식 중 하나로 처리되는 단일 함수로 구성됩니다:

1. 동기 함수: 예외를 던지면 실패로 간주되고, 그렇지 않으면 성공으로 간주됩니다.
2. `Promise`를 반환하는 함수: `Promise`가 거부되면 실패로, 이행되면 성공으로 간주됩니다.
3. 콜백 함수를 받는 함수: 콜백의 첫 번째 인자로 참 같은 값이 전달되면 테스트가 실패로 간주됩니다. 첫 번째 인자로 거짓 같은 값이 전달되면 테스트가 성공으로 간주됩니다. 테스트 함수가 콜백 함수를 받으면서 `Promise`를 반환하면 테스트는 실패합니다.

다음 예제는 `test` 모듈을 사용해 테스트를 작성하는 방법을 보여줍니다.

```js
test('동기 성공 테스트', (t) => {
    // 이 테스트는 예외를 던지지 않으므로 성공합니다.
    assert.strictEqual(1, 1);
});

test('동기 실패 테스트', (t) => {
    // 이 테스트는 예외를 던지므로 실패합니다.
    assert.strictEqual(1, 2);
});

test('비동기 성공 테스트', async (t) => {
    // 이 테스트는 async 함수가 반환한 Promise가 이행되므로 성공합니다.
    assert.strictEqual(1, 1);
});

test('비동기 실패 테스트', async (t) => {
    // 이 테스트는 async 함수가 반환한 Promise가 거부되므로 실패합니다.
    assert.strictEqual(1, 2);
});

test('Promise를 사용한 실패 테스트', (t) => {
    // Promise를 직접 사용할 수도 있습니다.
    return new Promise((resolve, reject) => {
        setImmediate(() => {
            reject(new Error('이로 인해 테스트가 실패합니다.'));
        });
    });
});

test('콜백 성공 테스트', (t, done) => {
    // done()은 콜백 함수입니다. setImmediate()가 실행되면 done()을 인자 없이 호출합니다.
    setImmediate(done);
});

test('콜백 실패 테스트', (t, done) => {
    // setImmediate()가 실행되면 done()이 Error 객체와 함께 호출되어 테스트가 실패합니다.
    setImmediate(() => {
        done(new Error('콜백 실패'));
    });
});
```

어떤 테스트라도 실패하면 프로세스 종료 코드가 `1`로 설정됩니다.


### 서브 테스트

테스트 컨텍스트의 `test()` 메서드를 사용하면 서브 테스트를 생성할 수 있습니다. 이를 통해 여러분은 테스트를 계층적으로 구조화할 수 있으며, 더 큰 테스트 내에 중첩된 테스트를 만들 수 있습니다. 이 메서드는 최상위 `test()` 함수와 동일하게 동작합니다. 다음 예제는 두 개의 서브 테스트를 포함한 최상위 테스트를 생성하는 방법을 보여줍니다.

```js
test('최상위 테스트', async (t) => {
    await t.test('서브 테스트 1', (t) => {
        assert.strictEqual(1, 1);
    });
    await t.test('서브 테스트 2', (t) => {
        assert.strictEqual(2, 2);
    });
});
```

> **참고:** `beforeEach`와 `afterEach` 훅은 각 서브 테스트 실행 사이에 트리거됩니다.

이 예제에서 `await`는 두 서브 테스트가 완료될 때까지 기다리기 위해 사용됩니다. 이는 테스트가 서브 테스트가 완료될 때까지 기다리지 않기 때문에 필요합니다. 이는 테스트 스위트 내에서 생성된 테스트와는 다릅니다. 부모 테스트가 완료될 때까지 아직 완료되지 않은 서브 테스트는 취소되고 실패로 처리됩니다. 또한, 서브 테스트의 실패는 부모 테스트도 실패하게 만듭니다.


### 테스트 건너뛰기

개별 테스트를 건너뛰려면 `skip` 옵션을 테스트에 전달하거나, 테스트 컨텍스트의 `skip()` 메서드를 호출하면 됩니다. 아래 예제를 참고하세요.

```js
// skip 옵션을 사용하지만 메시지는 제공하지 않음
test('skip option', { skip: true }, (t) => {
  // 이 코드는 실행되지 않음
});

// skip 옵션을 사용하고 메시지를 제공
test('skip option with message', { skip: 'this is skipped' }, (t) => {
  // 이 코드는 실행되지 않음
});

// skip() 메서드 사용
test('skip() method', (t) => {
  // 테스트에 추가 로직이 포함된 경우 여기서도 반드시 return 해야 함
  t.skip();
});

// skip() 메서드 사용 및 메시지 제공
test('skip() method with message', (t) => {
  // 테스트에 추가 로직이 포함된 경우 여기서도 반드시 return 해야 함
  t.skip('this is skipped');
});
```


### TODO 테스트

개별 테스트는 `todo` 옵션을 사용하거나 테스트 컨텍스트의 `todo()` 메서드를 호출하여 불완전하거나 아직 구현되지 않은 상태로 표시할 수 있습니다. 아래 예제에서 이를 확인할 수 있습니다. TODO 테스트는 아직 구현되지 않았거나 수정이 필요한 버그를 나타냅니다. TODO 테스트는 실행되지만, 테스트 실패로 간주되지 않으므로 프로세스 종료 코드에 영향을 미치지 않습니다. 만약 테스트가 TODO와 스킵(skip)으로 동시에 표시된 경우, TODO 옵션은 무시됩니다.

```js
// todo 옵션을 사용했지만 메시지는 제공하지 않음
test('todo option', { todo: true }, (t) => {
    // 이 코드는 실행되지만, 실패로 처리되지 않음
    throw new Error('이 오류는 테스트를 실패시키지 않음');
});

// todo 옵션을 사용하고 메시지를 제공함
test('todo option with message', { todo: '이것은 TODO 테스트입니다' }, (t) => {
    // 이 코드는 실행됨
});

// todo() 메서드를 사용함
test('todo() method', (t) => {
    t.todo();
});

// todo() 메서드를 사용하고 메시지를 제공함
test('todo() method with message', (t) => {
    t.todo('이것은 TODO 테스트이며 실패로 처리되지 않음');
    throw new Error('이 오류는 테스트를 실패시키지 않음');
});
```


### `describe()`와 `it()` 별칭

테스트 스위트와 테스트는 `describe()`와 `it()` 함수를 사용해서 작성할 수도 있습니다. [`describe()`](https://nodejs.org/docs/latest/api/test.html#describename-options-fn)는 [`suite()`](https://nodejs.org/docs/latest/api/test.html#suitename-options-fn)의 별칭이고, [`it()`](https://nodejs.org/docs/latest/api/test.html#itname-options-fn)는 [`test()`](https://nodejs.org/docs/latest/api/test.html#testname-options-fn)의 별칭입니다.

```js
describe('A thing', () => {
    it('should work', () => {
        assert.strictEqual(1, 1);
    });
    it('should be ok', () => {
        assert.strictEqual(2, 2);
    });
    describe('a nested thing', () => {
        it('should work', () => {
            assert.strictEqual(3, 3);
        });
    });
});
```

`describe()`와 `it()`은 `node:test` 모듈에서 가져옵니다.

```js
import { describe, it } from 'node:test';
```


### `only` 테스트[#](https://nodejs.org/docs/latest/api/test.html#only-tests)

Node.js를 [`--test-only`](https://nodejs.org/docs/latest/api/cli.html#--test-only) 커맨드라인 옵션과 함께 실행하거나 테스트 격리가 비활성화된 경우, `only` 옵션을 사용하여 선택한 테스트만 실행하고 나머지는 건너뛸 수 있습니다. `only` 옵션이 설정된 테스트는 해당 테스트의 모든 하위 테스트도 함께 실행됩니다. 만약 테스트 스위트에 `only` 옵션이 설정되어 있다면, 해당 스위트 내의 모든 테스트가 실행됩니다. 단, `only` 옵션이 설정된 하위 테스트가 있다면 해당 테스트만 실행됩니다.

`test()` 또는 `it()` 내에서 [하위 테스트](https://nodejs.org/docs/latest/api/test.html#subtests)를 사용할 때, 선택한 테스트만 실행하려면 모든 상위 테스트에 `only` 옵션을 설정해야 합니다.

테스트 컨텍스트의 `runOnly()` 메서드를 사용하면 하위 테스트 수준에서 동일한 동작을 구현할 수 있습니다. 실행되지 않은 테스트는 테스트 실행기 출력에서 제외됩니다.

```js
// Node.js가 --test-only 커맨드라인 옵션과 함께 실행되었다고 가정합니다.
// 스위트의 'only' 옵션이 설정되어 있으므로 이 테스트는 실행됩니다.
test('이 테스트는 실행됩니다', { only: true }, async (t) => {
    // 이 테스트 내에서는 모든 하위 테스트가 기본적으로 실행됩니다.
    await t.test('실행되는 하위 테스트');

    // 테스트 컨텍스트를 업데이트하여 'only' 옵션이 설정된 하위 테스트만 실행할 수 있습니다.
    t.runOnly(true);
    await t.test('이 하위 테스트는 이제 건너뜁니다');
    await t.test('이 하위 테스트는 실행됩니다', { only: true });

    // 컨텍스트를 다시 모든 테스트를 실행하도록 전환합니다.
    t.runOnly(false);
    await t.test('이 하위 테스트는 이제 실행됩니다');

    // 명시적으로 이 테스트들은 실행하지 않습니다.
    await t.test('건너뛴 하위 테스트 3', { only: false });
    await t.test('건너뛴 하위 테스트 4', { skip: true });
});

// 'only' 옵션이 설정되지 않았으므로 이 테스트는 건너뜁니다.
test('이 테스트는 실행되지 않습니다', () => {
    // 이 코드는 실행되지 않습니다.
    throw new Error('실패');
});

describe('스위트', () => {
    // 'only' 옵션이 설정되어 있으므로 이 테스트는 실행됩니다.
    it('이 테스트는 실행됩니다', { only: true }, () => {
        // 이 코드는 실행됩니다.
    });

    it('이 테스트는 실행되지 않습니다', () => {
        // 이 코드는 실행되지 않습니다.
        throw new Error('실패');
    });
});

describe.only('스위트', () => {
    // 'only' 옵션이 설정되어 있으므로 이 테스트는 실행됩니다.
    it('이 테스트는 실행됩니다', () => {
        // 이 코드는 실행됩니다.
    });

    it('이 테스트는 실행됩니다', () => {
        // 이 코드는 실행됩니다.
    });
});
```


### 이름으로 테스트 필터링하기

[`--test-name-pattern`](https://nodejs.org/docs/latest/api/cli.html#--test-name-pattern) 커맨드라인 옵션을 사용하면 이름이 주어진 패턴과 일치하는 테스트만 실행할 수 있습니다. 반면 [`--test-skip-pattern`](https://nodejs.org/docs/latest/api/cli.html#--test-skip-pattern) 옵션은 이름이 패턴과 일치하는 테스트를 건너뛰도록 합니다. 테스트 이름 패턴은 JavaScript 정규 표현식으로 해석됩니다. `--test-name-pattern`과 `--test-skip-pattern` 옵션은 중첩된 테스트를 실행하기 위해 여러 번 지정할 수 있습니다. 실행되는 각 테스트에 대해 `beforeEach()`와 같은 해당 테스트 훅도 함께 실행됩니다. 실행되지 않는 테스트는 테스트 러너 출력에서 제외됩니다.

다음 테스트 파일이 주어졌을 때, `--test-name-pattern="test [1-3]"` 옵션으로 Node.js를 시작하면 테스트 러너는 `test 1`, `test 2`, `test 3`을 실행합니다. 만약 `test 1`이 테스트 이름 패턴과 일치하지 않으면, 그 하위 테스트들은 패턴과 일치하더라도 실행되지 않습니다. 동일한 테스트 세트는 `--test-name-pattern`을 여러 번 전달하여 실행할 수도 있습니다 (예: `--test-name-pattern="test 1"`, `--test-name-pattern="test 2"` 등).

```js
test('test 1', async (t) => { 
    await t.test('test 2'); 
    await t.test('test 3'); 
}); 
test('Test 4', async (t) => { 
    await t.test('Test 5'); 
    await t.test('test 6'); 
});
```

테스트 이름 패턴은 정규 표현식 리터럴을 사용하여 지정할 수도 있습니다. 이를 통해 정규 표현식 플래그를 사용할 수 있습니다. 앞의 예제에서 `--test-name-pattern="/test [4-5]/i"` (또는 `--test-skip-pattern="/test [4-5]/i"`)로 Node.js를 시작하면, 패턴이 대소문자를 구분하지 않기 때문에 `Test 4`와 `Test 5`가 일치합니다.

특정 테스트를 패턴과 일치시키려면, 모든 상위 테스트 이름을 공백으로 구분하여 접두사로 붙여 고유하게 만들 수 있습니다. 예를 들어, 다음 테스트 파일이 주어졌을 때:

```js
describe('test 1', (t) => { 
    it('some test'); 
}); 
describe('test 2', (t) => { 
    it('some test'); 
});
```

`--test-name-pattern="test 1 some test"`로 Node.js를 시작하면 `test 1`의 `some test`만 일치합니다.

테스트 이름 패턴은 테스트 러너가 실행하는 파일 세트를 변경하지 않습니다.

`--test-name-pattern`과 `--test-skip-pattern`이 모두 제공되면, 테스트가 실행되려면 **두 가지** 요구 사항을 모두 충족해야 합니다.


### 불필요한 비동기 작업

테스트 함수가 실행을 마치면, 테스트 순서를 유지하면서 가능한 한 빠르게 결과를 보고합니다. 하지만 테스트 함수가 테스트 자체보다 오래 지속되는 비동기 작업을 생성할 수도 있습니다. 테스트 러너는 이런 유형의 작업을 처리하지만, 이를 수용하기 위해 테스트 결과 보고를 지연시키지는 않습니다.

다음 예제에서, 테스트는 두 개의 `setImmediate()` 작업이 아직 완료되지 않은 상태에서 끝납니다. 첫 번째 `setImmediate()`는 새로운 하위 테스트를 생성하려고 시도합니다. 부모 테스트가 이미 완료되고 결과를 출력했기 때문에, 새로운 하위 테스트는 즉시 실패로 표시되고 나중에 [`<TestsStream>`](https://nodejs.org/docs/latest/api/test.html#class-testsstream)에 보고됩니다.

두 번째 `setImmediate()`는 `uncaughtException` 이벤트를 생성합니다. 완료된 테스트에서 발생한 `uncaughtException` 및 `unhandledRejection` 이벤트는 `test` 모듈에 의해 실패로 표시되고, [`<TestsStream>`](https://nodejs.org/docs/latest/api/test.html#class-testsstream)에 의해 최상위 수준에서 진단 경고로 보고됩니다.

```js
test('비동기 작업을 생성하는 테스트', (t) => {
    setImmediate(() => {
        t.test('너무 늦게 생성된 하위 테스트', (t) => {
            throw new Error('error1');
        });
    });
    setImmediate(() => {
        throw new Error('error2');
    });
    // 이 줄 이후에 테스트가 종료됩니다.
});
```


### Watch 모드[#](https://nodejs.org/docs/latest/api/test.html#watch-mode)

추가된 버전: v19.2.0, v18.13.0

Node.js 테스트 러너는 `--watch` 플래그를 사용하여 Watch 모드로 실행할 수 있습니다:

```bash
node --test --watch
```

Watch 모드에서 테스트 러너는 테스트 파일과 그 의존성 파일의 변경 사항을 감시합니다. 변경이 감지되면, 테스트 러너는 해당 변경 사항에 영향을 받는 테스트를 다시 실행합니다. 테스트 러너는 프로세스가 종료될 때까지 계속 실행됩니다.


### 커맨드라인에서 테스트 실행하기

Node.js 테스트 러너는 [`--test`](https://nodejs.org/docs/latest/api/cli.html#--test) 플래그를 사용해 커맨드라인에서 실행할 수 있습니다.

```bash
node --test
```

기본적으로 Node.js는 다음 패턴에 일치하는 모든 파일을 실행합니다:

-   `**/*.test.{cjs,mjs,js}`
-   `**/*-test.{cjs,mjs,js}`
-   `**/*_test.{cjs,mjs,js}`
-   `**/test-*.{cjs,mjs,js}`
-   `**/test.{cjs,mjs,js}`
-   `**/test/**/*.{cjs,mjs,js}`

[`--experimental-strip-types`](https://nodejs.org/docs/latest/api/cli.html#--experimental-strip-types) 옵션이 제공되면, 다음 추가 패턴도 일치합니다:

-   `**/*.test.{cts,mts,ts}`
-   `**/*-test.{cts,mts,ts}`
-   `**/*_test.{cts,mts,ts}`
-   `**/test-*.{cts,mts,ts}`
-   `**/test.{cts,mts,ts}`
-   `**/test/**/*.{cts,mts,ts}`

또는, Node.js 커맨드의 마지막 인자로 하나 이상의 glob 패턴을 제공할 수 있습니다. 아래 예제를 참고하세요. glob 패턴은 [`glob(7)`](https://man7.org/linux/man-pages/man7/glob.7.html)의 동작을 따릅니다. 시스템 간 이식성을 높이기 위해, glob 패턴은 셸 확장을 방지하기 위해 커맨드라인에서 큰따옴표로 감싸는 것이 좋습니다.

```bash
node --test "**/*.test.js" "**/*.spec.js"
```

일치하는 파일은 테스트 파일로 실행됩니다. 테스트 파일 실행에 대한 자세한 내용은 [테스트 러너 실행 모델](https://nodejs.org/docs/latest/api/test.html#test-runner-execution-model) 섹션에서 확인할 수 있습니다.


#### 테스트 실행기 실행 모델

프로세스 수준의 테스트 격리가 활성화된 경우, 각각의 매칭되는 테스트 파일은 별도의 자식 프로세스에서 실행됩니다. 동시에 실행되는 자식 프로세스의 최대 수는 [`--test-concurrency`](https://nodejs.org/docs/latest/api/cli.html#--test-concurrency) 플래그로 제어됩니다. 자식 프로세스가 종료 코드 0으로 종료되면 테스트는 통과한 것으로 간주됩니다. 그렇지 않으면 테스트는 실패한 것으로 간주됩니다. 테스트 파일은 Node.js에서 실행 가능해야 하지만, 내부적으로 `node:test` 모듈을 사용할 필요는 없습니다.

각 테스트 파일은 일반 스크립트처럼 실행됩니다. 즉, 테스트 파일 자체가 `node:test`를 사용하여 테스트를 정의하는 경우, [`test()`](https://nodejs.org/docs/latest/api/test.html#testname-options-fn)의 `concurrency` 옵션 값과 관계없이 모든 테스트는 단일 애플리케이션 스레드 내에서 실행됩니다.

프로세스 수준의 테스트 격리가 비활성화된 경우, 각 매칭되는 테스트 파일은 테스트 실행기 프로세스로 임포트됩니다. 모든 테스트 파일이 로드되면, 최상위 테스트는 동시성 1로 실행됩니다. 테스트 파일이 모두 동일한 컨텍스트 내에서 실행되기 때문에, 테스트가 서로 상호작용할 가능성이 있습니다. 예를 들어, 테스트가 전역 상태에 의존하는 경우, 다른 파일에서 시작된 테스트에 의해 해당 상태가 수정될 수 있습니다.


### 코드 커버리지 수집하기

Node.js를 [`--experimental-test-coverage`](https://nodejs.org/docs/latest/api/cli.html#--experimental-test-coverage) 커맨드라인 플래그와 함께 실행하면, 모든 테스트가 완료된 후 코드 커버리지가 수집되고 통계가 보고됩니다. [`NODE_V8_COVERAGE`](https://nodejs.org/docs/latest/api/cli.html#node_v8_coveragedir) 환경 변수를 사용해 코드 커버리지 디렉토리를 지정하면, 생성된 V8 커버리지 파일이 해당 디렉토리에 저장됩니다. 기본적으로 Node.js 코어 모듈과 `node_modules/` 디렉토리 내의 파일은 커버리지 보고서에 포함되지 않습니다. 하지만 [`--test-coverage-include`](https://nodejs.org/docs/latest/api/cli.html#--test-coverage-include) 플래그를 사용해 명시적으로 포함시킬 수 있습니다. 기본적으로 모든 테스트 파일은 커버리지 보고서에서 제외됩니다. [`--test-coverage-exclude`](https://nodejs.org/docs/latest/api/cli.html#--test-coverage-exclude) 플래그를 사용해 제외 사항을 재정의할 수 있습니다. 커버리지가 활성화되면, 커버리지 보고서는 `'test:coverage'` 이벤트를 통해 모든 [테스트 리포터](https://nodejs.org/docs/latest/api/test.html#test-reporters)로 전송됩니다.

다음 주석 구문을 사용해 특정 라인의 커버리지를 비활성화할 수 있습니다:

```js
/* node:coverage disable */ 
if (anAlwaysFalseCondition) { 
    // 이 분기 내의 코드는 실행되지 않지만, 커버리지 목적으로는 무시됩니다.
    // 'disable' 주석 이후의 모든 라인은 'enable' 주석이 나올 때까지 무시됩니다.
    console.log('this is never executed'); 
} 
/* node:coverage enable */
```

또한 지정된 수의 라인에 대해 커버리지를 비활성화할 수도 있습니다. 지정된 수의 라인이 지나면 커버리지가 자동으로 다시 활성화됩니다. 라인 수가 명시적으로 제공되지 않으면, 단일 라인이 무시됩니다.

```js
/* node:coverage ignore next */ 
if (anAlwaysFalseCondition) { 
    console.log('this is never executed'); 
} 

/* node:coverage ignore next 3 */ 
if (anAlwaysFalseCondition) { 
    console.log('this is never executed'); 
}
```


#### 커버리지 리포트 도구

tap과 spec 리포트 도구는 커버리지 통계 요약을 출력합니다. 또한 lcov 리포트 도구도 있는데, 이 도구는 lcov 파일을 생성하여 상세한 커버리지 리포트로 사용할 수 있습니다.

```bash
node --test --experimental-test-coverage --test-reporter=lcov --test-reporter-destination=lcov.info
```

- 이 리포트 도구는 테스트 결과를 출력하지 않습니다.
- 이 리포트 도구는 다른 리포트 도구와 함께 사용하는 것이 이상적입니다.


### Mocking[#](https://nodejs.org/docs/latest/api/test.html#mocking)

`node:test` 모듈은 테스트 중에 모킹(mocking)을 지원하며, 이를 위해 최상위 `mock` 객체를 제공합니다. 다음 예제는 두 숫자를 더하는 함수에 스파이(spy)를 생성합니다. 이 스파이는 함수가 예상대로 호출되었는지 확인하는 데 사용됩니다.

```js
import assert from 'node:assert';
import { mock, test } from 'node:test';

test('spies on a function', () => {
    const sum = mock.fn((a, b) => {
        return a + b;
    });

    assert.strictEqual(sum.mock.callCount(), 0);
    assert.strictEqual(sum(3, 4), 7);
    assert.strictEqual(sum.mock.callCount(), 1);

    const call = sum.mock.calls[0];
    assert.deepStrictEqual(call.arguments, [3, 4]);
    assert.strictEqual(call.result, 7);
    assert.strictEqual(call.error, undefined);

    // 전역적으로 추적된 모킹을 초기화합니다.
    mock.reset();
});
```

동일한 모킹 기능은 각 테스트의 [`TestContext`](https://nodejs.org/docs/latest/api/test.html#class-testcontext) 객체에서도 제공됩니다. 다음 예제는 `TestContext`에서 제공하는 API를 사용해 객체 메서드에 스파이를 생성합니다. 테스트 컨텍스트를 통해 모킹을 사용하면 테스트가 끝나면 테스트 실행기가 자동으로 모든 모킹된 기능을 복원합니다.

```js
test('spies on an object method', (t) => {
    const number = {
        value: 5,
        add(a) {
            return this.value + a;
        },
    };

    t.mock.method(number, 'add');
    assert.strictEqual(number.add.mock.callCount(), 0);
    assert.strictEqual(number.add(3), 8);
    assert.strictEqual(number.add.mock.callCount(), 1);

    const call = number.add.mock.calls[0];
    assert.deepStrictEqual(call.arguments, [3]);
    assert.strictEqual(call.result, 8);
    assert.strictEqual(call.target, undefined);
    assert.strictEqual(call.this, number);
});
```


#### 타이머[#](https://nodejs.org/docs/latest/api/test.html#timers)

타이머 모킹(mocking)은 소프트웨어 테스트에서 자주 사용되는 기법입니다. 이 기법은 `setInterval`이나 `setTimeout`과 같은 타이머의 동작을 실제로 지정된 시간을 기다리지 않고 시뮬레이션하고 제어할 수 있게 해줍니다.

전체 메서드와 기능 목록은 [`MockTimers`](https://nodejs.org/docs/latest/api/test.html#class-mocktimers) 클래스를 참고하세요.

이를 통해 개발자는 시간에 의존하는 기능에 대해 더 신뢰할 수 있고 예측 가능한 테스트를 작성할 수 있습니다.

아래 예제는 `setTimeout`을 모킹하는 방법을 보여줍니다. `.enable({ apis: ['setTimeout'] });`를 사용하면 [node:timers](https://nodejs.org/docs/latest/api/timers.html)와 [node:timers/promises](https://nodejs.org/docs/latest/api/timers.html#timers-promises-api) 모듈, 그리고 Node.js 전역 컨텍스트에서의 `setTimeout` 함수를 모킹할 수 있습니다.

**참고:** `import { setTimeout } from 'node:timers'`와 같은 구조 분해 할당 방식의 함수는 현재 이 API에서 지원되지 않습니다.

```js
import assert from 'node:assert';
import { mock, test } from 'node:test';

test('mocks setTimeout to be executed synchronously without having to actually wait for it', () => {
    const fn = mock.fn();
    // 모킹할 대상을 선택적으로 지정
    mock.timers.enable({ apis: ['setTimeout'] });
    setTimeout(fn, 9999);
    assert.strictEqual(fn.mock.callCount(), 0);
    // 시간을 앞당김
    mock.timers.tick(9999);
    assert.strictEqual(fn.mock.callCount(), 1);
    // 전역적으로 추적된 모킹을 초기화
    mock.timers.reset();
    // 모크 인스턴스를 초기화하면 타이머 인스턴스도 초기화됨
    mock.reset();
});
```

동일한 모킹 기능은 각 테스트의 [`TestContext`](https://nodejs.org/docs/latest/api/test.html#class-testcontext) 객체의 `mock` 속성에서도 사용할 수 있습니다. 테스트 컨텍스트를 통해 모킹하는 장점은 테스트가 끝나면 테스트 러너가 자동으로 모든 모킹된 타이머 기능을 복원한다는 점입니다.

```js
import assert from 'node:assert';
import { test } from 'node:test';

test('mocks setTimeout to be executed synchronously without having to actually wait for it', (context) => {
    const fn = context.mock.fn();
    // 모킹할 대상을 선택적으로 지정
    context.mock.timers.enable({ apis: ['setTimeout'] });
    setTimeout(fn, 9999);
    assert.strictEqual(fn.mock.callCount(), 0);
    // 시간을 앞당김
    context.mock.timers.tick(9999);
    assert.strictEqual(fn.mock.callCount(), 1);
});
```


#### Dates

모의 타이머 API는 `Date` 객체를 모의로 사용할 수 있게 해줍니다. 이 기능은 시간에 의존하는 기능을 테스트하거나 `Date.now()`와 같은 내부 캘린더 함수를 시뮬레이션할 때 유용합니다.

`Date` 구현은 [`MockTimers`](https://nodejs.org/docs/latest/api/test.html#class-mocktimers) 클래스의 일부입니다. 전체 메서드와 기능 목록은 해당 클래스를 참조하세요.

**참고:** `Date`와 타이머를 함께 모의로 사용할 경우 서로 의존적입니다. 즉, `Date`와 `setTimeout`을 모두 모의로 설정하면 시간을 진행할 때 모의 날짜도 함께 진행됩니다. 이는 단일 내부 시계를 시뮬레이션하기 때문입니다.

아래 예제는 `Date` 객체를 모의로 설정하고 현재 `Date.now()` 값을 얻는 방법을 보여줍니다.

```js
import assert from 'node:assert';
import { test } from 'node:test';

test('mocks the Date object', (context) => {
    // 모의로 설정할 항목 선택 (선택 사항)
    context.mock.timers.enable({ apis: ['Date'] });

    // 초기 날짜는 UNIX epoch 기준 0으로 설정됨
    assert.strictEqual(Date.now(), 0);

    // 시간을 진행하면 날짜도 함께 진행됨
    context.mock.timers.tick(9999);
    assert.strictEqual(Date.now(), 9999);
});
```

초기 epoch를 설정하지 않으면 초기 날짜는 UNIX epoch 기준 0으로 설정됩니다. 이는 1970년 1월 1일 00:00:00 UTC를 의미합니다. `.enable()` 메서드에 `now` 속성을 전달하여 초기 날짜를 설정할 수 있습니다. 이 값은 모의 `Date` 객체의 초기 날짜로 사용되며, 양의 정수나 다른 `Date` 객체를 사용할 수 있습니다.

```js
import assert from 'node:assert';
import { test } from 'node:test';

test('mocks the Date object with initial time', (context) => {
    // 모의로 설정할 항목 선택 (선택 사항)
    context.mock.timers.enable({ apis: ['Date'], now: 100 });

    assert.strictEqual(Date.now(), 100);

    // 시간을 진행하면 날짜도 함께 진행됨
    context.mock.timers.tick(200);
    assert.strictEqual(Date.now(), 300);
});
```

`.setTime()` 메서드를 사용하여 모의 날짜를 다른 시간으로 수동으로 이동할 수 있습니다. 이 메서드는 양의 정수만 허용합니다.

**참고:** 이 메서드는 새로운 시간 기준으로 과거에 설정된 모의 타이머를 실행합니다.

아래 예제에서는 모의 날짜의 시간을 새로 설정합니다.

```js
import assert from 'node:assert';
import { test } from 'node:test';

test('sets the time of a date object', (context) => {
    // 모의로 설정할 항목 선택 (선택 사항)
    context.mock.timers.enable({ apis: ['Date'], now: 100 });

    assert.strictEqual(Date.now(), 100);

    // 시간을 진행하면 날짜도 함께 진행됨
    context.mock.timers.setTime(1000);
    context.mock.timers.tick(200);
    assert.strictEqual(Date.now(), 1200);
});
```

과거에 실행되도록 설정된 타이머가 있다면, `.tick()` 메서드가 호출된 것처럼 실행됩니다. 이는 이미 과거인 시간에 의존하는 기능을 테스트할 때 유용합니다.

```js
import assert from 'node:assert';
import { test } from 'node:test';

test('runs timers as setTime passes ticks', (context) => {
    // 모의로 설정할 항목 선택 (선택 사항)
    context.mock.timers.enable({ apis: ['setTimeout', 'Date'] });

    const fn = context.mock.fn();
    setTimeout(fn, 1000);

    context.mock.timers.setTime(800);
    // 시간이 도달하지 않아 타이머가 실행되지 않음
    assert.strictEqual(fn.mock.callCount(), 0);
    assert.strictEqual(Date.now(), 800);

    context.mock.timers.setTime(1200);
    // 시간이 도달하여 타이머가 실행됨
    assert.strictEqual(fn.mock.callCount(), 1);
    assert.strictEqual(Date.now(), 1200);
});
```

`.runAll()`을 사용하면 현재 큐에 있는 모든 타이머를 실행합니다. 이는 마지막 타이머가 실행된 시간까지 모의 날짜를 진행시킵니다.

```js
import assert from 'node:assert';
import { test } from 'node:test';

test('runs timers as setTime passes ticks', (context) => {
    // 모의로 설정할 항목 선택 (선택 사항)
    context.mock.timers.enable({ apis: ['setTimeout', 'Date'] });

    const fn = context.mock.fn();
    setTimeout(fn, 1000);
    setTimeout(fn, 2000);
    setTimeout(fn, 3000);

    context.mock.timers.runAll();
    // 모든 타이머가 실행됨
    assert.strictEqual(fn.mock.callCount(), 3);
    assert.strictEqual(Date.now(), 3000);
});
```


### 스냅샷 테스트

스냅샷 테스트는 임의의 값을 문자열로 직렬화하여 알려진 정상 값과 비교하는 방법입니다. 이 알려진 정상 값을 스냅샷이라고 하며, 스냅샷 파일에 저장됩니다. 스냅샷 파일은 테스트 러너가 관리하지만, 디버깅을 돕기 위해 사람이 읽을 수 있도록 설계되었습니다. 스냅샷 파일은 테스트 파일과 함께 소스 컨트롤에 체크인하는 것이 좋습니다.

스냅샷 파일은 Node.js를 [`--test-update-snapshots`](https://nodejs.org/docs/latest/api/cli.html#--test-update-snapshots) 커맨드라인 플래그와 함께 실행하여 생성됩니다. 각 테스트 파일마다 별도의 스냅샷 파일이 생성됩니다. 기본적으로 스냅샷 파일은 테스트 파일과 같은 이름에 `.snapshot` 확장자를 가집니다. 이 동작은 `snapshot.setResolveSnapshotPath()` 함수를 사용하여 설정할 수 있습니다. 각 스냅샷 어설션은 스냅샷 파일의 export에 해당합니다.

아래는 스냅샷 테스트 예제입니다. 이 테스트를 처음 실행하면 해당 스냅샷 파일이 없기 때문에 실패합니다.

```js
// test.js
suite('스냅샷 테스트 모음', () => {
  test('스냅샷 테스트', (t) => {
    t.assert.snapshot({ value1: 1, value2: 2 });
    t.assert.snapshot(5);
  });
});
```

`--test-update-snapshots` 플래그와 함께 테스트 파일을 실행하여 스냅샷 파일을 생성합니다. 테스트는 통과하고, 테스트 파일과 같은 디렉토리에 `test.js.snapshot` 파일이 생성됩니다. 스냅샷 파일의 내용은 아래와 같습니다. 각 스냅샷은 테스트의 전체 이름과 동일한 테스트 내에서 스냅샷을 구분하기 위한 카운터로 식별됩니다.

```js
exports[`스냅샷 테스트 모음 > 스냅샷 테스트 1`] = ` { "value1": 1, "value2": 2 } `;
exports[`스냅샷 테스트 모음 > 스냅샷 테스트 2`] = ` 5 `;
```

스냅샷 파일이 생성된 후, `--test-update-snapshots` 플래그 없이 테스트를 다시 실행합니다. 이제 테스트는 통과해야 합니다.


### 테스트 리포터[#](https://nodejs.org/docs/latest/api/test.html#test-reporters)

`node:test` 모듈은 테스트 실행기가 특정 리포터를 사용하도록 [`--test-reporter`](https://nodejs.org/docs/latest/api/cli.html#--test-reporter) 플래그를 전달하는 것을 지원합니다.

다음과 같은 내장 리포터들이 제공됩니다:

-   `spec`: `spec` 리포터는 테스트 결과를 사람이 읽기 쉬운 형식으로 출력합니다. 이는 기본 리포터입니다.
    
-   `tap`: `tap` 리포터는 테스트 결과를 [TAP](https://testanything.org/) 형식으로 출력합니다.
    
-   `dot`: `dot` 리포터는 테스트 결과를 간결한 형식으로 출력합니다. 각 통과한 테스트는 `.`로, 실패한 테스트는 `X`로 표시됩니다.
    
-   `junit`: `junit` 리포터는 테스트 결과를 jUnit XML 형식으로 출력합니다.
    
-   `lcov`: `lcov` 리포터는 [`--experimental-test-coverage`](https://nodejs.org/docs/latest/api/cli.html#--experimental-test-coverage) 플래그와 함께 사용될 때 테스트 커버리지를 출력합니다.

이 리포터들의 정확한 출력은 Node.js 버전 간에 변경될 수 있으며, 프로그래밍적으로 의존해서는 안 됩니다. 테스트 실행기의 출력에 프로그래밍적으로 접근해야 한다면, [`<TestsStream>`](https://nodejs.org/docs/latest/api/test.html#class-testsstream)에서 발생하는 이벤트를 사용하세요.

이 리포터들은 `node:test/reporters` 모듈을 통해 사용할 수 있습니다:

```js
import { tap, spec, dot, junit, lcov } from 'node:test/reporters';
```


#### 커스텀 리포터

[`--test-reporter`](https://nodejs.org/docs/latest/api/cli.html#--test-reporter)를 사용하여 커스텀 리포터의 경로를 지정할 수 있습니다. 커스텀 리포터는 [stream.compose](https://nodejs.org/docs/latest/api/stream.html#streamcomposestreams)에서 허용하는 값을 내보내는 모듈입니다. 리포터는 [`<TestsStream>`](https://nodejs.org/docs/latest/api/test.html#class-testsstream)에서 발생한 이벤트를 변환해야 합니다.

[`<stream.Transform>`](https://nodejs.org/docs/latest/api/stream.html#class-streamtransform)를 사용한 커스텀 리포터 예제:

```js
import { Transform } from 'node:stream';

const customReporter = new Transform({
    writableObjectMode: true,
    transform(event, encoding, callback) {
        switch (event.type) {
            case 'test:dequeue':
                callback(null, `test ${event.data.name} dequeued`);
                break;
            case 'test:enqueue':
                callback(null, `test ${event.data.name} enqueued`);
                break;
            case 'test:watch:drained':
                callback(null, 'test watch queue drained');
                break;
            case 'test:start':
                callback(null, `test ${event.data.name} started`);
                break;
            case 'test:pass':
                callback(null, `test ${event.data.name} passed`);
                break;
            case 'test:fail':
                callback(null, `test ${event.data.name} failed`);
                break;
            case 'test:plan':
                callback(null, 'test plan');
                break;
            case 'test:diagnostic':
            case 'test:stderr':
            case 'test:stdout':
                callback(null, event.data.message);
                break;
            case 'test:coverage': {
                const { totalLineCount } = event.data.summary.totals;
                callback(null, `total line count: ${totalLineCount}\n`);
                break;
            }
        }
    },
});

export default customReporter;
```

제너레이터 함수를 사용한 커스텀 리포터 예제:

```js
export default async function* customReporter(source) {
    for await (const event of source) {
        switch (event.type) {
            case 'test:dequeue':
                yield `test ${event.data.name} dequeued\n`;
                break;
            case 'test:enqueue':
                yield `test ${event.data.name} enqueued\n`;
                break;
            case 'test:watch:drained':
                yield 'test watch queue drained\n';
                break;
            case 'test:start':
                yield `test ${event.data.name} started\n`;
                break;
            case 'test:pass':
                yield `test ${event.data.name} passed\n`;
                break;
            case 'test:fail':
                yield `test ${event.data.name} failed\n`;
                break;
            case 'test:plan':
                yield 'test plan\n';
                break;
            case 'test:diagnostic':
            case 'test:stderr':
            case 'test:stdout':
                yield `${event.data.message}\n`;
                break;
            case 'test:coverage': {
                const { totalLineCount } = event.data.summary.totals;
                yield `total line count: ${totalLineCount}\n`;
                break;
            }
        }
    }
}
```

`--test-reporter`에 제공되는 값은 JavaScript 코드에서 `import()`에 사용되는 문자열과 같은 형식이어야 하거나, [`--import`](https://nodejs.org/docs/latest/api/cli.html#--importmodule)에 제공되는 값이어야 합니다.


#### 여러 개의 리포트 사용하기

[`--test-reporter`](https://nodejs.org/docs/latest/api/cli.html#--test-reporter) 플래그를 여러 번 지정하면 테스트 결과를 다양한 형식으로 출력할 수 있습니다. 이 경우, 각 리포터에 대해 [`--test-reporter-destination`](https://nodejs.org/docs/latest/api/cli.html#--test-reporter-destination)을 사용하여 출력 대상을 지정해야 합니다. 출력 대상은 `stdout`, `stderr`, 또는 파일 경로가 될 수 있습니다. 리포터와 출력 대상은 지정된 순서대로 짝을 이룹니다.

다음 예제에서는 `spec` 리포터가 `stdout`으로 출력하고, `dot` 리포터가 `file.txt` 파일로 출력합니다:

```bash
node --test-reporter=spec --test-reporter=dot --test-reporter-destination=stdout --test-reporter-destination=file.txt
```

단일 리포터를 지정할 때는, 출력 대상을 명시적으로 제공하지 않으면 기본적으로 `stdout`으로 출력됩니다.


### `run([options])`

- `options` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object) 테스트 실행을 위한 설정 옵션입니다. 다음 속성을 지원합니다:
    - `concurrency` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) | [`<boolean>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type) 숫자를 제공하면, 해당 숫자만큼의 테스트 프로세스가 병렬로 실행됩니다. 각 프로세스는 하나의 테스트 파일에 대응합니다. `true`로 설정하면 `os.availableParallelism() - 1`개의 테스트 파일이 병렬로 실행됩니다. `false`로 설정하면 한 번에 하나의 테스트 파일만 실행됩니다. **기본값:** `false`.
    - `cwd`: [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) 테스트 실행기가 사용할 현재 작업 디렉토리를 지정합니다. [테스트 실행기 실행 모델](https://nodejs.org/docs/latest/api/test.html#test-runner-execution-model)에 따라 파일을 해석할 때 기준 경로로 사용됩니다. **기본값:** `process.cwd()`.
    - `files`: [`<Array>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array) 실행할 파일 목록을 포함하는 배열입니다. **기본값:** [테스트 실행기 실행 모델](https://nodejs.org/docs/latest/api/test.html#test-runner-execution-model)에서 일치하는 파일.
    - `forceExit`: [`<boolean>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type) 테스트 실행기가 모든 테스트 실행을 완료한 후 이벤트 루프가 활성 상태로 남아 있어도 프로세스를 종료하도록 설정합니다. **기본값:** `false`.
    - `globPatterns`: [`<Array>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array) 테스트 파일과 일치할 glob 패턴 목록을 포함하는 배열입니다. 이 옵션은 `files`와 함께 사용할 수 없습니다. **기본값:** [테스트 실행기 실행 모델](https://nodejs.org/docs/latest/api/test.html#test-runner-execution-model)에서 일치하는 파일.
    - `inspectPort` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) | [`<Function>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function) 테스트 자식 프로세스의 inspector 포트를 설정합니다. 숫자나 인수를 받지 않고 숫자를 반환하는 함수로 설정할 수 있습니다. nullish 값을 제공하면 각 프로세스는 기본 `process.debugPort`에서 증가하는 고유한 포트를 가집니다. `isolation` 옵션이 `'none'`으로 설정된 경우 이 옵션은 무시됩니다. **기본값:** `undefined`.
    - `isolation` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) 테스트 격리 타입을 설정합니다. `'process'`로 설정하면 각 테스트 파일이 별도의 자식 프로세스에서 실행됩니다. `'none'`으로 설정하면 모든 테스트 파일이 현재 프로세스에서 실행됩니다. **기본값:** `'process'`.
    - `only`: [`<boolean>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type) truthy 값으로 설정하면, `only` 옵션이 설정된 테스트만 실행됩니다.
    - `setup` [`<Function>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function) `TestsStream` 인스턴스를 받아 테스트 실행 전 리스너를 설정할 수 있는 함수입니다. **기본값:** `undefined`.
    - `execArgv` [`<Array>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array) 자식 프로세스를 생성할 때 `node` 실행 파일에 전달할 CLI 플래그 배열입니다. `isolation`이 `'none'`인 경우 이 옵션은 효과가 없습니다. **기본값:** `[]`
    - `argv` [`<Array>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array) 자식 프로세스를 생성할 때 각 테스트 파일에 전달할 CLI 플래그 배열입니다. `isolation`이 `'none'`인 경우 이 옵션은 효과가 없습니다. **기본값:** `[]`.
    - `signal` [`<AbortSignal>`](https://nodejs.org/docs/latest/api/globals.html#class-abortsignal) 진행 중인 테스트 실행을 중단할 수 있습니다.
    - `testNamePatterns` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) | [`<RegExp>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp) | [`<Array>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array) 테스트 이름이 제공된 패턴과 일치하는 테스트만 실행합니다. 테스트 이름 패턴은 JavaScript 정규 표현식으로 해석됩니다. 실행되는 각 테스트에 대해 `beforeEach()`와 같은 해당 테스트 훅도 실행됩니다. **기본값:** `undefined`.
    - `testSkipPatterns` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) | [`<RegExp>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp) | [`<Array>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array) 테스트 이름이 제공된 패턴과 일치하는 테스트를 제외합니다. 테스트 이름 패턴은 JavaScript 정규 표현식으로 해석됩니다. 실행되는 각 테스트에 대해 `beforeEach()`와 같은 해당 테스트 훅도 실행됩니다. **기본값:** `undefined`.
    - `timeout` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 테스트 실행이 실패할 밀리초 단위 시간입니다. 지정되지 않으면 하위 테스트는 부모 테스트에서 이 값을 상속받습니다. **기본값:** `Infinity`.
    - `watch` [`<boolean>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type) watch 모드로 실행할지 여부를 설정합니다. **기본값:** `false`.
    - `shard` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object) 특정 샤드에서 테스트를 실행합니다. **기본값:** `undefined`.
        - `index` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 실행할 샤드의 인덱스를 지정하는 1부터 `<total>` 사이의 양의 정수입니다. 이 옵션은 *필수*입니다.
        - `total` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 테스트 파일을 분할할 총 샤드 수를 지정하는 양의 정수입니다. 이 옵션은 *필수*입니다.
    - `coverage` [`<boolean>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type) [코드 커버리지](https://nodejs.org/docs/latest/api/test.html#collecting-code-coverage) 수집을 활성화합니다. **기본값:** `false`.
    - `coverageExcludeGlobs` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) | [`<Array>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array) 코드 커버리지에서 제외할 파일을 glob 패턴으로 지정합니다. 절대 경로와 상대 경로 모두 일치할 수 있습니다. 이 속성은 `coverage`가 `true`로 설정된 경우에만 적용됩니다. `coverageExcludeGlobs`와 `coverageIncludeGlobs`가 모두 제공되면 파일은 **두 조건**을 모두 만족해야 커버리지 보고서에 포함됩니다. **기본값:** `undefined`.
    - `coverageIncludeGlobs` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) | [`<Array>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array) 코드 커버리지에 포함할 파일을 glob 패턴으로 지정합니다. 절대 경로와 상대 경로 모두 일치할 수 있습니다. 이 속성은 `coverage`가 `true`로 설정된 경우에만 적용됩니다. `coverageExcludeGlobs`와 `coverageIncludeGlobs`가 모두 제공되면 파일은 **두 조건**을 모두 만족해야 커버리지 보고서에 포함됩니다. **기본값:** `undefined`.
    - `lineCoverage` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 커버리지 라인의 최소 백분율을 요구합니다. 코드 커버리지가 지정된 임계값에 도달하지 않으면 프로세스는 코드 `1`로 종료됩니다. **기본값:** `0`.
    - `branchCoverage` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 커버리지 브랜치의 최소 백분율을 요구합니다. 코드 커버리지가 지정된 임계값에 도달하지 않으면 프로세스는 코드 `1`로 종료됩니다. **기본값:** `0`.
    - `functionCoverage` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 커버리지 함수의 최소 백분율을 요구합니다. 코드 커버리지가 지정된 임계값에 도달하지 않으면 프로세스는 코드 `1`로 종료됩니다. **기본값:** `0`.
- 반환값: [`<TestsStream>`](https://nodejs.org/docs/latest/api/test.html#class-testsstream)

**참고:** `shard`는 테스트 실행을 여러 머신이나 프로세스에 걸쳐 수평적으로 병렬화하는 데 사용됩니다. 다양한 환경에서 대규모 실행에 이상적입니다. `watch` 모드와 호환되지 않으며, 파일 변경 시 자동으로 테스트를 다시 실행하여 빠른 코드 반복을 위해 설계되었습니다.

```js
import { tap } from 'node:test/reporters';
import { run } from 'node:test';
import process from 'node:process';
import path from 'node:path';

run({ files: [path.resolve('./tests/test.js')] })
    .on('test:fail', () => {
        process.exitCode = 1;
    })
    .compose(tap)
    .pipe(process.stdout);
```


### `suite([name][, options][, fn])`[#](https://nodejs.org/docs/latest/api/test.html#suitename-options-fn)

추가된 버전: v22.0.0, v20.13.0

-   `name` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type)  
    테스트 결과를 보고할 때 표시되는 스위트의 이름. **기본값:** `fn`의 `name` 속성 또는 `fn`에 이름이 없는 경우 `'<anonymous>'`.

-   `options` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)  
    스위트에 대한 선택적 설정 옵션. 이 옵션은 `test([name][, options][, fn])`과 동일한 옵션을 지원합니다.

-   `fn` [`<Function>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function) | [`<AsyncFunction>`](https://tc39.es/ecma262/#sec-async-function-constructor)  
    중첩된 테스트와 스위트를 선언하는 스위트 함수. 이 함수의 첫 번째 인자는 [`SuiteContext`](https://nodejs.org/docs/latest/api/test.html#class-suitecontext) 객체입니다. **기본값:** 아무 작업도 하지 않는 함수.

-   반환값: [`<Promise>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)  
    즉시 `undefined`로 이행됩니다.

`suite()` 함수는 `node:test` 모듈에서 가져옵니다.


### `suite.skip([name][, options][, fn])`[#](https://nodejs.org/docs/latest/api/test.html#suiteskipname-options-fn)

추가된 버전: v22.0.0, v20.13.0

테스트 스위트를 건너뛰는 간단한 방법입니다. 이는 [`suite([name], { skip: true }[, fn])`](https://nodejs.org/docs/latest/api/test.html#suitename-options-fn)과 동일한 기능을 제공합니다.


### `suite.todo([name][, options][, fn])`[#](https://nodejs.org/docs/latest/api/test.html#suitetodoname-options-fn)

추가된 버전: v22.0.0, v20.13.0

이 메서드는 테스트 스위트를 `TODO`로 표시하는 간편한 방법입니다. 이는 [`suite([name], { todo: true }[, fn])`](https://nodejs.org/docs/latest/api/test.html#suitename-options-fn)과 동일한 기능을 제공합니다.


### `suite.only([name][, options][, fn])`[#](https://nodejs.org/docs/latest/api/test.html#suiteonlyname-options-fn)

추가된 버전: v22.0.0, v20.13.0

이 메서드는 특정 테스트 스위트를 `only`로 표시하는 간단한 방법입니다. 이는 [`suite([name], { only: true }[, fn])`](https://nodejs.org/docs/latest/api/test.html#suitename-options-fn)과 동일한 기능을 수행합니다.


### `test([name][, options][, fn])`

- `name` [`<string>`] 테스트의 이름으로, 테스트 결과를 보고할 때 표시됩니다. **기본값:** `fn`의 `name` 속성 또는 `fn`에 이름이 없는 경우 `'<anonymous>'`.
- `options` [`<Object>`] 테스트를 위한 설정 옵션입니다. 다음 속성을 지원합니다:
    - `concurrency` [`<number>`] | [`<boolean>`] 숫자를 제공하면, 해당 숫자만큼의 테스트가 애플리케이션 스레드 내에서 병렬로 실행됩니다. `true`인 경우, 예약된 모든 비동기 테스트가 스레드 내에서 동시에 실행됩니다. `false`인 경우, 한 번에 하나의 테스트만 실행됩니다. 지정하지 않으면, 하위 테스트는 부모 테스트로부터 이 값을 상속받습니다. **기본값:** `false`.
    - `only` [`<boolean>`] 참 값이고, 테스트 컨텍스트가 `only` 테스트를 실행하도록 설정된 경우, 이 테스트가 실행됩니다. 그렇지 않으면 테스트가 건너뜁니다. **기본값:** `false`.
    - `signal` [`<AbortSignal>`] 진행 중인 테스트를 중단할 수 있습니다.
    - `skip` [`<boolean>`] | [`<string>`] 참 값인 경우, 테스트가 건너뜁니다. 문자열을 제공하면, 테스트 결과에 이 문자열이 테스트를 건너뛴 이유로 표시됩니다. **기본값:** `false`.
    - `todo` [`<boolean>`] | [`<string>`] 참 값인 경우, 테스트가 `TODO`로 표시됩니다. 문자열을 제공하면, 테스트 결과에 이 문자열이 테스트가 `TODO`인 이유로 표시됩니다. **기본값:** `false`.
    - `timeout` [`<number>`] 테스트가 이 시간(밀리초)을 초과하면 실패합니다. 지정하지 않으면, 하위 테스트는 부모 테스트로부터 이 값을 상속받습니다. **기본값:** `Infinity`.
    - `plan` [`<number>`] 테스트에서 실행될 것으로 예상되는 어설션과 하위 테스트의 수입니다. 테스트에서 실행된 어설션 수가 이 값과 일치하지 않으면 테스트가 실패합니다. **기본값:** `undefined`.
- `fn` [`<Function>`] | [`<AsyncFunction>`] 테스트할 함수입니다. 이 함수의 첫 번째 인자는 [`TestContext`](https://nodejs.org/docs/latest/api/test.html#class-testcontext) 객체입니다. 테스트가 콜백을 사용하는 경우, 콜백 함수가 두 번째 인자로 전달됩니다. **기본값:** 아무 작업도 하지 않는 함수.
- 반환값: [`<Promise>`] 테스트가 완료되면 `undefined`로 이행됩니다. 테스트가 스위트 내에서 실행되는 경우 즉시 이행됩니다.

`test()` 함수는 `test` 모듈에서 가져온 값입니다. 이 함수를 호출할 때마다 테스트가 [`<TestsStream>`](https://nodejs.org/docs/latest/api/test.html#class-testsstream)에 보고됩니다.

`fn` 인자로 전달된 `TestContext` 객체는 현재 테스트와 관련된 작업을 수행하는 데 사용할 수 있습니다. 예를 들어, 테스트를 건너뛰거나 추가 진단 정보를 추가하거나 하위 테스트를 생성할 수 있습니다.

`test()`는 테스트가 완료되면 이행되는 `Promise`를 반환합니다. `test()`가 스위트 내에서 호출되면 즉시 이행됩니다. 최상위 테스트의 경우 반환값을 일반적으로 무시할 수 있습니다. 그러나 하위 테스트의 반환값은 부모 테스트가 먼저 완료되어 하위 테스트를 취소하지 않도록 사용해야 합니다. 다음 예제를 참고하세요.

```js
test('최상위 테스트', async (t) => {
    // 다음 하위 테스트의 setTimeout()은 'await'를 제거하면 부모 테스트보다 오래 실행됩니다.
    // 부모 테스트가 완료되면, 진행 중인 하위 테스트를 취소합니다.
    await t.test('더 오래 실행되는 하위 테스트', async (t) => {
        return new Promise((resolve, reject) => {
            setTimeout(resolve, 1000);
        });
    });
});
```

`timeout` 옵션은 테스트가 완료되는 데 `timeout` 밀리초보다 오래 걸리면 테스트를 실패하게 만듭니다. 그러나 실행 중인 테스트가 애플리케이션 스레드를 차단할 수 있으므로, 예정된 취소를 방해할 수 있어 신뢰할 수 있는 취소 메커니즘은 아닙니다.


### `test.skip([name][, options][, fn])`[#](https://nodejs.org/docs/latest/api/test.html#testskipname-options-fn)

이 메서드는 테스트를 건너뛰는 간단한 방법입니다. [`test([name], { skip: true }[, fn])`](https://nodejs.org/docs/latest/api/test.html#testname-options-fn)과 동일한 기능을 제공합니다.


### `test.todo([name][, options][, fn])`[#](https://nodejs.org/docs/latest/api/test.html#testtodoname-options-fn)

이 메서드는 테스트를 `TODO`로 표시하는 간단한 방법입니다. [`test([name], { todo: true }[, fn])`](https://nodejs.org/docs/latest/api/test.html#testname-options-fn)과 동일한 기능을 제공합니다.


### `test.only([name][, options][, fn])`[#](https://nodejs.org/docs/latest/api/test.html#testonlyname-options-fn)

`test.only`는 테스트를 `only`로 표시하는 간단한 방법입니다. 이는 [`test([name], { only: true }[, fn])`](https://nodejs.org/docs/latest/api/test.html#testname-options-fn)과 동일한 기능을 합니다.


### `describe([name][, options][, fn])`[#](https://nodejs.org/docs/latest/api/test.html#describename-options-fn)

`describe()` 함수는 [`suite()`](https://nodejs.org/docs/latest/api/test.html#suitename-options-fn)의 별칭입니다.

이 함수는 `node:test` 모듈에서 가져옵니다.


### `describe.skip([name][, options][, fn])`[#](https://nodejs.org/docs/latest/api/test.html#describeskipname-options-fn)

이 함수는 테스트 스위트를 건너뛰기 위한 간단한 방법입니다. [`describe([name], { skip: true }[, fn])`](https://nodejs.org/docs/latest/api/test.html#describename-options-fn)과 동일한 기능을 제공합니다.


### `describe.todo([name][, options][, fn])`

`describe.todo`는 테스트 스위트를 `TODO`로 표시하는 간단한 방법입니다. 이는 [`describe([name], { todo: true }[, fn])`](https://nodejs.org/docs/latest/api/test.html#describename-options-fn)과 동일한 기능을 제공합니다.

```javascript
describe.todo('이 테스트는 아직 구현되지 않았습니다', () => {
  // TODO: 테스트 구현 예정
});
```

위 예제에서 `describe.todo`를 사용하면 해당 테스트 스위트가 아직 완료되지 않았음을 명시적으로 표시할 수 있습니다. 이는 테스트 계획을 세우거나 구현 중인 기능을 추적하는 데 유용합니다.


### `describe.only([name][, options][, fn])`[#](https://nodejs.org/docs/latest/api/test.html#describeonlyname-options-fn)

추가된 버전: v19.8.0, v18.15.0

이 메서드는 테스트 스위트를 `only`로 표시하는 간단한 방법입니다. [`describe([name], { only: true }[, fn])`](https://nodejs.org/docs/latest/api/test.html#describename-options-fn)과 동일한 기능을 제공합니다.


### `it([name][, options][, fn])`[#](https://nodejs.org/docs/latest/api/test.html#itname-options-fn)

`it()` 함수는 [`test()`](https://nodejs.org/docs/latest/api/test.html#testname-options-fn)의 별칭(alias)입니다.

이 함수는 `node:test` 모듈에서 가져옵니다.


### `it.skip([name][, options][, fn])`[#](https://nodejs.org/docs/latest/api/test.html#itskipname-options-fn)

테스트를 건너뛰는 간단한 방법입니다. [`it([name], { skip: true }[, fn])`](https://nodejs.org/docs/latest/api/test.html#testname-options-fn)과 동일한 기능을 제공합니다.


### `it.todo([name][, options][, fn])`[#](https://nodejs.org/docs/latest/api/test.html#ittodoname-options-fn)

테스트를 `TODO`로 표시하는 간단한 방법입니다. [`it([name], { todo: true }[, fn])`](https://nodejs.org/docs/latest/api/test.html#testname-options-fn)과 동일한 기능을 제공합니다.


### `it.only([name][, options][, fn])`[#](https://nodejs.org/docs/latest/api/test.html#itonlyname-options-fn)

추가된 버전: v19.8.0, v18.15.0

테스트를 `only`로 표시하는 간단한 방법입니다. [`it([name], { only: true }[, fn])`](https://nodejs.org/docs/latest/api/test.html#testname-options-fn)과 동일한 기능을 제공합니다.


### `before([fn][, options])`[#](https://nodejs.org/docs/latest/api/test.html#beforefn-options)

추가된 버전: v18.8.0, v16.18.0

-   `fn` [`<Function>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function) | [`<AsyncFunction>`](https://tc39.es/ecma262/#sec-async-function-constructor) 훅 함수. 훅이 콜백을 사용하는 경우, 콜백 함수는 두 번째 인자로 전달됩니다. **기본값:** 아무 작업도 하지 않는 함수.
-   `options` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object) 훅의 설정 옵션. 다음 속성을 지원합니다:
    -   `signal` [`<AbortSignal>`](https://nodejs.org/docs/latest/api/globals.html#class-abortsignal) 진행 중인 훅을 중단할 수 있도록 합니다.
    -   `timeout` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 훅이 실패할 때까지의 시간(밀리초). 지정하지 않으면 하위 테스트는 부모로부터 이 값을 상속받습니다. **기본값:** `Infinity`.

이 함수는 테스트 스위트를 실행하기 전에 실행되는 훅을 생성합니다.

```js
describe('tests', async () => {
    before(() => console.log('테스트를 실행하기 전입니다.'));
    it('하위 테스트입니다.', () => {
        assert.ok('여기에 관련된 검증을 추가합니다.');
    });
});
```


### `after([fn][, options])`[#](https://nodejs.org/docs/latest/api/test.html#afterfn-options)

추가된 버전: v18.8.0, v16.18.0

- `fn` [`<Function>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function) | [`<AsyncFunction>`](https://tc39.es/ecma262/#sec-async-function-constructor)  
  훅 함수입니다. 훅이 콜백을 사용하는 경우, 콜백 함수는 두 번째 인자로 전달됩니다. **기본값:** 아무 작업도 하지 않는 함수.
- `options` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)  
  훅의 설정 옵션입니다. 다음 속성을 지원합니다:
  - `signal` [`<AbortSignal>`](https://nodejs.org/docs/latest/api/globals.html#class-abortsignal)  
    진행 중인 훅을 중단할 수 있습니다.
  - `timeout` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type)  
    훅이 실패할 때까지의 시간(밀리초)입니다. 지정하지 않으면 하위 테스트가 부모의 값을 상속받습니다. **기본값:** `Infinity`.

이 함수는 테스트 스위트 실행 후에 실행되는 훅을 생성합니다.

```js
describe('tests', async () => {
    after(() => console.log('finished running tests'));
    it('is a subtest', () => {
        assert.ok('some relevant assertion here');
    });
});
```

**참고:** `after` 훅은 스위트 내의 테스트가 실패하더라도 반드시 실행됩니다.


### `beforeEach([fn][, options])`[#](https://nodejs.org/docs/latest/api/test.html#beforeeachfn-options)

추가된 버전: v18.8.0, v16.18.0

- `fn` [`<Function>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function) | [`<AsyncFunction>`](https://tc39.es/ecma262/#sec-async-function-constructor)  
  훅 함수입니다. 훅이 콜백을 사용하는 경우, 콜백 함수는 두 번째 인자로 전달됩니다. **기본값:** 아무 작업도 하지 않는 함수.
  
- `options` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)  
  훅의 설정 옵션입니다. 다음 속성을 지원합니다:
  - `signal` [`<AbortSignal>`](https://nodejs.org/docs/latest/api/globals.html#class-abortsignal)  
    진행 중인 훅을 중단할 수 있습니다.
  - `timeout` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type)  
    훅이 실패할 때까지의 시간(밀리초)입니다. 지정하지 않으면, 하위 테스트는 부모로부터 이 값을 상속받습니다. **기본값:** `Infinity`.

이 함수는 현재 테스트 스위트의 각 테스트 실행 전에 실행되는 훅을 생성합니다.

```js
describe('tests', async () => {
    beforeEach(() => console.log('about to run a test'));
    it('is a subtest', () => {
        assert.ok('some relevant assertion here');
    });
});
```


### `afterEach([fn][, options])`[#](https://nodejs.org/docs/latest/api/test.html#aftereachfn-options)

추가된 버전: v18.8.0, v16.18.0

-   `fn` [`<Function>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function) | [`<AsyncFunction>`](https://tc39.es/ecma262/#sec-async-function-constructor) 훅 함수. 훅이 콜백을 사용하는 경우, 콜백 함수는 두 번째 인자로 전달된다. **기본값:** 아무 작업도 하지 않는 함수.
-   `options` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object) 훅의 설정 옵션. 다음 속성을 지원한다:
    -   `signal` [`<AbortSignal>`](https://nodejs.org/docs/latest/api/globals.html#class-abortsignal) 진행 중인 훅을 중단할 수 있다.
    -   `timeout` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 훅이 실패할 때까지의 시간(밀리초). 지정하지 않으면 하위 테스트는 부모로부터 이 값을 상속받는다. **기본값:** `Infinity`.

이 함수는 현재 테스트 스위트의 각 테스트가 실행된 후에 실행되는 훅을 생성한다. `afterEach()` 훅은 테스트가 실패하더라도 실행된다.

```js
describe('tests', async () => {
    afterEach(() => console.log('테스트 실행 완료'));
    it('하위 테스트', () => {
        assert.ok('여기에 관련된 검증을 추가');
    });
});
```


### `snapshot`[#](https://nodejs.org/docs/latest/api/test.html#snapshot)

추가된 버전: v22.3.0

이 객체는 현재 프로세스에서 기본 스냅샷 설정을 구성하는 데 사용되는 메서드를 제공합니다. `--require` 또는 `--import`로 미리 로드된 모듈에 공통 설정 코드를 추가하여 모든 파일에 동일한 구성을 적용할 수 있습니다.


#### `snapshot.setDefaultSnapshotSerializers(serializers)`[#](https://nodejs.org/docs/latest/api/test.html#snapshotsetdefaultsnapshotserializersserializers)

추가된 버전: v22.3.0

-   `serializers` [`<Array>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array) 스냅샷 테스트에 사용될 기본 직렬화 함수들의 배열입니다.

이 함수는 테스트 러너가 사용하는 기본 직렬화 방식을 커스터마이징할 때 사용됩니다. 기본적으로 테스트 러너는 제공된 값에 대해 `JSON.stringify(value, null, 2)`를 호출하여 직렬화를 수행합니다. 하지만 `JSON.stringify()`는 순환 구조와 지원되는 데이터 타입에 있어 제한이 있습니다. 더 강력한 직렬화 메커니즘이 필요하다면 이 함수를 사용해야 합니다.


#### `snapshot.setResolveSnapshotPath(fn)`[#](https://nodejs.org/docs/latest/api/test.html#snapshotsetresolvesnapshotpathfn)

추가된 버전: v22.3.0

-   `fn` [`<Function>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function) 스냅샷 파일의 위치를 계산하는 데 사용되는 함수입니다. 이 함수는 테스트 파일의 경로를 유일한 인자로 받습니다. 만약 테스트가 파일과 연결되어 있지 않은 경우(예: REPL에서 실행되는 경우), 입력값은 `undefined`가 됩니다. `fn()`은 스냅샷 파일의 위치를 지정하는 문자열을 반환해야 합니다.

이 함수는 스냅샷 테스트에 사용되는 스냅샷 파일의 위치를 커스터마이징하기 위해 사용됩니다. 기본적으로 스냅샷 파일명은 진입점 파일명과 동일하며, `.snapshot` 파일 확장자를 가집니다.


### 클래스: `MockFunctionContext`[#](https://nodejs.org/docs/latest/api/test.html#class-mockfunctioncontext)

추가된 버전: v19.1.0, v18.13.0

`MockFunctionContext` 클래스는 [`MockTracker`](https://nodejs.org/docs/latest/api/test.html#class-mocktracker) API를 통해 생성된 모의 함수(mock)의 동작을 검사하거나 조작하는 데 사용됩니다.


#### `ctx.calls`[#](https://nodejs.org/docs/latest/api/test.html#ctxcalls)

추가된 버전: v19.1.0, v18.13.0

-   [`<Array>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)

모의 함수 호출을 추적하기 위해 사용되는 내부 배열의 복사본을 반환하는 getter입니다. 배열의 각 항목은 다음과 같은 속성을 가진 객체입니다.

-   `arguments` [`<Array>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array) 모의 함수에 전달된 인자들의 배열입니다.
-   `error` [`<any>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Data_types) 모의 함수가 예외를 던졌다면 이 속성은 던져진 값을 포함합니다. **기본값:** `undefined`.
-   `result` [`<any>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Data_types) 모의 함수가 반환한 값입니다.
-   `stack` [`<Error>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error) 모의 함수 호출의 호출 위치를 확인하는 데 사용할 수 있는 `Error` 객체입니다.
-   `target` [`<Function>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function) | [`<undefined>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type) 모의 함수가 생성자라면, 이 필드는 생성 중인 클래스를 포함합니다. 그렇지 않으면 `undefined`가 됩니다.
-   `this` [`<any>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Data_types) 모의 함수의 `this` 값입니다.


#### `ctx.callCount()`[#](https://nodejs.org/docs/latest/api/test.html#ctxcallcount)

추가된 버전: v19.1.0, v18.13.0

-   반환값: [`<integer>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 이 모의 함수가 호출된 횟수

이 함수는 모의 함수가 호출된 횟수를 반환합니다. `ctx.calls.length`를 확인하는 것보다 이 함수가 더 효율적입니다. 왜냐하면 `ctx.calls`는 내부 호출 추적 배열의 복사본을 생성하는 getter이기 때문입니다.


#### `ctx.mockImplementation(implementation)`[#](https://nodejs.org/docs/latest/api/test.html#ctxmockimplementationimplementation)

추가된 버전: v19.1.0, v18.13.0

- `implementation` [`<Function>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function) | [`<AsyncFunction>`](https://tc39.es/ecma262/#sec-async-function-constructor)  
  모크의 새로운 동작으로 사용될 함수입니다.

이 함수는 기존 모크의 동작을 변경하는 데 사용됩니다.

아래 예제는 `t.mock.fn()`을 사용해 모크 함수를 생성하고, 모크 함수를 호출한 후, 모크의 동작을 다른 함수로 변경합니다.

```js
test('모크 동작 변경', (t) => {
    let cnt = 0;
    
    function addOne() {
        cnt++;
        return cnt;
    }
    
    function addTwo() {
        cnt += 2;
        return cnt;
    }
    
    const fn = t.mock.fn(addOne);
    assert.strictEqual(fn(), 1);
    
    fn.mock.mockImplementation(addTwo);
    assert.strictEqual(fn(), 3);
    assert.strictEqual(fn(), 5);
});
```


#### `ctx.mockImplementationOnce(implementation[, onCall])`[#](https://nodejs.org/docs/latest/api/test.html#ctxmockimplementationonceimplementation-oncall)

추가된 버전: v19.1.0, v18.13.0

-   `implementation` [`<Function>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function) | [`<AsyncFunction>`](https://tc39.es/ecma262/#sec-async-function-constructor) `onCall`에 지정된 호출 횟수에서 사용될 모의 함수의 구현체입니다.
-   `onCall` [`<integer>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) `implementation`을 사용할 호출 횟수입니다. 지정된 호출이 이미 발생했다면 예외가 발생합니다. **기본값:** 다음 호출 횟수입니다.

이 함수는 기존 모의 함수의 동작을 단일 호출에 한해 변경하는 데 사용됩니다. `onCall`에 지정된 호출이 발생하면, 모의 함수는 `mockImplementationOnce()`가 호출되지 않았을 때 사용했던 동작으로 돌아갑니다.

다음 예제는 `t.mock.fn()`을 사용해 모의 함수를 생성하고, 모의 함수를 호출한 후, 다음 호출에서 다른 함수로 모의 구현체를 변경한 뒤, 이전 동작으로 복귀하는 과정을 보여줍니다.

```js
test('모의 함수의 동작을 한 번 변경', (t) => {
    let cnt = 0;
    function addOne() {
        cnt++;
        return cnt;
    }
    function addTwo() {
        cnt += 2;
        return cnt;
    }
    const fn = t.mock.fn(addOne);
    assert.strictEqual(fn(), 1);
    fn.mock.mockImplementationOnce(addTwo);
    assert.strictEqual(fn(), 3);
    assert.strictEqual(fn(), 4);
});
```


#### `ctx.resetCalls()`[#](https://nodejs.org/docs/latest/api/test.html#ctxresetcalls)

**추가된 버전:** v19.3.0, v18.13.0

모의 함수(mock function)의 호출 기록을 초기화합니다.


#### `ctx.restore()`[#](https://nodejs.org/docs/latest/api/test.html#ctxrestore)

추가된 버전: v19.1.0, v18.13.0

모의 함수(mock function)의 동작을 원래의 동작으로 재설정합니다. 이 함수를 호출한 후에도 모의 함수를 계속 사용할 수 있습니다.


### 클래스: `MockModuleContext`[#](https://nodejs.org/docs/latest/api/test.html#class-mockmodulecontext)

추가된 버전: v22.3.0, v20.18.0

`MockModuleContext` 클래스는 [`MockTracker`](https://nodejs.org/docs/latest/api/test.html#class-mocktracker) API를 통해 생성된 모듈 모의(mock)의 동작을 조작하는 데 사용됩니다.


#### `ctx.restore()`[#](https://nodejs.org/docs/latest/api/test.html#ctxrestore_1)

추가된 버전: v22.3.0, v20.18.0

모의 모듈(mock module)의 구현을 초기 상태로 되돌립니다.


### 클래스: `MockTracker`[#](https://nodejs.org/docs/latest/api/test.html#class-mocktracker)

추가된 버전: v19.1.0, v18.13.0

`MockTracker` 클래스는 모킹(mocking) 기능을 관리하는 데 사용됩니다. 테스트 러너 모듈은 최상위 수준에서 `mock` 익스포트를 제공하며, 이는 `MockTracker` 인스턴스입니다. 각 테스트는 또한 테스트 컨텍스트의 `mock` 속성을 통해 자체 `MockTracker` 인스턴스를 제공합니다.


#### `mock.fn([original[, implementation]][, options])`[#](https://nodejs.org/docs/latest/api/test.html#mockfnoriginal-implementation-options)

추가된 버전: v19.1.0, v18.13.0

-   `original` [`<Function>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function) | [`<AsyncFunction>`](https://tc39.es/ecma262/#sec-async-function-constructor)  
    모의 함수를 생성할 때 사용할 선택적 함수. **기본값:** 아무 작업도 하지 않는 함수.
-   `implementation` [`<Function>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function) | [`<AsyncFunction>`](https://tc39.es/ecma262/#sec-async-function-constructor)  
    `original` 함수의 모의 구현으로 사용할 선택적 함수. 이는 특정 횟수만큼 다른 동작을 보여주고, 이후 `original`의 동작을 복원하는 모의 함수를 생성할 때 유용. **기본값:** `original`로 지정된 함수.
-   `options` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)  
    모의 함수에 대한 선택적 설정 옵션. 다음 속성을 지원:
    -   `times` [`<integer>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type)  
        모의 함수가 `implementation`의 동작을 사용할 횟수. 모의 함수가 `times` 횟수만큼 호출된 후, 자동으로 `original`의 동작을 복원. 이 값은 0보다 큰 정수여야 함. **기본값:** `Infinity`.
-   반환값: [`<Proxy>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy)  
    모의 함수. 모의 함수는 특별한 `mock` 속성을 포함하며, 이는 [`MockFunctionContext`](https://nodejs.org/docs/latest/api/test.html#class-mockfunctioncontext)의 인스턴스로, 모의 함수의 동작을 검사하고 변경하는 데 사용 가능.

이 함수는 모의 함수를 생성하는 데 사용.

다음 예제는 호출될 때마다 카운터를 1씩 증가시키는 모의 함수를 생성. `times` 옵션을 사용하여 처음 두 번의 호출에서는 카운터를 2씩 증가시키도록 모의 함수의 동작을 수정.

```js
test('mocks a counting function', (t) => {
    let cnt = 0;
    function addOne() {
        cnt++;
        return cnt;
    }
    function addTwo() {
        cnt += 2;
        return cnt;
    }
    const fn = t.mock.fn(addOne, addTwo, { times: 2 });
    assert.strictEqual(fn(), 2);
    assert.strictEqual(fn(), 4);
    assert.strictEqual(fn(), 5);
    assert.strictEqual(fn(), 6);
});
```


#### `mock.getter(object, methodName[, implementation][, options])`[#](https://nodejs.org/docs/latest/api/test.html#mockgetterobject-methodname-implementation-options)

추가된 버전: v19.3.0, v18.13.0

이 함수는 `options.getter`를 `true`로 설정한 [`MockTracker.method`](https://nodejs.org/docs/latest/api/test.html#mockmethodobject-methodname-implementation-options)의 문법적 편의를 제공합니다.


#### `mock.method(object, methodName[, implementation][, options])`[#](https://nodejs.org/docs/latest/api/test.html#mockmethodobject-methodname-implementation-options)

추가된 버전: v19.1.0, v18.13.0

-   `object` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object) 모의(mock)할 메서드가 속한 객체.
-   `methodName` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) | [`<symbol>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Symbol_type) 모의할 메서드의 식별자. `object[methodName]`이 함수가 아닌 경우 에러가 발생.
-   `implementation` [`<Function>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function) | [`<AsyncFunction>`](https://tc39.es/ecma262/#sec-async-function-constructor) `object[methodName]`의 모의 구현으로 사용할 선택적 함수. **기본값:** `object[methodName]`에 지정된 원본 메서드.
-   `options` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object) 모의 메서드에 대한 선택적 설정 옵션. 다음 속성을 지원:
    -   `getter` [`<boolean>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type) `true`인 경우, `object[methodName]`을 getter로 처리. 이 옵션은 `setter` 옵션과 함께 사용할 수 없음. **기본값:** false.
    -   `setter` [`<boolean>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type) `true`인 경우, `object[methodName]`을 setter로 처리. 이 옵션은 `getter` 옵션과 함께 사용할 수 없음. **기본값:** false.
    -   `times` [`<integer>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 모의가 `implementation`의 동작을 사용할 횟수. 모의 메서드가 `times`번 호출된 후, 원래 동작으로 자동 복원. 이 값은 0보다 큰 정수여야 함. **기본값:** `Infinity`.
-   반환값: [`<Proxy>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy) 모의된 메서드. 모의된 메서드는 특별한 `mock` 속성을 포함하며, 이는 [`MockFunctionContext`](https://nodejs.org/docs/latest/api/test.html#class-mockfunctioncontext)의 인스턴스로, 모의된 메서드의 동작을 검사하고 변경하는 데 사용.

이 함수는 기존 객체 메서드에 모의를 생성하는 데 사용. 다음 예제는 기존 객체 메서드에 모의를 생성하는 방법을 보여줌.

```js
test('객체 메서드에 스파이를 추가', (t) => {
    const number = {
        value: 5,
        subtract(a) {
            return this.value - a;
        },
    };
    t.mock.method(number, 'subtract');
    assert.strictEqual(number.subtract.mock.callCount(), 0);
    assert.strictEqual(number.subtract(3), 2);
    assert.strictEqual(number.subtract.mock.callCount(), 1);
    const call = number.subtract.mock.calls[0];
    assert.deepStrictEqual(call.arguments, [3]);
    assert.strictEqual(call.result, 2);
    assert.strictEqual(call.error, undefined);
    assert.strictEqual(call.target, undefined);
    assert.strictEqual(call.this, number);
});
```


#### `mock.module(specifier[, options])`[#](https://nodejs.org/docs/latest/api/test.html#mockmodulespecifier-options)

추가된 버전: v22.3.0, v20.18.0

-   `specifier` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) | [`<URL>`](https://nodejs.org/docs/latest/api/url.html#the-whatwg-url-api) 모의(mock)할 모듈을 식별하는 문자열.
-   `options` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object) 모의 모듈에 대한 선택적 설정 옵션. 다음 속성을 지원합니다:
    -   `cache` [`<boolean>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type) `false`인 경우, `require()` 또는 `import()`를 호출할 때마다 새로운 모의 모듈이 생성됩니다. `true`인 경우, 이후 호출에서는 동일한 모의 모듈이 반환되며, 모의 모듈은 CommonJS 캐시에 삽입됩니다. **기본값:** false.
    -   `defaultExport` [`<any>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Data_types) 모의 모듈의 기본 내보내기로 사용할 선택적 값. 이 값이 제공되지 않으면 ESM 모의 모듈은 기본 내보내기를 포함하지 않습니다. 모의 모듈이 CommonJS 또는 내장 모듈인 경우, 이 설정은 `module.exports`의 값으로 사용됩니다. 이 값이 제공되지 않으면 CJS 및 내장 모의 모듈은 빈 객체를 `module.exports`의 값으로 사용합니다.
    -   `namedExports` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object) 모의 모듈의 명명된 내보내기를 생성하는 데 사용되는 선택적 객체. 모의 모듈이 CommonJS 또는 내장 모듈인 경우, 이 값들은 `module.exports`에 복사됩니다. 따라서 명명된 내보내기와 객체가 아닌 기본 내보내기가 함께 있는 모의 모듈을 생성하면, CJS 또는 내장 모듈로 사용할 때 예외가 발생합니다.
-   반환값: [`<MockModuleContext>`](https://nodejs.org/docs/latest/api/test.html#class-mockmodulecontext) 모의 모듈을 조작하는 데 사용할 수 있는 객체.

이 함수는 ECMAScript 모듈, CommonJS 모듈, Node.js 내장 모듈의 내보내기를 모의(mock)하는 데 사용됩니다. 모의하기 전에 원본 모듈에 대한 참조는 영향을 받지 않습니다. 모듈 모의를 활성화하려면 Node.js를 [`--experimental-test-module-mocks`](https://nodejs.org/docs/latest/api/cli.html#--experimental-test-module-mocks) 커맨드라인 플래그와 함께 시작해야 합니다.

다음 예제는 모듈에 대한 모의를 생성하는 방법을 보여줍니다.

```js
test('모듈 시스템에서 내장 모듈을 모의합니다', async (t) => {
    // 'node:readline' 모듈을 모의합니다. 'fn'이라는 명명된 내보내기를 추가합니다.
    // 이는 원본 'node:readline' 모듈에 존재하지 않습니다.
    const mock = t.mock.module('node:readline', {
        namedExports: {
            fn() {
                return 42;
            },
        },
    });

    let esmImpl = await import('node:readline');
    let cjsImpl = require('node:readline');

    // cursorTo()는 원본 'node:readline' 모듈의 내보내기입니다.
    assert.strictEqual(esmImpl.cursorTo, undefined);
    assert.strictEqual(cjsImpl.cursorTo, undefined);
    assert.strictEqual(esmImpl.fn(), 42);
    assert.strictEqual(cjsImpl.fn(), 42);

    mock.restore(); // 모의를 복원하여 원본 내장 모듈이 반환됩니다.

    esmImpl = await import('node:readline');
    cjsImpl = require('node:readline');

    assert.strictEqual(typeof esmImpl.cursorTo, 'function');
    assert.strictEqual(typeof cjsImpl.cursorTo, 'function');
    assert.strictEqual(esmImpl.fn, undefined);
    assert.strictEqual(cjsImpl.fn, undefined);
});
```


#### `mock.reset()`[#](https://nodejs.org/docs/latest/api/test.html#mockreset)

추가된 버전: v19.1.0, v18.13.0

이 함수는 `MockTracker`로 생성된 모든 모의 객체(mock)의 기본 동작을 복원하고, 모의 객체를 `MockTracker` 인스턴스와 분리합니다. 분리된 후에도 모의 객체는 여전히 사용할 수 있지만, `MockTracker` 인스턴스는 더 이상 해당 모의 객체의 동작을 초기화하거나 상호작용할 수 없습니다.

각 테스트가 완료된 후, 이 함수는 테스트 컨텍스트의 `MockTracker`에서 자동으로 호출됩니다. 전역 `MockTracker`를 광범위하게 사용하는 경우, 이 함수를 수동으로 호출하는 것이 좋습니다.


#### `mock.restoreAll()`[#](https://nodejs.org/docs/latest/api/test.html#mockrestoreall)

추가된 버전: v19.1.0, v18.13.0

이 함수는 `MockTracker`에 의해 이전에 생성된 모든 목(mock)의 기본 동작을 복원합니다. `mock.reset()`과 달리, `mock.restoreAll()`은 목을 `MockTracker` 인스턴스에서 분리하지 않습니다.


#### `mock.setter(object, methodName[, implementation][, options])`[#](https://nodejs.org/docs/latest/api/test.html#mocksetterobject-methodname-implementation-options)

추가된 버전: v19.3.0, v18.13.0

이 함수는 `options.setter`를 `true`로 설정한 [`MockTracker.method`](https://nodejs.org/docs/latest/api/test.html#mockmethodobject-methodname-implementation-options)의 문법적 편의를 제공합니다.


### 클래스: `MockTimers`[#](https://nodejs.org/docs/latest/api/test.html#class-mocktimers)

타이머 모킹(Mocking timers)은 소프트웨어 테스트에서 자주 사용되는 기법입니다. 이 기법은 `setInterval`이나 `setTimeout`과 같은 타이머의 동작을 실제로 지정된 시간을 기다리지 않고 시뮬레이션하고 제어할 수 있게 해줍니다.

`MockTimers`는 `Date` 객체도 모킹할 수 있습니다.

[`MockTracker`](https://nodejs.org/docs/latest/api/test.html#class-mocktracker)는 최상위 레벨에서 `timers`를 제공하며, 이는 `MockTimers`의 인스턴스입니다.


#### `timers.enable([enableOptions])`[#](https://nodejs.org/docs/latest/api/test.html#timersenableenableoptions)

지정된 타이머에 대한 모킹(mocking)을 활성화합니다.

-   `enableOptions` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object) 타이머 모킹을 활성화하기 위한 선택적 설정 옵션입니다. 다음 속성을 지원합니다:
    -   `apis` [`<Array>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array) 모킹할 타이머를 포함하는 선택적 배열입니다. 현재 지원되는 타이머 값은 `'setInterval'`, `'setTimeout'`, `'setImmediate'`, 그리고 `'Date'`입니다. **기본값:** `['setInterval', 'setTimeout', 'setImmediate', 'Date']`. 배열이 제공되지 않으면 모든 시간 관련 API(`'setInterval'`, `'clearInterval'`, `'setTimeout'`, `'clearTimeout'`, `'setImmediate'`, `'clearImmediate'`, 그리고 `'Date'`)가 기본적으로 모킹됩니다.
    -   `now` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) | [`<Date>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date) `Date.now()`의 초기 시간(밀리초 단위)으로 사용할 숫자나 Date 객체입니다. **기본값:** `0`.

**참고:** 특정 타이머에 대한 모킹을 활성화하면, 해당 타이머와 연관된 clear 함수도 암묵적으로 모킹됩니다.

**참고:** `Date`를 모킹하면 모킹된 타이머의 동작에 영향을 미칩니다. 이는 동일한 내부 클록을 사용하기 때문입니다.

초기 시간을 설정하지 않고 사용하는 예제:

```js
import { mock } from 'node:test';
mock.timers.enable({ apis: ['setInterval'] });
```

위 예제는 `setInterval` 타이머에 대한 모킹을 활성화하고, `clearInterval` 함수도 암묵적으로 모킹합니다. `node:timers`, `node:timers/promises`, 그리고 `globalThis`에서 제공하는 `setInterval`과 `clearInterval` 함수만 모킹됩니다.

초기 시간을 설정하여 사용하는 예제:

```js
import { mock } from 'node:test';
mock.timers.enable({ apis: ['Date'], now: 1000 });
```

초기 시간으로 Date 객체를 설정하여 사용하는 예제:

```js
import { mock } from 'node:test';
mock.timers.enable({ apis: ['Date'], now: new Date() });
```

또는, `mock.timers.enable()`을 매개변수 없이 호출하면:

모든 타이머(`'setInterval'`, `'clearInterval'`, `'setTimeout'`, `'clearTimeout'`, `'setImmediate'`, 그리고 `'clearImmediate'`)가 모킹됩니다. `node:timers`, `node:timers/promises`, 그리고 `globalThis`에서 제공하는 `setInterval`, `clearInterval`, `setTimeout`, `clearTimeout`, `setImmediate`, 그리고 `clearImmediate` 함수가 모킹됩니다. 또한 전역 `Date` 객체도 모킹됩니다.


#### `timers.reset()`[#](https://nodejs.org/docs/latest/api/test.html#timersreset)

추가된 버전: v20.4.0, v18.19.0

이 함수는 이전에 `MockTimers` 인스턴스로 생성된 모든 모의 객체의 기본 동작을 복원하고, 모의 객체를 `MockTracker` 인스턴스와 분리합니다.

**참고:** 각 테스트가 완료된 후, 이 함수는 테스트 컨텍스트의 `MockTracker`에서 호출됩니다.

```js
import { mock } from 'node:test';
mock.timers.reset();
```


#### `timers[Symbol.dispose]()`[#](https://nodejs.org/docs/latest/api/test.html#timerssymboldispose)

`timers.reset()`을 호출합니다.


#### `timers.tick([milliseconds])`[#](https://nodejs.org/docs/latest/api/test.html#timerstickmilliseconds)

추가된 버전: v20.4.0, v18.19.0

모든 모의 타이머의 시간을 앞당깁니다.

-   `milliseconds` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 타이머를 앞당길 시간(밀리초 단위). **기본값:** `1`.

**참고:** 이 기능은 Node.js의 `setTimeout`과 다르게 동작하며, 양수만 허용합니다. Node.js에서 `setTimeout`은 웹 호환성을 이유로 음수도 지원합니다.

다음 예제는 `setTimeout` 함수를 모의로 만들고, `.tick`을 사용해 시간을 앞당겨 보류 중인 모든 타이머를 실행합니다.

```js
import assert from 'node:assert';
import { test } from 'node:test';

test('setTimeout를 모의로 만들어 실제로 기다리지 않고 동기적으로 실행', (context) => {
    const fn = context.mock.fn();
    context.mock.timers.enable({ apis: ['setTimeout'] });
    setTimeout(fn, 9999);
    assert.strictEqual(fn.mock.callCount(), 0);

    // 시간을 앞당김
    context.mock.timers.tick(9999);
    assert.strictEqual(fn.mock.callCount(), 1);
});
```

또는 `.tick` 함수를 여러 번 호출할 수도 있습니다.

```js
import assert from 'node:assert';
import { test } from 'node:test';

test('setTimeout를 모의로 만들어 실제로 기다리지 않고 동기적으로 실행', (context) => {
    const fn = context.mock.fn();
    context.mock.timers.enable({ apis: ['setTimeout'] });
    const nineSecs = 9000;
    setTimeout(fn, nineSecs);
    const threeSeconds = 3000;
    context.mock.timers.tick(threeSeconds);
    context.mock.timers.tick(threeSeconds);
    context.mock.timers.tick(threeSeconds);
    assert.strictEqual(fn.mock.callCount(), 1);
});
```

`.tick`을 사용해 시간을 앞당기면, 모의가 활성화된 후 생성된 `Date` 객체의 시간도 앞당겨집니다(`Date`도 모의로 설정된 경우).

```js
import assert from 'node:assert';
import { test } from 'node:test';

test('setTimeout를 모의로 만들어 실제로 기다리지 않고 동기적으로 실행', (context) => {
    const fn = context.mock.fn();
    context.mock.timers.enable({ apis: ['setTimeout', 'Date'] });
    setTimeout(fn, 9999);
    assert.strictEqual(fn.mock.callCount(), 0);
    assert.strictEqual(Date.now(), 0);

    // 시간을 앞당김
    context.mock.timers.tick(9999);
    assert.strictEqual(fn.mock.callCount(), 1);
    assert.strictEqual(Date.now(), 9999);
});
```


##### clear 함수 사용하기

앞서 언급했듯이, 모든 타이머 관련 clear 함수(`clearTimeout`, `clearInterval`, `clearImmediate`)는 암묵적으로 모킹됩니다. 아래 예제는 `setTimeout`을 사용한 경우입니다:

```js
import assert from 'node:assert';
import { test } from 'node:test';

test('setTimeout을 동기적으로 실행하도록 모킹하여 실제로 기다릴 필요 없이 테스트', (context) => {
    const fn = context.mock.fn();
    
    // 모킹할 대상을 선택적으로 지정
    context.mock.timers.enable({ apis: ['setTimeout'] });
    
    const id = setTimeout(fn, 9999);
    
    // clearTimeout도 암묵적으로 모킹됨
    clearTimeout(id);
    
    // setTimeout이 취소되었으므로 모크 함수는 호출되지 않음
    context.mock.timers.tick(9999);
    
    assert.strictEqual(fn.mock.callCount(), 0);
});
```


##### Node.js 타이머 모듈 사용하기

타이머 모킹을 활성화하면, [node:timers](https://nodejs.org/docs/latest/api/timers.html), [node:timers/promises](https://nodejs.org/docs/latest/api/timers.html#timers-promises-api) 모듈, 그리고 Node.js 전역 컨텍스트의 타이머가 활성화됩니다.

**참고:** `import { setTimeout } from 'node:timers'`와 같은 구조 분해 함수는 현재 이 API에서 지원되지 않습니다.

```js
import assert from 'node:assert';
import { test } from 'node:test';
import nodeTimers from 'node:timers';
import nodeTimersPromises from 'node:timers/promises';

test('setTimeout을 실제로 기다리지 않고 동기적으로 실행되도록 모킹', async (context) => {
    const globalTimeoutObjectSpy = context.mock.fn();
    const nodeTimerSpy = context.mock.fn();
    const nodeTimerPromiseSpy = context.mock.fn();

    // 모킹할 항목을 선택적으로 지정
    context.mock.timers.enable({ apis: ['setTimeout'] });

    setTimeout(globalTimeoutObjectSpy, 9999);
    nodeTimers.setTimeout(nodeTimerSpy, 9999);
    const promise = nodeTimersPromises.setTimeout(9999).then(nodeTimerPromiseSpy);

    // 시간을 앞당김
    context.mock.timers.tick(9999);

    assert.strictEqual(globalTimeoutObjectSpy.mock.callCount(), 1);
    assert.strictEqual(nodeTimerSpy.mock.callCount(), 1);

    await promise;
    assert.strictEqual(nodeTimerPromiseSpy.mock.callCount(), 1);
});
```

Node.js에서 [node:timers/promises](https://nodejs.org/docs/latest/api/timers.html#timers-promises-api)의 `setInterval`은 `AsyncGenerator`이며, 이 API에서도 지원됩니다.

```js
import assert from 'node:assert';
import { test } from 'node:test';
import nodeTimersPromises from 'node:timers/promises';

test('실제 사용 사례를 테스트하며 5번 틱', async (context) => {
    context.mock.timers.enable({ apis: ['setInterval'] });

    const expectedIterations = 3;
    const interval = 1000;
    const startedAt = Date.now();

    async function run() {
        const times = [];
        for await (const time of nodeTimersPromises.setInterval(interval, startedAt)) {
            times.push(time);
            if (times.length === expectedIterations) break;
        }
        return times;
    }

    const r = run();

    context.mock.timers.tick(interval);
    context.mock.timers.tick(interval);
    context.mock.timers.tick(interval);

    const timeResults = await r;
    assert.strictEqual(timeResults.length, expectedIterations);

    for (let it = 1; it < expectedIterations; it++) {
        assert.strictEqual(timeResults[it - 1], startedAt + (interval * it));
    }
});
```


#### `timers.runAll()`[#](https://nodejs.org/docs/latest/api/test.html#timersrunall)

추가된 버전: v20.4.0, v18.19.0

모의 타이머(mocked timers)로 설정된 모든 대기 중인 타이머를 즉시 실행합니다. 만약 `Date` 객체도 모의로 설정되어 있다면, `Date` 객체도 가장 먼저 실행될 타이머의 시간으로 이동합니다.

아래 예제는 모든 대기 중인 타이머를 즉시 실행시켜, 지연 없이 실행되도록 합니다.

```js
import assert from 'node:assert';
import { test } from 'node:test';

test('runAll functions following the given order', (context) => {
    context.mock.timers.enable({ apis: ['setTimeout', 'Date'] });
    const results = [];

    setTimeout(() => results.push(1), 9999);
    // 두 타이머가 동일한 시간을 가질 경우,
    // 실행 순서는 보장됩니다.
    setTimeout(() => results.push(3), 8888);
    setTimeout(() => results.push(2), 8888);

    assert.deepStrictEqual(results, []);
    context.mock.timers.runAll();
    assert.deepStrictEqual(results, [3, 2, 1]);

    // Date 객체도 가장 먼저 실행될 타이머의 시간으로 이동합니다.
    assert.strictEqual(Date.now(), 9999);
});
```

**참고:** `runAll()` 함수는 타이머 모의 환경에서 타이머를 실행하기 위해 특별히 설계되었습니다. 이 함수는 실제 시스템 시계나 모의 환경 외부의 실제 타이머에는 영향을 미치지 않습니다.


#### `timers.setTime(milliseconds)`[#](https://nodejs.org/docs/latest/api/test.html#timerssettimemilliseconds)

추가된 버전: v21.2.0, v20.11.0

모의(mocked) `Date` 객체가 참조할 현재 유닉스 타임스탬프를 설정합니다.

```js
import assert from 'node:assert';
import { test } from 'node:test';

test('주어진 순서대로 모든 함수를 실행', (context) => {
    const now = Date.now();
    const setTime = 1000;

    // Date.now는 모의되지 않음
    assert.deepStrictEqual(Date.now(), now);

    context.mock.timers.enable({ apis: ['Date'] });
    context.mock.timers.setTime(setTime);

    // Date.now는 이제 1000
    assert.strictEqual(Date.now(), setTime);
});
```


##### 날짜와 타이머의 상호작용[#](https://nodejs.org/docs/latest/api/test.html#dates-and-timers-working-together)

날짜와 타이머 객체는 서로 의존적입니다. `setTime()`을 사용해 현재 시간을 모의(mocked) `Date` 객체에 전달하더라도, `setTimeout`과 `setInterval`로 설정된 타이머는 **영향을 받지 않습니다**.

하지만 `tick` 메서드는 모의 `Date` 객체를 **진행시킵니다**.

```javascript
import assert from 'node:assert';
import { test } from 'node:test';

test('주어진 순서대로 모든 함수 실행', (context) => {
    context.mock.timers.enable({ apis: ['setTimeout', 'Date'] });
    const results = [];

    setTimeout(() => results.push(1), 9999);
    assert.deepStrictEqual(results, []);

    context.mock.timers.setTime(12000);
    assert.deepStrictEqual(results, []); // 날짜는 진행되지만 타이머는 작동하지 않음
    assert.strictEqual(Date.now(), 12000);
});
```


### 클래스: `TestsStream`[#](https://nodejs.org/docs/latest/api/test.html#class-testsstream)

-   [`<Readable>`](https://nodejs.org/docs/latest/api/stream.html#class-streamreadable)을 상속받음

[`run()`](https://nodejs.org/docs/latest/api/test.html#runoptions) 메서드를 성공적으로 호출하면 새로운 [`<TestsStream>`](https://nodejs.org/docs/latest/api/test.html#class-testsstream) 객체가 반환됩니다. 이 객체는 테스트 실행을 나타내는 일련의 이벤트를 스트리밍합니다. `TestsStream`은 테스트 정의 순서대로 이벤트를 발생시킵니다.

일부 이벤트는 테스트가 정의된 순서대로 발생하는 것이 보장되지만, 다른 이벤트들은 테스트가 실행되는 순서대로 발생합니다.


#### 이벤트: `'test:coverage'`[#](https://nodejs.org/docs/latest/api/test.html#event-testcoverage)

- `data` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)
    - `summary` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object) 코드 커버리지 리포트를 포함하는 객체.
        - `files` [`<Array>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array) 개별 파일에 대한 커버리지 리포트 배열. 각 리포트는 다음 스키마를 가진 객체:
            - `path` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) 파일의 절대 경로.
            - `totalLineCount` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 전체 라인 수.
            - `totalBranchCount` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 전체 브랜치 수.
            - `totalFunctionCount` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 전체 함수 수.
            - `coveredLineCount` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 커버된 라인 수.
            - `coveredBranchCount` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 커버된 브랜치 수.
            - `coveredFunctionCount` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 커버된 함수 수.
            - `coveredLinePercent` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 커버된 라인 비율.
            - `coveredBranchPercent` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 커버된 브랜치 비율.
            - `coveredFunctionPercent` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 커버된 함수 비율.
            - `functions` [`<Array>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array) 함수 커버리지를 나타내는 함수 배열.
                - `name` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) 함수 이름.
                - `line` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 함수가 정의된 라인 번호.
                - `count` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 함수가 호출된 횟수.
            - `branches` [`<Array>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array) 브랜치 커버리지를 나타내는 브랜치 배열.
                - `line` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 브랜치가 정의된 라인 번호.
                - `count` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 브랜치가 실행된 횟수.
            - `lines` [`<Array>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array) 라인 번호와 커버된 횟수를 나타내는 라인 배열.
                - `line` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 라인 번호.
                - `count` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 라인이 커버된 횟수.
        - `thresholds` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object) 각 커버리지 타입에 대한 임계값을 포함하는 객체.
            - `function` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 함수 커버리지 임계값.
            - `branch` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 브랜치 커버리지 임계값.
            - `line` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 라인 커버리지 임계값.
        - `totals` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object) 모든 파일에 대한 커버리지 요약을 포함하는 객체.
            - `totalLineCount` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 전체 라인 수.
            - `totalBranchCount` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 전체 브랜치 수.
            - `totalFunctionCount` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 전체 함수 수.
            - `coveredLineCount` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 커버된 라인 수.
            - `coveredBranchCount` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 커버된 브랜치 수.
            - `coveredFunctionCount` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 커버된 함수 수.
            - `coveredLinePercent` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 커버된 라인 비율.
            - `coveredBranchPercent` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 커버된 브랜치 비율.
            - `coveredFunctionPercent` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 커버된 함수 비율.
        - `workingDirectory` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) 코드 커버리지가 시작될 때의 작업 디렉토리. 테스트가 Node.js 프로세스의 작업 디렉토리를 변경한 경우 상대 경로를 표시하는 데 유용.
    - `nesting` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 테스트의 중첩 레벨.

코드 커버리지가 활성화되고 모든 테스트가 완료되면 이 이벤트가 발생합니다.


#### 이벤트: `'test:complete'`[#](https://nodejs.org/docs/latest/api/test.html#event-testcomplete)

-   `data` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)
    -   `column` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) | [`<undefined>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type) 테스트가 정의된 컬럼 번호. REPL을 통해 실행된 경우 `undefined`가 됩니다.
    -   `details` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object) 추가 실행 메타데이터.
        -   `passed` [`<boolean>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type) 테스트가 통과되었는지 여부.
        -   `duration_ms` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 테스트 실행 시간(밀리초 단위).
        -   `error` [`<Error>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error) | [`<undefined>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type) 테스트가 통과하지 못한 경우 발생한 오류를 감싼 오류 객체.
            -   `cause` [`<Error>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error) 테스트에서 실제로 발생한 오류.
        -   `type` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) | [`<undefined>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type) 테스트의 타입. 이 테스트가 스위트인지 여부를 나타냅니다.
    -   `file` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) | [`<undefined>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type) 테스트 파일의 경로. REPL을 통해 실행된 경우 `undefined`가 됩니다.
    -   `line` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) | [`<undefined>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type) 테스트가 정의된 라인 번호. REPL을 통해 실행된 경우 `undefined`가 됩니다.
    -   `name` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) 테스트 이름.
    -   `nesting` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 테스트의 중첩 레벨.
    -   `testNumber` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 테스트의 순서 번호.
    -   `todo` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) | [`<boolean>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type) | [`<undefined>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type) [`context.todo`](https://nodejs.org/docs/latest/api/test.html#contexttodomessage)가 호출된 경우 존재합니다.
    -   `skip` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) | [`<boolean>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type) | [`<undefined>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type) [`context.skip`](https://nodejs.org/docs/latest/api/test.html#contextskipmessage)가 호출된 경우 존재합니다.

테스트 실행이 완료되면 이 이벤트가 발생합니다. 이 이벤트는 테스트가 정의된 순서와 동일한 순서로 발생하지 않습니다. 해당 선언 순서 이벤트는 `'test:pass'`와 `'test:fail'`입니다.


#### 이벤트: `'test:dequeue'`[#](https://nodejs.org/docs/latest/api/test.html#event-testdequeue)

- `data` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)
    - `column` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) | [`<undefined>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type) 테스트가 정의된 컬럼 번호. REPL을 통해 실행된 경우 `undefined`가 됩니다.
    - `file` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) | [`<undefined>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type) 테스트 파일의 경로. REPL을 통해 실행된 경우 `undefined`가 됩니다.
    - `line` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) | [`<undefined>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type) 테스트가 정의된 라인 번호. REPL을 통해 실행된 경우 `undefined`가 됩니다.
    - `name` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) 테스트 이름.
    - `nesting` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 테스트의 중첩 수준.

이 이벤트는 테스트가 실행되기 직전에 큐에서 제거될 때 발생합니다. 이 이벤트는 테스트가 정의된 순서와 동일한 순서로 발생한다는 보장이 없습니다. 이에 대응하는 선언 순서 이벤트는 `'test:start'`입니다.


#### 이벤트: `'test:diagnostic'`[#](https://nodejs.org/docs/latest/api/test.html#event-testdiagnostic)

-   `data` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)
    -   `column` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) | [`<undefined>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type) 테스트가 정의된 컬럼 번호. 테스트가 REPL을 통해 실행된 경우 `undefined`가 됩니다.
    -   `file` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) | [`<undefined>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type) 테스트 파일의 경로. 테스트가 REPL을 통해 실행된 경우 `undefined`가 됩니다.
    -   `line` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) | [`<undefined>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type) 테스트가 정의된 라인 번호. 테스트가 REPL을 통해 실행된 경우 `undefined`가 됩니다.
    -   `message` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) 진단 메시지.
    -   `nesting` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 테스트의 중첩 레벨.

[`context.diagnostic`](https://nodejs.org/docs/latest/api/test.html#contextdiagnosticmessage)이 호출될 때 이 이벤트가 발생합니다. 이 이벤트는 테스트가 정의된 순서와 동일한 순서로 발생하는 것이 보장됩니다.


#### 이벤트: `'test:enqueue'`

- `data` [`<Object>`]
    - `column` [`<number>`] | [`<undefined>`] 테스트가 정의된 컬럼 번호. REPL을 통해 실행된 경우 `undefined`가 됩니다.
    - `file` [`<string>`] | [`<undefined>`] 테스트 파일의 경로. REPL을 통해 실행된 경우 `undefined`가 됩니다.
    - `line` [`<number>`] | [`<undefined>`] 테스트가 정의된 라인 번호. REPL을 통해 실행된 경우 `undefined`가 됩니다.
    - `name` [`<string>`] 테스트 이름.
    - `nesting` [`<number>`] 테스트의 중첩 레벨.

이 이벤트는 테스트가 실행 대기열에 추가될 때 발생합니다.


#### 이벤트: `'test:fail'`[#](https://nodejs.org/docs/latest/api/test.html#event-testfail)

-   `data` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)
    -   `column` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) | [`<undefined>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type) 테스트가 정의된 컬럼 번호. REPL을 통해 실행된 경우 `undefined`가 됩니다.
    -   `details` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object) 추가 실행 메타데이터.
        -   `duration_ms` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 테스트 실행 시간(밀리초 단위).
        -   `error` [`<Error>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error) 테스트에서 발생한 오류를 감싸는 오류 객체.
            -   `cause` [`<Error>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error) 테스트에서 실제로 발생한 오류.
        -   `type` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) | [`<undefined>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type) 테스트 타입. 이 테스트가 스위트인지 여부를 나타냅니다.
    -   `file` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) | [`<undefined>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type) 테스트 파일 경로. REPL을 통해 실행된 경우 `undefined`가 됩니다.
    -   `line` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) | [`<undefined>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type) 테스트가 정의된 라인 번호. REPL을 통해 실행된 경우 `undefined`가 됩니다.
    -   `name` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) 테스트 이름.
    -   `nesting` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 테스트의 중첩 레벨.
    -   `testNumber` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 테스트의 순서 번호.
    -   `todo` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) | [`<boolean>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type) | [`<undefined>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type) [`context.todo`](https://nodejs.org/docs/latest/api/test.html#contexttodomessage)가 호출된 경우 존재합니다.
    -   `skip` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) | [`<boolean>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type) | [`<undefined>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type) [`context.skip`](https://nodejs.org/docs/latest/api/test.html#contextskipmessage)가 호출된 경우 존재합니다.

테스트가 실패할 때 발생하는 이벤트입니다. 이 이벤트는 테스트가 정의된 순서대로 발생함이 보장됩니다. 해당 실행 순서 이벤트는 `'test:complete'`입니다.


#### 이벤트: `'test:pass'`[#](https://nodejs.org/docs/latest/api/test.html#event-testpass)

- `data` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)
    - `column` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) | [`<undefined>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type) 테스트가 정의된 컬럼 번호. REPL을 통해 실행된 경우 `undefined`가 됩니다.
    - `details` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object) 추가 실행 메타데이터.
        - `duration_ms` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 테스트 실행 시간(밀리초 단위).
        - `type` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) | [`<undefined>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type) 테스트 타입. 이 값이 테스트 스위트인지 여부를 나타냅니다.
    - `file` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) | [`<undefined>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type) 테스트 파일 경로. REPL을 통해 실행된 경우 `undefined`가 됩니다.
    - `line` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) | [`<undefined>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type) 테스트가 정의된 라인 번호. REPL을 통해 실행된 경우 `undefined`가 됩니다.
    - `name` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) 테스트 이름.
    - `nesting` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 테스트의 중첩 레벨.
    - `testNumber` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 테스트의 순서 번호.
    - `todo` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) | [`<boolean>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type) | [`<undefined>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type) [`context.todo`](https://nodejs.org/docs/latest/api/test.html#contexttodomessage)가 호출된 경우 존재합니다.
    - `skip` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) | [`<boolean>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type) | [`<undefined>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type) [`context.skip`](https://nodejs.org/docs/latest/api/test.html#contextskipmessage)가 호출된 경우 존재합니다.

테스트가 통과할 때 발생하는 이벤트입니다. 이 이벤트는 테스트가 정의된 순서대로 발생함이 보장됩니다. 해당 실행 순서 이벤트는 `'test:complete'`입니다.


#### 이벤트: `'test:plan'`[#](https://nodejs.org/docs/latest/api/test.html#event-testplan)

-   `data` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)
    -   `column` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) | [`<undefined>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type) 테스트가 정의된 컬럼 번호. REPL을 통해 실행된 경우 `undefined`가 됩니다.
    -   `file` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) | [`<undefined>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type) 테스트 파일의 경로. REPL을 통해 실행된 경우 `undefined`가 됩니다.
    -   `line` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) | [`<undefined>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type) 테스트가 정의된 라인 번호. REPL을 통해 실행된 경우 `undefined`가 됩니다.
    -   `nesting` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 테스트의 중첩 레벨.
    -   `count` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 실행된 하위 테스트의 수.

이 이벤트는 특정 테스트의 모든 하위 테스트가 완료되었을 때 발생합니다. 이 이벤트는 테스트가 정의된 순서와 동일한 순서로 발생함이 보장됩니다.


#### 이벤트: `'test:start'`

- `data` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)
    - `column` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) | [`<undefined>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type) 테스트가 정의된 컬럼 번호. REPL을 통해 실행된 경우 `undefined`가 됩니다.
    - `file` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) | [`<undefined>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type) 테스트 파일의 경로. REPL을 통해 실행된 경우 `undefined`가 됩니다.
    - `line` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) | [`<undefined>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type) 테스트가 정의된 라인 번호. REPL을 통해 실행된 경우 `undefined`가 됩니다.
    - `name` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) 테스트 이름.
    - `nesting` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 테스트의 중첩 레벨.

테스트가 자신과 하위 테스트의 상태를 보고하기 시작할 때 발생하는 이벤트입니다. 이 이벤트는 테스트가 정의된 순서와 동일하게 발생함이 보장됩니다. 해당 실행 순서 이벤트는 `'test:dequeue'`입니다.


#### 이벤트: `'test:stderr'`[#](https://nodejs.org/docs/latest/api/test.html#event-teststderr)

-   `data` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)
    -   `file` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) 테스트 파일의 경로.
    -   `message` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) `stderr`에 기록된 메시지.

이 이벤트는 실행 중인 테스트가 `stderr`에 쓰기를 할 때 발생합니다. 이 이벤트는 `--test` 플래그가 전달된 경우에만 발생합니다. 이 이벤트는 테스트가 정의된 순서와 동일한 순서로 발생한다는 보장이 없습니다.


#### 이벤트: `'test:stdout'`

- `data` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)
    - `file` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) 테스트 파일의 경로.
    - `message` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) `stdout`에 기록된 메시지.

이 이벤트는 실행 중인 테스트가 `stdout`에 쓰기를 수행할 때 발생합니다. 이 이벤트는 `--test` 플래그가 전달된 경우에만 발생합니다. 또한, 이 이벤트는 테스트가 정의된 순서와 동일한 순서로 발생한다는 보장이 없습니다.


#### 이벤트: `'test:summary'`[#](https://nodejs.org/docs/latest/api/test.html#event-testsummary)

-   `data` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)
    -   `counts` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object) 다양한 테스트 결과의 수를 담은 객체.
        -   `cancelled` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 취소된 테스트의 총 수.
        -   `failed` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 실패한 테스트의 총 수.
        -   `passed` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 통과한 테스트의 총 수.
        -   `skipped` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 건너뛴 테스트의 총 수.
        -   `suites` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 실행된 테스트 스위트의 총 수.
        -   `tests` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 실행된 테스트의 총 수 (스위트 제외).
        -   `todo` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) TODO 테스트의 총 수.
        -   `topLevel` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 최상위 테스트와 스위트의 총 수.
    -   `duration_ms` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 테스트 실행 시간 (밀리초 단위).
    -   `file` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) | [`<undefined>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type) 요약을 생성한 테스트 파일의 경로. 요약이 여러 파일에 해당하는 경우 이 값은 `undefined`가 됨.
    -   `success` [`<boolean>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type) 테스트 실행이 성공적으로 완료되었는지 여부. 테스트 실패나 커버리지 임계값 미달과 같은 오류가 발생하면 이 값은 `false`로 설정됨.

테스트 실행이 완료될 때 발생하는 이벤트. 이 이벤트는 완료된 테스트 실행과 관련된 메트릭을 포함하며, 테스트 실행이 통과했는지 실패했는지 확인하는 데 유용함. 프로세스 수준의 테스트 격리를 사용하는 경우, 각 테스트 파일에 대해 `'test:summary'` 이벤트가 생성되고 최종 누적 요약도 함께 제공됨.


#### 이벤트: `'test:watch:drained'`[#](https://nodejs.org/docs/latest/api/test.html#event-testwatchdrained)

이 이벤트는 **watch 모드**에서 실행을 위해 대기 중인 테스트가 더 이상 없을 때 발생합니다.


### 클래스: `TestContext`[#](https://nodejs.org/docs/latest/api/test.html#class-testcontext)

`TestContext`의 인스턴스는 테스트 러너와 상호작용하기 위해 각 테스트 함수에 전달됩니다. 하지만 `TestContext` 생성자는 API의 일부로 공개되지 않습니다.


#### `context.before([fn][, options])`[#](https://nodejs.org/docs/latest/api/test.html#contextbeforefn-options)

추가된 버전: v20.1.0, v18.17.0

-   `fn` [`<Function>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function) | [`<AsyncFunction>`](https://tc39.es/ecma262/#sec-async-function-constructor) 훅 함수. 이 함수의 첫 번째 인자는 [`TestContext`](https://nodejs.org/docs/latest/api/test.html#class-testcontext) 객체입니다. 훅이 콜백을 사용하는 경우, 콜백 함수는 두 번째 인자로 전달됩니다. **기본값:** 아무 작업도 하지 않는 함수.
-   `options` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object) 훅의 설정 옵션. 다음 속성을 지원합니다:
    -   `signal` [`<AbortSignal>`](https://nodejs.org/docs/latest/api/globals.html#class-abortsignal) 진행 중인 훅을 중단할 수 있도록 합니다.
    -   `timeout` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 훅이 실패할 때까지의 시간(밀리초). 지정하지 않으면 서브 테스트는 부모로부터 이 값을 상속받습니다. **기본값:** `Infinity`.

이 함수는 현재 테스트의 서브 테스트가 실행되기 전에 실행될 훅을 생성하는 데 사용됩니다.


#### `context.beforeEach([fn][, options])`[#](https://nodejs.org/docs/latest/api/test.html#contextbeforeeachfn-options)

추가된 버전: v18.8.0, v16.18.0

-   `fn` [`<Function>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function) | [`<AsyncFunction>`](https://tc39.es/ecma262/#sec-async-function-constructor) 훅 함수. 이 함수의 첫 번째 인자는 [`TestContext`](https://nodejs.org/docs/latest/api/test.html#class-testcontext) 객체입니다. 훅이 콜백을 사용하는 경우, 콜백 함수는 두 번째 인자로 전달됩니다. **기본값:** 아무 작업도 하지 않는 함수.
-   `options` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object) 훅의 설정 옵션. 다음 속성을 지원합니다:
    -   `signal` [`<AbortSignal>`](https://nodejs.org/docs/latest/api/globals.html#class-abortsignal) 진행 중인 훅을 중단할 수 있게 합니다.
    -   `timeout` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 훅이 실패하기까지의 시간(밀리초). 지정하지 않으면, 하위 테스트는 부모 테스트로부터 이 값을 상속받습니다. **기본값:** `Infinity`.

이 함수는 현재 테스트의 각 하위 테스트 실행 전에 실행될 훅을 생성하는 데 사용됩니다.

```js
test('최상위 테스트', async (t) => {
    t.beforeEach((t) => t.diagnostic(`실행 예정: ${t.name}`));
    await t.test(
        '하위 테스트입니다',
        (t) => {
            assert.ok('여기에 관련된 검증을 추가하세요');
        }
    );
});
```


#### `context.after([fn][, options])`[#](https://nodejs.org/docs/latest/api/test.html#contextafterfn-options)

추가된 버전: v19.3.0, v18.13.0

-   `fn` [`<Function>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function) | [`<AsyncFunction>`](https://tc39.es/ecma262/#sec-async-function-constructor) 훅 함수. 이 함수의 첫 번째 인자는 [`TestContext`](https://nodejs.org/docs/latest/api/test.html#class-testcontext) 객체입니다. 훅이 콜백을 사용하는 경우, 콜백 함수는 두 번째 인자로 전달됩니다. **기본값:** 아무 작업도 하지 않는 함수.
-   `options` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object) 훅의 설정 옵션. 다음 속성을 지원합니다:
    -   `signal` [`<AbortSignal>`](https://nodejs.org/docs/latest/api/globals.html#class-abortsignal) 진행 중인 훅을 중단할 수 있습니다.
    -   `timeout` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 훅이 실패할 때까지의 시간(밀리초). 지정하지 않으면 하위 테스트는 부모로부터 이 값을 상속받습니다. **기본값:** `Infinity`.

이 함수는 현재 테스트가 끝난 후 실행되는 훅을 생성하는 데 사용됩니다.

```js
test('최상위 테스트', async (t) => {
    t.after((t) => t.diagnostic(`${t.name} 실행 완료`));
    assert.ok('여기에 관련된 어설션이 있습니다');
});
```


#### `context.afterEach([fn][, options])`[#](https://nodejs.org/docs/latest/api/test.html#contextaftereachfn-options)

추가된 버전: v18.8.0, v16.18.0

-   `fn` [`<Function>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function) | [`<AsyncFunction>`](https://tc39.es/ecma262/#sec-async-function-constructor) 훅 함수. 이 함수의 첫 번째 인자는 [`TestContext`](https://nodejs.org/docs/latest/api/test.html#class-testcontext) 객체입니다. 훅이 콜백을 사용하는 경우, 콜백 함수는 두 번째 인자로 전달됩니다. **기본값:** 아무 작업도 하지 않는 함수.
-   `options` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object) 훅의 설정 옵션. 다음 속성을 지원합니다:
    -   `signal` [`<AbortSignal>`](https://nodejs.org/docs/latest/api/globals.html#class-abortsignal) 진행 중인 훅을 중단할 수 있게 합니다.
    -   `timeout` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 훅이 실패할 때까지의 시간(밀리초). 지정하지 않으면, 서브 테스트는 부모 테스트로부터 이 값을 상속받습니다. **기본값:** `Infinity`.

이 함수는 현재 테스트의 각 서브 테스트가 실행된 후에 실행될 훅을 생성하는 데 사용됩니다.

```js
test('최상위 테스트', async (t) => {
    t.afterEach((t) => t.diagnostic(`${t.name} 실행 완료`));
    await t.test('서브 테스트', (t) => {
        assert.ok('여기에 관련된 검증을 추가합니다.');
    });
});
```


#### `context.assert`[#](https://nodejs.org/docs/latest/api/test.html#contextassert)

추가된 버전: v22.2.0, v20.15.0

`context`에 바인딩된 assertion 메서드를 포함하는 객체입니다. 테스트 계획을 작성하기 위해 `node:assert` 모듈의 최상위 함수들이 여기에 노출됩니다.

```js
test('test', (t) => {
    t.plan(1);
    t.assert.strictEqual(true, true);
});
```


##### `context.assert.snapshot(value[, options])`[#](https://nodejs.org/docs/latest/api/test.html#contextassertsnapshotvalue-options)

추가된 버전: v22.3.0

-   `value` [`<any>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Data_types) 문자열로 직렬화할 값입니다. Node.js가 [`--test-update-snapshots`](https://nodejs.org/docs/latest/api/cli.html#--test-update-snapshots) 플래그와 함께 시작된 경우, 직렬화된 값이 스냅샷 파일에 기록됩니다. 그렇지 않으면 직렬화된 값이 기존 스냅샷 파일의 해당 값과 비교됩니다.
-   `options` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object) 선택적 구성 옵션입니다. 다음 속성을 지원합니다:
    -   `serializers` [`<Array>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array) `value`를 문자열로 직렬화하는 데 사용되는 동기 함수 배열입니다. `value`는 첫 번째 직렬화 함수의 유일한 인자로 전달됩니다. 각 직렬화 함수의 반환 값은 다음 직렬화 함수의 입력으로 전달됩니다. 모든 직렬화 함수가 실행되면 결과 값이 문자열로 강제 변환됩니다. **기본값:** 직렬화 함수가 제공되지 않으면 테스트 러너의 기본 직렬화 함수가 사용됩니다.

이 함수는 스냅샷 테스트를 위한 단언을 구현합니다.

```js
test('기본 직렬화를 사용한 스냅샷 테스트', (t) => {
    t.assert.snapshot({ value1: 1, value2: 2 });
});

test('커스텀 직렬화를 사용한 스냅샷 테스트', (t) => {
    t.assert.snapshot(
        { value3: 3, value4: 4 },
        { serializers: [(value) => JSON.stringify(value)] }
    );
});
```


#### `context.diagnostic(message)`[#](https://nodejs.org/docs/latest/api/test.html#contextdiagnosticmessage)

추가된 버전: v18.0.0, v16.17.0

-   `message` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) 보고할 메시지

이 함수는 진단 정보를 출력에 기록하는 데 사용됩니다. 모든 진단 정보는 테스트 결과의 끝에 포함됩니다. 이 함수는 값을 반환하지 않습니다.

```js
test('최상위 테스트', (t) => {
    t.diagnostic('진단 메시지');
});
```


#### `context.filePath`[#](https://nodejs.org/docs/latest/api/test.html#contextfilepath)

**추가된 버전:** v22.6.0, v20.16.0

현재 테스트를 생성한 테스트 파일의 절대 경로를 반환합니다. 만약 테스트 파일이 추가 모듈을 임포트하여 테스트를 생성하는 경우, 임포트된 테스트는 루트 테스트 파일의 경로를 반환합니다.


#### `context.fullName`[#](https://nodejs.org/docs/latest/api/test.html#contextfullname)

**추가된 버전:** v22.3.0

테스트와 그 상위 테스트들의 이름을 `>`로 구분하여 나타낸 값입니다.


#### `context.name`[#](https://nodejs.org/docs/latest/api/test.html#contextname)

추가된 버전: v18.8.0, v16.18.0

테스트의 이름입니다.


#### `context.plan(count)`[#](https://nodejs.org/docs/latest/api/test.html#contextplancount)

-   `count` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 실행될 것으로 예상되는 어설션(assertion)과 서브 테스트의 수입니다.

이 함수는 테스트 내에서 실행될 것으로 예상되는 어설션과 서브 테스트의 수를 설정하는 데 사용됩니다. 실행된 어설션과 서브 테스트의 수가 예상된 값과 일치하지 않으면 테스트는 실패합니다.

> 참고: 어설션이 제대로 추적되도록 하려면, `assert`를 직접 사용하는 대신 `t.assert`를 사용해야 합니다.

```js
test('최상위 테스트', (t) => {
    t.plan(2);
    t.assert.ok('여기에 관련된 어설션을 작성합니다.');
    t.test('서브 테스트', () => {});
});
```

비동기 코드를 다룰 때, `plan` 함수를 사용하여 올바른 수의 어설션이 실행되는지 확인할 수 있습니다:

```js
test('스트림과 함께 계획하기', (t, done) => {
    function* generate() {
        yield 'a';
        yield 'b';
        yield 'c';
    }
    const expected = ['a', 'b', 'c'];
    t.plan(expected.length);
    const stream = Readable.from(generate());
    stream.on('data', (chunk) => {
        t.assert.strictEqual(chunk, expected.shift());
    });
    stream.on('end', () => {
        done();
    });
});
```


#### `context.runOnly(shouldRunOnlyTests)`[#](https://nodejs.org/docs/latest/api/test.html#contextrunonlyshouldrunonlytests)

추가된 버전: v18.0.0, v16.17.0

- `shouldRunOnlyTests` [`<boolean>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type) `only` 옵션이 설정된 테스트만 실행할지 여부를 결정합니다.

`shouldRunOnlyTests`가 참(true)인 경우, 테스트 컨텍스트는 `only` 옵션이 설정된 테스트만 실행합니다. 그렇지 않으면 모든 테스트를 실행합니다. 만약 Node.js가 [`--test-only`](https://nodejs.org/docs/latest/api/cli.html#--test-only) 커맨드라인 옵션으로 시작되지 않았다면, 이 함수는 아무런 동작을 하지 않습니다.

```js
test('최상위 테스트', (t) => {
    // 테스트 컨텍스트를 설정하여 'only' 옵션이 있는 하위 테스트만 실행합니다.
    t.runOnly(true);
    return Promise.all([
        t.test('이 하위 테스트는 이제 건너뜁니다'),
        t.test('이 하위 테스트는 실행됩니다', { only: true }),
    ]);
});
```


#### `context.signal`[#](https://nodejs.org/docs/latest/api/test.html#contextsignal)

추가된 버전: v18.7.0, v16.17.0

-   타입: [`<AbortSignal>`](https://nodejs.org/docs/latest/api/globals.html#class-abortsignal)

테스트가 중단되었을 때, 테스트의 하위 작업을 중단하는 데 사용할 수 있습니다.

```js
test('최상위 테스트', async (t) => {
    await fetch('some/uri', { signal: t.signal });
});
```


#### `context.skip([message])`[#](https://nodejs.org/docs/latest/api/test.html#contextskipmessage)

추가된 버전: v18.0.0, v16.17.0

-   `message` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) 선택적으로 생략할 메시지.

이 함수는 테스트의 출력에서 해당 테스트를 생략된 것으로 표시합니다. `message`가 제공되면 출력에 포함됩니다. `skip()`을 호출해도 테스트 함수의 실행이 종료되지는 않습니다. 이 함수는 반환값이 없습니다.

```js
test('최상위 테스트', (t) => {
    // 테스트에 추가 로직이 포함된 경우 여기서도 반환해야 합니다.
    t.skip('이 테스트는 생략됩니다.');
});
```


#### `context.todo([message])`[#](https://nodejs.org/docs/latest/api/test.html#contexttodomessage)

추가된 버전: v18.0.0, v16.17.0

-   `message` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) 선택사항. `TODO` 메시지.

이 함수는 테스트 출력에 `TODO` 지시자를 추가합니다. `message`가 제공되면 출력에 포함됩니다. `todo()`를 호출해도 테스트 함수의 실행은 종료되지 않습니다. 이 함수는 값을 반환하지 않습니다.

```js
test('최상위 테스트', (t) => {
    // 이 테스트는 `TODO`로 표시됨
    t.todo('이것은 TODO입니다');
});
```


#### `context.test([name][, options][, fn])`[#](https://nodejs.org/docs/latest/api/test.html#contexttestname-options-fn)

-   `name` [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) 서브테스트의 이름으로, 테스트 결과를 보고할 때 표시됩니다. **기본값:** `fn`의 `name` 속성 또는 `fn`에 이름이 없는 경우 `'<anonymous>'`입니다.
-   `options` [`<Object>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object) 서브테스트를 위한 설정 옵션입니다. 다음 속성을 지원합니다:
    -   `concurrency` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) | [`<boolean>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type) | [`<null>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Null_type) 숫자를 제공하면, 해당 숫자만큼의 테스트가 애플리케이션 스레드 내에서 병렬로 실행됩니다. `true`인 경우, 모든 서브테스트를 병렬로 실행합니다. `false`인 경우, 한 번에 하나의 테스트만 실행합니다. 지정하지 않으면, 서브테스트는 부모 테스트로부터 이 값을 상속받습니다. **기본값:** `null`.
    -   `only` [`<boolean>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type) 참 값이고, 테스트 컨텍스트가 `only` 테스트를 실행하도록 설정된 경우, 이 테스트가 실행됩니다. 그렇지 않으면 테스트는 건너뜁니다. **기본값:** `false`.
    -   `signal` [`<AbortSignal>`](https://nodejs.org/docs/latest/api/globals.html#class-abortsignal) 진행 중인 테스트를 중단할 수 있습니다.
    -   `skip` [`<boolean>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type) | [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) 참 값인 경우, 테스트를 건너뜁니다. 문자열을 제공하면, 테스트 결과에 해당 문자열이 테스트를 건너뛴 이유로 표시됩니다. **기본값:** `false`.
    -   `todo` [`<boolean>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type) | [`<string>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type) 참 값인 경우, 테스트를 `TODO`로 표시합니다. 문자열을 제공하면, 테스트 결과에 해당 문자열이 테스트가 `TODO`인 이유로 표시됩니다. **기본값:** `false`.
    -   `timeout` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 테스트가 실패할 때까지의 시간(밀리초)입니다. 지정하지 않으면, 서브테스트는 부모 테스트로부터 이 값을 상속받습니다. **기본값:** `Infinity`.
    -   `plan` [`<number>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type) 테스트에서 실행될 것으로 예상되는 어설션과 서브테스트의 수입니다. 테스트에서 실행된 어설션의 수가 계획에 지정된 수와 일치하지 않으면 테스트가 실패합니다. **기본값:** `undefined`.
-   `fn` [`<Function>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function) | [`<AsyncFunction>`](https://tc39.es/ecma262/#sec-async-function-constructor) 테스트할 함수입니다. 이 함수의 첫 번째 인자는 [`TestContext`](https://nodejs.org/docs/latest/api/test.html#class-testcontext) 객체입니다. 테스트가 콜백을 사용하는 경우, 콜백 함수는 두 번째 인자로 전달됩니다. **기본값:** 아무 작업도 하지 않는 함수.
-   반환값: [`<Promise>`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise) 테스트가 완료되면 `undefined`로 이행됩니다.

이 함수는 현재 테스트 아래에 서브테스트를 생성하는 데 사용됩니다. 이 함수는 최상위 [`test()`](https://nodejs.org/docs/latest/api/test.html#testname-options-fn) 함수와 동일한 방식으로 동작합니다.

```js
test('최상위 테스트', async (t) => {
    await t.test(
        '이것은 서브테스트입니다',
        {
            only: false,
            skip: false,
            concurrency: 1,
            todo: false,
            plan: 1
        },
        (t) => {
            t.assert.ok('여기에 관련된 어설션을 작성하세요');
        }
    );
});
```


### 클래스: `SuiteContext`[#](https://nodejs.org/docs/latest/api/test.html#class-suitecontext)

추가된 버전: v18.7.0, v16.17.0

`SuiteContext`의 인스턴스는 테스트 러너와 상호작용하기 위해 각 테스트 스위트(suite) 함수에 전달됩니다. 하지만 `SuiteContext` 생성자는 API의 일부로 노출되지 않습니다.


#### `context.filePath`[#](https://nodejs.org/docs/latest/api/test.html#contextfilepath_1)

**추가된 버전:** v22.6.0

현재 테스트 스위트를 생성한 테스트 파일의 절대 경로를 반환합니다. 만약 테스트 파일이 추가 모듈을 임포트하고 그 모듈이 스위트를 생성한다면, 임포트된 스위트는 루트 테스트 파일의 경로를 반환합니다.


#### `context.name`[#](https://nodejs.org/docs/latest/api/test.html#contextname_1)

추가된 버전: v18.8.0, v16.18.0

테스트 스위트의 이름입니다.


#### `context.signal`[#](https://nodejs.org/docs/latest/api/test.html#contextsignal_1)

추가된 버전: v18.7.0, v16.17.0

-   타입: [`<AbortSignal>`](https://nodejs.org/docs/latest/api/globals.html#class-abortsignal)

테스트가 중단되었을 때, 테스트의 하위 작업을 중단하는 데 사용할 수 있습니다.


