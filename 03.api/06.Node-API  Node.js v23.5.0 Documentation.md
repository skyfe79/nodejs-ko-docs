# Table of Contents

- [Node-API](#node-api)
    - [ABI 안정성의 영향](#abi-안정성의-영향)
    - [빌드하기](#빌드하기)
      - [빌드 도구](#빌드-도구)
    - [node-gyp](#node-gyp)
        - [CMake.js](#cmakejs)
      - [사전 컴파일된 바이너리 업로드](#사전-컴파일된-바이너리-업로드)
        - [node-pre-gyp](#node-pre-gyp)
        - [prebuild](#prebuild)
        - [prebuildify](#prebuildify)
    - [사용법](#사용법)
    - [Node-API 버전 매트릭스[#](https://nodejs.org/docs/latest/api/n-api.html#node-api-version-matrix)](#node-api-버전-매트릭스httpsnodejsorgdocslatestapin-apihtmlnode-api-version-matrix)
    - [환경 생명주기 API](#환경-생명주기-api)
      - [`napi_set_instance_data`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_set_instance_data)](#napi_set_instance_datahttpsnodejsorgdocslatestapin-apihtmlnapi_set_instance_data)
      - [`napi_get_instance_data`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_instance_data)](#napi_get_instance_datahttpsnodejsorgdocslatestapin-apihtmlnapi_get_instance_data)
    - [기본 Node-API 데이터 타입](#기본-node-api-데이터-타입)
      - [`napi_status`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_status)](#napi_statushttpsnodejsorgdocslatestapin-apihtmlnapi_status)
      - [`napi_extended_error_info`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_extended_error_info)](#napi_extended_error_infohttpsnodejsorgdocslatestapin-apihtmlnapi_extended_error_info)
      - [`napi_env`](#napi_env)
      - [`node_api_basic_env`[#](https://nodejs.org/docs/latest/api/n-api.html#node_api_basic_env)](#node_api_basic_envhttpsnodejsorgdocslatestapin-apihtmlnode_api_basic_env)
      - [`napi_value`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_value)](#napi_valuehttpsnodejsorgdocslatestapin-apihtmlnapi_value)
      - [`napi_threadsafe_function`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_threadsafe_function)](#napi_threadsafe_functionhttpsnodejsorgdocslatestapin-apihtmlnapi_threadsafe_function)
      - [`napi_threadsafe_function_release_mode`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_threadsafe_function_release_mode)](#napi_threadsafe_function_release_modehttpsnodejsorgdocslatestapin-apihtmlnapi_threadsafe_function_release_mode)
      - [`napi_threadsafe_function_call_mode`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_threadsafe_function_call_mode)](#napi_threadsafe_function_call_modehttpsnodejsorgdocslatestapin-apihtmlnapi_threadsafe_function_call_mode)
      - [Node-API memory management types[#](https://nodejs.org/docs/latest/api/n-api.html#node-api-memory-management-types)](#node-api-memory-management-typeshttpsnodejsorgdocslatestapin-apihtmlnode-api-memory-management-types)
    - [`napi_handle_scope`](#napi_handle_scope)
        - [`napi_escapable_handle_scope`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_escapable_handle_scope)](#napi_escapable_handle_scopehttpsnodejsorgdocslatestapin-apihtmlnapi_escapable_handle_scope)
        - [`napi_ref`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_ref)](#napi_refhttpsnodejsorgdocslatestapin-apihtmlnapi_ref)
        - [`napi_type_tag`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_type_tag)](#napi_type_taghttpsnodejsorgdocslatestapin-apihtmlnapi_type_tag)
        - [`napi_async_cleanup_hook_handle`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_async_cleanup_hook_handle)](#napi_async_cleanup_hook_handlehttpsnodejsorgdocslatestapin-apihtmlnapi_async_cleanup_hook_handle)
      - [Node-API callback types[#](https://nodejs.org/docs/latest/api/n-api.html#node-api-callback-types)](#node-api-callback-typeshttpsnodejsorgdocslatestapin-apihtmlnode-api-callback-types)
        - [`napi_callback_info`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_callback_info)](#napi_callback_infohttpsnodejsorgdocslatestapin-apihtmlnapi_callback_info)
        - [`napi_callback`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_callback)](#napi_callbackhttpsnodejsorgdocslatestapin-apihtmlnapi_callback)
        - [`node_api_basic_finalize`[#](https://nodejs.org/docs/latest/api/n-api.html#node_api_basic_finalize)](#node_api_basic_finalizehttpsnodejsorgdocslatestapin-apihtmlnode_api_basic_finalize)
        - [`napi_finalize`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_finalize)](#napi_finalizehttpsnodejsorgdocslatestapin-apihtmlnapi_finalize)
        - [`napi_async_execute_callback`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_async_execute_callback)](#napi_async_execute_callbackhttpsnodejsorgdocslatestapin-apihtmlnapi_async_execute_callback)
        - [`napi_async_complete_callback`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_async_complete_callback)](#napi_async_complete_callbackhttpsnodejsorgdocslatestapin-apihtmlnapi_async_complete_callback)
        - [`napi_threadsafe_function_call_js`](#napi_threadsafe_function_call_js)
        - [`napi_cleanup_hook`](#napi_cleanup_hook)
        - [`napi_async_cleanup_hook`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_async_cleanup_hook)](#napi_async_cleanup_hookhttpsnodejsorgdocslatestapin-apihtmlnapi_async_cleanup_hook)
    - [에러 처리](#에러-처리)
      - [반환 값](#반환-값)
        - [`napi_get_last_error_info`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_last_error_info)](#napi_get_last_error_infohttpsnodejsorgdocslatestapin-apihtmlnapi_get_last_error_info)
      - [예외 처리](#예외-처리)
        - [`napi_throw`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_throw)](#napi_throwhttpsnodejsorgdocslatestapin-apihtmlnapi_throw)
        - [`napi_throw_error`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_throw_error)](#napi_throw_errorhttpsnodejsorgdocslatestapin-apihtmlnapi_throw_error)
        - [`napi_throw_type_error`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_throw_type_error)](#napi_throw_type_errorhttpsnodejsorgdocslatestapin-apihtmlnapi_throw_type_error)
        - [`napi_throw_range_error`](#napi_throw_range_error)
        - [`node_api_throw_syntax_error`[#](https://nodejs.org/docs/latest/api/n-api.html#node_api_throw_syntax_error)](#node_api_throw_syntax_errorhttpsnodejsorgdocslatestapin-apihtmlnode_api_throw_syntax_error)
        - [`napi_is_error`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_is_error)](#napi_is_errorhttpsnodejsorgdocslatestapin-apihtmlnapi_is_error)
        - [`napi_create_error`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_error)](#napi_create_errorhttpsnodejsorgdocslatestapin-apihtmlnapi_create_error)
        - [`napi_create_type_error`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_type_error)](#napi_create_type_errorhttpsnodejsorgdocslatestapin-apihtmlnapi_create_type_error)
        - [`napi_create_range_error`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_range_error)](#napi_create_range_errorhttpsnodejsorgdocslatestapin-apihtmlnapi_create_range_error)
        - [`node_api_create_syntax_error`[#](https://nodejs.org/docs/latest/api/n-api.html#node_api_create_syntax_error)](#node_api_create_syntax_errorhttpsnodejsorgdocslatestapin-apihtmlnode_api_create_syntax_error)
        - [`napi_get_and_clear_last_exception`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_and_clear_last_exception)](#napi_get_and_clear_last_exceptionhttpsnodejsorgdocslatestapin-apihtmlnapi_get_and_clear_last_exception)
        - [`napi_is_exception_pending`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_is_exception_pending)](#napi_is_exception_pendinghttpsnodejsorgdocslatestapin-apihtmlnapi_is_exception_pending)
        - [`napi_fatal_exception`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_fatal_exception)](#napi_fatal_exceptionhttpsnodejsorgdocslatestapin-apihtmlnapi_fatal_exception)
      - [치명적 오류](#치명적-오류)
        - [`napi_fatal_error`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_fatal_error)](#napi_fatal_errorhttpsnodejsorgdocslatestapin-apihtmlnapi_fatal_error)
    - [객체 수명 관리](#객체-수명-관리)
      - [핸들 수명을 네이티브 메서드보다 짧게 만들기](#핸들-수명을-네이티브-메서드보다-짧게-만들기)
        - [`napi_open_handle_scope`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_open_handle_scope)](#napi_open_handle_scopehttpsnodejsorgdocslatestapin-apihtmlnapi_open_handle_scope)
        - [`napi_close_handle_scope`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_close_handle_scope)](#napi_close_handle_scopehttpsnodejsorgdocslatestapin-apihtmlnapi_close_handle_scope)
        - [`napi_open_escapable_handle_scope`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_open_escapable_handle_scope)](#napi_open_escapable_handle_scopehttpsnodejsorgdocslatestapin-apihtmlnapi_open_escapable_handle_scope)
        - [`napi_close_escapable_handle_scope`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_close_escapable_handle_scope)](#napi_close_escapable_handle_scopehttpsnodejsorgdocslatestapin-apihtmlnapi_close_escapable_handle_scope)
        - [`napi_escape_handle`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_escape_handle)](#napi_escape_handlehttpsnodejsorgdocslatestapin-apihtmlnapi_escape_handle)
      - [네이티브 메서드의 수명보다 긴 값에 대한 참조](#네이티브-메서드의-수명보다-긴-값에-대한-참조)
        - [`napi_create_reference`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_reference)](#napi_create_referencehttpsnodejsorgdocslatestapin-apihtmlnapi_create_reference)
        - [`napi_delete_reference`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_delete_reference)](#napi_delete_referencehttpsnodejsorgdocslatestapin-apihtmlnapi_delete_reference)
        - [`napi_reference_ref`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_reference_ref)](#napi_reference_refhttpsnodejsorgdocslatestapin-apihtmlnapi_reference_ref)
        - [`napi_reference_unref`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_reference_unref)](#napi_reference_unrefhttpsnodejsorgdocslatestapin-apihtmlnapi_reference_unref)
        - [`napi_get_reference_value`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_reference_value)](#napi_get_reference_valuehttpsnodejsorgdocslatestapin-apihtmlnapi_get_reference_value)
      - [현재 Node.js 환경 종료 시 정리 작업](#현재-nodejs-환경-종료-시-정리-작업)
        - [`napi_add_env_cleanup_hook`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_add_env_cleanup_hook)](#napi_add_env_cleanup_hookhttpsnodejsorgdocslatestapin-apihtmlnapi_add_env_cleanup_hook)
        - [`napi_remove_env_cleanup_hook`](#napi_remove_env_cleanup_hook)
        - [`napi_add_async_cleanup_hook`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_add_async_cleanup_hook)](#napi_add_async_cleanup_hookhttpsnodejsorgdocslatestapin-apihtmlnapi_add_async_cleanup_hook)
        - [`napi_remove_async_cleanup_hook`](#napi_remove_async_cleanup_hook)
      - [Node.js 환경 종료 시의 정리 작업](#nodejs-환경-종료-시의-정리-작업)
    - [모듈 등록](#모듈-등록)
    - [JavaScript 값 다루기](#javascript-값-다루기)
      - [Enum types[#](https://nodejs.org/docs/latest/api/n-api.html#enum-types)](#enum-typeshttpsnodejsorgdocslatestapin-apihtmlenum-types)
        - [`napi_key_collection_mode`](#napi_key_collection_mode)
        - [`napi_key_filter`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_key_filter)](#napi_key_filterhttpsnodejsorgdocslatestapin-apihtmlnapi_key_filter)
        - [`napi_key_conversion`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_key_conversion)](#napi_key_conversionhttpsnodejsorgdocslatestapin-apihtmlnapi_key_conversion)
        - [`napi_valuetype`](#napi_valuetype)
        - [`napi_typedarray_type`](#napi_typedarray_type)
      - [Object creation functions[#](https://nodejs.org/docs/latest/api/n-api.html#object-creation-functions)](#object-creation-functionshttpsnodejsorgdocslatestapin-apihtmlobject-creation-functions)
        - [`napi_create_array`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_array)](#napi_create_arrayhttpsnodejsorgdocslatestapin-apihtmlnapi_create_array)
        - [`napi_create_array_with_length`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_array_with_length)](#napi_create_array_with_lengthhttpsnodejsorgdocslatestapin-apihtmlnapi_create_array_with_length)
        - [`napi_create_arraybuffer`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_arraybuffer)](#napi_create_arraybufferhttpsnodejsorgdocslatestapin-apihtmlnapi_create_arraybuffer)
        - [`napi_create_buffer`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_buffer)](#napi_create_bufferhttpsnodejsorgdocslatestapin-apihtmlnapi_create_buffer)
        - [`napi_create_buffer_copy`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_buffer_copy)](#napi_create_buffer_copyhttpsnodejsorgdocslatestapin-apihtmlnapi_create_buffer_copy)
        - [`napi_create_date`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_date)](#napi_create_datehttpsnodejsorgdocslatestapin-apihtmlnapi_create_date)
        - [`napi_create_external`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_external)](#napi_create_externalhttpsnodejsorgdocslatestapin-apihtmlnapi_create_external)
        - [`napi_create_external_arraybuffer`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_external_arraybuffer)](#napi_create_external_arraybufferhttpsnodejsorgdocslatestapin-apihtmlnapi_create_external_arraybuffer)
        - [`napi_create_external_buffer`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_external_buffer)](#napi_create_external_bufferhttpsnodejsorgdocslatestapin-apihtmlnapi_create_external_buffer)
        - [`napi_create_object`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_object)](#napi_create_objecthttpsnodejsorgdocslatestapin-apihtmlnapi_create_object)
        - [`napi_create_symbol`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_symbol)](#napi_create_symbolhttpsnodejsorgdocslatestapin-apihtmlnapi_create_symbol)
        - [`node_api_symbol_for`[#](https://nodejs.org/docs/latest/api/n-api.html#node_api_symbol_for)](#node_api_symbol_forhttpsnodejsorgdocslatestapin-apihtmlnode_api_symbol_for)
        - [`napi_create_typedarray`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_typedarray)](#napi_create_typedarrayhttpsnodejsorgdocslatestapin-apihtmlnapi_create_typedarray)
        - [`node_api_create_buffer_from_arraybuffer`[#](https://nodejs.org/docs/latest/api/n-api.html#node_api_create_buffer_from_arraybuffer)](#node_api_create_buffer_from_arraybufferhttpsnodejsorgdocslatestapin-apihtmlnode_api_create_buffer_from_arraybuffer)
        - [`napi_create_dataview`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_dataview)](#napi_create_dataviewhttpsnodejsorgdocslatestapin-apihtmlnapi_create_dataview)
      - [Functions to convert from C types to Node-API[#](https://nodejs.org/docs/latest/api/n-api.html#functions-to-convert-from-c-types-to-node-api)](#functions-to-convert-from-c-types-to-node-apihttpsnodejsorgdocslatestapin-apihtmlfunctions-to-convert-from-c-types-to-node-api)
        - [`napi_create_int32`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_int32)](#napi_create_int32httpsnodejsorgdocslatestapin-apihtmlnapi_create_int32)
        - [`napi_create_uint32`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_uint32)](#napi_create_uint32httpsnodejsorgdocslatestapin-apihtmlnapi_create_uint32)
        - [`napi_create_int64`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_int64)](#napi_create_int64httpsnodejsorgdocslatestapin-apihtmlnapi_create_int64)
        - [`napi_create_double`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_double)](#napi_create_doublehttpsnodejsorgdocslatestapin-apihtmlnapi_create_double)
        - [`napi_create_bigint_int64`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_bigint_int64)](#napi_create_bigint_int64httpsnodejsorgdocslatestapin-apihtmlnapi_create_bigint_int64)
        - [`napi_create_bigint_uint64`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_bigint_uint64)](#napi_create_bigint_uint64httpsnodejsorgdocslatestapin-apihtmlnapi_create_bigint_uint64)
        - [`napi_create_bigint_words`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_bigint_words)](#napi_create_bigint_wordshttpsnodejsorgdocslatestapin-apihtmlnapi_create_bigint_words)
        - [`napi_create_string_latin1`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_string_latin1)](#napi_create_string_latin1httpsnodejsorgdocslatestapin-apihtmlnapi_create_string_latin1)
        - [`node_api_create_external_string_latin1`[#](https://nodejs.org/docs/latest/api/n-api.html#node_api_create_external_string_latin1)](#node_api_create_external_string_latin1httpsnodejsorgdocslatestapin-apihtmlnode_api_create_external_string_latin1)
        - [`napi_create_string_utf16`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_string_utf16)](#napi_create_string_utf16httpsnodejsorgdocslatestapin-apihtmlnapi_create_string_utf16)
        - [`node_api_create_external_string_utf16`[#](https://nodejs.org/docs/latest/api/n-api.html#node_api_create_external_string_utf16)](#node_api_create_external_string_utf16httpsnodejsorgdocslatestapin-apihtmlnode_api_create_external_string_utf16)
        - [`napi_create_string_utf8`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_string_utf8)](#napi_create_string_utf8httpsnodejsorgdocslatestapin-apihtmlnapi_create_string_utf8)
      - [최적화된 프로퍼티 키 생성 함수](#최적화된-프로퍼티-키-생성-함수)
        - [`node_api_create_property_key_latin1`[#](https://nodejs.org/docs/latest/api/n-api.html#node_api_create_property_key_latin1)](#node_api_create_property_key_latin1httpsnodejsorgdocslatestapin-apihtmlnode_api_create_property_key_latin1)
        - [`node_api_create_property_key_utf16`[#](https://nodejs.org/docs/latest/api/n-api.html#node_api_create_property_key_utf16)](#node_api_create_property_key_utf16httpsnodejsorgdocslatestapin-apihtmlnode_api_create_property_key_utf16)
        - [`node_api_create_property_key_utf8`[#](https://nodejs.org/docs/latest/api/n-api.html#node_api_create_property_key_utf8)](#node_api_create_property_key_utf8httpsnodejsorgdocslatestapin-apihtmlnode_api_create_property_key_utf8)
      - [Functions to convert from Node-API to C types[#](https://nodejs.org/docs/latest/api/n-api.html#functions-to-convert-from-node-api-to-c-types)](#functions-to-convert-from-node-api-to-c-typeshttpsnodejsorgdocslatestapin-apihtmlfunctions-to-convert-from-node-api-to-c-types)
        - [`napi_get_array_length`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_array_length)](#napi_get_array_lengthhttpsnodejsorgdocslatestapin-apihtmlnapi_get_array_length)
        - [`napi_get_arraybuffer_info`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_arraybuffer_info)](#napi_get_arraybuffer_infohttpsnodejsorgdocslatestapin-apihtmlnapi_get_arraybuffer_info)
        - [`napi_get_buffer_info`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_buffer_info)](#napi_get_buffer_infohttpsnodejsorgdocslatestapin-apihtmlnapi_get_buffer_info)
        - [`napi_get_prototype`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_prototype)](#napi_get_prototypehttpsnodejsorgdocslatestapin-apihtmlnapi_get_prototype)
        - [`napi_get_typedarray_info`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_typedarray_info)](#napi_get_typedarray_infohttpsnodejsorgdocslatestapin-apihtmlnapi_get_typedarray_info)
        - [`napi_get_dataview_info`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_dataview_info)](#napi_get_dataview_infohttpsnodejsorgdocslatestapin-apihtmlnapi_get_dataview_info)
        - [`napi_get_date_value`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_date_value)](#napi_get_date_valuehttpsnodejsorgdocslatestapin-apihtmlnapi_get_date_value)
        - [`napi_get_value_bool`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_value_bool)](#napi_get_value_boolhttpsnodejsorgdocslatestapin-apihtmlnapi_get_value_bool)
        - [`napi_get_value_double`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_value_double)](#napi_get_value_doublehttpsnodejsorgdocslatestapin-apihtmlnapi_get_value_double)
        - [`napi_get_value_bigint_int64`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_value_bigint_int64)](#napi_get_value_bigint_int64httpsnodejsorgdocslatestapin-apihtmlnapi_get_value_bigint_int64)
        - [`napi_get_value_bigint_uint64`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_value_bigint_uint64)](#napi_get_value_bigint_uint64httpsnodejsorgdocslatestapin-apihtmlnapi_get_value_bigint_uint64)
        - [`napi_get_value_bigint_words`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_value_bigint_words)](#napi_get_value_bigint_wordshttpsnodejsorgdocslatestapin-apihtmlnapi_get_value_bigint_words)
        - [`napi_get_value_external`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_value_external)](#napi_get_value_externalhttpsnodejsorgdocslatestapin-apihtmlnapi_get_value_external)
        - [`napi_get_value_int32`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_value_int32)](#napi_get_value_int32httpsnodejsorgdocslatestapin-apihtmlnapi_get_value_int32)
        - [`napi_get_value_int64`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_value_int64)](#napi_get_value_int64httpsnodejsorgdocslatestapin-apihtmlnapi_get_value_int64)
        - [`napi_get_value_string_latin1`](#napi_get_value_string_latin1)
        - [`napi_get_value_string_utf8`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_value_string_utf8)](#napi_get_value_string_utf8httpsnodejsorgdocslatestapin-apihtmlnapi_get_value_string_utf8)
        - [`napi_get_value_string_utf16`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_value_string_utf16)](#napi_get_value_string_utf16httpsnodejsorgdocslatestapin-apihtmlnapi_get_value_string_utf16)
        - [`napi_get_value_uint32`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_value_uint32)](#napi_get_value_uint32httpsnodejsorgdocslatestapin-apihtmlnapi_get_value_uint32)
      - [Functions to get global instances[#](https://nodejs.org/docs/latest/api/n-api.html#functions-to-get-global-instances)](#functions-to-get-global-instanceshttpsnodejsorgdocslatestapin-apihtmlfunctions-to-get-global-instances)
        - [`napi_get_boolean`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_boolean)](#napi_get_booleanhttpsnodejsorgdocslatestapin-apihtmlnapi_get_boolean)
        - [`napi_get_global`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_global)](#napi_get_globalhttpsnodejsorgdocslatestapin-apihtmlnapi_get_global)
        - [`napi_get_null`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_null)](#napi_get_nullhttpsnodejsorgdocslatestapin-apihtmlnapi_get_null)
        - [`napi_get_undefined`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_undefined)](#napi_get_undefinedhttpsnodejsorgdocslatestapin-apihtmlnapi_get_undefined)
    - [자바스크립트 값과 추상 연산 작업하기](#자바스크립트-값과-추상-연산-작업하기)
      - [`napi_coerce_to_bool`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_coerce_to_bool)](#napi_coerce_to_boolhttpsnodejsorgdocslatestapin-apihtmlnapi_coerce_to_bool)
      - [`napi_coerce_to_number`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_coerce_to_number)](#napi_coerce_to_numberhttpsnodejsorgdocslatestapin-apihtmlnapi_coerce_to_number)
      - [`napi_coerce_to_object`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_coerce_to_object)](#napi_coerce_to_objecthttpsnodejsorgdocslatestapin-apihtmlnapi_coerce_to_object)
      - [`napi_coerce_to_string`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_coerce_to_string)](#napi_coerce_to_stringhttpsnodejsorgdocslatestapin-apihtmlnapi_coerce_to_string)
      - [`napi_typeof`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_typeof)](#napi_typeofhttpsnodejsorgdocslatestapin-apihtmlnapi_typeof)
      - [`napi_instanceof`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_instanceof)](#napi_instanceofhttpsnodejsorgdocslatestapin-apihtmlnapi_instanceof)
      - [`napi_is_array`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_is_array)](#napi_is_arrayhttpsnodejsorgdocslatestapin-apihtmlnapi_is_array)
      - [`napi_is_arraybuffer`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_is_arraybuffer)](#napi_is_arraybufferhttpsnodejsorgdocslatestapin-apihtmlnapi_is_arraybuffer)
      - [`napi_is_buffer`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_is_buffer)](#napi_is_bufferhttpsnodejsorgdocslatestapin-apihtmlnapi_is_buffer)
      - [`napi_is_date`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_is_date)](#napi_is_datehttpsnodejsorgdocslatestapin-apihtmlnapi_is_date)
      - [`napi_is_error`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_is_error_1)](#napi_is_errorhttpsnodejsorgdocslatestapin-apihtmlnapi_is_error_1)
      - [`napi_is_typedarray`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_is_typedarray)](#napi_is_typedarrayhttpsnodejsorgdocslatestapin-apihtmlnapi_is_typedarray)
      - [`napi_is_dataview`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_is_dataview)](#napi_is_dataviewhttpsnodejsorgdocslatestapin-apihtmlnapi_is_dataview)
      - [`napi_strict_equals`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_strict_equals)](#napi_strict_equalshttpsnodejsorgdocslatestapin-apihtmlnapi_strict_equals)
      - [`napi_detach_arraybuffer`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_detach_arraybuffer)](#napi_detach_arraybufferhttpsnodejsorgdocslatestapin-apihtmlnapi_detach_arraybuffer)
      - [`napi_is_detached_arraybuffer`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_is_detached_arraybuffer)](#napi_is_detached_arraybufferhttpsnodejsorgdocslatestapin-apihtmlnapi_is_detached_arraybuffer)
    - [JavaScript 프로퍼티 작업하기](#javascript-프로퍼티-작업하기)
      - [Structures[#](https://nodejs.org/docs/latest/api/n-api.html#structures)](#structureshttpsnodejsorgdocslatestapin-apihtmlstructures)
        - [`napi_property_attributes`](#napi_property_attributes)
        - [`napi_property_descriptor`](#napi_property_descriptor)
      - [Functions[#](https://nodejs.org/docs/latest/api/n-api.html#functions)](#functionshttpsnodejsorgdocslatestapin-apihtmlfunctions)
        - [`napi_get_property_names`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_property_names)](#napi_get_property_nameshttpsnodejsorgdocslatestapin-apihtmlnapi_get_property_names)
        - [`napi_get_all_property_names`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_all_property_names)](#napi_get_all_property_nameshttpsnodejsorgdocslatestapin-apihtmlnapi_get_all_property_names)
        - [`napi_set_property`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_set_property)](#napi_set_propertyhttpsnodejsorgdocslatestapin-apihtmlnapi_set_property)
        - [`napi_get_property`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_property)](#napi_get_propertyhttpsnodejsorgdocslatestapin-apihtmlnapi_get_property)
        - [`napi_has_property`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_has_property)](#napi_has_propertyhttpsnodejsorgdocslatestapin-apihtmlnapi_has_property)
        - [`napi_delete_property`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_delete_property)](#napi_delete_propertyhttpsnodejsorgdocslatestapin-apihtmlnapi_delete_property)
        - [`napi_has_own_property`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_has_own_property)](#napi_has_own_propertyhttpsnodejsorgdocslatestapin-apihtmlnapi_has_own_property)
        - [`napi_set_named_property`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_set_named_property)](#napi_set_named_propertyhttpsnodejsorgdocslatestapin-apihtmlnapi_set_named_property)
        - [`napi_get_named_property`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_named_property)](#napi_get_named_propertyhttpsnodejsorgdocslatestapin-apihtmlnapi_get_named_property)
        - [`napi_has_named_property`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_has_named_property)](#napi_has_named_propertyhttpsnodejsorgdocslatestapin-apihtmlnapi_has_named_property)
        - [`napi_set_element`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_set_element)](#napi_set_elementhttpsnodejsorgdocslatestapin-apihtmlnapi_set_element)
        - [`napi_get_element`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_element)](#napi_get_elementhttpsnodejsorgdocslatestapin-apihtmlnapi_get_element)
        - [`napi_has_element`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_has_element)](#napi_has_elementhttpsnodejsorgdocslatestapin-apihtmlnapi_has_element)
        - [`napi_delete_element`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_delete_element)](#napi_delete_elementhttpsnodejsorgdocslatestapin-apihtmlnapi_delete_element)
        - [`napi_define_properties`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_define_properties)](#napi_define_propertieshttpsnodejsorgdocslatestapin-apihtmlnapi_define_properties)
        - [`napi_object_freeze`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_object_freeze)](#napi_object_freezehttpsnodejsorgdocslatestapin-apihtmlnapi_object_freeze)
        - [`napi_object_seal`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_object_seal)](#napi_object_sealhttpsnodejsorgdocslatestapin-apihtmlnapi_object_seal)
    - [자바스크립트 함수 작업하기](#자바스크립트-함수-작업하기)
      - [`napi_call_function`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_call_function)](#napi_call_functionhttpsnodejsorgdocslatestapin-apihtmlnapi_call_function)
      - [`napi_create_function`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_function)](#napi_create_functionhttpsnodejsorgdocslatestapin-apihtmlnapi_create_function)
      - [`napi_get_cb_info`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_cb_info)](#napi_get_cb_infohttpsnodejsorgdocslatestapin-apihtmlnapi_get_cb_info)
      - [`napi_get_new_target`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_new_target)](#napi_get_new_targethttpsnodejsorgdocslatestapin-apihtmlnapi_get_new_target)
      - [`napi_new_instance`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_new_instance)](#napi_new_instancehttpsnodejsorgdocslatestapin-apihtmlnapi_new_instance)
    - [객체 래핑](#객체-래핑)
      - [`napi_define_class`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_define_class)](#napi_define_classhttpsnodejsorgdocslatestapin-apihtmlnapi_define_class)
      - [`napi_wrap`](#napi_wrap)
      - [`napi_unwrap`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_unwrap)](#napi_unwraphttpsnodejsorgdocslatestapin-apihtmlnapi_unwrap)
      - [`napi_remove_wrap`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_remove_wrap)](#napi_remove_wraphttpsnodejsorgdocslatestapin-apihtmlnapi_remove_wrap)
      - [`napi_type_tag_object`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_type_tag_object)](#napi_type_tag_objecthttpsnodejsorgdocslatestapin-apihtmlnapi_type_tag_object)
      - [`napi_check_object_type_tag`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_check_object_type_tag)](#napi_check_object_type_taghttpsnodejsorgdocslatestapin-apihtmlnapi_check_object_type_tag)
      - [`napi_add_finalizer`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_add_finalizer)](#napi_add_finalizerhttpsnodejsorgdocslatestapin-apihtmlnapi_add_finalizer)
        - [`node_api_post_finalizer`[#](https://nodejs.org/docs/latest/api/n-api.html#node_api_post_finalizer)](#node_api_post_finalizerhttpsnodejsorgdocslatestapin-apihtmlnode_api_post_finalizer)
    - [간단한 비동기 작업](#간단한-비동기-작업)
      - [`napi_create_async_work`](#napi_create_async_work)
      - [`napi_delete_async_work`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_delete_async_work)](#napi_delete_async_workhttpsnodejsorgdocslatestapin-apihtmlnapi_delete_async_work)
      - [`napi_queue_async_work`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_queue_async_work)](#napi_queue_async_workhttpsnodejsorgdocslatestapin-apihtmlnapi_queue_async_work)
      - [`napi_cancel_async_work`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_cancel_async_work)](#napi_cancel_async_workhttpsnodejsorgdocslatestapin-apihtmlnapi_cancel_async_work)
    - [커스텀 비동기 작업](#커스텀-비동기-작업)
      - [`napi_async_init`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_async_init)](#napi_async_inithttpsnodejsorgdocslatestapin-apihtmlnapi_async_init)
      - [`napi_async_destroy`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_async_destroy)](#napi_async_destroyhttpsnodejsorgdocslatestapin-apihtmlnapi_async_destroy)
      - [`napi_make_callback`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_make_callback)](#napi_make_callbackhttpsnodejsorgdocslatestapin-apihtmlnapi_make_callback)
      - [`napi_open_callback_scope`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_open_callback_scope)](#napi_open_callback_scopehttpsnodejsorgdocslatestapin-apihtmlnapi_open_callback_scope)
      - [`napi_close_callback_scope`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_close_callback_scope)](#napi_close_callback_scopehttpsnodejsorgdocslatestapin-apihtmlnapi_close_callback_scope)
    - [Version management[#](https://nodejs.org/docs/latest/api/n-api.html#version-management)](#version-managementhttpsnodejsorgdocslatestapin-apihtmlversion-management)
      - [`napi_get_node_version`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_node_version)](#napi_get_node_versionhttpsnodejsorgdocslatestapin-apihtmlnapi_get_node_version)
      - [`napi_get_version`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_version)](#napi_get_versionhttpsnodejsorgdocslatestapin-apihtmlnapi_get_version)
    - [Memory management[#](https://nodejs.org/docs/latest/api/n-api.html#memory-management)](#memory-managementhttpsnodejsorgdocslatestapin-apihtmlmemory-management)
      - [`napi_adjust_external_memory`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_adjust_external_memory)](#napi_adjust_external_memoryhttpsnodejsorgdocslatestapin-apihtmlnapi_adjust_external_memory)
    - [Promise[#](https://nodejs.org/docs/latest/api/n-api.html#promises)](#promisehttpsnodejsorgdocslatestapin-apihtmlpromises)
      - [`napi_create_promise`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_promise)](#napi_create_promisehttpsnodejsorgdocslatestapin-apihtmlnapi_create_promise)
      - [`napi_resolve_deferred`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_resolve_deferred)](#napi_resolve_deferredhttpsnodejsorgdocslatestapin-apihtmlnapi_resolve_deferred)
      - [`napi_reject_deferred`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_reject_deferred)](#napi_reject_deferredhttpsnodejsorgdocslatestapin-apihtmlnapi_reject_deferred)
      - [`napi_is_promise`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_is_promise)](#napi_is_promisehttpsnodejsorgdocslatestapin-apihtmlnapi_is_promise)
    - [스크립트 실행](#스크립트-실행)
      - [`napi_run_script`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_run_script)](#napi_run_scripthttpsnodejsorgdocslatestapin-apihtmlnapi_run_script)
    - [libuv 이벤트 루프](#libuv-이벤트-루프)
      - [`napi_get_uv_event_loop`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_uv_event_loop)](#napi_get_uv_event_loophttpsnodejsorgdocslatestapin-apihtmlnapi_get_uv_event_loop)
    - [비동기 스레드 안전 함수 호출](#비동기-스레드-안전-함수-호출)
      - [스레드 안전 함수 호출하기](#스레드-안전-함수-호출하기)
      - [스레드 안전 함수의 참조 카운팅](#스레드-안전-함수의-참조-카운팅)
      - [프로세스 실행 유지 여부 결정하기](#프로세스-실행-유지-여부-결정하기)
      - [`napi_create_threadsafe_function`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_threadsafe_function)](#napi_create_threadsafe_functionhttpsnodejsorgdocslatestapin-apihtmlnapi_create_threadsafe_function)
      - [`napi_get_threadsafe_function_context`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_threadsafe_function_context)](#napi_get_threadsafe_function_contexthttpsnodejsorgdocslatestapin-apihtmlnapi_get_threadsafe_function_context)
      - [`napi_call_threadsafe_function`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_call_threadsafe_function)](#napi_call_threadsafe_functionhttpsnodejsorgdocslatestapin-apihtmlnapi_call_threadsafe_function)
      - [`napi_acquire_threadsafe_function`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_acquire_threadsafe_function)](#napi_acquire_threadsafe_functionhttpsnodejsorgdocslatestapin-apihtmlnapi_acquire_threadsafe_function)
      - [`napi_release_threadsafe_function`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_release_threadsafe_function)](#napi_release_threadsafe_functionhttpsnodejsorgdocslatestapin-apihtmlnapi_release_threadsafe_function)
      - [`napi_ref_threadsafe_function`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_ref_threadsafe_function)](#napi_ref_threadsafe_functionhttpsnodejsorgdocslatestapin-apihtmlnapi_ref_threadsafe_function)
      - [`napi_unref_threadsafe_function`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_unref_threadsafe_function)](#napi_unref_threadsafe_functionhttpsnodejsorgdocslatestapin-apihtmlnapi_unref_threadsafe_function)
    - [Miscellaneous utilities[#](https://nodejs.org/docs/latest/api/n-api.html#miscellaneous-utilities)](#miscellaneous-utilitieshttpsnodejsorgdocslatestapin-apihtmlmiscellaneous-utilities)
      - [`node_api_get_module_file_name`[#](https://nodejs.org/docs/latest/api/n-api.html#node_api_get_module_file_name)](#node_api_get_module_file_namehttpsnodejsorgdocslatestapin-apihtmlnode_api_get_module_file_name)

# Node-API

Node-API(이전 명칭: N-API)는 네이티브 애드온을 빌드하기 위한 API입니다. 이 API는 기본 JavaScript 런타임(예: V8)과 독립적이며, Node.js 자체의 일부로 유지됩니다. Node-API는 Node.js 버전 간에 **ABI(Application Binary Interface)** 안정성을 보장합니다. 이는 애드온이 기본 JavaScript 엔진의 변경으로부터 격리되도록 하며, 한 주요 버전용으로 컴파일된 모듈이 재컴파일 없이 이후 Node.js 주요 버전에서 실행될 수 있게 합니다. [ABI 안정성](https://nodejs.org/en/docs/guides/abi-stability/) 가이드에서 더 자세한 설명을 확인할 수 있습니다.

애드온은 [C++ 애드온](https://nodejs.org/docs/latest/api/addons.html) 섹션에 설명된 접근 방식과 도구를 사용해 빌드/패키징됩니다. 유일한 차이점은 네이티브 코드에서 사용하는 API 집합입니다. V8 또는 [Node.js용 네이티브 추상화(NAN)](https://github.com/nodejs/nan) API 대신 Node-API에서 제공하는 함수를 사용합니다.

Node-API가 노출하는 API는 일반적으로 JavaScript 값을 생성하고 조작하는 데 사용됩니다. 개념과 연산은 ECMA-262 언어 사양에 정의된 아이디어와 대응됩니다. 이 API는 다음과 같은 특징을 가집니다:

- 모든 Node-API 호출은 `napi_status` 타입의 상태 코드를 반환합니다. 이 상태는 API 호출이 성공했는지 실패했는지를 나타냅니다.
- API의 반환 값은 **out 매개변수**를 통해 전달됩니다.
- 모든 JavaScript 값은 `napi_value`라는 불투명 타입으로 추상화됩니다.
- 오류 상태 코드가 반환된 경우, `napi_get_last_error_info`를 사용해 추가 정보를 얻을 수 있습니다. 더 자세한 내용은 [오류 처리](https://nodejs.org/docs/latest/api/n-api.html#error-handling) 섹션에서 확인할 수 있습니다.

Node-API는 C API로, Node.js 버전과 컴파일러 수준 간에 ABI 안정성을 보장합니다. C++ API는 사용하기 더 쉬울 수 있습니다. 이를 지원하기 위해 프로젝트는 [`node-addon-api`](https://github.com/nodejs/node-addon-api)라는 C++ 래퍼 모듈을 유지합니다. 이 래퍼는 인라인 가능한 C++ API를 제공합니다. `node-addon-api`로 빌드된 바이너리는 Node.js가 내보내는 Node-API C 기반 함수의 심볼에 의존합니다. `node-addon-api`는 Node-API를 호출하는 코드를 더 효율적으로 작성할 수 있게 합니다. 예를 들어, 다음 `node-addon-api` 코드를 살펴보겠습니다. 첫 번째 섹션은 `node-addon-api` 코드를, 두 번째 섹션은 애드온에서 실제로 사용되는 코드를 보여줍니다.

```cpp
Object obj = Object::New(env);
obj["foo"] = String::New(env, "bar");
```

```cpp
napi_status status;
napi_value object, string;
status = napi_create_object(env, &object);
if (status != napi_ok) {
    napi_throw_error(env, ...);
    return;
}
status = napi_create_string_utf8(env, "bar", NAPI_AUTO_LENGTH, &string);
if (status != napi_ok) {
    napi_throw_error(env, ...);
    return;
}
status = napi_set_named_property(env, object, "foo", string);
if (status != napi_ok) {
    napi_throw_error(env, ...);
    return;
}
```

최종 결과는 애드온이 내보낸 C API만 사용한다는 점입니다. 따라서 C API가 제공하는 ABI 안정성의 이점을 그대로 유지합니다.

C API 대신 `node-addon-api`를 사용할 때는 `node-addon-api`의 [API 문서](https://github.com/nodejs/node-addon-api#api-documentation)를 참고하세요.

[Node-API 리소스](https://nodejs.github.io/node-addon-examples/)는 Node-API와 `node-addon-api`를 처음 시작하는 개발자에게 훌륭한 가이드와 팁을 제공합니다. 추가 미디어 리소스는 [Node-API 미디어](https://github.com/nodejs/abi-stable-node/blob/HEAD/node-api-media.md) 페이지에서 확인할 수 있습니다.


### ABI 안정성의 영향

Node-API는 ABI 안정성을 보장하지만, Node.js의 다른 부분이나 애드온에서 사용하는 외부 라이브러리는 이를 보장하지 않을 수 있습니다. 특히, 다음 API들은 주요 버전 간에 ABI 안정성을 보장하지 않습니다:

- Node.js C++ API (다음 헤더 파일을 통해 사용 가능)
    
    ```cpp
    #include <node.h>
    #include <node_buffer.h>
    #include <node_object_wrap.h>
    #include <node_version.h>
    ```
    
- Node.js에 포함된 libuv API (다음 헤더 파일을 통해 사용 가능)
    
    ```cpp
    #include <uv.h>
    ```
    
- V8 API (다음 헤더 파일을 통해 사용 가능)
    
    ```cpp
    #include <v8.h>
    ```

따라서 애드온이 Node.js 주요 버전 간에 ABI 호환성을 유지하려면, Node-API만을 사용해야 합니다. 이를 위해 다음 헤더 파일만 포함해야 합니다.

```c
#include <node_api.h>
```

또한, 애드온이 사용하는 모든 외부 라이브러리가 Node-API와 유사한 ABI 안정성을 보장하는지 확인해야 합니다.


### 빌드하기

자바스크립트로 작성된 모듈과 달리, Node-API를 사용하여 Node.js 네이티브 애드온을 개발하고 배포하려면 추가 도구가 필요합니다. Node.js 개발에 필요한 기본 도구 외에도, 네이티브 애드온 개발자는 C와 C++ 코드를 바이너리로 컴파일할 수 있는 툴체인이 필요합니다. 또한, 네이티브 애드온이 배포되는 방식에 따라, 네이티브 애드온을 사용하는 **사용자**도 C/C++ 툴체인이 설치되어 있어야 합니다.

리눅스 개발자라면 필요한 C/C++ 툴체인 패키지를 쉽게 구할 수 있습니다. [GCC](https://gcc.gnu.org/)는 다양한 플랫폼에서 빌드와 테스트를 위해 Node.js 커뮤니티에서 널리 사용됩니다. 많은 개발자에게 [LLVM](https://llvm.org/) 컴파일러 인프라도 좋은 선택입니다.

맥 개발자라면 [Xcode](https://developer.apple.com/xcode/)가 필요한 모든 컴파일러 도구를 제공합니다. 하지만 전체 Xcode IDE를 설치할 필요는 없습니다. 다음 명령어로 필요한 툴체인을 설치할 수 있습니다:

```bash
xcode-select --install
```

윈도우 개발자라면 [Visual Studio](https://visualstudio.microsoft.com/)가 필요한 모든 컴파일러 도구를 제공합니다. 하지만 전체 Visual Studio IDE를 설치할 필요는 없습니다. 다음 명령어로 필요한 툴체인을 설치할 수 있습니다:

```bash
npm install --global windows-build-tools
```

아래 섹션에서는 Node.js 네이티브 애드온을 개발하고 배포하기 위해 사용할 수 있는 추가 도구에 대해 설명합니다.


#### 빌드 도구

여기서 소개하는 도구들은 네이티브 애드온을 사용하려면 C/C++ 툴체인이 설치되어 있어야 합니다. 이를 통해 네이티브 애드온을 성공적으로 설치할 수 있습니다.


### node-gyp

[node-gyp](https://github.com/nodejs/node-gyp)는 Google의 [GYP](https://gyp.gsrc.io/) 도구를 기반으로 한 [gyp-next](https://github.com/nodejs/gyp-next) 포크를 사용하는 빌드 시스템입니다. npm과 함께 번들로 제공되며, GYP와 node-gyp는 Python이 설치되어 있어야 합니다.

전통적으로 node-gyp는 네이티브 애드온을 빌드하는 데 주로 사용되었습니다. 이 도구는 널리 사용되고 있으며 문서화도 잘 되어 있습니다. 하지만 일부 개발자들은 node-gyp의 한계를 경험하기도 했습니다.


##### CMake.js

[CMake.js](https://github.com/cmake-js/cmake-js)는 [CMake](https://cmake.org/)를 기반으로 한 대체 빌드 시스템입니다.

CMake.js는 이미 CMake를 사용하는 프로젝트나 node-gyp의 제약에 영향을 받는 개발자에게 적합한 선택입니다. [`build_with_cmake`](https://github.com/nodejs/node-addon-examples/tree/main/src/8-tooling/build_with_cmake)는 CMake 기반 네이티브 애드온 프로젝트의 예제입니다.


#### 사전 컴파일된 바이너리 업로드

여기서 소개할 세 가지 도구는 네이티브 애드온 개발자와 관리자가 바이너리를 생성하여 공개 또는 비공개 서버에 업로드할 수 있게 해줍니다. 이 도구들은 일반적으로 [Travis CI](https://travis-ci.org/)나 [AppVeyor](https://www.appveyor.com/)와 같은 CI/CD 빌드 시스템과 통합되어 다양한 플랫폼과 아키텍처를 위한 바이너리를 빌드하고 업로드합니다. 이렇게 업로드된 바이너리는 C/C++ 툴체인을 설치하지 않은 사용자도 다운로드하여 사용할 수 있습니다.


##### node-pre-gyp

[node-pre-gyp](https://github.com/mapbox/node-pre-gyp)는 node-gyp를 기반으로 한 도구로, 개발자가 선택한 서버에 바이너리를 업로드할 수 있는 기능을 추가합니다. 특히 node-pre-gyp는 Amazon S3에 바이너리를 업로드하는 데 뛰어난 지원을 제공합니다.


##### prebuild

[prebuild](https://github.com/prebuild/prebuild)는 node-gyp 또는 CMake.js를 사용한 빌드를 지원하는 도구입니다. 다양한 서버를 지원하는 node-pre-gyp와 달리, prebuild는 바이너리를 [GitHub 릴리스](https://help.github.com/en/github/administering-a-repository/about-releases)에만 업로드합니다. CMake.js를 사용하는 GitHub 프로젝트에 적합한 선택입니다.


##### prebuildify

[prebuildify](https://github.com/prebuild/prebuildify)는 node-gyp를 기반으로 한 도구입니다. prebuildify의 장점은 네이티브 애드온이 npm에 업로드될 때 빌드된 바이너리가 함께 번들로 제공된다는 점입니다. 이 바이너리는 npm에서 다운로드되며, 네이티브 애드온이 설치될 때 모듈 사용자에게 즉시 사용 가능합니다.


### 사용법

Node-API 함수를 사용하려면, Node 개발 트리의 `src` 디렉토리에 있는 [`node_api.h`](https://github.com/nodejs/node/blob/HEAD/src/node_api.h) 파일을 포함해야 합니다:

```c
#include <node_api.h>
```

이렇게 하면 해당 Node.js 릴리스의 기본 `NAPI_VERSION`이 적용됩니다. 특정 버전의 Node-API와의 호환성을 보장하려면, 헤더 파일을 포함할 때 버전을 명시적으로 지정할 수 있습니다:

```c
#define NAPI_VERSION 3
#include <node_api.h>
```

이렇게 하면 Node-API의 기능이 지정된 버전(이전 버전 포함)에서 사용 가능한 기능으로 제한됩니다.

일부 Node-API는 실험적 기능이며, 명시적으로 활성화해야 합니다:

```c
#define NAPI_EXPERIMENTAL
#include <node_api.h>
```

이 경우, 실험적 API를 포함한 전체 API 기능이 모듈 코드에서 사용 가능해집니다.

가끔, 이미 출시된 안정적인 API에 영향을 미치는 실험적 기능이 도입될 수 있습니다. 이러한 기능은 옵트아웃(opt-out)을 통해 비활성화할 수 있습니다:

```c
#define NAPI_EXPERIMENTAL
#define NODE_API_EXPERIMENTAL__OPT_OUT
#include <node_api.h>
```

여기서 `<FEATURE_NAME>`은 실험적 및 안정적인 API 모두에 영향을 미치는 실험적 기능의 이름입니다.


### Node-API 버전 매트릭스[#](https://nodejs.org/docs/latest/api/n-api.html#node-api-version-matrix)

버전 9 이전까지 Node-API 버전은 Node.js와 독립적으로 버전이 관리되었으며, 각 버전은 이전 버전의 모든 API를 포함하면서 새로운 기능을 추가하는 방식으로 확장되었습니다. 각 Node.js 버전은 단 하나의 Node-API 버전만 지원했습니다. 예를 들어, v18.15.0은 Node-API 버전 8만 지원합니다. ABI 안정성은 버전 8이 이전 모든 버전의 엄격한 상위 집합이기 때문에 달성되었습니다.

버전 9부터는 Node-API 버전이 여전히 독립적으로 관리되지만, Node-API 버전 9에서 실행되던 애드온이 버전 10에서 실행되기 위해 코드 업데이트가 필요할 수 있습니다. 그러나 ABI 안정성은 유지됩니다. Node.js 버전이 Node-API 버전 8 이상을 지원하는 경우, 버전 8부터 지원하는 최고 버전까지 모든 버전을 지원하며, 애드온이 더 높은 Node-API 버전을 선택하지 않는 한 기본적으로 버전 8 API를 제공합니다. 이 접근 방식은 기존 Node-API 함수를 더 잘 최적화할 수 있는 유연성을 제공하면서도 ABI 안정성을 유지합니다. 기존 애드온은 이전 Node-API 버전을 사용하여 재컴파일 없이 계속 실행할 수 있습니다. 애드온이 새로운 Node-API 버전의 기능이 필요한 경우, 해당 새로운 함수를 사용하기 위해 기존 코드를 변경하고 재컴파일해야 합니다.

Node-API 버전 9 이상을 지원하는 Node.js 버전에서 `NAPI_VERSION=X`를 정의하고 기존 애드온 초기화 매크로를 사용하면, 런타임에 사용할 Node-API 버전이 애드온에 포함됩니다. `NAPI_VERSION`이 설정되지 않은 경우 기본값은 8입니다.

이 표는 오래된 스트림에서는 최신 정보가 아닐 수 있으며, 최신 정보는 [Node-API 버전 매트릭스](https://nodejs.org/docs/latest/api/n-api.html#node-api-version-matrix)에서 확인할 수 있습니다.

| Node-API 버전 | 지원 버전 |
| --- | --- |
| 9 | v18.17.0+, 20.3.0+, 21.0.0 및 이후 모든 버전 |
| 8 | v12.22.0+, v14.17.0+, v15.12.0+, 16.0.0 및 이후 모든 버전 |
| 7 | v10.23.0+, v12.19.0+, v14.12.0+, 15.0.0 및 이후 모든 버전 |
| 6 | v10.20.0+, v12.17.0+, 14.0.0 및 이후 모든 버전 |
| 5 | v10.17.0+, v12.11.0+, 13.0.0 및 이후 모든 버전 |
| 4 | v10.16.0+, v11.8.0+, 12.0.0 및 이후 모든 버전 |
| 3 | v6.14.2\*, 8.11.2+, v9.11.0+\*, 10.0.0 및 이후 모든 버전 |
| 2 | v8.10.0+\*, v9.3.0+\*, 10.0.0 및 이후 모든 버전 |
| 1 | v8.6.0+\*\*, v9.0.0+\*, 10.0.0 및 이후 모든 버전 |

\* Node-API는 실험적이었습니다.

\*\* Node.js 8.0.0은 Node-API를 실험적으로 포함했습니다. Node-API 버전 1로 출시되었지만 Node.js 8.6.0까지 계속 발전했습니다. Node.js 8.6.0 이전 버전의 API는 다릅니다. Node-API 버전 3 이상을 사용하는 것을 권장합니다.

Node-API에 문서화된 각 API에는 `added in:`이라는 헤더가 있으며, 안정적인 API에는 추가로 `Node-API version:` 헤더가 있습니다. API는 `Node-API version:`에 표시된 버전 이상을 지원하는 Node.js 버전에서 직접 사용할 수 있습니다. `Node-API version:`에 나열된 버전을 지원하지 않는 Node.js 버전을 사용하거나 `Node-API version:`이 나열되지 않은 경우, `#define NAPI_EXPERIMENTAL`이 `node_api.h` 또는 `js_native_api.h`를 포함하기 전에 선언되어야 API를 사용할 수 있습니다. `added in:`에 표시된 버전보다 이후의 Node.js 버전에서 API가 사용할 수 없는 것처럼 보인다면, 이는 대부분 그 이유 때문일 것입니다.

네이티브 코드에서 ECMAScript 기능에 접근하는 것과 관련된 Node-API는 `js_native_api.h`와 `js_native_api_types.h`에서 별도로 찾을 수 있습니다. 이 헤더에 정의된 API는 `node_api.h`와 `node_api_types.h`에 포함되어 있습니다. 이 헤더는 Node.js 외부에서 Node-API를 구현할 수 있도록 이렇게 구조화되었습니다. 이러한 구현에서는 Node.js 특정 API가 적용되지 않을 수 있습니다.

애드온의 Node.js 특정 부분은 JavaScript 환경에 실제 기능을 노출하는 코드와 분리할 수 있습니다. 이렇게 하면 후자는 여러 Node-API 구현과 함께 사용될 수 있습니다. 아래 예제에서 `addon.c`와 `addon.h`는 `js_native_api.h`만 참조합니다. 이렇게 하면 `addon.c`가 Node.js의 Node-API 구현 또는 Node.js 외부의 Node-API 구현에 대해 재사용될 수 있습니다.

`addon_node.c`는 애드온의 Node.js 특정 진입점을 포함하는 별도의 파일이며, 애드온이 Node.js 환경에 로드될 때 `addon.c`를 호출하여 애드온을 인스턴스화합니다.

```c
// addon.h
#ifndef _ADDON_H_
#define _ADDON_H_
#include <js_native_api.h>

napi_value create_addon(napi_env env);
#endif // _ADDON_H_
```

```c
// addon.c
#include "addon.h"

#define NODE_API_CALL(env, call) \
    do { \
        napi_status status = (call); \
        if (status != napi_ok) { \
            const napi_extended_error_info* error_info = NULL; \
            napi_get_last_error_info((env), &error_info); \
            const char* err_message = error_info->error_message; \
            bool is_pending; \
            napi_is_exception_pending((env), &is_pending); \
            /* 예외가 이미 대기 중인 경우 다시 던지지 않음 */ \
            if (!is_pending) { \
                const char* message = (err_message == NULL) \
                    ? "empty error message" \
                    : err_message; \
                napi_throw_error((env), NULL, message); \
            } \
            return NULL; \
        } \
    } while(0)

static napi_value DoSomethingUseful(napi_env env, napi_callback_info info) {
    // 유용한 작업 수행
    return NULL;
}

napi_value create_addon(napi_env env) {
    napi_value result;
    NODE_API_CALL(env, napi_create_object(env, &result));

    napi_value exported_function;
    NODE_API_CALL(env, napi_create_function(env, "doSomethingUseful", NAPI_AUTO_LENGTH, DoSomethingUseful, NULL, &exported_function));

    NODE_API_CALL(env, napi_set_named_property(env, result, "doSomethingUseful", exported_function));

    return result;
}
```

```c
// addon_node.c
#include <node_api.h>
#include "addon.h"

NAPI_MODULE_INIT(/* napi_env env, napi_value exports */) {
    // 이 함수는 `napi_value`를 반환해야 함
    // `napi_env env`와 `napi_value exports` 변수는 `NAPI_MODULE_INIT()` 정의에 의해 제공되므로 함수 내에서 사용 가능
    return create_addon(env);
}
```


### 환경 생명주기 API

[ECMAScript 언어 사양](https://tc39.github.io/ecma262/)의 [8.7절](https://tc39.es/ecma262/#sec-agents)은 "에이전트(Agent)"라는 개념을 정의합니다. 에이전트는 자바스크립트 코드가 실행되는 독립적인 환경을 의미합니다. 여러 에이전트는 동시에 또는 순차적으로 시작되고 종료될 수 있습니다.

Node.js 환경은 ECMAScript 에이전트에 대응됩니다. 메인 프로세스에서는 시작 시 환경이 생성되고, 추가 환경은 별도의 스레드에서 [워커 스레드](https://nodejs.org/api/worker_threads.html)로 생성될 수 있습니다. Node.js가 다른 애플리케이션에 내장된 경우, 애플리케이션의 메인 스레드는 애플리케이션 프로세스의 생명주기 동안 여러 번 Node.js 환경을 생성하고 제거할 수 있습니다. 이렇게 생성된 각 Node.js 환경은 자신의 생명주기 동안 추가 환경을 워커 스레드로 생성하고 제거할 수도 있습니다.

네이티브 애드온의 관점에서 이는 제공하는 바인딩이 여러 컨텍스트에서 여러 번 호출될 수 있고, 심지어 여러 스레드에서 동시에 호출될 수 있음을 의미합니다.

네이티브 애드온은 Node.js 환경의 생명주기 동안 사용할 전역 상태를 할당해야 할 수 있습니다. 이 상태는 애드온의 각 인스턴스에 고유할 수 있습니다.

이를 위해 Node-API는 데이터를 Node.js 환경의 생명주기에 연결할 수 있는 방법을 제공합니다.


#### `napi_set_instance_data`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_set_instance_data)

추가된 버전: v12.8.0, v10.20.0  
N-API 버전: 6

```c
napi_status napi_set_instance_data(node_api_basic_env env, void* data, napi_finalize finalize_cb, void* finalize_hint);
```

-   `[in] env`: Node-API 호출이 실행되는 환경
-   `[in] data`: 현재 인스턴스의 바인딩에서 사용할 수 있도록 설정할 데이터 항목
-   `[in] finalize_cb`: 환경이 종료될 때 호출할 함수. 이 함수는 `data`를 받아 해제할 수 있다. 자세한 내용은 [`napi_finalize`](https://nodejs.org/docs/latest/api/n-api.html#napi_finalize)를 참고하세요.
-   `[in] finalize_hint`: 종료 콜백에 전달할 선택적 힌트

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 `data`를 현재 실행 중인 Node.js 환경과 연결합니다. `data`는 나중에 `napi_get_instance_data()`를 사용해 가져올 수 있습니다. 이전에 `napi_set_instance_data()`를 호출해 설정한 현재 실행 중인 Node.js 환경과 연결된 기존 데이터는 덮어씌워집니다. 이전 호출에서 `finalize_cb`가 제공되었다면, 이 콜백은 호출되지 않습니다.


#### `napi_get_instance_data`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_instance_data)

추가된 버전: v12.8.0, v10.20.0 N-API 버전: 6

```c
napi_status napi_get_instance_data(node_api_basic_env env, void** data);
```

-   `[in] env`: Node-API 호출이 실행되는 환경
-   `[out] data`: `napi_set_instance_data()`를 통해 현재 실행 중인 Node.js 환경에 이전에 연결된 데이터 항목

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 `napi_set_instance_data()`를 통해 현재 실행 중인 Node.js 환경에 이전에 연결된 데이터를 가져옵니다. 데이터가 설정되지 않은 경우 호출은 성공하고 `data`는 `NULL`로 설정됩니다.


### 기본 Node-API 데이터 타입

Node-API는 다양한 API에서 사용되는 추상화된 기본 데이터 타입을 제공합니다. 이 API들은 불투명하게 취급되어야 하며, 다른 Node-API 호출을 통해서만 내부를 살펴볼 수 있습니다.


#### `napi_status`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_status)

추가된 버전: v8.0.0  
N-API 버전: 1

Node-API 호출의 성공 또는 실패를 나타내는 정수형 상태 코드입니다. 현재 다음과 같은 상태 코드가 지원됩니다.

```c
typedef enum {
  napi_ok,
  napi_invalid_arg,
  napi_object_expected,
  napi_string_expected,
  napi_name_expected,
  napi_function_expected,
  napi_number_expected,
  napi_boolean_expected,
  napi_array_expected,
  napi_generic_failure,
  napi_pending_exception,
  napi_cancelled,
  napi_escape_called_twice,
  napi_handle_scope_mismatch,
  napi_callback_scope_mismatch,
  napi_queue_full,
  napi_closing,
  napi_bigint_expected,
  napi_date_expected,
  napi_arraybuffer_expected,
  napi_detachable_arraybuffer_expected,
  napi_would_deadlock,
  /* unused */
  napi_no_external_buffers_allowed,
  napi_cannot_run_js
} napi_status;
```

API가 실패 상태를 반환할 때 추가 정보가 필요한 경우, `napi_get_last_error_info`를 호출하여 얻을 수 있습니다.


#### `napi_extended_error_info`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_extended_error_info)

추가된 버전: v8.0.0 N-API 버전: 1

```c
typedef struct {
    const char* error_message;
    void* engine_reserved;
    uint32_t engine_error_code;
    napi_status error_code;
} napi_extended_error_info;
```

-   `error_message`: 오류에 대한 VM 중립적인 설명을 포함하는 UTF8 인코딩 문자열.
-   `engine_reserved`: VM별 오류 상세 정보를 위해 예약된 공간. 현재는 어떤 VM에서도 구현되지 않음.
-   `engine_error_code`: VM별 오류 코드. 현재는 어떤 VM에서도 구현되지 않음.
-   `error_code`: 마지막 오류와 관련된 Node-API 상태 코드.

추가 정보는 [오류 처리](https://nodejs.org/docs/latest/api/n-api.html#error-handling) 섹션을 참고하세요.


#### `napi_env`

`napi_env`는 Node-API 구현이 VM(가상 머신)별 상태를 유지하기 위해 사용하는 컨텍스트를 나타냅니다. 이 구조체는 네이티브 함수가 호출될 때 전달되며, Node-API 호출을 할 때 다시 전달되어야 합니다. 특히, 초기 네이티브 함수가 호출될 때 전달된 동일한 `napi_env`는 이후 중첩된 Node-API 호출에도 반드시 전달되어야 합니다. 일반적인 재사용을 목적으로 `napi_env`를 캐싱하거나, 서로 다른 [`Worker`](https://nodejs.org/docs/latest/api/worker_threads.html#class-worker) 스레드에서 실행되는 동일한 애드온 인스턴스 간에 `napi_env`를 전달하는 것은 허용되지 않습니다. 네이티브 애드온 인스턴스가 언로드되면 `napi_env`는 무효화됩니다. 이 이벤트에 대한 알림은 [`napi_add_env_cleanup_hook`](https://nodejs.org/docs/latest/api/n-api.html#napi_add_env_cleanup_hook)과 [`napi_set_instance_data`](https://nodejs.org/docs/latest/api/n-api.html#napi_set_instance_data)에 제공된 콜백을 통해 전달됩니다.


#### `node_api_basic_env`[#](https://nodejs.org/docs/latest/api/n-api.html#node_api_basic_env)

이 `napi_env` 변형은 동기적 파이널라이저([`node_api_basic_finalize`](https://nodejs.org/docs/latest/api/n-api.html#node_api_basic_finalize))에 전달됩니다. Node-API 중 일부는 첫 번째 인자로 `node_api_basic_env` 타입의 매개변수를 받습니다. 이 API들은 JavaScript 엔진의 상태에 접근하지 않으므로 동기적 파이널라이저에서 호출해도 안전합니다. 이 API들에 `napi_env` 타입의 매개변수를 전달하는 것은 허용되지만, JavaScript 엔진 상태에 접근하는 API에 `node_api_basic_env` 타입의 매개변수를 전달하는 것은 허용되지 않습니다. 캐스트 없이 이를 시도하면, 잘못된 포인터 타입이 함수에 전달될 때 경고나 오류를 발생시키는 플래그로 애드온을 컴파일할 경우 컴파일러 경고나 오류가 발생합니다. 동기적 파이널라이저에서 이러한 API를 호출하면 결국 애플리케이션이 종료됩니다.


#### `napi_value`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_value)

`napi_value`는 자바스크립트 값을 나타내는 불투명 포인터입니다.


#### `napi_threadsafe_function`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_threadsafe_function)

추가된 버전: v10.6.0  
N-API 버전: 4

이것은 불투명 포인터(opaque pointer)로, `napi_call_threadsafe_function()`을 통해 여러 스레드에서 비동기적으로 호출할 수 있는 JavaScript 함수를 나타냅니다.


#### `napi_threadsafe_function_release_mode`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_threadsafe_function_release_mode)

추가된 버전: v10.6.0  
N-API 버전: 4

`napi_release_threadsafe_function()` 함수에 전달할 값으로, 스레드 안전 함수를 즉시 닫을지(`napi_tsfn_abort`) 아니면 단순히 해제할지(`napi_tsfn_release`)를 나타냅니다. 해제된 함수는 이후 `napi_acquire_threadsafe_function()`과 `napi_call_threadsafe_function()`을 통해 다시 사용할 수 있습니다.

```c
typedef enum { 
    napi_tsfn_release, 
    napi_tsfn_abort 
} napi_threadsafe_function_release_mode;
```


#### `napi_threadsafe_function_call_mode`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_threadsafe_function_call_mode)

추가된 버전: v10.6.0  
N-API 버전: 4

`napi_call_threadsafe_function()`에 전달할 값으로, 스레드 안전 함수와 연결된 큐가 가득 찼을 때 호출이 블로킹되어야 하는지 여부를 나타냅니다.

```c
typedef enum { 
    napi_tsfn_nonblocking,  // 비블로킹 모드
    napi_tsfn_blocking      // 블로킹 모드
} napi_threadsafe_function_call_mode;
```


#### Node-API memory management types[#](https://nodejs.org/docs/latest/api/n-api.html#node-api-memory-management-types)





### `napi_handle_scope`

`napi_handle_scope`는 특정 범위 내에서 생성된 객체의 수명을 제어하고 관리하기 위한 추상화 개념입니다. 일반적으로 Node-API 값은 핸들 스코프의 컨텍스트 내에서 생성됩니다. 자바스크립트에서 네이티브 메서드를 호출할 때, 기본 핸들 스코프가 존재합니다. 사용자가 명시적으로 새로운 핸들 스코프를 생성하지 않으면, Node-API 값은 기본 핸들 스코프 내에서 생성됩니다. 네이티브 메서드 실행 외부에서 코드가 호출되는 경우(예: libuv 콜백 호출 중), 자바스크립트 값 생성이 가능한 함수를 호출하기 전에 스코프를 생성해야 합니다.

핸들 스코프는 [`napi_open_handle_scope`](https://nodejs.org/docs/latest/api/n-api.html#napi_open_handle_scope)를 사용해 생성하고, [`napi_close_handle_scope`](https://nodejs.org/docs/latest/api/n-api.html#napi_close_handle_scope)를 사용해 제거합니다. 스코프를 닫는 것은 가비지 컬렉션(GC)에게 핸들 스코프의 수명 동안 생성된 모든 `napi_value`가 현재 스택 프레임에서 더 이상 참조되지 않음을 알리는 역할을 합니다.

더 자세한 내용은 [객체 수명 관리](https://nodejs.org/docs/latest/api/n-api.html#object-lifetime-management)를 참고하세요.


##### `napi_escapable_handle_scope`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_escapable_handle_scope)

추가된 버전: v8.0.0  
N-API 버전: 1

`napi_escapable_handle_scope`는 특정 핸들 스코프 내에서 생성된 값을 상위 스코프로 반환할 수 있는 특별한 타입의 핸들 스코프입니다.


##### `napi_ref`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_ref)

추가된 버전: v8.0.0  
N-API 버전: 1

`napi_ref`는 `napi_value`를 참조하기 위해 사용하는 추상화입니다. 이를 통해 여러분은 JavaScript 값의 수명을 관리할 수 있으며, 최소 수명을 명시적으로 정의할 수도 있습니다.

더 자세한 내용은 [객체 수명 관리](https://nodejs.org/docs/latest/api/n-api.html#object-lifetime-management)를 참고하세요.


##### `napi_type_tag`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_type_tag)

추가된 버전: v14.8.0, v12.19.0  
N-API 버전: 8

`napi_type_tag`는 두 개의 부호 없는 64비트 정수로 저장되는 128비트 값입니다. 이 값은 UUID처럼 사용되며, 특정 타입임을 보장하기 위해 자바스크립트 객체나 [externals](https://nodejs.org/docs/latest/api/n-api.html#napi_create_external)에 "태그"를 붙이는 데 활용됩니다. 이는 [`napi_instanceof`](https://nodejs.org/docs/latest/api/n-api.html#napi_instanceof)보다 강력한 검사 방법입니다. 왜냐하면 `napi_instanceof`는 객체의 프로토타입이 조작된 경우 잘못된 결과를 반환할 수 있기 때문입니다. 타입 태깅은 [`napi_wrap`](https://nodejs.org/docs/latest/api/n-api.html#napi_wrap)과 함께 사용할 때 가장 유용합니다. 이는 래핑된 객체에서 가져온 포인터가 이전에 자바스크립트 객체에 적용된 타입 태그에 해당하는 네이티브 타입으로 안전하게 캐스팅될 수 있도록 보장하기 때문입니다.

```c
typedef struct {
    uint64_t lower;
    uint64_t upper;
} napi_type_tag;
```


##### `napi_async_cleanup_hook_handle`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_async_cleanup_hook_handle)

추가된 버전: v14.10.0, v12.19.0

이 값은 [`napi_add_async_cleanup_hook`](https://nodejs.org/docs/latest/api/n-api.html#napi_add_async_cleanup_hook) 함수가 반환하는 불투명한 값입니다. 비동기 정리 이벤트 체인이 완료되면, 이 값을 [`napi_remove_async_cleanup_hook`](https://nodejs.org/docs/latest/api/n-api.html#napi_remove_async_cleanup_hook) 함수에 전달해야 합니다.


#### Node-API callback types[#](https://nodejs.org/docs/latest/api/n-api.html#node-api-callback-types)





##### `napi_callback_info`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_callback_info)

추가된 버전: v8.0.0  
N-API 버전: 1

`napi_callback_info`는 콜백 함수에 전달되는 불투명한 데이터 타입입니다. 이 타입은 콜백이 호출된 컨텍스트에 대한 추가 정보를 얻는 데 사용할 수 있습니다.


##### `napi_callback`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_callback)

추가된 버전: v8.0.0 N-API 버전: 1

Node-API를 통해 JavaScript에 노출될 사용자 제공 네이티브 함수를 위한 함수 포인터 타입입니다. 콜백 함수는 다음 시그니처를 만족해야 합니다:

```c
typedef napi_value (*napi_callback)(napi_env, napi_callback_info);
```

[객체 수명 관리](https://nodejs.org/docs/latest/api/n-api.html#object-lifetime-management)에서 논의된 이유가 없는 한, `napi_callback` 내에서 핸들이나 콜백 스코프를 생성할 필요는 없습니다.


##### `node_api_basic_finalize`[#](https://nodejs.org/docs/latest/api/n-api.html#node_api_basic_finalize)

추가된 버전: v21.6.0, v20.12.0, v18.20.0

이 함수 포인터 타입은 외부 소유 데이터가 가비지 컬렉션으로 인해 정리될 준비가 되었을 때 사용자에게 알림을 보내기 위해 애드온에서 제공하는 함수를 정의합니다. 사용자는 객체가 수집될 때 호출될 함수를 제공해야 하며, 이 함수는 다음과 같은 시그니처를 만족해야 합니다. 현재 `node_api_basic_finalize`는 외부 데이터를 가진 객체가 수집되는 시점을 알아내는 데 사용할 수 있습니다.

```c
typedef void (*node_api_basic_finalize)(node_api_basic_env env, void* finalize_data, void* finalize_hint);
```

[객체 수명 관리](https://nodejs.org/docs/latest/api/n-api.html#object-lifetime-management)에서 논의된 이유가 아니라면, 함수 본문 내에서 핸들이나 콜백 스코프를 생성할 필요는 없습니다.

이 함수들은 자바스크립트 엔진이 자바스크립트 코드를 실행할 수 없는 상태에서 호출될 수 있으므로, 첫 번째 매개변수로 `node_api_basic_env`를 받는 Node-API만 호출할 수 있습니다. [`node_api_post_finalizer`](https://nodejs.org/docs/latest/api/n-api.html#node_api_post_finalizer)를 사용하면 현재 가비지 컬렉션 사이클이 완료된 후에 자바스크립트 엔진의 상태에 접근해야 하는 Node-API 호출을 예약할 수 있습니다.

[`node_api_create_external_string_latin1`](https://nodejs.org/docs/latest/api/n-api.html#node_api_create_external_string_latin1)과 [`node_api_create_external_string_utf16`](https://nodejs.org/docs/latest/api/n-api.html#node_api_create_external_string_utf16)의 경우, `env` 매개변수는 null일 수 있습니다. 이는 외부 문자열이 환경 종료 후반부에 수집될 수 있기 때문입니다.

변경 이력:

-   실험적 기능 (`NAPI_EXPERIMENTAL`):
    
    첫 번째 매개변수로 `node_api_basic_env`를 받는 Node-API만 호출할 수 있습니다. 그렇지 않으면 애플리케이션은 적절한 오류 메시지와 함께 종료됩니다. 이 기능은 `NODE_API_EXPERIMENTAL_BASIC_ENV_OPT_OUT`를 정의하여 끌 수 있습니다.


##### `napi_finalize`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_finalize)

추가된 버전: v8.0.0  
N-API 버전: 1

`napi_finalize`는 가비지 컬렉션 이벤트가 완료된 후, 사용자가 Node-API 호출 그룹을 예약할 수 있도록 하는 애드온 제공 함수 포인터 타입입니다. 이 함수 포인터는 [`node_api_post_finalizer`](https://nodejs.org/docs/latest/api/n-api.html#node_api_post_finalizer)와 함께 사용할 수 있습니다.

```c
typedef void (*napi_finalize)(napi_env env, void* finalize_data, void* finalize_hint);
```

변경 내역:

-   실험적 기능 (`NAPI_EXPERIMENTAL`이 정의된 경우):
    
    이 타입의 함수는 더 이상 파이널라이저로 사용할 수 없으며, [`node_api_post_finalizer`](https://nodejs.org/docs/latest/api/n-api.html#node_api_post_finalizer)와 함께 사용해야 합니다. 대신 [`node_api_basic_finalize`](https://nodejs.org/docs/latest/api/n-api.html#node_api_basic_finalize)를 사용해야 합니다. 이 기능은 `NODE_API_EXPERIMENTAL_BASIC_ENV_OPT_OUT`를 정의하여 끌 수 있습니다.


##### `napi_async_execute_callback`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_async_execute_callback)

추가된 버전: v8.0.0  
N-API 버전: 1

비동기 작업을 지원하는 함수와 함께 사용되는 함수 포인터입니다. 콜백 함수는 다음 시그니처를 충족해야 합니다:

```c
typedef void (*napi_async_execute_callback)(napi_env env, void* data);
```

이 함수를 구현할 때는 자바스크립트를 실행하거나 자바스크립트 객체와 상호작용하는 Node-API 호출을 피해야 합니다. Node-API 호출은 `napi_async_complete_callback`에서 수행해야 합니다. `napi_env` 매개변수를 사용하지 마세요. 이는 자바스크립트 실행을 유발할 가능성이 높습니다.


##### `napi_async_complete_callback`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_async_complete_callback)

추가된 버전: v8.0.0 N-API 버전: 1

비동기 작업을 지원하는 함수와 함께 사용되는 함수 포인터입니다. 콜백 함수는 다음 시그니처를 만족해야 합니다:

```c
typedef void (*napi_async_complete_callback)(napi_env env, napi_status status, void* data);
```

[객체 수명 관리](https://nodejs.org/docs/latest/api/n-api.html#object-lifetime-management)에서 논의된 이유가 아닌 한, 함수 본문 내에서 핸들 및/또는 콜백 스코프를 생성할 필요는 없습니다.


##### `napi_threadsafe_function_call_js`

추가된 버전: v10.6.0  
N-API 버전: 4

비동기 스레드 안전 함수 호출과 함께 사용되는 함수 포인터입니다. 이 콜백은 메인 스레드에서 호출됩니다. 이 콜백의 목적은 보조 스레드 중 하나에서 큐를 통해 도착한 데이터 항목을 사용해 JavaScript 호출에 필요한 매개변수를 구성하고, 일반적으로 `napi_call_function`을 통해 JavaScript를 호출하는 것입니다.

보조 스레드에서 큐를 통해 도착한 데이터는 `data` 매개변수로 제공되며, 호출할 JavaScript 함수는 `js_callback` 매개변수로 제공됩니다.

Node-API는 이 콜백을 호출하기 전에 환경을 설정하므로, `napi_make_callback` 대신 `napi_call_function`을 사용해 JavaScript 함수를 호출하는 것으로 충분합니다.

콜백 함수는 다음 시그니처를 만족해야 합니다:

```c
typedef void (*napi_threadsafe_function_call_js)(napi_env env, napi_value js_callback, void* context, void* data);
```

- `[in] env`: API 호출에 사용할 환경. 스레드 안전 함수가 종료되고 `data`를 해제해야 할 경우 `NULL`이 될 수 있습니다.
- `[in] js_callback`: 호출할 JavaScript 함수. 스레드 안전 함수가 종료되고 `data`를 해제해야 할 경우 `NULL`이 될 수 있습니다. 또한, `js_callback` 없이 스레드 안전 함수가 생성된 경우에도 `NULL`일 수 있습니다.
- `[in] context`: 스레드 안전 함수가 생성될 때 사용된 선택적 데이터.
- `[in] data`: 보조 스레드에서 생성된 데이터. 이 콜백은 이 네이티브 데이터를 JavaScript 값으로 변환하는 책임이 있으며, 이 값은 `js_callback`이 호출될 때 매개변수로 전달될 수 있습니다. 이 포인터는 스레드와 이 콜백에 의해 완전히 관리됩니다. 따라서 이 콜백은 데이터를 해제해야 합니다.

[객체 수명 관리](https://nodejs.org/docs/latest/api/n-api.html#object-lifetime-management)에서 논의된 이유가 아닌 한, 함수 본문 내에서 핸들이나 콜백 범위를 생성할 필요는 없습니다.


##### `napi_cleanup_hook`

추가된 버전: v19.2.0, v18.13.0  
N-API 버전: 3

이 함수 포인터는 [`napi_add_env_cleanup_hook`](https://nodejs.org/docs/latest/api/n-api.html#napi_add_env_cleanup_hook)과 함께 사용됩니다. 환경이 종료될 때 호출됩니다.

콜백 함수는 다음 시그니처를 만족해야 합니다:

```c
typedef void (*napi_cleanup_hook)(void* data);
```

-   `[in] data`: [`napi_add_env_cleanup_hook`](https://nodejs.org/docs/latest/api/n-api.html#napi_add_env_cleanup_hook)에 전달된 데이터입니다.


##### `napi_async_cleanup_hook`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_async_cleanup_hook)

추가된 버전: v14.10.0, v12.19.0

이 함수 포인터는 [`napi_add_async_cleanup_hook`](https://nodejs.org/docs/latest/api/n-api.html#napi_add_async_cleanup_hook)과 함께 사용됩니다. 환경이 종료될 때 호출됩니다.

콜백 함수는 다음 시그니처를 만족해야 합니다:

```c
typedef void (*napi_async_cleanup_hook)(napi_async_cleanup_hook_handle handle, void* data);
```

-   `[in] handle`: 비동기 정리 작업이 완료된 후 [`napi_remove_async_cleanup_hook`](https://nodejs.org/docs/latest/api/n-api.html#napi_remove_async_cleanup_hook)에 전달해야 하는 핸들입니다.
-   `[in] data`: [`napi_add_async_cleanup_hook`](https://nodejs.org/docs/latest/api/n-api.html#napi_add_async_cleanup_hook)에 전달된 데이터입니다.

함수 본문에서는 비동기 정리 작업을 시작해야 하며, 작업이 끝나면 `handle`을 [`napi_remove_async_cleanup_hook`](https://nodejs.org/docs/latest/api/n-api.html#napi_remove_async_cleanup_hook)에 전달해야 합니다.


### 에러 처리

Node-API는 에러 처리를 위해 반환 값과 자바스크립트 예외를 모두 사용합니다. 아래 섹션에서는 각 경우에 대한 접근 방식을 설명합니다.


#### 반환 값

모든 Node-API 함수는 동일한 오류 처리 패턴을 공유합니다. 모든 API 함수의 반환 타입은 `napi_status`입니다.

요청이 성공적으로 처리되고, 잡히지 않은 JavaScript 예외가 발생하지 않았다면 반환 값은 `napi_ok`가 됩니다. 오류가 발생했고 예외가 던져진 경우, 해당 오류에 대한 `napi_status` 값이 반환됩니다. 예외가 던져졌지만 오류가 발생하지 않은 경우에는 `napi_pending_exception`이 반환됩니다.

`napi_ok` 또는 `napi_pending_exception` 이외의 값이 반환된 경우, [`napi_is_exception_pending`](https://nodejs.org/docs/latest/api/n-api.html#napi_is_exception_pending)을 호출하여 예외가 대기 중인지 확인해야 합니다. 자세한 내용은 예외 처리 섹션을 참고하세요.

가능한 모든 `napi_status` 값은 `napi_api_types.h`에 정의되어 있습니다.

`napi_status` 반환 값은 발생한 오류를 VM(가상 머신)에 독립적으로 표현합니다. 경우에 따라 오류를 나타내는 문자열과 VM(엔진)별 정보를 포함한 더 상세한 정보를 얻는 것이 유용할 수 있습니다.

이러한 정보를 얻기 위해 [`napi_get_last_error_info`](https://nodejs.org/docs/latest/api/n-api.html#napi_get_last_error_info)가 제공됩니다. 이 함수는 `napi_extended_error_info` 구조체를 반환합니다. `napi_extended_error_info` 구조체의 형식은 다음과 같습니다:

추가된 버전: v8.0.0 N-API 버전: 1

```c
typedef struct napi_extended_error_info {
    const char* error_message;
    void* engine_reserved;
    uint32_t engine_error_code;
    napi_status error_code;
};
```

-   `error_message`: 발생한 오류를 설명하는 텍스트
-   `engine_reserved`: 엔진 전용으로 예약된 불투명 핸들
-   `engine_error_code`: VM별 오류 코드
-   `error_code`: 마지막 오류에 대한 Node-API 상태 코드

[`napi_get_last_error_info`](https://nodejs.org/docs/latest/api/n-api.html#napi_get_last_error_info)는 마지막으로 호출된 Node-API에 대한 정보를 반환합니다.

확장된 정보의 내용이나 형식에 의존하지 마세요. 이 정보는 SemVer의 적용을 받지 않으며 언제든지 변경될 수 있습니다. 이 정보는 로깅 목적으로만 사용됩니다.


##### `napi_get_last_error_info`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_last_error_info)

추가된 버전: v8.0.0 N-API 버전: 1

```c
napi_status napi_get_last_error_info(node_api_basic_env env, const napi_extended_error_info** result);
```

-   `[in] env`: API가 호출된 환경
-   `[out] result`: 오류에 대한 추가 정보를 담은 `napi_extended_error_info` 구조체

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 마지막으로 발생한 오류에 대한 정보를 담은 `napi_extended_error_info` 구조체를 가져옵니다.

반환된 `napi_extended_error_info`의 내용은 동일한 `env`에서 Node-API 함수가 호출되기 전까지만 유효합니다. 이는 `napi_is_exception_pending` 호출도 포함되므로, 나중에 사용할 수 있도록 정보를 복사해 두는 것이 필요할 때가 많습니다. `error_message`에 반환된 포인터는 정적으로 정의된 문자열을 가리키므로, 다른 Node-API 함수가 호출되기 전에 `error_message` 필드에서 복사해 둔다면 해당 포인터를 안전하게 사용할 수 있습니다.

확장된 정보의 내용이나 형식에 의존하지 마세요. 이 정보는 SemVer의 적용을 받지 않으며 언제든지 변경될 수 있습니다. 이 정보는 로깅 목적으로만 사용됩니다.

이 API는 JavaScript 예외가 보류 중인 상태에서도 호출할 수 있습니다.


#### 예외 처리

Node-API 함수 호출은 JavaScript 예외를 발생시킬 수 있습니다. 이는 JavaScript 실행을 유발하지 않는 API 함수에서도 마찬가지입니다.

함수가 반환한 `napi_status`가 `napi_ok`라면 예외가 발생하지 않았으므로 추가 작업이 필요 없습니다. 반환된 `napi_status`가 `napi_ok`나 `napi_pending_exception`이 아니라면, 즉시 반환하는 대신 복구하고 계속 진행하려면 [`napi_is_exception_pending`](https://nodejs.org/docs/latest/api/n-api.html#napi_is_exception_pending)을 호출하여 예외가 발생했는지 확인해야 합니다.

Node-API 함수를 호출했을 때 이미 예외가 발생한 경우, 대부분의 함수는 `napi_pending_exception` 상태로 즉시 반환합니다. 하지만 모든 함수가 그런 것은 아닙니다. Node-API는 일부 함수를 호출하여 JavaScript로 돌아가기 전에 최소한의 정리 작업을 할 수 있도록 허용합니다. 이 경우 `napi_status`는 해당 함수의 상태를 반영하며, 이전에 발생한 예외를 반영하지 않습니다. 혼동을 피하기 위해 모든 함수 호출 후에 오류 상태를 확인하세요.

예외가 발생했을 때는 두 가지 접근 방식 중 하나를 선택할 수 있습니다.

첫 번째 방법은 적절한 정리 작업을 수행한 후 JavaScript로 돌아가는 것입니다. JavaScript로 돌아가는 과정에서 예외는 네이티브 메서드가 호출된 지점에서 발생합니다. 예외가 발생한 상태에서 대부분의 Node-API 호출의 동작은 명시되지 않으며, 많은 경우 `napi_pending_exception`을 반환합니다. 따라서 가능한 한 적은 작업을 수행한 후 예외를 처리할 수 있는 JavaScript로 돌아가세요.

두 번째 방법은 예외를 처리하려고 시도하는 것입니다. 네이티브 코드가 예외를 잡아 적절한 조치를 취한 후 계속 진행할 수 있는 경우가 있습니다. 이는 예외를 안전하게 처리할 수 있는 특정한 경우에만 권장됩니다. 이러한 경우 [`napi_get_and_clear_last_exception`](https://nodejs.org/docs/latest/api/n-api.html#napi_get_and_clear_last_exception)을 사용하여 예외를 가져오고 지울 수 있습니다. 성공하면 결과는 마지막으로 발생한 JavaScript `Object`에 대한 핸들을 포함합니다. 예외를 가져온 후 처리할 수 없다고 판단되면 [`napi_throw`](https://nodejs.org/docs/latest/api/n-api.html#napi_throw)를 사용하여 예외를 다시 발생시킬 수 있습니다. 여기서 `error`는 발생시킬 JavaScript 값입니다.

네이티브 코드가 예외를 발생시키거나 `napi_value`가 JavaScript `Error` 객체의 인스턴스인지 확인해야 하는 경우 다음 유틸리티 함수를 사용할 수 있습니다: [`napi_throw_error`](https://nodejs.org/docs/latest/api/n-api.html#napi_throw_error), [`napi_throw_type_error`](https://nodejs.org/docs/latest/api/n-api.html#napi_throw_type_error), [`napi_throw_range_error`](https://nodejs.org/docs/latest/api/n-api.html#napi_throw_range_error), [`node_api_throw_syntax_error`](https://nodejs.org/docs/latest/api/n-api.html#node_api_throw_syntax_error), [`napi_is_error`](https://nodejs.org/docs/latest/api/n-api.html#napi_is_error).

네이티브 코드가 `Error` 객체를 생성해야 하는 경우 다음 유틸리티 함수를 사용할 수 있습니다: [`napi_create_error`](https://nodejs.org/docs/latest/api/n-api.html#napi_create_error), [`napi_create_type_error`](https://nodejs.org/docs/latest/api/n-api.html#napi_create_type_error), [`napi_create_range_error`](https://nodejs.org/docs/latest/api/n-api.html#napi_create_range_error), [`node_api_create_syntax_error`](https://nodejs.org/docs/latest/api/n-api.html#node_api_create_syntax_error). 여기서 `result`는 새로 생성된 JavaScript `Error` 객체를 참조하는 `napi_value`입니다.

Node.js 프로젝트는 내부적으로 발생하는 모든 오류에 오류 코드를 추가하고 있습니다. 애플리케이션이 모든 오류 검사에 이러한 오류 코드를 사용하는 것이 목표입니다. 관련 오류 메시지는 남아 있지만, 로깅 및 표시용으로만 사용되며 메시지는 SemVer 적용 없이 변경될 수 있습니다. Node-API에서 이 모델을 지원하기 위해(내부 기능 및 모듈별 기능 모두에 대해 좋은 관행으로), `throw_` 및 `create_` 함수는 오류 객체에 추가할 코드 문자열인 선택적 매개변수를 받습니다. 선택적 매개변수가 `NULL`이면 오류에 코드가 연결되지 않습니다. 코드가 제공되면 오류와 관련된 이름도 다음과 같이 업데이트됩니다:

```text
originalName [code]
```

여기서 `originalName`은 오류와 관련된 원래 이름이고 `code`는 제공된 코드입니다. 예를 들어, 코드가 `'ERR_ERROR_1'`이고 `TypeError`를 생성하는 경우 이름은 다음과 같습니다:

```text
TypeError [ERR_ERROR_1]
```


##### `napi_throw`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_throw)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
NAPI_EXTERN napi_status napi_throw(napi_env env, napi_value error);
```

-   `[in] env`: API가 호출되는 환경
-   `[in] error`: 던져질 JavaScript 값

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 제공된 JavaScript 값을 던집니다.


##### `napi_throw_error`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_throw_error)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
NAPI_EXTERN napi_status napi_throw_error(napi_env env, const char* code, const char* msg);
```

-   `[in] env`: API가 호출되는 환경
-   `[in] code`: 오류에 설정할 선택적 오류 코드
-   `[in] msg`: 오류와 연결할 텍스트를 나타내는 C 문자열

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 제공된 텍스트와 함께 JavaScript `Error`를 발생시킵니다.


##### `napi_throw_type_error`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_throw_type_error)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
NAPI_EXTERN napi_status napi_throw_type_error(napi_env env, const char* code, const char* msg);
```

-   `[in] env`: API가 호출되는 환경
-   `[in] code`: 오류에 설정할 선택적 오류 코드
-   `[in] msg`: 오류와 연결할 텍스트를 나타내는 C 문자열

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 제공된 텍스트와 함께 JavaScript `TypeError`를 발생시킵니다.


##### `napi_throw_range_error`

추가된 버전: v8.0.0  
N-API 버전: 1

```c
NAPI_EXTERN napi_status napi_throw_range_error(napi_env env, const char* code, const char* msg);
```

-   `[in] env`: API가 호출되는 환경을 나타냅니다.
-   `[in] code`: 오류에 설정할 선택적 오류 코드입니다.
-   `[in] msg`: 오류와 연결할 텍스트를 나타내는 C 문자열입니다.

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 제공된 텍스트와 함께 JavaScript `RangeError`를 발생시킵니다.


##### `node_api_throw_syntax_error`[#](https://nodejs.org/docs/latest/api/n-api.html#node_api_throw_syntax_error)

추가된 버전: v17.2.0, v16.14.0  
N-API 버전: 9

```c
NAPI_EXTERN napi_status node_api_throw_syntax_error(napi_env env, const char* code, const char* msg);
```

-   `[in] env`: API가 호출되는 환경
-   `[in] code`: 오류에 설정할 선택적 오류 코드
-   `[in] msg`: 오류와 연결할 텍스트를 나타내는 C 문자열

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 제공된 텍스트와 함께 JavaScript `SyntaxError`를 발생시킵니다.


##### `napi_is_error`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_is_error)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
NAPI_EXTERN napi_status napi_is_error(napi_env env, napi_value value, bool* result);
```

-   `[in] env`: API가 호출된 환경
-   `[in] value`: 확인할 `napi_value`
-   `[out] result`: `napi_value`가 에러 객체를 나타내면 `true`, 아니면 `false`로 설정되는 불리언 값

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 `napi_value`가 에러 객체를 나타내는지 확인하기 위해 쿼리를 수행합니다.


##### `napi_create_error`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_error)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
NAPI_EXTERN napi_status napi_create_error(napi_env env, napi_value code, napi_value msg, napi_value* result);
```

-   `[in] env`: API가 호출되는 환경
-   `[in] code`: 오류와 연결될 오류 코드를 나타내는 문자열을 담은 `napi_value` (선택 사항)
-   `[in] msg`: `Error`의 메시지로 사용될 JavaScript `string`을 참조하는 `napi_value`
-   `[out] result`: 생성된 오류를 나타내는 `napi_value`

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 제공된 텍스트를 가진 JavaScript `Error`를 반환합니다.


##### `napi_create_type_error`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_type_error)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
NAPI_EXTERN napi_status napi_create_type_error(napi_env env, napi_value code, napi_value msg, napi_value* result);
```

-   `[in] env`: API가 호출되는 환경을 나타냅니다.
-   `[in] code`: 선택적 `napi_value`로, 오류와 연결될 오류 코드 문자열을 포함합니다.
-   `[in] msg`: `Error`의 메시지로 사용될 JavaScript `string`을 참조하는 `napi_value`입니다.
-   `[out] result`: 생성된 오류를 나타내는 `napi_value`입니다.

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 제공된 텍스트를 가진 JavaScript `TypeError`를 반환합니다.


##### `napi_create_range_error`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_range_error)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
NAPI_EXTERN napi_status napi_create_range_error(napi_env env, napi_value code, napi_value msg, napi_value* result);
```

-   `[in] env`: API가 호출되는 환경을 나타냅니다.
-   `[in] code`: 오류와 연결될 오류 코드를 담은 문자열 `napi_value` (선택 사항).
-   `[in] msg`: `Error`의 메시지로 사용될 JavaScript `string`을 참조하는 `napi_value`.
-   `[out] result`: 생성된 오류를 나타내는 `napi_value`.

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 제공된 텍스트를 가진 JavaScript `RangeError`를 반환합니다.


##### `node_api_create_syntax_error`[#](https://nodejs.org/docs/latest/api/n-api.html#node_api_create_syntax_error)

추가된 버전: v17.2.0, v16.14.0  
N-API 버전: 9

```c
NAPI_EXTERN napi_status node_api_create_syntax_error(napi_env env, napi_value code, napi_value msg, napi_value* result);
```

-   `[in] env`: API가 호출되는 환경을 나타냅니다.
-   `[in] code`: 선택적 `napi_value`로, 오류와 연결될 오류 코드를 담은 문자열입니다.
-   `[in] msg`: `Error`의 메시지로 사용될 JavaScript `string`을 참조하는 `napi_value`입니다.
-   `[out] result`: 생성된 오류를 나타내는 `napi_value`입니다.

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 제공된 텍스트를 가진 JavaScript `SyntaxError`를 반환합니다.


##### `napi_get_and_clear_last_exception`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_and_clear_last_exception)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_get_and_clear_last_exception(napi_env env, napi_value* result);
```

-   `[in] env`: API가 호출된 환경
-   `[out] result`: 보류 중인 예외가 있다면 해당 예외, 없다면 `NULL`

API가 성공적으로 실행되면 `napi_ok`를 반환합니다.

이 API는 JavaScript 예외가 보류 중인 상태에서도 호출할 수 있습니다.


##### `napi_is_exception_pending`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_is_exception_pending)

추가된 버전: v8.0.0 N-API 버전: 1

```c
napi_status napi_is_exception_pending(napi_env env, bool* result);
```

-   `[in] env`: API가 호출되는 환경
-   `[out] result`: 예외가 대기 중인 경우 true로 설정되는 불리언 값

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 JavaScript 예외가 대기 중인 상태에서도 호출할 수 있습니다.


##### `napi_fatal_exception`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_fatal_exception)

추가된 버전: v9.10.0  
N-API 버전: 3

```c
napi_status napi_fatal_exception(napi_env env, napi_value err);
```

-   `[in] env`: API가 호출되는 환경
-   `[in] err`: `'uncaughtException'`에 전달되는 오류

자바스크립트에서 `'uncaughtException'`을 발생시킵니다. 비동기 콜백에서 복구할 수 없는 예외가 발생했을 때 유용합니다.


#### 치명적 오류

네이티브 애드온에서 복구할 수 없는 오류가 발생했을 때, 프로세스를 즉시 종료하기 위해 치명적 오류를 발생시킬 수 있습니다.


##### `napi_fatal_error`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_fatal_error)

추가된 버전: v8.2.0  
N-API 버전: 1

```c
NAPI_NO_RETURN void napi_fatal_error(const char* location, size_t location_len, const char* message, size_t message_len);
```

-   `[in] location`: 오류가 발생한 위치 (선택 사항).
-   `[in] location_len`: 위치 문자열의 바이트 길이. null로 종료된 문자열일 경우 `NAPI_AUTO_LENGTH`를 사용.
-   `[in] message`: 오류와 관련된 메시지.
-   `[in] message_len`: 메시지 문자열의 바이트 길이. null로 종료된 문자열일 경우 `NAPI_AUTO_LENGTH`를 사용.

이 함수는 반환하지 않으며, 프로세스가 종료됩니다.

이 API는 JavaScript 예외가 대기 중인 상태에서도 호출할 수 있습니다.


### 객체 수명 관리

Node-API 호출을 수행하면 기본 VM의 힙에 있는 객체에 대한 핸들이 `napi_values`로 반환될 수 있습니다. 이러한 핸들은 네이티브 코드가 더 이상 필요하지 않을 때까지 객체를 '살아있게' 유지해야 합니다. 그렇지 않으면 네이티브 코드가 사용을 마치기 전에 객체가 수집될 수 있습니다.

객체 핸들이 반환되면 '스코프'와 연결됩니다. 기본 스코프의 수명은 네이티브 메서드 호출의 수명과 연결됩니다. 결과적으로, 기본적으로 핸들은 유효하게 유지되며, 이러한 핸들과 연결된 객체들은 네이티브 메서드 호출의 수명 동안 살아있게 됩니다.

그러나 많은 경우, 핸들이 네이티브 메서드의 수명보다 짧거나 긴 기간 동안 유효하게 유지되어야 할 필요가 있습니다. 다음 섹션에서는 핸들의 수명을 기본값에서 변경할 수 있는 Node-API 함수들에 대해 설명합니다.


#### 핸들 수명을 네이티브 메서드보다 짧게 만들기

핸들의 수명을 네이티브 메서드보다 짧게 만들어야 하는 경우가 종종 있습니다. 예를 들어, 큰 배열의 엘리먼트를 반복적으로 처리하는 네이티브 메서드를 생각해보겠습니다.

```c
for (int i = 0; i < 1000000; i++) {
    napi_value result;
    napi_status status = napi_get_element(env, object, i, &result);
    if (status != napi_ok) {
        break;
    }
    // 엘리먼트로 작업 수행
}
```

이 코드는 많은 수의 핸들을 생성하여 상당한 리소스를 소모합니다. 또한, 네이티브 코드가 가장 최근의 핸들만 사용할 수 있더라도, 모든 관련 객체가 동일한 스코프를 공유하기 때문에 모두 유지됩니다.

이러한 경우를 처리하기 위해 Node-API는 새로운 '스코프'를 설정할 수 있는 기능을 제공합니다. 이 스코프에 새로 생성된 핸들이 연결됩니다. 핸들이 더 이상 필요하지 않으면 스코프를 '닫을' 수 있으며, 스코프에 연결된 모든 핸들은 무효화됩니다. 스코프를 열고 닫는 메서드는 [`napi_open_handle_scope`](https://nodejs.org/docs/latest/api/n-api.html#napi_open_handle_scope)와 [`napi_close_handle_scope`](https://nodejs.org/docs/latest/api/n-api.html#napi_close_handle_scope)입니다.

Node-API는 단일 중첩 스코프 계층만 지원합니다. 한 번에 하나의 활성 스코프만 존재하며, 모든 새 핸들은 해당 스코프가 활성 상태인 동안 그 스코프에 연결됩니다. 스코프는 열린 순서의 반대로 닫아야 합니다. 또한, 네이티브 메서드 내에서 생성된 모든 스코프는 메서드에서 반환되기 전에 닫아야 합니다.

앞의 예제에 [`napi_open_handle_scope`](https://nodejs.org/docs/latest/api/n-api.html#napi_open_handle_scope)와 [`napi_close_handle_scope`](https://nodejs.org/docs/latest/api/n-api.html#napi_close_handle_scope) 호출을 추가하면 루프 실행 중에 최대 하나의 핸들만 유효하도록 보장할 수 있습니다.

```c
for (int i = 0; i < 1000000; i++) {
    napi_handle_scope scope;
    napi_status status = napi_open_handle_scope(env, &scope);
    if (status != napi_ok) {
        break;
    }
    napi_value result;
    status = napi_get_element(env, object, i, &result);
    if (status != napi_ok) {
        break;
    }
    // 엘리먼트로 작업 수행
    status = napi_close_handle_scope(env, scope);
    if (status != napi_ok) {
        break;
    }
}
```

스코프를 중첩할 때, 내부 스코프의 핸들이 해당 스코프의 수명을 넘어서야 하는 경우가 있습니다. Node-API는 이러한 경우를 지원하기 위해 '탈출 가능한 스코프(escapable scope)'를 제공합니다. 탈출 가능한 스코프는 하나의 핸들을 '승격'시켜 현재 스코프를 '탈출'하게 하고, 핸들의 수명을 현재 스코프에서 외부 스코프로 변경합니다.

탈출 가능한 스코프를 열고 닫는 메서드는 [`napi_open_escapable_handle_scope`](https://nodejs.org/docs/latest/api/n-api.html#napi_open_escapable_handle_scope)와 [`napi_close_escapable_handle_scope`](https://nodejs.org/docs/latest/api/n-api.html#napi_close_escapable_handle_scope)입니다.

핸들 승격 요청은 [`napi_escape_handle`](https://nodejs.org/docs/latest/api/n-api.html#napi_escape_handle)을 통해 이루어지며, 이 메서드는 한 번만 호출할 수 있습니다.


##### `napi_open_handle_scope`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_open_handle_scope)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
NAPI_EXTERN napi_status napi_open_handle_scope(napi_env env, napi_handle_scope* result);
```

-   `[in] env`: API가 호출되는 환경을 나타냅니다.
-   `[out] result`: 새로운 스코프를 나타내는 `napi_value`입니다.

API가 성공적으로 실행되면 `napi_ok`를 반환합니다.

이 API는 새로운 스코프를 엽니다.


##### `napi_close_handle_scope`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_close_handle_scope)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
NAPI_EXTERN napi_status napi_close_handle_scope(napi_env env, napi_handle_scope scope);
```

-   `[in] env`: API가 호출되는 환경
-   `[in] scope`: 닫을 스코프를 나타내는 `napi_value`

API가 성공적으로 실행되면 `napi_ok`를 반환합니다.

이 API는 전달된 스코프를 닫습니다. 스코프는 생성된 순서의 역순으로 닫아야 합니다.

이 API는 JavaScript 예외가 발생한 상태에서도 호출할 수 있습니다.


##### `napi_open_escapable_handle_scope`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_open_escapable_handle_scope)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
NAPI_EXTERN napi_status napi_open_escapable_handle_scope(napi_env env, napi_handle_scope* result);
```

-   `[in] env`: API가 호출되는 환경
-   `[out] result`: 새로운 스코프를 나타내는 `napi_value`

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 하나의 객체를 외부 스코프로 승격시킬 수 있는 새로운 스코프를 엽니다.


##### `napi_close_escapable_handle_scope`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_close_escapable_handle_scope)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
NAPI_EXTERN napi_status napi_close_escapable_handle_scope(napi_env env, napi_handle_scope scope);
```

-   `[in] env`: API가 호출되는 환경을 나타냅니다.
-   `[in] scope`: 닫을 스코프를 나타내는 `napi_value`입니다.

API가 성공적으로 실행되면 `napi_ok`를 반환합니다.

이 API는 전달된 스코프를 닫습니다. 스코프는 생성된 순서의 역순으로 닫아야 합니다.

이 API는 JavaScript 예외가 발생한 상태에서도 호출할 수 있습니다.


##### `napi_escape_handle`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_escape_handle)

추가된 버전: v8.0.0 N-API 버전: 1

```c
napi_status napi_escape_handle(napi_env env, napi_escapable_handle_scope scope, napi_value escapee, napi_value* result);
```

-   `[in] env`: API가 호출되는 환경을 나타냅니다.
-   `[in] scope`: 현재 스코프를 나타내는 `napi_value`입니다.
-   `[in] escapee`: 외부 스코프로 벗어날 JavaScript `Object`를 나타내는 `napi_value`입니다.
-   `[out] result`: 외부 스코프에서 벗어난 `Object`의 핸들을 나타내는 `napi_value`입니다.

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 JavaScript 객체의 핸들을 외부 스코프의 수명 동안 유효하도록 승격시킵니다. 이 API는 각 스코프당 한 번만 호출할 수 있습니다. 여러 번 호출하면 오류가 반환됩니다.

이 API는 JavaScript 예외가 발생한 상태에서도 호출할 수 있습니다.


#### 네이티브 메서드의 수명보다 긴 값에 대한 참조

경우에 따라 애드온은 단일 네이티브 메서드 호출의 수명보다 긴 값을 생성하고 참조할 수 있어야 합니다. 예를 들어, 생성자를 만들고 나중에 해당 생성자를 사용하여 인스턴스를 생성하는 요청을 보낼 때, 여러 다른 인스턴스 생성 요청에 걸쳐 생성자 객체를 참조할 수 있어야 합니다. 이전 섹션에서 설명한 `napi_value`로 반환된 일반 핸들로는 이 작업이 불가능합니다. 일반 핸들의 수명은 스코프에 의해 관리되며, 모든 스코프는 네이티브 메서드가 끝나기 전에 닫혀야 합니다.

Node-API는 값에 대한 지속적인 참조를 생성하는 메서드를 제공합니다. 현재 Node-API는 객체, 외부, 함수, 심볼과 같은 제한된 값 타입에 대한 참조만 생성할 수 있습니다.

각 참조는 0 이상의 값을 가진 연관된 카운트를 가지며, 이 카운트는 참조가 해당 값을 유지할지 여부를 결정합니다. 카운트가 0인 참조는 값이 수집되는 것을 막지 않습니다. 객체(객체, 함수, 외부) 및 심볼 타입의 값은 '약한' 참조가 되며, 수집되지 않은 동안에는 여전히 접근할 수 있습니다. 0보다 큰 카운트는 값이 수집되는 것을 방지합니다.

심볼 값은 다양한 종류가 있습니다. 진정한 약한 참조 동작은 `napi_create_symbol` 함수 또는 JavaScript `Symbol()` 생성자 호출로 생성된 로컬 심볼에서만 지원됩니다. `node_api_symbol_for` 함수 또는 JavaScript `Symbol.for()` 함수 호출로 생성된 전역적으로 등록된 심볼은 가비지 컬렉터가 수집하지 않기 때문에 항상 강한 참조로 남습니다. `Symbol.iterator`와 같은 잘 알려진 심볼도 마찬가지입니다. 이들은 가비지 컬렉터에 의해 절대 수집되지 않습니다.

참조는 초기 참조 카운트로 생성될 수 있습니다. 그런 다음 [`napi_reference_ref`](https://nodejs.org/docs/latest/api/n-api.html#napi_reference_ref)와 [`napi_reference_unref`](https://nodejs.org/docs/latest/api/n-api.html#napi_reference_unref)를 통해 카운트를 수정할 수 있습니다. 참조 카운트가 0인 상태에서 객체가 수집되면, 해당 참조와 연관된 객체를 가져오기 위한 모든 후속 호출 [`napi_get_reference_value`](https://nodejs.org/docs/latest/api/n-api.html#napi_get_reference_value)는 반환된 `napi_value`로 `NULL`을 반환합니다. 수집된 객체에 대해 [`napi_reference_ref`](https://nodejs.org/docs/latest/api/n-api.html#napi_reference_ref)를 호출하려고 하면 오류가 발생합니다.

참조는 애드온에서 더 이상 필요하지 않을 때 삭제해야 합니다. 참조가 삭제되면 해당 객체가 수집되는 것을 더 이상 막지 않습니다. 지속적인 참조를 삭제하지 않으면 '메모리 누수'가 발생하며, 지속적인 참조를 위한 네이티브 메모리와 힙에 있는 해당 객체가 영원히 유지됩니다.

동일한 객체를 참조하는 여러 지속적인 참조가 생성될 수 있으며, 각 참조는 개별 카운트에 따라 객체를 유지할지 여부가 결정됩니다. 동일한 객체에 대한 여러 지속적인 참조는 예기치 않게 네이티브 메모리를 유지할 수 있습니다. 지속적인 참조를 위한 네이티브 구조는 참조된 객체에 대한 파이널라이저가 실행될 때까지 유지되어야 합니다. 동일한 객체에 대해 새로운 지속적인 참조가 생성되면, 해당 객체에 대한 파이널라이저가 실행되지 않으며 이전 지속적인 참조가 가리키는 네이티브 메모리가 해제되지 않습니다. 이는 가능한 경우 `napi_reference_unref` 외에 `napi_delete_reference`를 호출함으로써 피할 수 있습니다.

**변경 내역:**

-   실험적 (`NAPI_EXPERIMENTAL`이 정의된 경우):
    
    모든 값 타입에 대한 참조를 생성할 수 있습니다. 새로 지원되는 값 타입은 약한 참조 의미를 지원하지 않으며, 이러한 타입의 값은 참조 카운트가 0이 되면 해제되고 참조에서 더 이상 접근할 수 없습니다.


##### `napi_create_reference`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_reference)

추가된 버전: v8.0.0 N-API 버전: 1

```c
NAPI_EXTERN napi_status napi_create_reference(napi_env env, napi_value value, uint32_t initial_refcount, napi_ref* result);
```

-   `[in] env`: API가 호출되는 환경
-   `[in] value`: 참조를 생성할 `napi_value`
-   `[in] initial_refcount`: 새 참조의 초기 참조 카운트
-   `[out] result`: 새 참조를 가리키는 `napi_ref`

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 전달된 값에 대해 지정된 참조 카운트로 새로운 참조를 생성합니다.


##### `napi_delete_reference`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_delete_reference)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
NAPI_EXTERN napi_status napi_delete_reference(napi_env env, napi_ref ref);
```

-   `[in] env`: API가 호출되는 환경
-   `[in] ref`: 삭제할 `napi_ref`

API가 성공적으로 실행되면 `napi_ok`를 반환합니다.

이 API는 전달된 참조를 삭제합니다.

이 API는 JavaScript 예외가 발생한 상태에서도 호출할 수 있습니다.


##### `napi_reference_ref`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_reference_ref)

추가된 버전: v8.0.0 N-API 버전: 1

```c
NAPI_EXTERN napi_status napi_reference_ref(napi_env env, napi_ref ref, uint32_t* result);
```

-   `[in] env`: API가 호출되는 환경
-   `[in] ref`: 참조 카운트가 증가할 `napi_ref`
-   `[out] result`: 새로운 참조 카운트

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 전달된 참조의 참조 카운트를 증가시키고, 결과적으로 새로운 참조 카운트를 반환합니다.


##### `napi_reference_unref`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_reference_unref)

추가된 버전: v8.0.0 N-API 버전: 1

```c
NAPI_EXTERN napi_status napi_reference_unref(napi_env env, napi_ref ref, uint32_t* result);
```

-   `[in] env`: API가 호출되는 환경
-   `[in] ref`: 참조 카운트를 감소시킬 `napi_ref`
-   `[out] result`: 새로운 참조 카운트

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 전달된 참조의 참조 카운트를 감소시키고, 결과적으로 나온 참조 카운트를 반환합니다.


##### `napi_get_reference_value`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_reference_value)

추가된 버전: v8.0.0 N-API 버전: 1

```c
NAPI_EXTERN napi_status napi_get_reference_value(napi_env env, napi_ref ref, napi_value* result);
```

-   `[in] env`: API가 호출되는 환경
-   `[in] ref`: 해당 값을 요청하는 `napi_ref`
-   `[out] result`: `napi_ref`가 참조하는 `napi_value`

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 `napi_ref`와 연결된 JavaScript 값을 나타내는 `napi_value`를 반환합니다. 만약 유효하지 않다면, `result`는 `NULL`이 됩니다.


#### 현재 Node.js 환경 종료 시 정리 작업

일반적으로 Node.js 프로세스는 종료 시 모든 리소스를 자동으로 해제합니다. 하지만 Node.js를 임베딩하거나 향후 Worker 지원을 위해, 애드온이 현재 Node.js 환경이 종료될 때 실행될 정리 작업을 등록해야 할 수 있습니다.

Node-API는 이러한 콜백을 등록하고 해제하는 함수를 제공합니다. 이 콜백이 실행될 때, 애드온이 보유하고 있는 모든 리소스가 해제되어야 합니다.


##### `napi_add_env_cleanup_hook`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_add_env_cleanup_hook)

추가된 버전: v10.2.0  
N-API 버전: 3

```c
NODE_EXTERN napi_status napi_add_env_cleanup_hook(node_api_basic_env env, napi_cleanup_hook fun, void* arg);
```

이 함수는 현재 Node.js 환경이 종료될 때 `arg` 인자와 함께 실행될 함수 `fun`을 등록합니다.

같은 함수를 서로 다른 `arg` 값으로 여러 번 지정할 수 있습니다. 이 경우, 해당 함수는 여러 번 호출됩니다. 하지만 동일한 `fun`과 `arg` 값을 여러 번 제공하는 것은 허용되지 않으며, 프로세스가 중단됩니다.

훅은 역순으로 호출됩니다. 즉, 가장 최근에 추가된 훅이 먼저 실행됩니다.

이 훅을 제거하려면 [`napi_remove_env_cleanup_hook`](https://nodejs.org/docs/latest/api/n-api.html#napi_remove_env_cleanup_hook)을 사용할 수 있습니다. 일반적으로 이 훅이 추가된 리소스가 해제될 때 제거됩니다.

비동기 정리를 위해서는 [`napi_add_async_cleanup_hook`](https://nodejs.org/docs/latest/api/n-api.html#napi_add_async_cleanup_hook)을 사용할 수 있습니다.


##### `napi_remove_env_cleanup_hook`

추가된 버전: v10.2.0  
N-API 버전: 3

```c
NAPI_EXTERN napi_status napi_remove_env_cleanup_hook(node_api_basic_env env, void (*fun)(void* arg), void* arg);
```

이 함수는 현재 Node.js 환경이 종료될 때 `arg` 인자와 함께 실행될 `fun` 함수를 등록 해제합니다. 인자와 함수 값 모두 정확히 일치해야 합니다.

함수는 반드시 `napi_add_env_cleanup_hook`을 통해 등록되어 있어야 하며, 그렇지 않으면 프로세스가 중단됩니다.


##### `napi_add_async_cleanup_hook`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_add_async_cleanup_hook)

```c
NAPI_EXTERN napi_status napi_add_async_cleanup_hook( node_api_basic_env env, napi_async_cleanup_hook hook, void* arg, napi_async_cleanup_hook_handle* remove_handle);
```

-   `[in] env`: API가 호출되는 환경을 나타냅니다.
-   `[in] hook`: 환경 종료 시 호출할 함수 포인터입니다.
-   `[in] arg`: `hook`이 호출될 때 전달할 포인터입니다.
-   `[out] remove_handle`: 비동기 정리 훅을 참조하는 선택적 핸들입니다.

`hook`을 현재 Node.js 환경이 종료될 때 `remove_handle`과 `arg` 매개변수와 함께 실행될 함수로 등록합니다. 이 함수는 [`napi_async_cleanup_hook`](https://nodejs.org/docs/latest/api/n-api.html#napi_async_cleanup_hook) 타입입니다.

[`napi_add_env_cleanup_hook`](https://nodejs.org/docs/latest/api/n-api.html#napi_add_env_cleanup_hook)과 달리, 이 훅은 비동기적으로 동작할 수 있습니다.

그 외의 동작은 일반적으로 [`napi_add_env_cleanup_hook`](https://nodejs.org/docs/latest/api/n-api.html#napi_add_env_cleanup_hook)과 유사합니다.

`remove_handle`이 `NULL`이 아닌 경우, 훅이 이미 호출되었는지 여부와 상관없이 이후 [`napi_remove_async_cleanup_hook`](https://nodejs.org/docs/latest/api/n-api.html#napi_remove_async_cleanup_hook)에 전달해야 하는 불투명한 값이 저장됩니다. 일반적으로 이는 이 훅이 추가된 리소스가 종료될 때 발생합니다.


##### `napi_remove_async_cleanup_hook`

```c
NAPI_EXTERN napi_status napi_remove_async_cleanup_hook(napi_async_cleanup_hook_handle remove_handle);
```

- `[in] remove_handle`: [`napi_add_async_cleanup_hook`](https://nodejs.org/docs/latest/api/n-api.html#napi_add_async_cleanup_hook)로 생성된 비동기 클린업 훅의 핸들입니다.

`remove_handle`에 해당하는 클린업 훅을 등록 해제합니다. 이렇게 하면 해당 훅이 이미 실행을 시작하지 않은 한 실행되지 않습니다. 이 함수는 [`napi_add_async_cleanup_hook`](https://nodejs.org/docs/latest/api/n-api.html#napi_add_async_cleanup_hook)에서 얻은 모든 `napi_async_cleanup_hook_handle` 값에 대해 호출되어야 합니다.


#### Node.js 환경 종료 시의 정리 작업

Node.js 환경은 JavaScript 실행이 허용되지 않는 상태에서 [`worker.terminate()`](https://nodejs.org/docs/latest/api/worker_threads.html#workerterminate)와 같은 요청에 의해 가능한 한 빠르게 종료될 수 있습니다. 환경이 종료될 때, JavaScript 객체, 스레드 안전 함수, 그리고 환경 인스턴스 데이터에 등록된 `napi_finalize` 콜백이 즉시 독립적으로 호출됩니다.

`napi_finalize` 콜백의 호출은 수동으로 등록된 정리 훅 이후에 예약됩니다. 환경 종료 시 `napi_finalize` 콜백에서 use-after-free 문제를 방지하기 위해 적절한 순서로 애드온 정리 작업을 보장하려면, 애드온은 `napi_add_env_cleanup_hook`과 `napi_add_async_cleanup_hook`을 사용하여 정리 훅을 등록하고, 할당된 리소스를 적절한 순서로 수동으로 해제해야 합니다.


### 모듈 등록

Node-API 모듈은 다른 모듈과 유사한 방식으로 등록되지만, `NODE_MODULE` 매크로 대신 다음과 같은 방식을 사용합니다:

```c
NAPI_MODULE(NODE_GYP_MODULE_NAME, Init)
```

다음 차이점은 `Init` 메서드의 시그니처입니다. Node-API 모듈의 경우 다음과 같습니다:

```c
napi_value Init(napi_env env, napi_value exports);
```

`Init`의 반환 값은 모듈의 `exports` 객체로 처리됩니다. `Init` 메서드는 편의를 위해 `exports` 매개변수를 통해 빈 객체를 전달받습니다. 만약 `Init`이 `NULL`을 반환하면, `exports`로 전달된 매개변수가 모듈에 의해 내보내집니다. Node-API 모듈은 `module` 객체를 수정할 수 없지만, 모듈의 `exports` 속성으로 무엇이든 지정할 수 있습니다.

`hello` 메서드를 함수로 추가하여 애드온에서 제공하는 메서드로 호출할 수 있게 하려면 다음과 같이 작성합니다:

```c
napi_value Init(napi_env env, napi_value exports) {
    napi_status status;
    napi_property_descriptor desc = {
        "hello", NULL, Method, NULL, NULL, NULL, napi_writable | napi_enumerable | napi_configurable, NULL
    };
    status = napi_define_properties(env, exports, 1, &desc);
    if (status != napi_ok) return NULL;
    return exports;
}
```

`require()`를 통해 애드온이 반환할 함수를 설정하려면 다음과 같이 작성합니다:

```c
napi_value Init(napi_env env, napi_value exports) {
    napi_value method;
    napi_status status;
    status = napi_create_function(env, "exports", NAPI_AUTO_LENGTH, Method, NULL, &method);
    if (status != napi_ok) return NULL;
    return method;
}
```

새로운 인스턴스를 생성할 수 있는 클래스를 정의하려면 (주로 [Object wrap](https://nodejs.org/docs/latest/api/n-api.html#object-wrap)과 함께 사용됨):

```c
// 참고: 부분 예제, 모든 참조 코드가 포함되지는 않음
napi_value Init(napi_env env, napi_value exports) {
    napi_status status;
    napi_property_descriptor properties[] = {
        { "value", NULL, NULL, GetValue, SetValue, NULL, napi_writable | napi_configurable, NULL },
        DECLARE_NAPI_METHOD("plusOne", PlusOne),
        DECLARE_NAPI_METHOD("multiply", Multiply),
    };
    napi_value cons;
    status = napi_define_class(env, "MyObject", New, NULL, 3, properties, &cons);
    if (status != napi_ok) return NULL;
    status = napi_create_reference(env, cons, 1, &constructor);
    if (status != napi_ok) return NULL;
    status = napi_set_named_property(env, exports, "MyObject", cons);
    if (status != napi_ok) return NULL;
    return exports;
}
```

`NAPI_MODULE_INIT` 매크로를 사용할 수도 있습니다. 이 매크로는 `NAPI_MODULE`과 `Init` 함수 정의를 간단히 줄여줍니다:

```c
NAPI_MODULE_INIT(/* napi_env env, napi_value exports */) {
    napi_value answer;
    napi_status result;
    status = napi_create_int64(env, 42, &answer);
    if (status != napi_ok) return NULL;
    status = napi_set_named_property(env, exports, "answer", answer);
    if (status != napi_ok) return NULL;
    return exports;
}
```

`NAPI_MODULE_INIT` 매크로의 본문에는 `env`와 `exports` 매개변수가 제공됩니다.

모든 Node-API 애드온은 컨텍스트 인식(context-aware)입니다. 즉, 여러 번 로드될 수 있습니다. 이러한 모듈을 선언할 때 고려해야 할 몇 가지 설계 사항이 있습니다. [컨텍스트 인식 애드온](https://nodejs.org/docs/latest/api/addons.html#context-aware-addons)에 대한 문서에서 더 자세한 내용을 확인할 수 있습니다.

`env`와 `exports` 변수는 매크로 호출 후 함수 본문 내에서 사용할 수 있습니다.

객체에 속성을 설정하는 방법에 대한 자세한 내용은 [JavaScript 속성 작업](https://nodejs.org/docs/latest/api/n-api.html#working-with-javascript-properties) 섹션을 참조하세요.

일반적으로 애드온 모듈을 빌드하는 방법에 대한 자세한 내용은 기존 API를 참조하세요.


### JavaScript 값 다루기

Node-API는 모든 타입의 JavaScript 값을 생성하기 위한 API 집합을 제공합니다. 이 중 일부 타입은 [ECMAScript 언어 사양](https://tc39.github.io/ecma262/)의 [섹션 6](https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values)에 문서화되어 있습니다.

기본적으로, 이 API들은 다음 작업 중 하나를 수행하기 위해 사용됩니다:

1. 새로운 JavaScript 객체 생성
2. 기본 C 타입을 Node-API 값으로 변환
3. Node-API 값을 기본 C 타입으로 변환
4. `undefined`와 `null`을 포함한 전역 인스턴스 가져오기

Node-API 값은 `napi_value` 타입으로 표현됩니다. JavaScript 값이 필요한 모든 Node-API 호출은 `napi_value`를 인자로 받습니다. 경우에 따라, API는 `napi_value`의 타입을 사전에 확인하기도 합니다. 하지만 더 나은 성능을 위해, 호출자는 해당 `napi_value`가 API가 기대하는 JavaScript 타입인지 확인하는 것이 좋습니다.


#### Enum types[#](https://nodejs.org/docs/latest/api/n-api.html#enum-types)





##### `napi_key_collection_mode`

추가된 버전: v13.7.0, v12.17.0, v10.20.0  
N-API 버전: 6

```c
typedef enum { 
    napi_key_include_prototypes, 
    napi_key_own_only 
} napi_key_collection_mode;
```

`Keys/Properties` 필터 열거형을 설명합니다:

`napi_key_collection_mode`는 수집된 프로퍼티의 범위를 제한합니다.

`napi_key_own_only`는 주어진 객체의 프로퍼티만 수집합니다.  
`napi_key_include_prototypes`는 객체의 프로토타입 체인에 있는 모든 키도 포함합니다.


##### `napi_key_filter`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_key_filter)

추가된 버전: v13.7.0, v12.17.0, v10.20.0  
N-API 버전: 6

```c
typedef enum {
  napi_key_all_properties = 0,
  napi_key_writable = 1,
  napi_key_enumerable = 1 << 1,
  napi_key_configurable = 1 << 2,
  napi_key_skip_strings = 1 << 3,
  napi_key_skip_symbols = 1 << 4
} napi_key_filter;
```

프로퍼티 필터 비트입니다. 이 비트들은 OR 연산을 통해 복합 필터를 구성할 수 있습니다.


##### `napi_key_conversion`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_key_conversion)

추가된 버전: v13.7.0, v12.17.0, v10.20.0  
N-API 버전: 6

```c
typedef enum { 
    napi_key_keep_numbers, 
    napi_key_numbers_to_strings 
} napi_key_conversion;
```

`napi_key_numbers_to_strings`는 정수 인덱스를 문자열로 변환합니다. `napi_key_keep_numbers`는 정수 인덱스를 숫자로 반환합니다.


##### `napi_valuetype`

```c
typedef enum {
    // ES6 타입 (typeof에 해당)
    napi_undefined,
    napi_null,
    napi_boolean,
    napi_number,
    napi_string,
    napi_symbol,
    napi_object,
    napi_function,
    napi_external,
    napi_bigint,
} napi_valuetype;
```

`napi_valuetype`은 `napi_value`의 타입을 설명합니다. 이는 일반적으로 [ECMAScript 언어 명세서의 6.1절](https://tc39.github.io/ecma262/#sec-ecmascript-language-types)에 설명된 타입에 해당합니다. 해당 절에 나열된 타입 외에도, `napi_valuetype`은 외부 데이터를 가진 `Function`과 `Object`를 나타낼 수 있습니다.

`napi_external` 타입의 JavaScript 값은 JavaScript에서 일반 객체로 나타나며, 이 객체에는 속성을 설정할 수 없고 프로토타입도 없습니다.


##### `napi_typedarray_type`

```c
typedef enum {
  napi_int8_array,
  napi_uint8_array,
  napi_uint8_clamped_array,
  napi_int16_array,
  napi_uint16_array,
  napi_int32_array,
  napi_uint32_array,
  napi_float32_array,
  napi_float64_array,
  napi_bigint64_array,
  napi_biguint64_array,
} napi_typedarray_type;
```

이 `napi_typedarray_type`은 `TypedArray`의 기본 바이너리 스칼라 데이터 타입을 나타냅니다. 이 열거형의 각 요소는 [ECMAScript 언어 사양](https://tc39.github.io/ecma262/)의 [22.2절](https://tc39.github.io/ecma262/#sec-typedarray-objects)에 해당합니다.


#### Object creation functions[#](https://nodejs.org/docs/latest/api/n-api.html#object-creation-functions)





##### `napi_create_array`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_array)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_create_array(napi_env env, napi_value* result)
```

-   `[in] env`: Node-API 호출이 실행되는 환경
-   `[out] result`: JavaScript `Array`를 나타내는 `napi_value`

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 JavaScript `Array` 타입에 해당하는 Node-API 값을 반환합니다. JavaScript 배열은 ECMAScript 언어 명세의 [22.1절](https://tc39.github.io/ecma262/#sec-array-objects)에 설명되어 있습니다.


##### `napi_create_array_with_length`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_array_with_length)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_create_array_with_length(napi_env env, size_t length, napi_value* result)
```

-   `[in] env`: API가 호출되는 환경
-   `[in] length`: `Array`의 초기 길이
-   `[out] result`: JavaScript `Array`를 나타내는 `napi_value`

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 JavaScript `Array` 타입에 해당하는 Node-API 값을 반환합니다. `Array`의 `length` 속성은 전달된 `length` 매개변수로 설정됩니다. 하지만 배열이 생성될 때 VM이 기본 버퍼를 미리 할당한다는 보장은 없습니다. 이 동작은 VM 구현에 따라 다릅니다. 만약 버퍼가 C를 통해 직접 읽고/쓰기 가능한 연속된 메모리 블록이어야 한다면, [`napi_create_external_arraybuffer`](https://nodejs.org/docs/latest/api/n-api.html#napi_create_external_arraybuffer)를 고려해 보세요.

JavaScript 배열은 [ECMAScript 언어 명세서의 22.1절](https://tc39.github.io/ecma262/#sec-array-objects)에 설명되어 있습니다.


##### `napi_create_arraybuffer`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_arraybuffer)

추가된 버전: v8.0.0 N-API 버전: 1

```c
napi_status napi_create_arraybuffer(napi_env env, size_t byte_length, void** data, napi_value* result)
```

-   `[in] env`: API가 호출되는 환경
-   `[in] length`: 생성할 `ArrayBuffer`의 바이트 길이
-   `[out] data`: `ArrayBuffer`의 바이트 버퍼를 가리키는 포인터. `NULL`을 전달하면 `data`를 무시할 수 있음
-   `[out] result`: JavaScript `ArrayBuffer`를 나타내는 `napi_value`

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 JavaScript `ArrayBuffer`에 해당하는 Node-API 값을 반환합니다. `ArrayBuffer`는 고정 길이의 이진 데이터 버퍼를 나타내는 데 사용됩니다. 일반적으로 `TypedArray` 객체의 백업 버퍼로 활용됩니다. 할당된 `ArrayBuffer`는 전달된 `length` 매개변수에 따라 크기가 결정되는 바이트 버퍼를 가집니다. 호출자가 직접 버퍼를 조작하고 싶은 경우, 이 버퍼를 선택적으로 반환할 수 있습니다. 이 버퍼는 네이티브 코드에서만 직접 쓸 수 있습니다. JavaScript에서 이 버퍼에 쓰려면 `TypedArray`나 `DataView` 객체를 생성해야 합니다.

JavaScript `ArrayBuffer` 객체는 [ECMAScript 언어 명세서의 24.1절](https://tc39.github.io/ecma262/#sec-arraybuffer-objects)에 설명되어 있습니다.


##### `napi_create_buffer`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_buffer)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_create_buffer(napi_env env, size_t size, void** data, napi_value* result)
```

-   `[in] env`: API가 호출되는 환경을 나타냅니다.
-   `[in] size`: 버퍼의 크기를 바이트 단위로 지정합니다.
-   `[out] data`: 버퍼의 원시 데이터를 가리키는 포인터입니다. `NULL`을 전달하면 `data`를 무시할 수 있습니다.
-   `[out] result`: `node::Buffer`를 나타내는 `napi_value`입니다.

API가 성공적으로 실행되면 `napi_ok`를 반환합니다.

이 API는 `node::Buffer` 객체를 할당합니다. 이 데이터 구조는 여전히 완전히 지원되지만, 대부분의 경우 `TypedArray`를 사용하는 것으로 충분합니다.


##### `napi_create_buffer_copy`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_buffer_copy)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_create_buffer_copy(napi_env env, size_t length, const void* data, void** result_data, napi_value* result)
```

-   `[in] env`: API가 호출되는 환경을 나타냅니다.
-   `[in] size`: 입력 버퍼의 크기를 바이트 단위로 지정합니다. 이 값은 새 버퍼의 크기와 동일해야 합니다.
-   `[in] data`: 복사할 원본 버퍼의 데이터를 가리키는 포인터입니다.
-   `[out] result_data`: 새 `Buffer`의 데이터 버퍼를 가리키는 포인터입니다. `NULL`을 전달하면 이 값을 무시할 수 있습니다.
-   `[out] result`: `node::Buffer`를 나타내는 `napi_value`입니다.

API가 성공적으로 실행되면 `napi_ok`를 반환합니다.

이 API는 `node::Buffer` 객체를 할당하고 전달된 버퍼의 데이터를 복사하여 초기화합니다. 이 데이터 구조는 여전히 완전히 지원되지만, 대부분의 경우 `TypedArray`를 사용하는 것으로 충분합니다.


##### `napi_create_date`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_date)

추가된 버전: v11.11.0, v10.17.0  
N-API 버전: 5

```c
napi_status napi_create_date(napi_env env, double time, napi_value* result);
```

-   `[in] env`: API가 호출되는 환경
-   `[in] time`: 1970년 1월 1일 UTC 이후의 밀리초 단위 ECMAScript 시간 값
-   `[out] result`: JavaScript `Date`를 나타내는 `napi_value`

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 윤초를 고려하지 않습니다. ECMAScript가 POSIX 시간 규격과 일치하므로 윤초는 무시됩니다.

이 API는 JavaScript `Date` 객체를 할당합니다.

JavaScript `Date` 객체는 [ECMAScript 언어 명세서의 20.3절](https://tc39.github.io/ecma262/#sec-date-objects)에 설명되어 있습니다.


##### `napi_create_external`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_external)

추가된 버전: v8.0.0 N-API 버전: 1

```c
napi_status napi_create_external(napi_env env, void* data, napi_finalize finalize_cb, void* finalize_hint, napi_value* result)
```

-   `[in] env`: API가 호출되는 환경.
-   `[in] data`: 외부 데이터에 대한 원시 포인터.
-   `[in] finalize_cb`: 외부 값이 수집될 때 호출할 선택적 콜백. [`napi_finalize`](https://nodejs.org/docs/latest/api/n-api.html#napi_finalize)에서 자세한 정보를 확인할 수 있습니다.
-   `[in] finalize_hint`: 수집 중에 finalize 콜백에 전달할 선택적 힌트.
-   `[out] result`: 외부 값을 나타내는 `napi_value`.

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 외부 데이터가 첨부된 JavaScript 값을 할당합니다. 이는 외부 데이터를 JavaScript 코드를 통해 전달하고, 나중에 네이티브 코드에서 [`napi_get_value_external`](https://nodejs.org/docs/latest/api/n-api.html#napi_get_value_external)을 사용해 검색할 수 있도록 합니다.

API는 `napi_finalize` 콜백을 추가하며, 이 콜백은 방금 생성된 JavaScript 객체가 가비지 컬렉션될 때 호출됩니다.

생성된 값은 객체가 아니므로 추가 속성을 지원하지 않습니다. 이 값은 별개의 값 타입으로 간주됩니다: 외부 값으로 `napi_typeof()`를 호출하면 `napi_external`이 반환됩니다.


##### `napi_create_external_arraybuffer`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_external_arraybuffer)

추가된 버전: v8.0.0 N-API 버전: 1

```c
napi_status napi_create_external_arraybuffer(napi_env env, void* external_data, size_t byte_length, napi_finalize finalize_cb, void* finalize_hint, napi_value* result)
```

-   `[in] env`: API가 호출되는 환경
-   `[in] external_data`: `ArrayBuffer`의 바이트 버퍼를 가리키는 포인터
-   `[in] byte_length`: 바이트 버퍼의 길이
-   `[in] finalize_cb`: `ArrayBuffer`가 수집될 때 호출할 선택적 콜백. 자세한 내용은 [`napi_finalize`](https://nodejs.org/docs/latest/api/n-api.html#napi_finalize)를 참조
-   `[in] finalize_hint`: 수집 중에 finalize 콜백에 전달할 선택적 힌트
-   `[out] result`: JavaScript `ArrayBuffer`를 나타내는 `napi_value`

API가 성공하면 `napi_ok`를 반환합니다.

**Node.js 이외의 일부 런타임은 외부 버퍼 지원을 중단했습니다.** Node.js 이외의 런타임에서는 이 메서드가 `napi_no_external_buffers_allowed`를 반환하여 외부 버퍼가 지원되지 않음을 나타낼 수 있습니다. 예를 들어, Electron은 이 문제 [electron/issues/35801](https://github.com/electron/electron/issues/35801)에서 설명한 것과 같습니다.

모든 런타임과의 최대 호환성을 유지하기 위해, node-api 헤더를 포함하기 전에 애드온에서 `NODE_API_NO_EXTERNAL_BUFFERS_ALLOWED`를 정의할 수 있습니다. 이렇게 하면 외부 버퍼를 생성하는 2개의 함수가 숨겨집니다. 이는 실수로 이러한 메서드를 사용할 경우 컴파일 오류가 발생하도록 보장합니다.

이 API는 JavaScript `ArrayBuffer`에 해당하는 Node-API 값을 반환합니다. `ArrayBuffer`의 바이트 버퍼는 외부에서 할당되고 관리됩니다. 호출자는 finalize 콜백이 호출될 때까지 바이트 버퍼가 유효한 상태로 유지되도록 해야 합니다.

이 API는 방금 생성된 JavaScript 객체가 가비지 컬렉션될 때 호출될 `napi_finalize` 콜백을 추가합니다.

JavaScript `ArrayBuffer`는 ECMAScript 언어 사양의 [Section 24.1](https://tc39.github.io/ecma262/#sec-arraybuffer-objects)에 설명되어 있습니다.


##### `napi_create_external_buffer`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_external_buffer)

추가된 버전: v8.0.0 N-API 버전: 1

```c
napi_status napi_create_external_buffer(napi_env env, size_t length, void* data, napi_finalize finalize_cb, void* finalize_hint, napi_value* result)
```

-   `[in] env`: API가 호출되는 환경.
-   `[in] length`: 입력 버퍼의 크기(바이트 단위). 새로운 버퍼의 크기와 동일해야 함.
-   `[in] data`: JavaScript에 노출할 기본 버퍼의 원시 포인터.
-   `[in] finalize_cb`: `ArrayBuffer`가 수집될 때 호출할 선택적 콜백. 자세한 내용은 [`napi_finalize`](https://nodejs.org/docs/latest/api/n-api.html#napi_finalize) 참조.
-   `[in] finalize_hint`: 수집 중에 finalize 콜백에 전달할 선택적 힌트.
-   `[out] result`: `node::Buffer`를 나타내는 `napi_value`.

API가 성공하면 `napi_ok`를 반환.

**Node.js 이외의 일부 런타임은 외부 버퍼 지원을 중단했습니다.** Node.js 이외의 런타임에서 이 메서드는 외부 버퍼가 지원되지 않음을 나타내기 위해 `napi_no_external_buffers_allowed`를 반환할 수 있습니다. 예를 들어, Electron은 이 문제 [electron/issues/35801](https://github.com/electron/electron/issues/35801)에서 설명된 대로 외부 버퍼를 지원하지 않습니다.

모든 런타임과의 최대 호환성을 유지하기 위해, node-api 헤더를 포함하기 전에 애드온에서 `NODE_API_NO_EXTERNAL_BUFFERS_ALLOWED`를 정의할 수 있습니다. 이렇게 하면 외부 버퍼를 생성하는 2개의 함수가 숨겨집니다. 이는 실수로 이러한 메서드를 사용할 경우 컴파일 오류가 발생하도록 보장합니다.

이 API는 `node::Buffer` 객체를 할당하고 전달된 버퍼로 데이터를 초기화합니다. 이 데이터 구조는 여전히 완전히 지원되지만, 대부분의 경우 `TypedArray`를 사용하는 것으로 충분합니다.

이 API는 생성된 JavaScript 객체가 가비지 컬렉션될 때 호출될 `napi_finalize` 콜백을 추가합니다.

Node.js >=4에서 `Buffers`는 `Uint8Array`입니다.


##### `napi_create_object`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_object)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_create_object(napi_env env, napi_value* result)
```

-   `[in] env`: API가 호출되는 환경을 나타냅니다.
-   `[out] result`: JavaScript `Object`를 나타내는 `napi_value`입니다.

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 기본 JavaScript `Object`를 할당합니다. JavaScript에서 `new Object()`를 수행하는 것과 동일합니다.

JavaScript `Object` 타입은 [ECMAScript 언어 명세서의 6.1.7절](https://tc39.github.io/ecma262/#sec-object-type)에 설명되어 있습니다.


##### `napi_create_symbol`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_symbol)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_create_symbol(napi_env env, napi_value description, napi_value* result)
```

-   `[in] env`: API가 호출되는 환경을 나타내는 `napi_env` 타입의 값.
-   `[in] description`: JavaScript `string`을 참조하는 선택적 `napi_value`. 이 값은 심볼의 설명으로 설정된다.
-   `[out] result`: JavaScript `symbol`을 나타내는 `napi_value`.

API가 성공적으로 실행되면 `napi_ok`를 반환한다.

이 API는 UTF8로 인코딩된 C 문자열로부터 JavaScript `symbol` 값을 생성한다.

JavaScript `symbol` 타입은 [ECMAScript 언어 명세서의 19.4절](https://tc39.github.io/ecma262/#sec-symbol-objects)에서 설명하고 있다.


##### `node_api_symbol_for`[#](https://nodejs.org/docs/latest/api/n-api.html#node_api_symbol_for)

추가된 버전: v17.5.0, v16.15.0  
N-API 버전: 9

```c
napi_status node_api_symbol_for(napi_env env, const char* utf8description, size_t length, napi_value* result)
```

-   `[in] env`: API가 호출되는 환경을 나타냅니다.
-   `[in] utf8description`: 심볼의 설명으로 사용될 UTF-8 C 문자열입니다.
-   `[in] length`: 설명 문자열의 길이(바이트 단위)입니다. 문자열이 null로 종료된 경우 `NAPI_AUTO_LENGTH`를 사용할 수 있습니다.
-   `[out] result`: JavaScript `symbol`을 나타내는 `napi_value`입니다.

API가 성공적으로 실행되면 `napi_ok`를 반환합니다.

이 API는 전역 레지스트리에서 주어진 설명과 일치하는 기존 심볼을 검색합니다. 심볼이 이미 존재하면 해당 심볼을 반환하고, 그렇지 않으면 레지스트리에 새로운 심볼을 생성합니다.

JavaScript `symbol` 타입은 [ECMAScript 언어 명세서의 19.4절](https://tc39.github.io/ecma262/#sec-symbol-objects)에서 설명하고 있습니다.


##### `napi_create_typedarray`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_typedarray)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_create_typedarray(napi_env env, napi_typedarray_type type, size_t length, napi_value arraybuffer, size_t byte_offset, napi_value* result)
```

-   `[in] env`: API가 호출되는 환경
-   `[in] type`: `TypedArray` 내부 요소의 스칼라 데이터 타입
-   `[in] length`: `TypedArray`의 요소 개수
-   `[in] arraybuffer`: `TypedArray`의 기반이 되는 `ArrayBuffer`
-   `[in] byte_offset`: `ArrayBuffer` 내에서 `TypedArray`를 시작할 바이트 오프셋
-   `[out] result`: JavaScript `TypedArray`를 나타내는 `napi_value`

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 기존 `ArrayBuffer` 위에 JavaScript `TypedArray` 객체를 생성합니다. `TypedArray` 객체는 각 요소가 동일한 이진 스칼라 데이터 타입을 가지는 데이터 버퍼에 대한 배열과 같은 뷰를 제공합니다.

`(length * size_of_element) + byte_offset`는 전달된 배열의 바이트 크기보다 작거나 같아야 합니다. 그렇지 않으면 `RangeError` 예외가 발생합니다.

JavaScript `TypedArray` 객체는 [ECMAScript 언어 명세서의 22.2절](https://tc39.github.io/ecma262/#sec-typedarray-objects)에 설명되어 있습니다.


##### `node_api_create_buffer_from_arraybuffer`[#](https://nodejs.org/docs/latest/api/n-api.html#node_api_create_buffer_from_arraybuffer)

추가된 버전: v23.0.0

```c
napi_status NAPI_CDECL node_api_create_buffer_from_arraybuffer(napi_env env, napi_value arraybuffer, size_t byte_offset, size_t byte_length, napi_value* result)
```

-   **`[in] env`**: API가 호출되는 환경을 나타냅니다.
-   **`[in] arraybuffer`**: 버퍼를 생성할 `ArrayBuffer`입니다.
-   **`[in] byte_offset`**: `ArrayBuffer` 내에서 버퍼 생성을 시작할 바이트 오프셋입니다.
-   **`[in] byte_length`**: `ArrayBuffer`에서 생성할 버퍼의 바이트 길이입니다.
-   **`[out] result`**: 생성된 JavaScript `Buffer` 객체를 나타내는 `napi_value`입니다.

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 기존 `ArrayBuffer`에서 JavaScript `Buffer` 객체를 생성합니다. `Buffer` 객체는 Node.js에서 이진 데이터를 직접 다루기 위한 클래스입니다.

바이트 범위 `[byte_offset, byte_offset + byte_length)`는 `ArrayBuffer`의 범위 내에 있어야 합니다. 만약 `byte_offset + byte_length`가 `ArrayBuffer`의 크기를 초과하면 `RangeError` 예외가 발생합니다.


##### `napi_create_dataview`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_dataview)

추가된 버전: v8.3.0  
N-API 버전: 1

```c
napi_status napi_create_dataview(napi_env env, size_t byte_length, napi_value arraybuffer, size_t byte_offset, napi_value* result)
```

-   `[in] env`: API가 호출되는 환경
-   `[in] length`: `DataView`에 포함될 요소의 개수
-   `[in] arraybuffer`: `DataView`의 기반이 되는 `ArrayBuffer`
-   `[in] byte_offset`: `ArrayBuffer` 내에서 `DataView`가 시작할 바이트 오프셋
-   `[out] result`: JavaScript `DataView`를 나타내는 `napi_value`

API가 성공적으로 실행되면 `napi_ok`를 반환합니다.

이 API는 기존 `ArrayBuffer` 위에 JavaScript `DataView` 객체를 생성합니다. `DataView` 객체는 기본 데이터 버퍼에 대한 배열과 유사한 뷰를 제공하지만, `ArrayBuffer` 내에서 서로 다른 크기와 타입의 항목을 허용합니다.

`byte_length + byte_offset`이 전달된 배열의 바이트 크기보다 작거나 같아야 합니다. 그렇지 않으면 `RangeError` 예외가 발생합니다.

JavaScript `DataView` 객체는 [ECMAScript 언어 명세서의 24.3절](https://tc39.github.io/ecma262/#sec-dataview-objects)에 설명되어 있습니다.


#### Functions to convert from C types to Node-API[#](https://nodejs.org/docs/latest/api/n-api.html#functions-to-convert-from-c-types-to-node-api)





##### `napi_create_int32`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_int32)

추가된 버전: v8.4.0  
N-API 버전: 1

```c
napi_status napi_create_int32(napi_env env, int32_t value, napi_value* result)
```

-   `[in] env`: API가 호출되는 환경
-   `[in] value`: JavaScript에서 표현할 정수 값
-   `[out] result`: JavaScript `number`를 나타내는 `napi_value`

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 C 언어의 `int32_t` 타입을 JavaScript의 `number` 타입으로 변환하는 데 사용됩니다.

JavaScript의 `number` 타입은 [ECMAScript 언어 명세서의 6.1.6절](https://tc39.github.io/ecma262/#sec-ecmascript-language-types-number-type)에 설명되어 있습니다.


##### `napi_create_uint32`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_uint32)

추가된 버전: v8.4.0  
N-API 버전: 1

```c
napi_status napi_create_uint32(napi_env env, uint32_t value, napi_value* result)
```

-   `[in] env`: API가 호출되는 환경
-   `[in] value`: JavaScript에서 표현할 부호 없는 정수 값
-   `[out] result`: JavaScript `number`를 나타내는 `napi_value`

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 C의 `uint32_t` 타입을 JavaScript의 `number` 타입으로 변환하는 데 사용됩니다.

JavaScript `number` 타입은 [ECMAScript 언어 명세서의 6.1.6절](https://tc39.github.io/ecma262/#sec-ecmascript-language-types-number-type)에 설명되어 있습니다.


##### `napi_create_int64`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_int64)

추가된 버전: v8.4.0  
N-API 버전: 1

```c
napi_status napi_create_int64(napi_env env, int64_t value, napi_value* result)
```

-   `[in] env`: API가 호출되는 환경
-   `[in] value`: JavaScript에서 표현될 정수 값
-   `[out] result`: JavaScript `number`를 나타내는 `napi_value`

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 C의 `int64_t` 타입을 JavaScript의 `number` 타입으로 변환하는 데 사용됩니다.

JavaScript의 `number` 타입은 [ECMAScript 언어 명세서의 6.1.6절](https://tc39.github.io/ecma262/#sec-ecmascript-language-types-number-type)에 설명되어 있습니다. `int64_t`의 전체 범위는 JavaScript에서 완전한 정밀도로 표현될 수 없습니다. [`Number.MIN_SAFE_INTEGER`](https://tc39.github.io/ecma262/#sec-number.min_safe_integer) `-(2**53 - 1)`부터 [`Number.MAX_SAFE_INTEGER`](https://tc39.github.io/ecma262/#sec-number.max_safe_integer) `(2**53 - 1)` 범위를 벗어나는 정수 값은 정밀도를 잃게 됩니다.


##### `napi_create_double`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_double)

추가된 버전: v8.4.0  
N-API 버전: 1

```c
napi_status napi_create_double(napi_env env, double value, napi_value* result)
```

-   `[in] env`: API가 호출되는 환경
-   `[in] value`: JavaScript에서 표현할 배정밀도(double-precision) 값
-   `[out] result`: JavaScript `number`를 나타내는 `napi_value`

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 C 언어의 `double` 타입을 JavaScript의 `number` 타입으로 변환하는 데 사용됩니다.

JavaScript의 `number` 타입은 [ECMAScript 언어 명세서의 6.1.6절](https://tc39.github.io/ecma262/#sec-ecmascript-language-types-number-type)에 설명되어 있습니다.


##### `napi_create_bigint_int64`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_bigint_int64)

추가된 버전: v10.7.0  
N-API 버전: 6

```c
napi_status napi_create_bigint_int64(napi_env env, int64_t value, napi_value* result);
```

-   `[in] env`: API가 호출되는 환경
-   `[in] value`: JavaScript에서 표현될 정수 값
-   `[out] result`: JavaScript `BigInt`를 나타내는 `napi_value`

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 C의 `int64_t` 타입을 JavaScript의 `BigInt` 타입으로 변환합니다.


##### `napi_create_bigint_uint64`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_bigint_uint64)

추가된 버전: v10.7.0  
N-API 버전: 6

```c
napi_status napi_create_bigint_uint64(napi_env env, uint64_t value, napi_value* result);
```

-   `[in] env`: API가 호출되는 환경
-   `[in] value`: 자바스크립트에서 표현할 부호 없는 정수 값
-   `[out] result`: 자바스크립트 `BigInt`를 나타내는 `napi_value`

API가 성공적으로 실행되면 `napi_ok`를 반환합니다.

이 API는 C의 `uint64_t` 타입을 자바스크립트의 `BigInt` 타입으로 변환합니다.


##### `napi_create_bigint_words`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_bigint_words)

추가된 버전: v10.7.0  
N-API 버전: 6

```c
napi_status napi_create_bigint_words(napi_env env, int sign_bit, size_t word_count, const uint64_t* words, napi_value* result);
```

-   `[in] env`: API가 호출되는 환경을 나타냅니다.
-   `[in] sign_bit`: 결과로 생성될 `BigInt`가 양수인지 음수인지를 결정합니다.
-   `[in] word_count`: `words` 배열의 길이입니다.
-   `[in] words`: `uint64_t` 타입의 리틀 엔디언(little-endian) 64비트 단어 배열입니다.
-   `[out] result`: JavaScript `BigInt`를 나타내는 `napi_value`입니다.

API가 성공적으로 실행되면 `napi_ok`를 반환합니다.

이 API는 부호 없는 64비트 단어 배열을 단일 `BigInt` 값으로 변환합니다.

결과로 생성된 `BigInt`는 다음과 같이 계산됩니다:  
(–1)<sup><code>sign_bit</code></sup> (`words[0]` × (2<sup>64</sup>)<sup>0</sup> + `words[1]` × (2<sup>64</sup>)<sup>1</sup> + …)


##### `napi_create_string_latin1`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_string_latin1)

추가된 버전: v8.0.0 N-API 버전: 1

```c
napi_status napi_create_string_latin1(napi_env env, const char* str, size_t length, napi_value* result);
```

-   `[in] env`: API가 호출되는 환경
-   `[in] str`: ISO-8859-1 인코딩된 문자열을 나타내는 문자 버퍼
-   `[in] length`: 문자열의 바이트 길이. null 종료 문자열일 경우 `NAPI_AUTO_LENGTH`를 사용
-   `[out] result`: JavaScript `string`을 나타내는 `napi_value`

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 ISO-8859-1 인코딩된 C 문자열로부터 JavaScript `string` 값을 생성합니다. 원본 문자열은 복사됩니다.

JavaScript `string` 타입은 [ECMAScript 언어 명세서의 6.1.4절](https://tc39.github.io/ecma262/#sec-ecmascript-language-types-string-type)에 설명되어 있습니다.


##### `node_api_create_external_string_latin1`[#](https://nodejs.org/docs/latest/api/n-api.html#node_api_create_external_string_latin1)

추가된 버전: v20.4.0, v18.18.0

```c
napi_status node_api_create_external_string_latin1(napi_env env, char* str, size_t length, napi_finalize finalize_callback, void* finalize_hint, napi_value* result, bool* copied);
```

-   `[in] env`: API가 호출되는 환경을 나타냅니다.
-   `[in] str`: ISO-8859-1 인코딩된 문자열을 나타내는 문자 버퍼입니다.
-   `[in] length`: 문자열의 바이트 길이입니다. null로 종료된 문자열인 경우 `NAPI_AUTO_LENGTH`를 사용할 수 있습니다.
-   `[in] finalize_callback`: 문자열이 수집될 때 호출되는 함수입니다. 이 함수는 다음과 같은 매개변수로 호출됩니다:
    -   `[in] env`: 애드온이 실행 중인 환경입니다. 이 값은 워커나 메인 Node.js 인스턴스의 종료 과정에서 문자열이 수집되는 경우 null일 수 있습니다.
    -   `[in] data`: `void*` 포인터로 변환된 `str` 값입니다.
    -   `[in] finalize_hint`: API에 전달된 `finalize_hint` 값입니다. [`napi_finalize`](https://nodejs.org/docs/latest/api/n-api.html#napi_finalize)에서 더 자세한 정보를 확인할 수 있습니다. 이 매개변수는 선택 사항입니다. null 값을 전달하면 해당 JavaScript 문자열이 수집될 때 애드온이 알림을 받을 필요가 없음을 의미합니다.
-   `[in] finalize_hint`: 수집 과정에서 finalize 콜백에 전달할 선택적 힌트입니다.
-   `[out] result`: JavaScript `string`을 나타내는 `napi_value`입니다.
-   `[out] copied`: 문자열이 복사되었는지 여부를 나타냅니다. 복사된 경우, finalizer가 이미 호출되어 `str`을 제거했음을 의미합니다.

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 ISO-8859-1 인코딩된 C 문자열로부터 JavaScript `string` 값을 생성합니다. 네이티브 문자열은 복사되지 않을 수 있으므로, JavaScript 값의 전체 생명 주기 동안 존재해야 합니다.

JavaScript `string` 타입에 대한 설명은 [ECMAScript 언어 명세서의 6.1.4절](https://tc39.github.io/ecma262/#sec-ecmascript-language-types-string-type)에서 확인할 수 있습니다.


##### `napi_create_string_utf16`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_string_utf16)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_create_string_utf16(napi_env env, const char16_t* str, size_t length, napi_value* result)
```

-   `[in] env`: API가 호출되는 환경을 나타냅니다.
-   `[in] str`: UTF16-LE로 인코딩된 문자열을 나타내는 문자 버퍼입니다.
-   `[in] length`: 문자열의 길이를 2바이트 코드 단위로 나타냅니다. 문자열이 null로 종료된 경우 `NAPI_AUTO_LENGTH`를 사용할 수 있습니다.
-   `[out] result`: JavaScript `string`을 나타내는 `napi_value`입니다.

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 UTF16-LE로 인코딩된 C 문자열에서 JavaScript `string` 값을 생성합니다. 원본 문자열은 복사됩니다.

JavaScript `string` 타입은 [ECMAScript 언어 명세서의 6.1.4절](https://tc39.github.io/ecma262/#sec-ecmascript-language-types-string-type)에 설명되어 있습니다.


##### `node_api_create_external_string_utf16`[#](https://nodejs.org/docs/latest/api/n-api.html#node_api_create_external_string_utf16)

추가된 버전: v20.4.0, v18.18.0

```c
napi_status node_api_create_external_string_utf16(napi_env env, char16_t* str, size_t length, napi_finalize finalize_callback, void* finalize_hint, napi_value* result, bool* copied);
```

-   `[in] env`: API가 호출되는 환경.
-   `[in] str`: UTF16-LE로 인코딩된 문자열을 나타내는 문자 버퍼.
-   `[in] length`: 문자열의 길이(2바이트 코드 단위). null로 종료된 경우 `NAPI_AUTO_LENGTH`를 사용.
-   `[in] finalize_callback`: 문자열이 수집될 때 호출할 함수. 이 함수는 다음 매개변수와 함께 호출됨:
    -   `[in] env`: 애드온이 실행 중인 환경. 문자열이 워커 또는 메인 Node.js 인스턴스의 종료 과정에서 수집되는 경우 이 값은 null일 수 있음.
    -   `[in] data`: `str` 값을 `void*` 포인터로 전달.
    -   `[in] finalize_hint`: API에 제공된 `finalize_hint` 값. [`napi_finalize`](https://nodejs.org/docs/latest/api/n-api.html#napi_finalize)에서 더 자세한 정보를 확인할 수 있음. 이 매개변수는 선택 사항. null 값을 전달하면 해당 JavaScript 문자열이 수집될 때 애드온이 알림을 받을 필요가 없음을 의미.
-   `[in] finalize_hint`: 수집 중 finalize 콜백에 전달할 선택적 힌트.
-   `[out] result`: JavaScript `string`을 나타내는 `napi_value`.
-   `[out] copied`: 문자열이 복사되었는지 여부. 복사된 경우, finalizer가 이미 호출되어 `str`을 제거했음을 의미.

API가 성공하면 `napi_ok`를 반환.

이 API는 UTF16-LE로 인코딩된 C 문자열에서 JavaScript `string` 값을 생성. 네이티브 문자열은 복사되지 않을 수 있으므로 JavaScript 값의 전체 생명 주기 동안 존재해야 함.

JavaScript `string` 타입은 [ECMAScript 언어 명세서의 섹션 6.1.4](https://tc39.github.io/ecma262/#sec-ecmascript-language-types-string-type)에서 설명됨.


##### `napi_create_string_utf8`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_string_utf8)

추가된 버전: v8.0.0 N-API 버전: 1

```c
napi_status napi_create_string_utf8(napi_env env, const char* str, size_t length, napi_value* result)
```

-   `[in] env`: API가 호출되는 환경
-   `[in] str`: UTF8로 인코딩된 문자열을 나타내는 문자 버퍼
-   `[in] length`: 문자열의 바이트 길이. null로 종료된 경우 `NAPI_AUTO_LENGTH`를 사용
-   `[out] result`: JavaScript `string`을 나타내는 `napi_value`

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 UTF8로 인코딩된 C 문자열로부터 JavaScript `string` 값을 생성합니다. 원본 문자열은 복사됩니다.

JavaScript `string` 타입은 [ECMAScript 언어 명세서의 6.1.4절](https://tc39.github.io/ecma262/#sec-ecmascript-language-types-string-type)에 설명되어 있습니다.


#### 최적화된 프로퍼티 키 생성 함수

V8을 포함한 많은 자바스크립트 엔진은 프로퍼티 값을 설정하거나 가져올 때 내부화된 문자열을 키로 사용합니다. 일반적으로 이러한 문자열을 생성하고 조회하기 위해 해시 테이블을 사용합니다. 키 생성 시 약간의 비용이 추가되지만, 이후에는 전체 문자열을 비교하는 대신 문자열 포인터를 비교할 수 있어 성능이 향상됩니다.

새로운 자바스크립트 문자열을 프로퍼티 키로 사용하려는 경우, 일부 자바스크립트 엔진에서는 이 섹션의 함수를 사용하는 것이 더 효율적일 수 있습니다. 그렇지 않다면, 프로퍼티 키 생성 메서드를 사용하여 문자열을 생성하거나 저장할 때 추가 오버헤드가 발생할 수 있으므로 `napi_create_string_utf8` 또는 `node_api_create_external_string_utf8` 계열 함수를 사용하세요.


##### `node_api_create_property_key_latin1`[#](https://nodejs.org/docs/latest/api/n-api.html#node_api_create_property_key_latin1)

추가된 버전: v22.9.0, v20.18.0

```c
napi_status NAPI_CDECL node_api_create_property_key_latin1(napi_env env, const char* str, size_t length, napi_value* result);
```

-   `[in] env`: API가 호출되는 환경을 나타냅니다.
-   `[in] str`: ISO-8859-1 인코딩된 문자열을 나타내는 문자 버퍼입니다.
-   `[in] length`: 문자열의 바이트 길이입니다. null로 종료된 경우 `NAPI_AUTO_LENGTH`를 사용할 수 있습니다.
-   `[out] result`: 객체의 프로퍼티 키로 사용될 최적화된 JavaScript `string`을 나타내는 `napi_value`입니다.

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 ISO-8859-1 인코딩된 C 문자열로부터 최적화된 JavaScript `string` 값을 생성하여 객체의 프로퍼티 키로 사용합니다. 네이티브 문자열은 복사됩니다. `napi_create_string_latin1`과 달리, 동일한 `str` 포인터로 이 함수를 반복 호출할 경우, 엔진에 따라 요청된 `napi_value` 생성 속도가 빨라질 수 있습니다.

JavaScript `string` 타입은 [ECMAScript 언어 명세서의 6.1.4절](https://tc39.github.io/ecma262/#sec-ecmascript-language-types-string-type)에 설명되어 있습니다.


##### `node_api_create_property_key_utf16`[#](https://nodejs.org/docs/latest/api/n-api.html#node_api_create_property_key_utf16)

추가된 버전: v21.7.0, v20.12.0

```c
napi_status NAPI_CDECL node_api_create_property_key_utf16(napi_env env, const char16_t* str, size_t length, napi_value* result);
```

-   `[in] env`: API가 호출되는 환경을 나타냅니다.
-   `[in] str`: UTF16-LE로 인코딩된 문자열을 나타내는 문자 버퍼입니다.
-   `[in] length`: 문자열의 길이를 2바이트 코드 단위로 나타냅니다. 문자열이 null로 종료된 경우 `NAPI_AUTO_LENGTH`를 사용합니다.
-   `[out] result`: 객체의 프로퍼티 키로 사용될 최적화된 JavaScript `string`을 나타내는 `napi_value`입니다.

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 UTF16-LE로 인코딩된 C 문자열에서 최적화된 JavaScript `string` 값을 생성하여 객체의 프로퍼티 키로 사용합니다. 네이티브 문자열은 복사됩니다.

JavaScript `string` 타입은 [ECMAScript 언어 명세서의 6.1.4절](https://tc39.github.io/ecma262/#sec-ecmascript-language-types-string-type)에 설명되어 있습니다.


##### `node_api_create_property_key_utf8`[#](https://nodejs.org/docs/latest/api/n-api.html#node_api_create_property_key_utf8)

추가된 버전: v22.9.0, v20.18.0

```c
napi_status NAPI_CDECL node_api_create_property_key_utf8(napi_env env, const char* str, size_t length, napi_value* result);
```

-   `[in] env`: API가 호출되는 환경
-   `[in] str`: UTF8로 인코딩된 문자열을 나타내는 문자 버퍼
-   `[in] length`: 문자열의 길이(2바이트 코드 단위), null로 종료된 경우 `NAPI_AUTO_LENGTH`
-   `[out] result`: 객체의 프로퍼티 키로 사용될 최적화된 JavaScript `string`을 나타내는 `napi_value`

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 UTF8로 인코딩된 C 문자열에서 최적화된 JavaScript `string` 값을 생성하여 객체의 프로퍼티 키로 사용합니다. 네이티브 문자열은 복사됩니다.

JavaScript `string` 타입은 [ECMAScript 언어 명세서의 6.1.4절](https://tc39.github.io/ecma262/#sec-ecmascript-language-types-string-type)에 설명되어 있습니다.


#### Functions to convert from Node-API to C types[#](https://nodejs.org/docs/latest/api/n-api.html#functions-to-convert-from-node-api-to-c-types)





##### `napi_get_array_length`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_array_length)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_get_array_length(napi_env env, napi_value value, uint32_t* result)
```

-   `[in] env`: API가 호출되는 환경
-   `[in] value`: 길이를 조회할 JavaScript `Array`를 나타내는 `napi_value`
-   `[out] result`: 배열의 길이를 나타내는 `uint32`

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 배열의 길이를 반환합니다.

`Array`의 길이는 [ECMAScript 언어 명세서의 22.1.4.1 섹션](https://tc39.github.io/ecma262/#sec-properties-of-array-instances-length)에 설명되어 있습니다.


##### `napi_get_arraybuffer_info`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_arraybuffer_info)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_get_arraybuffer_info(napi_env env, napi_value arraybuffer, void** data, size_t* byte_length)
```

-   `[in] env`: API가 호출된 환경을 나타냅니다.
-   `[in] arraybuffer`: 조회할 `ArrayBuffer`를 나타내는 `napi_value`입니다.
-   `[out] data`: `ArrayBuffer`의 실제 데이터 버퍼입니다. `byte_length`가 `0`인 경우, 이 값은 `NULL`이거나 다른 포인터 값일 수 있습니다.
-   `[out] byte_length`: 실제 데이터 버퍼의 바이트 단위 길이입니다.

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 `ArrayBuffer`의 실제 데이터 버퍼와 그 길이를 가져오는 데 사용됩니다.

*경고*: 이 API를 사용할 때 주의가 필요합니다. 반환된 후에도 실제 데이터 버퍼의 수명은 `ArrayBuffer`에 의해 관리됩니다. 이 API를 안전하게 사용하는 한 가지 방법은 [`napi_create_reference`](https://nodejs.org/docs/latest/api/n-api.html#napi_create_reference)와 함께 사용하여 `ArrayBuffer`의 수명을 보장하는 것입니다. 또한, 동일한 콜백 내에서 반환된 데이터 버퍼를 사용하는 것은 안전합니다. 단, 가비지 컬렉션(GC)을 트리거할 수 있는 다른 API를 호출하지 않는 한입니다.


##### `napi_get_buffer_info`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_buffer_info)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_get_buffer_info(napi_env env, napi_value value, void** data, size_t* length)
```

-   `[in] env`: API가 호출된 환경을 나타냅니다.
-   `[in] value`: `node::Buffer` 또는 `Uint8Array`를 나타내는 `napi_value`입니다.
-   `[out] data`: `node::Buffer` 또는 `Uint8Array`의 실제 데이터 버퍼입니다. 길이가 `0`인 경우, 이 값은 `NULL`이거나 다른 포인터 값일 수 있습니다.
-   `[out] length`: 실제 데이터 버퍼의 바이트 단위 길이입니다.

API가 성공하면 `napi_ok`를 반환합니다.

이 메서드는 [`napi_get_typedarray_info`](https://nodejs.org/docs/latest/api/n-api.html#napi_get_typedarray_info)와 동일한 `data`와 `byte_length`를 반환합니다. 또한 `napi_get_typedarray_info`는 `node::Buffer`(Uint8Array)도 값으로 받아들입니다.

이 API는 `node::Buffer`의 실제 데이터 버퍼와 그 길이를 가져오는 데 사용됩니다.

*경고*: 이 API를 사용할 때는 주의가 필요합니다. VM에 의해 관리되는 데이터 버퍼의 수명이 보장되지 않을 수 있습니다.


##### `napi_get_prototype`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_prototype)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_get_prototype(napi_env env, napi_value object, napi_value* result)
```

-   `[in] env`: API가 호출되는 환경을 나타냅니다.
-   `[in] object`: 프로토타입을 반환할 JavaScript `Object`를 나타내는 `napi_value`입니다. 이 함수는 `Object.getPrototypeOf`와 동일한 결과를 반환합니다. (이는 함수의 `prototype` 속성과는 다릅니다.)
-   `[out] result`: 주어진 객체의 프로토타입을 나타내는 `napi_value`입니다.

API가 성공적으로 실행되면 `napi_ok`를 반환합니다.


##### `napi_get_typedarray_info`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_typedarray_info)

추가된 버전: v8.0.0 N-API 버전: 1

```c
napi_status napi_get_typedarray_info(napi_env env, napi_value typedarray, napi_typedarray_type* type, size_t* length, void** data, napi_value* arraybuffer, size_t* byte_offset)
```

-   `[in] env`: API가 호출되는 환경.
-   `[in] typedarray`: 속성을 조회할 `TypedArray`를 나타내는 `napi_value`.
-   `[out] type`: `TypedArray` 내 요소의 스칼라 데이터 타입.
-   `[out] length`: `TypedArray` 내 요소의 개수.
-   `[out] data`: `TypedArray`의 첫 번째 요소를 가리키도록 `byte_offset` 값으로 조정된 데이터 버퍼. 배열의 길이가 `0`인 경우, 이 값은 `NULL`이거나 다른 포인터 값일 수 있음.
-   `[out] arraybuffer`: `TypedArray`의 기반이 되는 `ArrayBuffer`.
-   `[out] byte_offset`: 기본 네이티브 배열 내에서 첫 번째 요소가 위치한 바이트 오프셋. `data` 매개변수는 이미 조정되어 배열의 첫 번째 요소를 가리키므로, 네이티브 배열의 첫 번째 바이트는 `data - byte_offset`에 위치함.

API가 성공하면 `napi_ok`를 반환함.

이 API는 타입 배열의 다양한 속성을 반환함.

필요하지 않은 속성에 대해서는 출력 매개변수 중 어느 것이든 `NULL`일 수 있음.

*경고*: 이 API를 사용할 때는 기본 데이터 버퍼가 VM에 의해 관리되므로 주의가 필요함.


##### `napi_get_dataview_info`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_dataview_info)

추가된 버전: v8.3.0 N-API 버전: 1

```c
napi_status napi_get_dataview_info(napi_env env, napi_value dataview, size_t* byte_length, void** data, napi_value* arraybuffer, size_t* byte_offset)
```

-   `[in] env`: API가 호출된 환경.
-   `[in] dataview`: 조회할 속성을 가진 `DataView`를 나타내는 `napi_value`.
-   `[out] byte_length`: `DataView`의 바이트 수.
-   `[out] data`: `DataView`의 기반이 되는 데이터 버퍼. `byte_length`가 `0`인 경우, 이 값은 `NULL`이거나 다른 포인터 값일 수 있음.
-   `[out] arraybuffer`: `DataView`의 기반이 되는 `ArrayBuffer`.
-   `[out] byte_offset`: `DataView`를 투영하기 시작할 데이터 버퍼 내의 바이트 오프셋.

API가 성공하면 `napi_ok`를 반환함.

필요하지 않은 속성에 대해서는 아웃 파라미터 중 어느 것이든 `NULL`일 수 있음.

이 API는 `DataView`의 다양한 속성을 반환함.


##### `napi_get_date_value`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_date_value)

추가된 버전: v11.11.0, v10.17.0  
N-API 버전: 5

```c
napi_status napi_get_date_value(napi_env env, napi_value value, double* result)
```

-   `[in] env`: API가 호출된 환경
-   `[in] value`: JavaScript `Date`를 나타내는 `napi_value`
-   `[out] result`: 1970년 1월 1일 UTC 자정부터 경과한 시간을 밀리초 단위로 나타낸 `double` 값

이 API는 윤초를 고려하지 않습니다. ECMAScript가 POSIX 시간 규격과 일치하기 때문에 윤초는 무시됩니다.

API가 성공적으로 실행되면 `napi_ok`를 반환합니다. `Date`가 아닌 `napi_value`가 전달되면 `napi_date_expected`를 반환합니다.

이 API는 주어진 JavaScript `Date`의 시간 값을 C의 `double` 기본 타입으로 반환합니다.


##### `napi_get_value_bool`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_value_bool)

추가된 버전: v8.0.0 N-API 버전: 1

```c
napi_status napi_get_value_bool(napi_env env, napi_value value, bool* result)
```

-   `[in] env`: API가 호출되는 환경
-   `[in] value`: JavaScript `Boolean`을 나타내는 `napi_value`
-   `[out] result`: 주어진 JavaScript `Boolean`에 해당하는 C 언어의 boolean 기본 타입

API가 성공하면 `napi_ok`를 반환합니다. 만약 boolean이 아닌 `napi_value`가 전달되면 `napi_boolean_expected`를 반환합니다.

이 API는 주어진 JavaScript `Boolean`에 해당하는 C 언어의 boolean 기본 타입을 반환합니다.


##### `napi_get_value_double`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_value_double)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_get_value_double(napi_env env, napi_value value, double* result)
```

-   `[in] env`: API가 호출되는 환경
-   `[in] value`: JavaScript `number`를 나타내는 `napi_value`
-   `[out] result`: 주어진 JavaScript `number`에 해당하는 C 언어의 `double` 기본 타입

API가 성공적으로 실행되면 `napi_ok`를 반환합니다. 만약 `number`가 아닌 `napi_value`가 전달되면 `napi_number_expected`를 반환합니다.

이 API는 주어진 JavaScript `number`에 해당하는 C 언어의 `double` 기본 타입을 반환합니다.


##### `napi_get_value_bigint_int64`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_value_bigint_int64)

추가된 버전: v10.7.0  
N-API 버전: 6

```c
napi_status napi_get_value_bigint_int64(napi_env env, napi_value value, int64_t* result, bool* lossless);
```

- `[in] env`: API가 호출되는 환경
- `[in] value`: JavaScript `BigInt`를 나타내는 `napi_value`
- `[out] result`: 주어진 JavaScript `BigInt`와 동등한 C `int64_t` 기본 타입
- `[out] lossless`: `BigInt` 값이 손실 없이 변환되었는지 여부를 나타냄

API가 성공하면 `napi_ok`를 반환합니다. `BigInt`가 아닌 값이 전달되면 `napi_bigint_expected`를 반환합니다.

이 API는 주어진 JavaScript `BigInt`를 C `int64_t` 기본 타입으로 변환합니다. 필요한 경우 값을 잘라내고 `lossless`를 `false`로 설정합니다.


##### `napi_get_value_bigint_uint64`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_value_bigint_uint64)

추가된 버전: v10.7.0  
N-API 버전: 6

```c
napi_status napi_get_value_bigint_uint64(napi_env env, napi_value value, uint64_t* result, bool* lossless);
```

-   `[in] env`: API가 호출되는 환경
-   `[in] value`: JavaScript `BigInt`를 나타내는 `napi_value`
-   `[out] result`: 주어진 JavaScript `BigInt`와 동등한 C `uint64_t` 기본 타입
-   `[out] lossless`: `BigInt` 값이 손실 없이 변환되었는지 여부를 나타냄

API가 성공하면 `napi_ok`를 반환합니다. `BigInt`가 아닌 값이 전달되면 `napi_bigint_expected`를 반환합니다.

이 API는 주어진 JavaScript `BigInt`와 동등한 C `uint64_t` 기본 타입을 반환합니다. 필요한 경우 값을 잘라내고 `lossless`를 `false`로 설정합니다.


##### `napi_get_value_bigint_words`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_value_bigint_words)

추가된 버전: v10.7.0  
N-API 버전: 6

```c
napi_status napi_get_value_bigint_words(napi_env env, napi_value value, int* sign_bit, size_t* word_count, uint64_t* words);
```

-   `[in] env`: API가 호출되는 환경을 나타냅니다.
-   `[in] value`: JavaScript `BigInt`를 나타내는 `napi_value`입니다.
-   `[out] sign_bit`: JavaScript `BigInt`가 양수인지 음수인지를 나타내는 정수입니다.
-   `[in/out] word_count`: `words` 배열의 길이로 초기화되어야 합니다. 반환 시, 이 `BigInt`를 저장하는 데 필요한 실제 단어 수로 설정됩니다.
-   `[out] words`: 미리 할당된 64비트 단어 배열에 대한 포인터입니다.

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 단일 `BigInt` 값을 부호 비트, 64비트 리틀 엔디언 배열, 그리고 배열의 요소 수로 변환합니다. `sign_bit`와 `words`는 모두 `NULL`로 설정할 수 있으며, 이 경우 `word_count`만 얻을 수 있습니다.


##### `napi_get_value_external`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_value_external)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_get_value_external(napi_env env, napi_value value, void** result)
```

-   `[in] env`: API가 호출되는 환경
-   `[in] value`: JavaScript 외부 값을 나타내는 `napi_value`
-   `[out] result`: JavaScript 외부 값으로 감싸진 데이터를 가리키는 포인터

API가 성공하면 `napi_ok`를 반환합니다. 만약 외부 값이 아닌 `napi_value`가 전달되면 `napi_invalid_arg`를 반환합니다.

이 API는 이전에 `napi_create_external()`에 전달된 외부 데이터 포인터를 가져옵니다.


##### `napi_get_value_int32`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_value_int32)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_get_value_int32(napi_env env, napi_value value, int32_t* result)
```

-   `[in] env`: API가 호출되는 환경
-   `[in] value`: JavaScript `number`를 나타내는 `napi_value`
-   `[out] result`: 주어진 JavaScript `number`에 해당하는 C `int32` 기본 타입

API가 성공하면 `napi_ok`를 반환합니다. 만약 `napi_value`가 숫자가 아닌 경우 `napi_number_expected`를 반환합니다.

이 API는 주어진 JavaScript `number`에 해당하는 C `int32` 기본 타입을 반환합니다.

만약 숫자가 32비트 정수 범위를 초과하면, 결과는 하위 32비트에 해당하는 값으로 잘립니다. 이로 인해 값이 2<sup>31</sup> - 1보다 크면 큰 양수가 음수로 변환될 수 있습니다.

비유한 숫자 값(`NaN`, `+Infinity`, `-Infinity`)은 결과를 0으로 설정합니다.


##### `napi_get_value_int64`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_value_int64)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_get_value_int64(napi_env env, napi_value value, int64_t* result)
```

-   `[in] env`: API가 호출되는 환경
-   `[in] value`: JavaScript `number`를 나타내는 `napi_value`
-   `[out] result`: 주어진 JavaScript `number`에 해당하는 C `int64` 기본 타입

API가 성공하면 `napi_ok`를 반환합니다. 숫자가 아닌 `napi_value`가 전달되면 `napi_number_expected`를 반환합니다.

이 API는 주어진 JavaScript `number`에 해당하는 C `int64` 기본 타입을 반환합니다.

[`Number.MIN_SAFE_INTEGER`](https://tc39.github.io/ecma262/#sec-number.min_safe_integer) `-(2**53 - 1)`부터 [`Number.MAX_SAFE_INTEGER`](https://tc39.github.io/ecma262/#sec-number.max_safe_integer) `(2**53 - 1)` 범위를 벗어난 `number` 값은 정밀도를 잃을 수 있습니다.

비유한 숫자 값(`NaN`, `+Infinity`, `-Infinity`)은 결과를 0으로 설정합니다.


##### `napi_get_value_string_latin1`

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_get_value_string_latin1(napi_env env, napi_value value, char* buf, size_t bufsize, size_t* result)
```

- `[in] env`: API가 호출되는 환경을 나타냅니다.
- `[in] value`: 자바스크립트 문자열을 나타내는 `napi_value`입니다.
- `[in] buf`: ISO-8859-1로 인코딩된 문자열을 저장할 버퍼입니다. `NULL`이 전달되면, 문자열의 길이(바이트 단위, null 종료 문자 제외)가 `result`에 반환됩니다.
- `[in] bufsize`: 대상 버퍼의 크기입니다. 이 값이 충분하지 않으면, 반환된 문자열은 잘리고 null로 종료됩니다.
- `[out] result`: 버퍼에 복사된 바이트 수를 반환합니다. null 종료 문자는 제외됩니다.

API가 성공하면 `napi_ok`를 반환합니다. `string`이 아닌 `napi_value`가 전달되면 `napi_string_expected`를 반환합니다.

이 API는 전달된 값에 해당하는 ISO-8859-1로 인코딩된 문자열을 반환합니다.


##### `napi_get_value_string_utf8`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_value_string_utf8)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_get_value_string_utf8(napi_env env, napi_value value, char* buf, size_t bufsize, size_t* result)
```

-   `[in] env`: API가 호출되는 환경을 나타냅니다.
-   `[in] value`: 자바스크립트 문자열을 나타내는 `napi_value`입니다.
-   `[in] buf`: UTF8로 인코딩된 문자열을 저장할 버퍼입니다. `NULL`이 전달되면, `result`에 문자열의 길이(바이트 단위, null 종료자 제외)가 반환됩니다.
-   `[in] bufsize`: 대상 버퍼의 크기입니다. 이 값이 부족할 경우, 반환된 문자열은 잘리고 null로 종료됩니다.
-   `[out] result`: 버퍼에 복사된 바이트 수를 반환합니다. null 종료자는 제외됩니다.

API가 성공하면 `napi_ok`를 반환합니다. `string` 타입이 아닌 `napi_value`가 전달되면 `napi_string_expected`를 반환합니다.

이 API는 전달된 값에 해당하는 UTF8로 인코딩된 문자열을 반환합니다.


##### `napi_get_value_string_utf16`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_value_string_utf16)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_get_value_string_utf16(napi_env env, napi_value value, char16_t* buf, size_t bufsize, size_t* result)
```

-   `[in] env`: API가 호출된 환경을 나타냅니다.
-   `[in] value`: JavaScript 문자열을 나타내는 `napi_value`입니다.
-   `[in] buf`: UTF16-LE로 인코딩된 문자열을 쓸 버퍼입니다. `NULL`이 전달되면, 문자열의 길이를 2바이트 코드 단위로 반환하며, 널 종결자는 제외됩니다.
-   `[in] bufsize`: 대상 버퍼의 크기입니다. 이 값이 부족할 경우, 반환된 문자열은 잘리고 널 종결자가 추가됩니다.
-   `[out] result`: 버퍼에 복사된 2바이트 코드 단위의 수를 반환하며, 널 종결자는 제외됩니다.

API가 성공하면 `napi_ok`를 반환합니다. `string`이 아닌 `napi_value`가 전달되면 `napi_string_expected`를 반환합니다.

이 API는 전달된 값에 해당하는 UTF16으로 인코딩된 문자열을 반환합니다.


##### `napi_get_value_uint32`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_value_uint32)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_get_value_uint32(napi_env env, napi_value value, uint32_t* result)
```

-   `[in] env`: API가 호출되는 환경
-   `[in] value`: JavaScript `number`를 나타내는 `napi_value`
-   `[out] result`: 주어진 `napi_value`의 C 언어 기본 타입인 `uint32_t`로 변환된 값

API가 성공하면 `napi_ok`를 반환합니다. 만약 `number`가 아닌 `napi_value`가 전달되면 `napi_number_expected`를 반환합니다.

이 API는 주어진 `napi_value`를 C 언어의 `uint32_t` 타입으로 변환한 값을 반환합니다.


#### Functions to get global instances[#](https://nodejs.org/docs/latest/api/n-api.html#functions-to-get-global-instances)





##### `napi_get_boolean`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_boolean)

추가된 버전: v8.0.0 N-API 버전: 1

```c
napi_status napi_get_boolean(napi_env env, bool value, napi_value* result)
```

-   `[in] env`: API가 호출되는 환경
-   `[in] value`: 가져올 불리언 값
-   `[out] result`: JavaScript `Boolean` 싱글톤을 나타내는 `napi_value`

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 주어진 불리언 값을 나타내는 JavaScript 싱글톤 객체를 반환하는 데 사용됩니다.


##### `napi_get_global`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_global)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_get_global(napi_env env, napi_value* result)
```

-   `[in] env`: API가 호출되는 환경
-   `[out] result`: JavaScript의 `global` 객체를 나타내는 `napi_value`

API가 성공적으로 실행되면 `napi_ok`를 반환합니다.

이 API는 `global` 객체를 반환합니다.


##### `napi_get_null`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_null)

추가된 버전: v8.0.0 N-API 버전: 1

```c
napi_status napi_get_null(napi_env env, napi_value* result)
```

-   `[in] env`: API가 호출되는 환경
-   `[out] result`: JavaScript `null` 객체를 나타내는 `napi_value`

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 `null` 객체를 반환합니다.


##### `napi_get_undefined`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_undefined)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_get_undefined(napi_env env, napi_value* result)
```

-   `[in] env`: API가 호출되는 환경
-   `[out] result`: JavaScript의 `Undefined` 값을 나타내는 `napi_value`

API가 성공적으로 실행되면 `napi_ok`를 반환합니다.

이 API는 JavaScript의 `Undefined` 객체를 반환합니다.


### 자바스크립트 값과 추상 연산 작업하기

Node-API는 자바스크립트 값에 대해 일부 추상 연산을 수행할 수 있는 API 세트를 제공합니다. 이 연산 중 일부는 [ECMAScript 언어 사양](https://tc39.github.io/ecma262/)의 [섹션 7](https://tc39.github.io/ecma262/#sec-abstract-operations)에 문서화되어 있습니다.

이 API들은 다음과 같은 작업을 지원합니다:

1. 자바스크립트 값을 특정 자바스크립트 타입(예: `number` 또는 `string`)으로 강제 변환합니다.
2. 자바스크립트 값의 타입을 확인합니다.
3. 두 자바스크립트 값이 동일한지 확인합니다.


#### `napi_coerce_to_bool`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_coerce_to_bool)

추가된 버전: v8.0.0 N-API 버전: 1

```c
napi_status napi_coerce_to_bool(napi_env env, napi_value value, napi_value* result)
```

-   `[in] env`: API가 호출되는 환경
-   `[in] value`: 강제 변환할 JavaScript 값
-   `[out] result`: 강제 변환된 JavaScript `Boolean`을 나타내는 `napi_value`

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 ECMAScript 언어 명세의 [7.1.2절](https://tc39.github.io/ecma262/#sec-toboolean)에 정의된 `ToBoolean()` 추상 연산을 구현합니다.


#### `napi_coerce_to_number`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_coerce_to_number)

추가된 버전: v8.0.0 N-API 버전: 1

```c
napi_status napi_coerce_to_number(napi_env env, napi_value value, napi_value* result)
```

-   `[in] env`: API가 호출되는 환경
-   `[in] value`: 강제 변환할 JavaScript 값
-   `[out] result`: 강제 변환된 JavaScript `number`를 나타내는 `napi_value`

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 ECMAScript 언어 명세서의 [Section 7.1.3](https://tc39.github.io/ecma262/#sec-tonumber)에 정의된 `ToNumber()` 추상 연산을 구현합니다. 전달된 값이 객체인 경우 이 함수는 잠재적으로 JavaScript 코드를 실행할 수 있습니다.


#### `napi_coerce_to_object`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_coerce_to_object)

추가된 버전: v8.0.0 N-API 버전: 1

```c
napi_status napi_coerce_to_object(napi_env env, napi_value value, napi_value* result)
```

-   `[in] env`: API가 호출되는 환경
-   `[in] value`: 객체로 변환할 JavaScript 값
-   `[out] result`: 변환된 JavaScript `Object`를 나타내는 `napi_value`

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 ECMAScript 언어 명세서의 [Section 7.1.13](https://tc39.github.io/ecma262/#sec-toobject)에 정의된 `ToObject()` 추상 연산을 구현합니다.


#### `napi_coerce_to_string`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_coerce_to_string)

추가된 버전: v8.0.0 N-API 버전: 1

```c
napi_status napi_coerce_to_string(napi_env env, napi_value value, napi_value* result)
```

-   `[in] env`: API가 호출되는 환경
-   `[in] value`: 문자열로 변환할 JavaScript 값
-   `[out] result`: 변환된 JavaScript `string`을 나타내는 `napi_value`

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 ECMAScript 언어 명세서의 [Section 7.1.13](https://tc39.github.io/ecma262/#sec-toobject)에 정의된 `ToString()` 추상 연산을 구현합니다. 전달된 값이 객체인 경우, 이 함수는 잠재적으로 JavaScript 코드를 실행할 수 있습니다.


#### `napi_typeof`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_typeof)

추가된 버전: v8.0.0 N-API 버전: 1

```c
napi_status napi_typeof(napi_env env, napi_value value, napi_valuetype* result)
```

-   `[in] env`: API가 호출되는 환경
-   `[in] value`: 타입을 확인할 자바스크립트 값
-   `[out] result`: 자바스크립트 값의 타입

API가 성공하면 `napi_ok`를 반환합니다.

-   `value`의 타입이 알려진 ECMAScript 타입이 아니고 `value`가 External 값이 아닌 경우 `napi_invalid_arg`를 반환합니다.

이 API는 ECMAScript 언어 명세서의 [Section 12.5.5](https://tc39.github.io/ecma262/#sec-typeof-operator)에 정의된 `typeof` 연산자를 객체에 적용한 것과 유사한 동작을 나타냅니다. 하지만 몇 가지 차이점이 있습니다:

1.  External 값을 감지하는 기능을 지원합니다.
2.  `null`을 별도의 타입으로 감지하며, ECMAScript `typeof`는 `object`로 감지합니다.

`value`의 타입이 유효하지 않으면 오류가 반환됩니다.


#### `napi_instanceof`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_instanceof)

추가된 버전: v8.0.0 N-API 버전: 1

```c
napi_status napi_instanceof(napi_env env, napi_value object, napi_value constructor, bool* result)
```

-   `[in] env`: API가 호출되는 환경
-   `[in] object`: 확인할 JavaScript 값
-   `[in] constructor`: 확인할 생성자 함수의 JavaScript 함수 객체
-   `[out] result`: `object instanceof constructor`가 참일 경우 true로 설정되는 불리언 값

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 ECMAScript 언어 명세서의 [Section 12.10.4](https://tc39.github.io/ecma262/#sec-instanceofoperator)에 정의된 대로 객체에 `instanceof` 연산자를 호출하는 것을 나타냅니다.


#### `napi_is_array`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_is_array)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_is_array(napi_env env, napi_value value, bool* result)
```

-   `[in] env`: API가 호출되는 환경
-   `[in] value`: 확인할 JavaScript 값
-   `[out] result`: 주어진 객체가 배열인지 여부

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 ECMAScript 언어 명세서의 [7.2.2절](https://tc39.github.io/ecma262/#sec-isarray)에 정의된 `IsArray` 연산을 객체에 적용하는 것을 나타냅니다.


#### `napi_is_arraybuffer`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_is_arraybuffer)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_is_arraybuffer(napi_env env, napi_value value, bool* result)
```

-   `[in] env`: API가 호출되는 환경
-   `[in] value`: 확인할 JavaScript 값
-   `[out] result`: 주어진 객체가 `ArrayBuffer`인지 여부

API가 성공적으로 실행되면 `napi_ok`를 반환합니다.

이 API는 전달된 `Object`가 배열 버퍼인지 확인합니다.


#### `napi_is_buffer`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_is_buffer)

추가된 버전: v8.0.0 N-API 버전: 1

```c
napi_status napi_is_buffer(napi_env env, napi_value value, bool* result)
```

-   `[in] env`: API가 호출되는 환경
-   `[in] value`: 확인할 JavaScript 값
-   `[out] result`: 주어진 `napi_value`가 `node::Buffer` 또는 `Uint8Array` 객체인지 여부

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 전달된 `Object`가 버퍼 또는 Uint8Array인지 확인합니다. 호출자가 값이 Uint8Array인지 확인해야 한다면 [`napi_is_typedarray`](https://nodejs.org/docs/latest/api/n-api.html#napi_is_typedarray)를 사용하는 것이 더 좋습니다.


#### `napi_is_date`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_is_date)

추가된 버전: v11.11.0, v10.17.0  
N-API 버전: 5

```c
napi_status napi_is_date(napi_env env, napi_value value, bool* result)
```

-   `[in] env`: API가 호출된 환경
-   `[in] value`: 확인할 JavaScript 값
-   `[out] result`: 주어진 `napi_value`가 JavaScript `Date` 객체인지 여부

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 전달된 `Object`가 날짜 객체인지 확인합니다.


#### `napi_is_error`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_is_error_1)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_is_error(napi_env env, napi_value value, bool* result)
```

-   `[in] env`: API가 호출되는 환경
-   `[in] value`: 확인할 JavaScript 값
-   `[out] result`: 주어진 `napi_value`가 `Error` 객체인지 여부

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 전달된 `Object`가 `Error`인지 확인합니다.


#### `napi_is_typedarray`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_is_typedarray)

추가된 버전: v8.0.0 N-API 버전: 1

```c
napi_status napi_is_typedarray(napi_env env, napi_value value, bool* result)
```

-   `[in] env`: API가 호출되는 환경.
-   `[in] value`: 확인할 JavaScript 값.
-   `[out] result`: 주어진 `napi_value`가 `TypedArray`인지 여부.

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 전달된 `Object`가 typed array인지 확인합니다.


#### `napi_is_dataview`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_is_dataview)

추가된 버전: v8.3.0  
N-API 버전: 1

```c
napi_status napi_is_dataview(napi_env env, napi_value value, bool* result)
```

-   `[in] env`: API가 호출된 환경
-   `[in] value`: 확인할 JavaScript 값
-   `[out] result`: 주어진 `napi_value`가 `DataView`인지 여부

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 전달된 `Object`가 `DataView`인지 확인합니다.


#### `napi_strict_equals`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_strict_equals)

추가된 버전: v8.0.0 N-API 버전: 1

```c
napi_status napi_strict_equals(napi_env env, napi_value lhs, napi_value rhs, bool* result)
```

-   `[in] env`: API가 호출되는 환경
-   `[in] lhs`: 비교할 JavaScript 값
-   `[in] rhs`: 비교 대상 JavaScript 값
-   `[out] result`: 두 `napi_value` 객체가 동일한지 여부

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 ECMAScript 언어 명세서의 [Section 7.2.14](https://tc39.github.io/ecma262/#sec-strict-equality-comparison)에 정의된 **Strict Equality 알고리즘**을 호출하는 것을 나타냅니다.


#### `napi_detach_arraybuffer`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_detach_arraybuffer)

추가된 버전: v13.0.0, v12.16.0, v10.22.0  
N-API 버전: 7

```c
napi_status napi_detach_arraybuffer(napi_env env, napi_value arraybuffer)
```

-   `[in] env`: API가 호출되는 환경
-   `[in] arraybuffer`: 분리할 JavaScript `ArrayBuffer`

API가 성공하면 `napi_ok`를 반환합니다. 분리할 수 없는 `ArrayBuffer`가 전달되면 `napi_detachable_arraybuffer_expected`를 반환합니다.

일반적으로, `ArrayBuffer`는 이전에 분리된 경우 분리할 수 없습니다. 엔진은 `ArrayBuffer`가 분리 가능한지 여부에 추가 조건을 부과할 수 있습니다. 예를 들어, V8은 `ArrayBuffer`가 외부에서 생성되어야 한다는 조건을 요구합니다. 즉, [`napi_create_external_arraybuffer`](https://nodejs.org/docs/latest/api/n-api.html#napi_create_external_arraybuffer)로 생성되어야 합니다.

이 API는 ECMAScript 언어 명세서의 [24.1.1.3절](https://tc39.es/ecma262/#sec-detacharraybuffer)에 정의된 `ArrayBuffer` 분리 작업을 호출하는 것을 나타냅니다.


#### `napi_is_detached_arraybuffer`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_is_detached_arraybuffer)

추가된 버전: v13.3.0, v12.16.0, v10.22.0  
N-API 버전: 7

```c
napi_status napi_is_detached_arraybuffer(napi_env env, napi_value arraybuffer, bool* result)
```

-   `[in] env`: API가 호출되는 환경
-   `[in] arraybuffer`: 확인할 JavaScript `ArrayBuffer`
-   `[out] result`: `arraybuffer`가 분리되었는지 여부

API가 성공하면 `napi_ok`를 반환합니다.

`ArrayBuffer`의 내부 데이터가 `null`인 경우, 이 버퍼는 분리된 것으로 간주됩니다.

이 API는 ECMAScript 언어 명세서의 [섹션 24.1.1.2](https://tc39.es/ecma262/#sec-isdetachedbuffer)에 정의된 `ArrayBuffer`의 `IsDetachedBuffer` 연산을 호출하는 것을 나타냅니다.


### JavaScript 프로퍼티 작업하기

Node-API는 JavaScript 객체의 프로퍼티를 가져오고 설정하는 API를 제공합니다. 이 타입들 중 일부는 [ECMAScript 언어 사양](https://tc39.github.io/ecma262/)의 [Section 7](https://tc39.github.io/ecma262/#sec-abstract-operations)에 문서화되어 있습니다.

JavaScript에서 프로퍼티는 키와 값의 튜플로 표현됩니다. 기본적으로 Node-API의 모든 프로퍼티 키는 다음 형태 중 하나로 표현될 수 있습니다:

- **이름 기반**: 간단한 UTF8 인코딩 문자열
- **정수 인덱스 기반**: `uint32_t`로 표현된 인덱스 값
- **JavaScript 값**: Node-API에서 `napi_value`로 표현됩니다. 이는 `string`, `number`, `symbol`을 나타내는 `napi_value`일 수 있습니다.

Node-API 값은 `napi_value` 타입으로 표현됩니다. JavaScript 값을 필요로 하는 모든 Node-API 호출은 `napi_value`를 입력으로 받습니다. 그러나 API가 예상하는 JavaScript 타입인지 확인하는 것은 호출자의 책임입니다.

이 섹션에 문서화된 API는 `napi_value`로 표현된 임의의 JavaScript 객체에서 프로퍼티를 가져오고 설정하는 간단한 인터페이스를 제공합니다.

예를 들어, 다음 JavaScript 코드를 살펴보겠습니다:

```js
const obj = {};
obj.myProp = 123;
```

이와 동일한 작업을 Node-API 값으로 수행하려면 다음과 같이 작성할 수 있습니다:

```c
napi_status status = napi_generic_failure;

// const obj = {}
napi_value obj, value;
status = napi_create_object(env, &obj);
if (status != napi_ok) return status;

// 123을 나타내는 napi_value 생성
status = napi_create_int32(env, 123, &value);
if (status != napi_ok) return status;

// obj.myProp = 123
status = napi_set_named_property(env, obj, "myProp", value);
if (status != napi_ok) return status;
```

인덱스 기반 프로퍼티도 비슷한 방식으로 설정할 수 있습니다. 다음 JavaScript 코드를 살펴보겠습니다:

```js
const arr = [];
arr[123] = 'hello';
```

이와 동일한 작업을 Node-API 값으로 수행하려면 다음과 같이 작성할 수 있습니다:

```c
napi_status status = napi_generic_failure;

// const arr = []
napi_value arr, value;
status = napi_create_array(env, &arr);
if (status != napi_ok) return status;

// 'hello'를 나타내는 napi_value 생성
status = napi_create_string_utf8(env, "hello", NAPI_AUTO_LENGTH, &value);
if (status != napi_ok) return status;

// arr[123] = 'hello'
status = napi_set_element(env, arr, 123, value);
if (status != napi_ok) return status;
```

이 섹션에 설명된 API를 사용하여 프로퍼티를 가져올 수도 있습니다. 다음 JavaScript 코드를 살펴보겠습니다:

```js
const arr = [];
const value = arr[123];
```

이와 동일한 작업을 Node-API 값으로 수행하려면 다음과 같이 작성할 수 있습니다:

```c
napi_status status = napi_generic_failure;

// const arr = []
napi_value arr, value;
status = napi_create_array(env, &arr);
if (status != napi_ok) return status;

// const value = arr[123]
status = napi_get_element(env, arr, 123, &value);
if (status != napi_ok) return status;
```

마지막으로, 성능상의 이유로 객체에 여러 프로퍼티를 한 번에 정의할 수도 있습니다. 다음 JavaScript 코드를 살펴보겠습니다:

```js
const obj = {};
Object.defineProperties(obj, {
  'foo': { value: 123, writable: true, configurable: true, enumerable: true },
  'bar': { value: 456, writable: true, configurable: true, enumerable: true },
});
```

이와 동일한 작업을 Node-API 값으로 수행하려면 다음과 같이 작성할 수 있습니다:

```c
napi_status status = napi_status_generic_failure;

// const obj = {};
napi_value obj;
status = napi_create_object(env, &obj);
if (status != napi_ok) return status;

// 123과 456을 나타내는 napi_value 생성
napi_value fooValue, barValue;
status = napi_create_int32(env, 123, &fooValue);
if (status != napi_ok) return status;
status = napi_create_int32(env, 456, &barValue);
if (status != napi_ok) return status;

// 프로퍼티 설정
napi_property_descriptor descriptors[] = {
  { "foo", NULL, NULL, NULL, NULL, fooValue, napi_writable | napi_configurable, NULL },
  { "bar", NULL, NULL, NULL, NULL, barValue, napi_writable | napi_configurable, NULL }
};
status = napi_define_properties(env, obj, sizeof(descriptors) / sizeof(descriptors[0]), descriptors);
if (status != napi_ok) return status;
```


#### Structures[#](https://nodejs.org/docs/latest/api/n-api.html#structures)





##### `napi_property_attributes`

```c
typedef enum {
    napi_default = 0,
    napi_writable = 1 << 0,
    napi_enumerable = 1 << 1,
    napi_configurable = 1 << 2,
    // napi_define_class에서 사용되며, 인스턴스 속성과 구분하기 위해 정적 속성을 나타냄.
    // napi_define_properties에서는 무시됨.
    napi_static = 1 << 10,
    // 클래스 메서드의 기본값.
    napi_default_method = napi_writable | napi_configurable,
    // JS 객체 속성의 기본값, 예: obj[prop].
    napi_default_jsproperty = napi_writable | napi_enumerable | napi_configurable,
} napi_property_attributes;
```

`napi_property_attributes`는 JavaScript 객체에 설정된 속성의 동작을 제어하는 플래그입니다. `napi_static`을 제외하고는 [ECMAScript 언어 사양](https://tc39.github.io/ecma262/)의 [섹션 6.1.7.1](https://tc39.github.io/ecma262/#table-2)에 나열된 속성과 일치합니다. 이 플래그는 다음과 같은 비트 플래그 중 하나 이상으로 구성될 수 있습니다:

-   `napi_default`: 속성에 명시적인 속성이 설정되지 않음. 기본적으로 속성은 읽기 전용이며, 열거 불가능하고 설정 불가능합니다.
-   `napi_writable`: 속성이 쓰기 가능합니다.
-   `napi_enumerable`: 속성이 열거 가능합니다.
-   `napi_configurable`: 속성이 [ECMAScript 언어 사양](https://tc39.github.io/ecma262/)의 [섹션 6.1.7.1](https://tc39.github.io/ecma262/#table-2)에 정의된 대로 설정 가능합니다.
-   `napi_static`: 속성이 클래스의 정적 속성으로 정의됩니다. 기본값은 인스턴스 속성입니다. 이 플래그는 [`napi_define_class`](https://nodejs.org/docs/latest/api/n-api.html#napi_define_class)에서만 사용되며, `napi_define_properties`에서는 무시됩니다.
-   `napi_default_method`: JS 클래스의 메서드처럼 속성이 설정 가능하고 쓰기 가능하지만, 열거 불가능합니다.
-   `napi_default_jsproperty`: JavaScript에서 할당을 통해 설정된 속성처럼 속성이 쓰기 가능하고, 열거 가능하며, 설정 가능합니다.


##### `napi_property_descriptor`

```c
typedef struct {
    // utf8name 또는 name 중 하나는 NULL이어야 함
    const char* utf8name;
    napi_value name;
    napi_callback method;
    napi_callback getter;
    napi_callback setter;
    napi_value value;
    napi_property_attributes attributes;
    void* data;
} napi_property_descriptor;
```

- **`utf8name`**: 프로퍼티의 키를 설명하는 선택적 문자열로, UTF8로 인코딩됩니다. `utf8name` 또는 `name` 중 하나는 반드시 제공되어야 합니다.
- **`name`**: 프로퍼티의 키로 사용될 JavaScript 문자열이나 심볼을 가리키는 선택적 `napi_value`입니다. `utf8name` 또는 `name` 중 하나는 반드시 제공되어야 합니다.
- **`value`**: 프로퍼티가 데이터 프로퍼티일 때, 프로퍼티의 get 접근으로 검색되는 값입니다. 이 값이 제공되면 `getter`, `setter`, `method`, `data`는 `NULL`로 설정해야 합니다 (이 멤버들은 사용되지 않기 때문입니다).
- **`getter`**: 프로퍼티의 get 접근이 수행될 때 호출될 함수입니다. 이 값이 제공되면 `value`와 `method`는 `NULL`로 설정해야 합니다 (이 멤버들은 사용되지 않기 때문입니다). 이 함수는 JavaScript 코드에서 프로퍼티에 접근하거나 Node-API 호출을 통해 프로퍼티를 get할 때 런타임에 의해 암시적으로 호출됩니다. 자세한 내용은 [`napi_callback`](https://nodejs.org/docs/latest/api/n-api.html#napi_callback)을 참조하세요.
- **`setter`**: 프로퍼티의 set 접근이 수행될 때 호출될 함수입니다. 이 값이 제공되면 `value`와 `method`는 `NULL`로 설정해야 합니다 (이 멤버들은 사용되지 않기 때문입니다). 이 함수는 JavaScript 코드에서 프로퍼티를 설정하거나 Node-API 호출을 통해 프로퍼티를 set할 때 런타임에 의해 암시적으로 호출됩니다. 자세한 내용은 [`napi_callback`](https://nodejs.org/docs/latest/api/n-api.html#napi_callback)을 참조하세요.
- **`method`**: 이 값을 설정하면 프로퍼티 디스크립터 객체의 `value` 프로퍼티가 `method`로 표현된 JavaScript 함수가 됩니다. 이 값이 제공되면 `value`, `getter`, `setter`는 `NULL`로 설정해야 합니다 (이 멤버들은 사용되지 않기 때문입니다). 자세한 내용은 [`napi_callback`](https://nodejs.org/docs/latest/api/n-api.html#napi_callback)을 참조하세요.
- **`attributes`**: 특정 프로퍼티와 관련된 속성입니다. 자세한 내용은 [`napi_property_attributes`](https://nodejs.org/docs/latest/api/n-api.html#napi_property_attributes)를 참조하세요.
- **`data`**: `method`, `getter`, `setter`가 호출될 때 전달되는 콜백 데이터입니다.


#### Functions[#](https://nodejs.org/docs/latest/api/n-api.html#functions)





##### `napi_get_property_names`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_property_names)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_get_property_names(napi_env env, napi_value object, napi_value* result);
```

-   `[in] env`: Node-API 호출이 실행되는 환경
-   `[in] object`: 프로퍼티를 가져올 객체
-   `[out] result`: 객체의 프로퍼티 이름을 나타내는 JavaScript 값의 배열을 표현하는 `napi_value`. 이 배열은 [`napi_get_array_length`](https://nodejs.org/docs/latest/api/n-api.html#napi_get_array_length)와 [`napi_get_element`](https://nodejs.org/docs/latest/api/n-api.html#napi_get_element)를 사용하여 순회할 수 있다.

API가 성공하면 `napi_ok`를 반환한다.

이 API는 `object`의 열거 가능한 프로퍼티 이름을 문자열 배열로 반환한다. 키가 심볼인 프로퍼티는 포함되지 않는다.


##### `napi_get_all_property_names`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_all_property_names)

추가된 버전: v13.7.0, v12.17.0, v10.20.0  
N-API 버전: 6

```c
napi_get_all_property_names(napi_env env, napi_value object, napi_key_collection_mode key_mode, napi_key_filter key_filter, napi_key_conversion key_conversion, napi_value* result);
```

-   `[in] env`: Node-API 호출이 실행되는 환경입니다.
-   `[in] object`: 프로퍼티를 가져올 객체입니다.
-   `[in] key_mode`: 프로토타입 프로퍼티도 함께 가져올지 여부를 결정합니다.
-   `[in] key_filter`: 어떤 프로퍼티를 가져올지 지정합니다 (열거 가능한/읽기 가능한/쓰기 가능한 프로퍼티).
-   `[in] key_conversion`: 숫자로 된 프로퍼티 키를 문자열로 변환할지 여부를 결정합니다.
-   `[out] result`: 객체의 프로퍼티 이름을 나타내는 JavaScript 값들의 배열을 표현하는 `napi_value`입니다. [`napi_get_array_length`](https://nodejs.org/docs/latest/api/n-api.html#napi_get_array_length)와 [`napi_get_element`](https://nodejs.org/docs/latest/api/n-api.html#napi_get_element)을 사용해 `result`를 순회할 수 있습니다.

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 해당 객체의 사용 가능한 프로퍼티 이름들을 담은 배열을 반환합니다.


##### `napi_set_property`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_set_property)

추가된 버전: v8.0.0 N-API 버전: 1

```c
napi_status napi_set_property(napi_env env, napi_value object, napi_value key, napi_value value);
```

-   `[in] env`: Node-API 호출이 실행되는 환경
-   `[in] object`: 속성을 설정할 객체
-   `[in] key`: 설정할 속성의 이름
-   `[in] value`: 속성 값

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 전달된 `Object`에 속성을 설정합니다.


##### `napi_get_property`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_property)

추가된 버전: v8.0.0 N-API 버전: 1

```c
napi_status napi_get_property(napi_env env, napi_value object, napi_value key, napi_value* result);
```

-   `[in] env`: Node-API 호출이 실행되는 환경
-   `[in] object`: 속성을 가져올 객체
-   `[in] key`: 가져올 속성의 이름
-   `[out] result`: 속성의 값

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 전달된 `Object`에서 요청된 속성을 가져옵니다.


##### `napi_has_property`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_has_property)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_has_property(napi_env env, napi_value object, napi_value key, bool* result);
```

-   `[in] env`: Node-API 호출이 실행되는 환경
-   `[in] object`: 쿼리할 객체
-   `[in] key`: 존재 여부를 확인할 프로퍼티의 이름
-   `[out] result`: 객체에 해당 프로퍼티가 존재하는지 여부

API가 성공적으로 실행되면 `napi_ok`를 반환합니다.

이 API는 전달된 `Object`에 지정된 이름의 프로퍼티가 있는지 확인합니다.


##### `napi_delete_property`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_delete_property)

추가된 버전: v8.2.0  
N-API 버전: 1

```c
napi_status napi_delete_property(napi_env env, napi_value object, napi_value key, bool* result);
```

-   `[in] env`: Node-API 호출이 실행되는 환경입니다.
-   `[in] object`: 쿼리할 객체입니다.
-   `[in] key`: 삭제할 프로퍼티의 이름입니다.
-   `[out] result`: 프로퍼티 삭제가 성공했는지 여부를 나타냅니다. `result`는 `NULL`을 전달하여 무시할 수 있습니다.

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 `object`에서 `key` 프로퍼티를 삭제하려고 시도합니다.


##### `napi_has_own_property`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_has_own_property)

추가된 버전: v8.2.0  
N-API 버전: 1

```c
napi_status napi_has_own_property(napi_env env, napi_value object, napi_value key, bool* result);
```

-   `[in] env`: Node-API 호출이 실행되는 환경
-   `[in] object`: 쿼리할 객체
-   `[in] key`: 존재 여부를 확인할 프로퍼티의 이름
-   `[out] result`: 객체에 해당 프로퍼티가 존재하는지 여부

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 전달된 `Object`가 명시된 프로퍼티를 직접 소유하고 있는지 확인합니다. `key`는 반드시 `string` 또는 `symbol`이어야 하며, 그렇지 않으면 오류가 발생합니다. Node-API는 데이터 타입 간의 변환을 수행하지 않습니다.


##### `napi_set_named_property`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_set_named_property)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_set_named_property(napi_env env, napi_value object, const char* utf8Name, napi_value value);
```

-   `[in] env`: Node-API 호출이 실행되는 환경입니다.
-   `[in] object`: 속성을 설정할 객체입니다.
-   `[in] utf8Name`: 설정할 속성의 이름입니다.
-   `[in] value`: 속성 값입니다.

API가 성공하면 `napi_ok`를 반환합니다.

이 메서드는 `utf8Name`으로 전달된 문자열로부터 생성된 `napi_value`를 사용하여 [`napi_set_property`](https://nodejs.org/docs/latest/api/n-api.html#napi_set_property)를 호출하는 것과 동일합니다.


##### `napi_get_named_property`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_named_property)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_get_named_property(napi_env env, napi_value object, const char* utf8Name, napi_value* result);
```

-   `[in] env`: Node-API 호출이 실행되는 환경입니다.
-   `[in] object`: 프로퍼티를 가져올 객체입니다.
-   `[in] utf8Name`: 가져올 프로퍼티의 이름입니다.
-   `[out] result`: 프로퍼티의 값입니다.

API가 성공하면 `napi_ok`를 반환합니다.

이 메서드는 `utf8Name`으로 전달된 문자열로부터 생성된 `napi_value`를 사용하여 [`napi_get_property`](https://nodejs.org/docs/latest/api/n-api.html#napi_get_property)를 호출하는 것과 동일합니다.


##### `napi_has_named_property`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_has_named_property)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_has_named_property(napi_env env, napi_value object, const char* utf8Name, bool* result);
```

-   `[in] env`: Node-API 호출이 실행되는 환경입니다.
-   `[in] object`: 쿼리할 객체입니다.
-   `[in] utf8Name`: 존재 여부를 확인할 프로퍼티의 이름입니다.
-   `[out] result`: 객체에 해당 프로퍼티가 존재하는지 여부를 나타냅니다.

API가 성공적으로 실행되면 `napi_ok`를 반환합니다.

이 메서드는 `utf8Name`으로 전달된 문자열로부터 생성된 `napi_value`를 사용하여 [`napi_has_property`](https://nodejs.org/docs/latest/api/n-api.html#napi_has_property)를 호출하는 것과 동일합니다.


##### `napi_set_element`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_set_element)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_set_element(napi_env env, napi_value object, uint32_t index, napi_value value);
```

-   `[in] env`: Node-API 호출이 실행되는 환경
-   `[in] object`: 속성을 설정할 객체
-   `[in] index`: 설정할 속성의 인덱스
-   `[in] value`: 속성 값

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 전달된 `Object`에 요소를 설정합니다.


##### `napi_get_element`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_element)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_get_element(napi_env env, napi_value object, uint32_t index, napi_value* result);
```

-   `[in] env`: Node-API 호출이 실행되는 환경
-   `[in] object`: 속성을 가져올 객체
-   `[in] index`: 가져올 속성의 인덱스
-   `[out] result`: 속성의 값

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 요청한 인덱스에 있는 엘리먼트를 가져옵니다.


##### `napi_has_element`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_has_element)

추가된 버전: v8.0.0 N-API 버전: 1

```c
napi_status napi_has_element(napi_env env, napi_value object, uint32_t index, bool* result);
```

-   `[in] env`: Node-API 호출이 실행되는 환경.
-   `[in] object`: 쿼리할 객체.
-   `[in] index`: 존재 여부를 확인할 프로퍼티의 인덱스.
-   `[out] result`: 객체에 해당 프로퍼티가 존재하는지 여부.

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 전달된 `Object`가 요청된 인덱스에 엘리먼트를 가지고 있는지 여부를 반환합니다.


##### `napi_delete_element`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_delete_element)

추가된 버전: v8.2.0  
N-API 버전: 1

```c
napi_status napi_delete_element(napi_env env, napi_value object, uint32_t index, bool* result);
```

-   `[in] env`: Node-API 호출이 실행되는 환경입니다.
-   `[in] object`: 쿼리할 객체입니다.
-   `[in] index`: 삭제할 프로퍼티의 인덱스입니다.
-   `[out] result`: 엘리먼트 삭제가 성공했는지 여부를 나타냅니다. `result`는 `NULL`을 전달해 무시할 수 있습니다.

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 `object`에서 지정된 `index`를 삭제하려고 시도합니다.


##### `napi_define_properties`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_define_properties)

추가된 버전: v8.0.0 N-API 버전: 1

```c
napi_status napi_define_properties(napi_env env, napi_value object, size_t property_count, const napi_property_descriptor* properties);
```

-   `[in] env`: Node-API 호출이 실행되는 환경
-   `[in] object`: 프로퍼티를 정의할 객체
-   `[in] property_count`: `properties` 배열의 요소 개수
-   `[in] properties`: 프로퍼티 디스크립터 배열

API가 성공하면 `napi_ok`를 반환합니다.

이 메서드는 주어진 객체에 여러 프로퍼티를 효율적으로 정의할 수 있게 해줍니다. 프로퍼티는 프로퍼티 디스크립터를 사용하여 정의됩니다 (자세한 내용은 [`napi_property_descriptor`](https://nodejs.org/docs/latest/api/n-api.html#napi_property_descriptor) 참조). 프로퍼티 디스크립터 배열이 주어지면, 이 API는 `DefineOwnProperty()` (ECMA-262 명세의 [Section 9.1.6](https://tc39.github.io/ecma262/#sec-ordinary-object-internal-methods-and-internal-slots-defineownproperty-p-desc)에 설명됨)에 정의된 대로 객체에 프로퍼티를 하나씩 설정합니다.


##### `napi_object_freeze`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_object_freeze)

추가된 버전: v14.14.0, v12.20.0  
N-API 버전: 8

```c
napi_status napi_object_freeze(napi_env env, napi_value object);
```

-   `[in] env`: Node-API 호출이 실행되는 환경
-   `[in] object`: 고정할 객체

API가 성공하면 `napi_ok`를 반환합니다.

이 메서드는 주어진 객체를 고정(freeze)합니다. 객체를 고정하면 새로운 속성을 추가하거나 기존 속성을 제거할 수 없으며, 기존 속성의 열거 가능성, 구성 가능성, 쓰기 가능성을 변경할 수 없습니다. 또한 기존 속성의 값을 변경하거나 객체의 프로토타입을 변경할 수 없습니다. 이는 ECMA-262 명세의 [Section 19.1.2.6](https://tc39.es/ecma262/#sec-object.freeze)에 설명되어 있습니다.


##### `napi_object_seal`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_object_seal)

추가된 버전: v14.14.0, v12.20.0  
N-API 버전: 8

```c
napi_status napi_object_seal(napi_env env, napi_value object);
```

-   `[in] env`: Node-API 호출이 실행되는 환경
-   `[in] object`: 봉인할 객체

API가 성공하면 `napi_ok`를 반환합니다.

이 메서드는 주어진 객체를 봉인합니다. 이는 객체에 새로운 속성을 추가하는 것을 방지하고, 기존 속성을 모두 수정 불가능한 상태로 만듭니다. 이는 ECMA-262 명세의 [Section 19.1.2.20](https://tc39.es/ecma262/#sec-object.seal)에 설명되어 있습니다.


### 자바스크립트 함수 작업하기

Node-API는 자바스크립트 코드가 네이티브 코드로 다시 호출할 수 있도록 하는 API 집합을 제공합니다. 네이티브 코드로 다시 호출을 지원하는 Node-API는 `napi_callback` 타입으로 표현되는 콜백 함수를 받습니다. 자바스크립트 VM이 네이티브 코드로 다시 호출할 때, 제공된 `napi_callback` 함수가 호출됩니다. 이 섹션에서 설명하는 API는 콜백 함수가 다음 작업을 수행할 수 있게 합니다:

- 콜백이 호출된 컨텍스트에 대한 정보를 가져옵니다.
- 콜백에 전달된 인자를 가져옵니다.
- 콜백에서 `napi_value`를 반환합니다.

또한, Node-API는 네이티브 코드에서 자바스크립트 함수를 호출할 수 있게 하는 함수 집합을 제공합니다. 일반 자바스크립트 함수 호출처럼 함수를 호출하거나, 생성자 함수로 호출할 수 있습니다.

`napi_property_descriptor` 항목의 `data` 필드를 통해 이 API에 전달된 `NULL`이 아닌 데이터는 `object`와 연결될 수 있으며, `object`가 가비지 컬렉션될 때 [`napi_add_finalizer`](https://nodejs.org/docs/latest/api/n-api.html#napi_add_finalizer)에 `object`와 데이터를 전달하여 해제할 수 있습니다.


#### `napi_call_function`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_call_function)

추가된 버전: v8.0.0 N-API 버전: 1

```c
NAPI_EXTERN napi_status napi_call_function(napi_env env, napi_value recv, napi_value func, size_t argc, const napi_value* argv, napi_value* result);
```

-   `[in] env`: API가 호출되는 환경
-   `[in] recv`: 호출된 함수에 전달될 `this` 값
-   `[in] func`: 호출할 자바스크립트 함수를 나타내는 `napi_value`
-   `[in] argc`: `argv` 배열의 요소 개수
-   `[in] argv`: 함수에 인자로 전달될 자바스크립트 값을 나타내는 `napi_value` 배열
-   `[out] result`: 반환된 자바스크립트 객체를 나타내는 `napi_value`

API가 성공하면 `napi_ok`를 반환합니다.

이 메서드는 네이티브 애드온에서 자바스크립트 함수 객체를 호출할 수 있게 합니다. 이는 애드온의 네이티브 코드에서 자바스크립트로 콜백을 호출하는 주요 메커니즘입니다. 비동기 작업 후 자바스크립트를 호출하는 특별한 경우에는 [`napi_make_callback`](https://nodejs.org/docs/latest/api/n-api.html#napi_make_callback)을 참조하세요.

다음은 사용 예제입니다. 아래 자바스크립트 코드를 고려해 보세요:

```js
function AddTwo(num) { return num + 2; } global.AddTwo = AddTwo;
```

그런 다음, 위 함수는 아래 코드를 사용하여 네이티브 애드온에서 호출할 수 있습니다:

```c
// 전역 객체에서 "AddTwo" 함수를 가져옴
napi_value global, add_two, arg;
napi_status status = napi_get_global(env, &global);
if (status != napi_ok) return;

status = napi_get_named_property(env, global, "AddTwo", &add_two);
if (status != napi_ok) return;

// const arg = 1337
status = napi_create_int32(env, 1337, &arg);
if (status != napi_ok) return;

napi_value* argv = &arg;
size_t argc = 1;

// AddTwo(arg);
napi_value return_val;
status = napi_call_function(env, global, add_two, argc, argv, &return_val);
if (status != napi_ok) return;

// 결과를 네이티브 타입으로 변환
int32_t result;
status = napi_get_value_int32(env, return_val, &result);
if (status != napi_ok) return;
```


#### `napi_create_function`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_function)

추가된 버전: v8.0.0 N-API 버전: 1

```c
napi_status napi_create_function(napi_env env, const char* utf8name, size_t length, napi_callback cb, void* data, napi_value* result);
```

-   `[in] env`: API가 호출되는 환경.
-   `[in] utf8Name`: UTF8로 인코딩된 함수의 이름(선택 사항). 이는 JavaScript에서 새로운 함수 객체의 `name` 속성으로 표시된다.
-   `[in] length`: `utf8name`의 바이트 길이. null로 종료된 경우 `NAPI_AUTO_LENGTH`를 사용한다.
-   `[in] cb`: 이 함수 객체가 호출될 때 실행될 네이티브 함수. [`napi_callback`](https://nodejs.org/docs/latest/api/n-api.html#napi_callback)에서 자세한 정보를 확인할 수 있다.
-   `[in] data`: 사용자가 제공한 데이터 컨텍스트. 이 데이터는 나중에 함수가 호출될 때 다시 전달된다.
-   `[out] result`: 새로 생성된 함수 객체를 나타내는 `napi_value`.

API가 성공하면 `napi_ok`를 반환한다.

이 API는 애드온 개발자가 네이티브 코드에서 함수 객체를 생성할 수 있게 한다. 이는 JavaScript에서 애드온의 네이티브 코드를 호출할 수 있게 하는 주요 메커니즘이다.

새로 생성된 함수는 이 호출 후 자동으로 스크립트에서 보이지 않는다. 대신, 함수를 스크립트에서 접근할 수 있도록 하려면 JavaScript에서 보이는 객체에 명시적으로 속성을 설정해야 한다.

함수를 애드온의 모듈 exports의 일부로 노출하려면, 새로 생성된 함수를 exports 객체에 설정한다. 예제 모듈은 다음과 같다:

```c
napi_value SayHello(napi_env env, napi_callback_info info) {
    printf("Hello\n");
    return NULL;
}

napi_value Init(napi_env env, napi_value exports) {
    napi_status status;
    napi_value fn;
    status = napi_create_function(env, NULL, 0, SayHello, NULL, &fn);
    if (status != napi_ok) return NULL;
    status = napi_set_named_property(env, exports, "sayHello", fn);
    if (status != napi_ok) return NULL;
    return exports;
}

NAPI_MODULE(NODE_GYP_MODULE_NAME, Init)
```

위 코드를 사용하면, JavaScript에서 다음과 같이 애드온을 사용할 수 있다:

```js
const myaddon = require('./addon');
myaddon.sayHello();
```

`require()`에 전달된 문자열은 `.node` 파일을 생성하는 `binding.gyp`의 대상 이름이다.

`data` 매개변수를 통해 이 API에 전달된 `NULL`이 아닌 데이터는 결과 JavaScript 함수( `result` 매개변수로 반환됨)와 연결될 수 있으며, 함수가 가비지 컬렉션될 때 [`napi_add_finalizer`](https://nodejs.org/docs/latest/api/n-api.html#napi_add_finalizer)를 통해 해제될 수 있다.

JavaScript `Function`은 [ECMAScript 언어 사양의 19.2절](https://tc39.github.io/ecma262/#sec-function-objects)에 설명되어 있다.


#### `napi_get_cb_info`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_cb_info)

추가된 버전: v8.0.0 N-API 버전: 1

```c
napi_status napi_get_cb_info(napi_env env, napi_callback_info cbinfo, size_t* argc, napi_value* argv, napi_value* thisArg, void** data)
```

-   `[in] env`: API가 호출되는 환경을 나타냅니다.
-   `[in] cbinfo`: 콜백 함수에 전달된 콜백 정보입니다.
-   `[in-out] argc`: 제공된 `argv` 배열의 길이를 지정하고 실제 인자의 개수를 받습니다. `argc`는 `NULL`을 전달하여 무시할 수 있습니다.
-   `[out] argv`: 인자가 복사될 `napi_value`의 C 배열입니다. 제공된 개수보다 더 많은 인자가 있으면 요청된 개수만큼만 복사됩니다. 제공된 인자가 선언된 개수보다 적으면 나머지 `argv`는 `undefined`를 나타내는 `napi_value`로 채워집니다. `argv`는 `NULL`을 전달하여 무시할 수 있습니다.
-   `[out] thisArg`: 호출에 대한 JavaScript `this` 인자를 받습니다. `thisArg`는 `NULL`을 전달하여 무시할 수 있습니다.
-   `[out] data`: 콜백에 대한 데이터 포인터를 받습니다. `data`는 `NULL`을 전달하여 무시할 수 있습니다.

API가 성공하면 `napi_ok`를 반환합니다.

이 메서드는 콜백 함수 내에서 주어진 콜백 정보로부터 인자와 `this` 포인터와 같은 호출에 대한 세부 정보를 가져오는 데 사용됩니다.


#### `napi_get_new_target`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_new_target)

추가된 버전: v8.6.0  
N-API 버전: 1

```c
napi_status napi_get_new_target(napi_env env, napi_callback_info cbinfo, napi_value* result)
```

-   `[in] env`: API가 호출된 환경
-   `[in] cbinfo`: 콜백 함수에 전달된 콜백 정보
-   `[out] result`: 생성자 호출의 `new.target`

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 생성자 호출의 `new.target`을 반환합니다. 현재 콜백이 생성자 호출이 아닌 경우, 결과는 `NULL`입니다.


#### `napi_new_instance`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_new_instance)

추가된 버전: v8.0.0 N-API 버전: 1

```c
napi_status napi_new_instance(napi_env env, napi_value cons, size_t argc, napi_value* argv, napi_value* result)
```

-   `[in] env`: API가 호출되는 환경
-   `[in] cons`: 생성자로 호출될 자바스크립트 함수를 나타내는 `napi_value`
-   `[in] argc`: `argv` 배열의 요소 개수
-   `[in] argv`: 생성자에 전달될 인자를 나타내는 `napi_value` 배열. `argc`가 0인 경우 이 매개변수는 `NULL`을 전달하여 생략할 수 있음
-   `[out] result`: 생성된 객체를 나타내는 `napi_value`

이 메서드는 객체의 생성자를 나타내는 `napi_value`를 사용하여 새로운 자바스크립트 값을 생성하는 데 사용됩니다. 예를 들어, 다음 코드 조각을 살펴보겠습니다.

```js
function MyObject(param) { this.param = param; } 
const arg = 'hello'; 
const value = new MyObject(arg);
```

위 코드는 Node-API를 사용하여 다음과 같이 구현할 수 있습니다.

```c
// MyObject 생성자 함수 가져오기
napi_value global, constructor, arg, value;
napi_status status = napi_get_global(env, &global);
if (status != napi_ok) return;

status = napi_get_named_property(env, global, "MyObject", &constructor);
if (status != napi_ok) return;

// const arg = "hello"
status = napi_create_string_utf8(env, "hello", NAPI_AUTO_LENGTH, &arg);
if (status != napi_ok) return;

napi_value* argv = &arg;
size_t argc = 1;

// const value = new MyObject(arg)
status = napi_new_instance(env, constructor, argc, argv, &value);
```

API가 성공적으로 실행되면 `napi_ok`를 반환합니다.


### 객체 래핑

Node-API는 C++ 클래스와 인스턴스를 "래핑"하는 방법을 제공하여 JavaScript에서 클래스 생성자와 메서드를 호출할 수 있게 합니다.

1. [`napi_define_class`](https://nodejs.org/docs/latest/api/n-api.html#napi_define_class) API는 C++ 클래스에 대응하는 JavaScript 클래스를 정의합니다. 이 클래스는 생성자, 정적 속성 및 메서드, 인스턴스 속성 및 메서드를 포함합니다.
2. JavaScript 코드가 생성자를 호출하면, 생성자 콜백은 [`napi_wrap`](https://nodejs.org/docs/latest/api/n-api.html#napi_wrap)을 사용하여 새로운 C++ 인스턴스를 JavaScript 객체로 래핑한 후, 래퍼 객체를 반환합니다.
3. JavaScript 코드가 클래스의 메서드나 속성 접근자를 호출하면, 해당 `napi_callback` C++ 함수가 호출됩니다. 인스턴스 콜백의 경우, [`napi_unwrap`](https://nodejs.org/docs/latest/api/n-api.html#napi_unwrap)을 사용하여 호출 대상인 C++ 인스턴스를 가져옵니다.

래핑된 객체의 경우, 클래스 프로토타입에서 호출된 함수와 클래스 인스턴스에서 호출된 함수를 구분하기 어려울 수 있습니다. 이 문제를 해결하기 위해 일반적으로 클래스 생성자에 대한 지속적인 참조를 저장하여 나중에 `instanceof` 검사를 수행하는 패턴을 사용합니다.

```c
napi_value MyClass_constructor = NULL;
status = napi_get_reference_value(env, MyClass::es_constructor, &MyClass_constructor);
assert(napi_ok == status);

bool is_instance = false;
status = napi_instanceof(env, es_this, MyClass_constructor, &is_instance);
assert(napi_ok == status);

if (is_instance) {
    // napi_unwrap() ...
} else {
    // otherwise...
}
```

참조가 더 이상 필요하지 않으면 해제해야 합니다.

`napi_instanceof()`가 JavaScript 객체가 특정 네이티브 타입의 래퍼인지 확인하는 데 충분하지 않은 경우가 있습니다. 특히 래핑된 JavaScript 객체가 프로토타입 메서드의 `this` 값이 아닌 정적 메서드를 통해 애드온으로 다시 전달될 때 이런 경우가 발생합니다. 이 경우 잘못된 객체가 언래핑될 가능성이 있습니다.

```js
const myAddon = require('./build/Release/my_addon.node');

// `openDatabase()`는 네이티브 데이터베이스 핸들을 래핑한 JavaScript 객체를 반환합니다.
const dbHandle = myAddon.openDatabase();

// `query()`는 네이티브 쿼리 핸들을 래핑한 JavaScript 객체를 반환합니다.
const queryHandle = myAddon.query(dbHandle, 'Gimme ALL the things!');

// 아래 줄에 실수가 있습니다. `myAddon.queryHasRecords()`의 첫 번째 인자는
// 데이터베이스 핸들(`dbHandle`)이어야 하는데, 쿼리 핸들(`query`)이 전달되었습니다.
// 올바른 조건은 다음과 같아야 합니다:
//
// myAddon.queryHasRecords(dbHandle, queryHandle)
//
while (myAddon.queryHasRecords(queryHandle, dbHandle)) {
    // 레코드 조회
}
```

위 예제에서 `myAddon.queryHasRecords()`는 두 개의 인자를 받는 메서드입니다. 첫 번째는 데이터베이스 핸들이고 두 번째는 쿼리 핸들입니다. 내부적으로 첫 번째 인자를 언래핑하고 결과 포인터를 네이티브 데이터베이스 핸들로 캐스팅합니다. 그런 다음 두 번째 인자를 언래핑하고 결과 포인터를 쿼리 핸들로 캐스팅합니다. 인자가 잘못된 순서로 전달되면 캐스팅은 동작하지만, 내부 데이터베이스 작업이 실패하거나 잘못된 메모리 접근을 일으킬 가능성이 높습니다.

첫 번째 인자에서 가져온 포인터가 실제로 데이터베이스 핸들 포인터인지, 두 번째 인자에서 가져온 포인터가 실제로 쿼리 핸들 포인터인지 확인하기 위해 `queryHasRecords()` 구현에서 타입 검증을 수행해야 합니다. 데이터베이스 핸들이 인스턴스화된 JavaScript 클래스 생성자와 쿼리 핸들이 인스턴스화된 생성자를 `napi_ref`에 유지하면 `napi_instanceof()`를 사용하여 `queryHashRecords()`에 전달된 인스턴스가 올바른 타입인지 확인할 수 있습니다.

불행히도 `napi_instanceof()`는 프로토타입 조작을 방지하지 못합니다. 예를 들어, 데이터베이스 핸들 인스턴스의 프로토타입을 쿼리 핸들 인스턴스의 생성자 프로토타입으로 설정할 수 있습니다. 이 경우 데이터베이스 핸들 인스턴스가 쿼리 핸들 인스턴스로 보일 수 있으며, `napi_instanceof()` 테스트를 통과할 수 있지만 여전히 데이터베이스 핸들 포인터를 포함하고 있을 수 있습니다.

이를 위해 Node-API는 타입 태깅 기능을 제공합니다.

타입 태그는 애드온에 고유한 128비트 정수입니다. Node-API는 타입 태그를 저장하기 위해 `napi_type_tag` 구조체를 제공합니다. 이 값이 JavaScript 객체나 `napi_value`에 저장된 [external](https://nodejs.org/docs/latest/api/n-api.html#napi_create_external)과 함께 `napi_type_tag_object()`에 전달되면, JavaScript 객체는 타입 태그로 "표시"됩니다. 이 "표시"는 JavaScript 측에서는 보이지 않습니다. JavaScript 객체가 네이티브 바인딩에 도착하면 `napi_check_object_type_tag()`를 원래 타입 태그와 함께 사용하여 JavaScript 객체가 이전에 타입 태그로 "표시"되었는지 확인할 수 있습니다. 이는 `napi_instanceof()`보다 높은 정밀도의 타입 검사 기능을 제공하며, 프로토타입 조작과 애드온 언로드/리로드에도 타입 태깅이 유지됩니다.

위 예제를 이어서, 다음 스켈레톤 애드온 구현은 `napi_type_tag_object()`와 `napi_check_object_type_tag()`의 사용을 보여줍니다.

```c
// 이 값은 데이터베이스 핸들의 타입 태그입니다. 다음 명령어를 사용하여
// 구조체를 초기화할 두 값을 얻을 수 있습니다:
//
// uuidgen | sed -r -e 's/-//g' -e 's/(.{16})(.*)/0x\1, 0x\2/'
//
static const napi_type_tag DatabaseHandleTypeTag = { 0x1edf75a38336451d, 0xa5ed9ce2e4c00c38 };

// 이 값은 쿼리 핸들의 타입 태그입니다.
static const napi_type_tag QueryHandleTypeTag = { 0x9c73317f9fad44a3, 0x93c3920bf3b0ad6a };

static napi_value openDatabase(napi_env env, napi_callback_info info) {
    napi_status status;
    napi_value result;

    // 데이터베이스 핸들을 생성하는 기본 작업을 수행합니다.
    DatabaseHandle* dbHandle = open_database();

    // 새로운 빈 JS 객체를 생성합니다.
    status = napi_create_object(env, &result);
    if (status != napi_ok) return NULL;

    // 객체에 `DatabaseHandle` 포인터를 포함한다는 표시를 합니다.
    status = napi_type_tag_object(env, result, &DatabaseHandleTypeTag);
    if (status != napi_ok) return NULL;

    // `DatabaseHandle` 구조체에 대한 포인터를 JS 객체 내부에 저장합니다.
    status = napi_wrap(env, result, dbHandle, NULL, NULL, NULL);
    if (status != napi_ok) return NULL;

    return result;
}

// 나중에 데이터베이스 핸들로 추정되는 JavaScript 객체를 받으면
// `napi_check_object_type_tag()`를 사용하여 실제로 그런 핸들인지 확인할 수 있습니다.
static napi_value query(napi_env env, napi_callback_info info) {
    napi_status status;
    size_t argc = 2;
    napi_value argv[2];
    bool is_db_handle;

    status = napi_get_cb_info(env, info, &argc, argv, NULL, NULL);
    if (status != napi_ok) return NULL;

    // 첫 번째 매개변수로 전달된 객체에 이전에 적용된 태그가 있는지 확인합니다.
    status = napi_check_object_type_tag(env, argv[0], &DatabaseHandleTypeTag, &is_db_handle);
    if (status != napi_ok) return NULL;

    // 태그가 없으면 `TypeError`를 발생시킵니다.
    if (!is_db_handle) {
        // TypeError를 발생시킵니다.
        return NULL;
    }
}
```


#### `napi_define_class`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_define_class)

추가된 버전: v8.0.0 N-API 버전: 1

```c
napi_status napi_define_class(napi_env env, const char* utf8name, size_t length, napi_callback constructor, void* data, size_t property_count, const napi_property_descriptor* properties, napi_value* result);
```

-   `[in] env`: API가 호출되는 환경.
-   `[in] utf8name`: JavaScript 생성자 함수의 이름. C++ 클래스를 래핑할 때는 C++ 클래스 이름을 사용하는 것이 명확성을 높입니다.
-   `[in] length`: `utf8name`의 바이트 길이. null로 종료된 문자열이라면 `NAPI_AUTO_LENGTH`를 사용합니다.
-   `[in] constructor`: 클래스의 인스턴스를 생성하는 콜백 함수. C++ 클래스를 래핑할 때 이 메서드는 [`napi_callback`](https://nodejs.org/docs/latest/api/n-api.html#napi_callback) 시그니처를 가진 정적 멤버여야 합니다. C++ 클래스 생성자는 사용할 수 없습니다. 자세한 내용은 [`napi_callback`](https://nodejs.org/docs/latest/api/n-api.html#napi_callback)을 참조하세요.
-   `[in] data`: 생성자 콜백에 전달될 선택적 데이터. 콜백 정보의 `data` 속성으로 전달됩니다.
-   `[in] property_count`: `properties` 배열의 항목 수.
-   `[in] properties`: 클래스의 정적 및 인스턴스 데이터 속성, 접근자, 메서드를 설명하는 속성 디스크립터 배열. `napi_property_descriptor`를 참조하세요.
-   `[out] result`: 클래스의 생성자 함수를 나타내는 `napi_value`.

API가 성공하면 `napi_ok`를 반환합니다.

JavaScript 클래스를 정의하며, 다음을 포함합니다:

-   클래스 이름을 가진 JavaScript 생성자 함수. C++ 클래스를 래핑할 때, `constructor`를 통해 전달된 콜백은 새로운 C++ 클래스 인스턴스를 생성하는 데 사용할 수 있습니다. 이 인스턴스는 [`napi_wrap`](https://nodejs.org/docs/latest/api/n-api.html#napi_wrap)을 사용하여 생성 중인 JavaScript 객체 인스턴스 내부에 배치할 수 있습니다.
-   생성자 함수의 속성. 이 속성의 구현은 C++ 클래스의 *정적* 데이터 속성, 접근자, 메서드를 호출할 수 있습니다 (`napi_static` 속성을 가진 속성 디스크립터로 정의됨).
-   생성자 함수의 `prototype` 객체의 속성. C++ 클래스를 래핑할 때, *비정적* 데이터 속성, 접근자, 메서드는 `napi_static` 속성이 없는 속성 디스크립터에 제공된 정적 함수에서 호출할 수 있습니다. 이때 JavaScript 객체 인스턴스 내부에 배치된 C++ 클래스 인스턴스를 [`napi_unwrap`](https://nodejs.org/docs/latest/api/n-api.html#napi_unwrap)을 사용하여 가져옵니다.

C++ 클래스를 래핑할 때, `constructor`를 통해 전달된 C++ 생성자 콜백은 클래스의 정적 메서드여야 합니다. 이 메서드는 실제 클래스 생성자를 호출한 후 새로운 C++ 인스턴스를 JavaScript 객체로 래핑하고 래퍼 객체를 반환합니다. 자세한 내용은 [`napi_wrap`](https://nodejs.org/docs/latest/api/n-api.html#napi_wrap)을 참조하세요.

[`napi_define_class`](https://nodejs.org/docs/latest/api/n-api.html#napi_define_class)에서 반환된 JavaScript 생성자 함수는 종종 나중에 네이티브 코드에서 클래스의 새로운 인스턴스를 생성하거나 제공된 값이 클래스의 인스턴스인지 확인하는 데 사용됩니다. 이 경우 함수 값이 가비지 컬렉션되는 것을 방지하기 위해 [`napi_create_reference`](https://nodejs.org/docs/latest/api/n-api.html#napi_create_reference)를 사용하여 강력한 영구 참조를 생성할 수 있습니다. 이를 통해 참조 카운트가 >= 1로 유지됩니다.

`data` 매개변수를 통해 이 API에 전달된 모든 non-`NULL` 데이터 또는 `napi_property_descriptor` 배열 항목의 `data` 필드를 통해 전달된 데이터는 결과 JavaScript 생성자(결과 매개변수로 반환됨)와 연결될 수 있습니다. 이 데이터는 클래스가 가비지 컬렉션될 때 [`napi_add_finalizer`](https://nodejs.org/docs/latest/api/n-api.html#napi_add_finalizer)를 사용하여 JavaScript 함수와 함께 해제될 수 있습니다.


#### `napi_wrap`

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_wrap(napi_env env, 
                      napi_value js_object, 
                      void* native_object, 
                      napi_finalize finalize_cb, 
                      void* finalize_hint, 
                      napi_ref* result);
```

- `[in] env`: API가 호출되는 환경
- `[in] js_object`: 네이티브 객체를 감싸는 JavaScript 객체
- `[in] native_object`: JavaScript 객체로 감싸질 네이티브 인스턴스
- `[in] finalize_cb`: JavaScript 객체가 가비지 컬렉션될 때 네이티브 인스턴스를 해제하기 위해 사용할 수 있는 선택적 네이티브 콜백. 자세한 내용은 [`napi_finalize`](https://nodejs.org/docs/latest/api/n-api.html#napi_finalize)를 참고
- `[in] finalize_hint`: finalize 콜백에 전달되는 선택적 컨텍스트 힌트
- `[out] result`: 감싸진 객체에 대한 선택적 참조

API가 성공하면 `napi_ok`를 반환합니다.

네이티브 인스턴스를 JavaScript 객체로 감쌉니다. 이후 `napi_unwrap()`을 사용해 네이티브 인스턴스를 다시 가져올 수 있습니다.

JavaScript 코드가 `napi_define_class()`로 정의된 클래스의 생성자를 호출하면, 생성자에 대한 `napi_callback`이 실행됩니다. 네이티브 클래스의 인스턴스를 생성한 후, 콜백은 `napi_wrap()`을 호출해 새로 생성된 인스턴스를 생성자 콜백의 `this` 인자로 이미 생성된 JavaScript 객체로 감싸야 합니다. (이 `this` 객체는 생성자 함수의 `prototype`에서 생성되었으므로, 이미 모든 인스턴스 속성과 메서드 정의를 가지고 있습니다.)

일반적으로 클래스 인스턴스를 감쌀 때, finalize 콜백을 제공해 finalize 콜백의 `data` 인자로 받은 네이티브 인스턴스를 삭제해야 합니다.

선택적으로 반환된 참조는 초기에 약한 참조(weak reference)로, 참조 카운트가 0입니다. 일반적으로 이 참조 카운트는 인스턴스가 유효해야 하는 비동기 작업 중에 일시적으로 증가합니다.

**주의**: 선택적으로 반환된 참조(획득한 경우)는 finalize 콜백 호출에 대응해서만 [`napi_delete_reference`](https://nodejs.org/docs/latest/api/n-api.html#napi_delete_reference)를 통해 삭제해야 합니다. 그 전에 삭제하면 finalize 콜백이 호출되지 않을 수 있습니다. 따라서 참조를 얻을 때는 참조를 올바르게 처리하기 위해 finalize 콜백도 필요합니다.

Finalizer 콜백은 지연될 수 있으며, 객체가 가비지 컬렉션되고 약한 참조가 무효화되었지만 finalizer가 아직 호출되지 않은 상태가 될 수 있습니다. `napi_wrap()`에서 반환된 약한 참조에 대해 `napi_get_reference_value()`를 사용할 때, 빈 결과를 처리해야 합니다.

객체에 대해 `napi_wrap()`을 두 번째 호출하면 오류가 반환됩니다. 객체에 다른 네이티브 인스턴스를 연결하려면 먼저 `napi_remove_wrap()`을 사용해야 합니다.


#### `napi_unwrap`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_unwrap)

추가된 버전: v8.0.0 N-API 버전: 1

```c
napi_status napi_unwrap(napi_env env, napi_value js_object, void** result);
```

-   `[in] env`: API가 호출된 환경
-   `[in] js_object`: 네이티브 인스턴스와 연결된 객체
-   `[out] result`: 래핑된 네이티브 인스턴스를 가리키는 포인터

API가 성공하면 `napi_ok`를 반환합니다.

`napi_wrap()`을 사용해 JavaScript 객체에 래핑된 네이티브 인스턴스를 가져옵니다.

JavaScript 코드가 클래스의 메서드나 속성 접근자를 호출하면, 해당 `napi_callback`이 호출됩니다. 콜백이 인스턴스 메서드나 접근자에 대한 것이라면, 콜백의 `this` 인자는 래퍼 객체입니다. 이때 `napi_unwrap()`을 호출하면 래퍼 객체에서 호출 대상인 래핑된 C++ 인스턴스를 얻을 수 있습니다.


#### `napi_remove_wrap`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_remove_wrap)

추가된 버전: v8.5.0  
N-API 버전: 1

```c
napi_status napi_remove_wrap(napi_env env, napi_value js_object, void** result);
```

-   `[in] env`: API가 호출되는 환경
-   `[in] js_object`: 네이티브 인스턴스와 연결된 객체
-   `[out] result`: 래핑된 네이티브 인스턴스를 가리키는 포인터

API가 성공하면 `napi_ok`를 반환합니다.

이 함수는 `napi_wrap()`을 사용해 JavaScript 객체 `js_object`에 래핑된 네이티브 인스턴스를 가져오고, 래핑을 제거합니다. 만약 래핑과 연결된 종료 콜백이 있었다면, JavaScript 객체가 가비지 컬렉션될 때 더 이상 호출되지 않습니다.


#### `napi_type_tag_object`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_type_tag_object)

추가된 버전: v14.8.0, v12.19.0  
N-API 버전: 8

```c
napi_status napi_type_tag_object(napi_env env, napi_value js_object, const napi_type_tag* type_tag);
```

-   `[in] env`: API가 호출되는 환경
-   `[in] js_object`: 태그를 지정할 JavaScript 객체 또는 [external](https://nodejs.org/docs/latest/api/n-api.html#napi_create_external)
-   `[in] type_tag`: 객체에 지정할 태그

API가 성공하면 `napi_ok`를 반환합니다.

이 함수는 `type_tag` 포인터의 값을 JavaScript 객체 또는 [external](https://nodejs.org/docs/latest/api/n-api.html#napi_create_external)과 연결합니다. 이후 `napi_check_object_type_tag()`를 사용해 객체에 연결된 태그와 애드온이 소유한 태그를 비교하여 객체가 올바른 타입인지 확인할 수 있습니다.

이미 태그가 연결된 객체에 이 API를 사용하면 `napi_invalid_arg`를 반환합니다.


#### `napi_check_object_type_tag`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_check_object_type_tag)

추가된 버전: v14.8.0, v12.19.0  
N-API 버전: 8

```c
napi_status napi_check_object_type_tag(napi_env env, napi_value js_object, const napi_type_tag* type_tag, bool* result);
```

-   `[in] env`: API가 호출된 환경을 나타냅니다.
-   `[in] js_object`: 타입 태그를 검사할 JavaScript 객체 또는 [external](https://nodejs.org/docs/latest/api/n-api.html#napi_create_external) 객체입니다.
-   `[in] type_tag`: 객체에 있는 태그와 비교할 태그입니다.
-   `[out] result`: 주어진 타입 태그가 객체의 타입 태그와 일치하는지 여부를 나타냅니다. 객체에 타입 태그가 없을 경우에도 `false`가 반환됩니다.

API가 성공적으로 실행되면 `napi_ok`를 반환합니다.

`type_tag`로 주어진 포인터를 `js_object`에서 찾을 수 있는 태그와 비교합니다. `js_object`에 태그가 없거나, 태그가 있지만 `type_tag`와 일치하지 않으면 `result`는 `false`로 설정됩니다. 태그가 발견되고 `type_tag`와 일치하면 `result`는 `true`로 설정됩니다.


#### `napi_add_finalizer`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_add_finalizer)

추가된 버전: v8.0.0 N-API 버전: 5

```c
napi_status napi_add_finalizer(napi_env env, napi_value js_object, void* finalize_data, node_api_basic_finalize finalize_cb, void* finalize_hint, napi_ref* result);
```

-   `[in] env`: API가 호출되는 환경
-   `[in] js_object`: 네이티브 데이터가 첨부될 자바스크립트 객체
-   `[in] finalize_data`: `finalize_cb`에 전달될 선택적 데이터
-   `[in] finalize_cb`: 자바스크립트 객체가 가비지 컬렉션될 때 네이티브 데이터를 해제하기 위해 사용되는 네이티브 콜백. 자세한 내용은 [`napi_finalize`](https://nodejs.org/docs/latest/api/n-api.html#napi_finalize)를 참고하세요.
-   `[in] finalize_hint`: finalize 콜백에 전달되는 선택적 컨텍스트 힌트
-   `[out] result`: 자바스크립트 객체에 대한 선택적 참조

API가 성공하면 `napi_ok`를 반환합니다.

`js_object`에 있는 자바스크립트 객체가 가비지 컬렉션될 때 호출될 `napi_finalize` 콜백을 추가합니다.

이 API는 하나의 자바스크립트 객체에 대해 여러 번 호출할 수 있습니다.

*주의*: 선택적으로 반환된 참조(획득한 경우)는 finalize 콜백 호출 시에만 [`napi_delete_reference`](https://nodejs.org/docs/latest/api/n-api.html#napi_delete_reference)를 통해 삭제해야 합니다. 그 전에 삭제하면 finalize 콜백이 호출되지 않을 수 있습니다. 따라서 참조를 획득할 때는 참조의 올바른 처리를 위해 finalize 콜백도 함께 필요합니다.


##### `node_api_post_finalizer`[#](https://nodejs.org/docs/latest/api/n-api.html#node_api_post_finalizer)

추가된 버전: v21.0.0, v20.10.0, v18.19.0

```c
napi_status node_api_post_finalizer(node_api_basic_env env, napi_finalize finalize_cb, void* finalize_data, void* finalize_hint);
```

-   `[in] env`: API가 호출되는 환경을 나타냅니다.
-   `[in] finalize_cb`: 자바스크립트 객체가 가비지 컬렉션될 때 네이티브 데이터를 해제하기 위해 사용되는 콜백 함수입니다. 자세한 내용은 [`napi_finalize`](https://nodejs.org/docs/latest/api/n-api.html#napi_finalize)를 참고하세요.
-   `[in] finalize_data`: `finalize_cb`에 전달될 선택적 데이터입니다.
-   `[in] finalize_hint`: finalize 콜백에 전달될 선택적 컨텍스트 힌트입니다.

API가 성공하면 `napi_ok`를 반환합니다.

이 함수는 `napi_finalize` 콜백을 이벤트 루프에서 비동기적으로 호출되도록 예약합니다.

일반적으로 finalizer는 GC(가비지 컬렉터)가 객체를 수집할 때 호출됩니다. 이 시점에서 GC 상태를 변경할 수 있는 Node-API를 호출하면 Node.js가 비정상 종료될 수 있습니다.

`node_api_post_finalizer`는 이러한 제한을 우회하기 위해, 애드온이 Node-API 호출을 GC finalization 외부로 미룰 수 있도록 도와줍니다.


### 간단한 비동기 작업

애드온 모듈은 종종 구현 과정에서 libuv의 비동기 헬퍼를 활용해야 합니다. 이를 통해 작업을 비동기적으로 실행할 수 있도록 스케줄링하여, 작업이 완료되기 전에 메서드가 반환되도록 할 수 있습니다. 이렇게 하면 Node.js 애플리케이션의 전체 실행이 차단되는 것을 방지할 수 있습니다.

Node-API는 이러한 지원 함수를 위한 ABI-안정적인 인터페이스를 제공하며, 가장 일반적인 비동기 사용 사례를 다룹니다.

Node-API는 비동기 작업자를 관리하기 위해 `napi_async_work` 구조체를 정의합니다. 이 구조체의 인스턴스는 [`napi_create_async_work`](https://nodejs.org/docs/latest/api/n-api.html#napi_create_async_work)와 [`napi_delete_async_work`](https://nodejs.org/docs/latest/api/n-api.html#napi_delete_async_work)를 사용해 생성 및 삭제됩니다.

`execute`와 `complete` 콜백은 각각 실행자가 작업을 실행할 준비가 되었을 때와 작업이 완료되었을 때 호출되는 함수입니다.

`execute` 함수는 JavaScript를 실행하거나 JavaScript 객체와 상호작용할 수 있는 Node-API 호출을 피해야 합니다. 대부분의 경우, Node-API 호출이 필요한 코드는 `complete` 콜백에서 작성해야 합니다. `execute` 콜백에서 `napi_env` 매개변수를 사용하는 것도 피해야 합니다. 이는 JavaScript를 실행할 가능성이 높기 때문입니다.

이러한 함수는 다음과 같은 인터페이스를 구현합니다:

```c
typedef void (*napi_async_execute_callback)(napi_env env, void* data);
typedef void (*napi_async_complete_callback)(napi_env env, napi_status status, void* data);
```

이 메서드들이 호출될 때, 전달되는 `data` 매개변수는 `napi_create_async_work` 호출에 전달된 애드온이 제공한 `void*` 데이터가 됩니다.

일단 생성된 비동기 작업자는 [`napi_queue_async_work`](https://nodejs.org/docs/latest/api/n-api.html#napi_queue_async_work) 함수를 사용해 실행 대기열에 추가할 수 있습니다:

```c
napi_status napi_queue_async_work(node_api_basic_env env, napi_async_work work);
```

작업이 실행되기 전에 취소해야 하는 경우 [`napi_cancel_async_work`](https://nodejs.org/docs/latest/api/n-api.html#napi_cancel_async_work)를 사용할 수 있습니다.

[`napi_cancel_async_work`](https://nodejs.org/docs/latest/api/n-api.html#napi_cancel_async_work)를 호출한 후, `complete` 콜백은 `napi_cancelled` 상태 값과 함께 호출됩니다. 작업이 취소되었더라도 `complete` 콜백이 호출되기 전에는 작업을 삭제해서는 안 됩니다.


#### `napi_create_async_work`

```c
napi_status napi_create_async_work(napi_env env, napi_value async_resource, napi_value async_resource_name, napi_async_execute_callback execute, napi_async_complete_callback complete, void* data, napi_async_work* result);
```

-   `[in] env`: API가 호출되는 환경을 나타냅니다.
-   `[in] async_resource`: 비동기 작업과 연결될 수 있는 선택적 객체입니다. 이 객체는 `async_hooks`의 [`init` 훅](https://nodejs.org/docs/latest/api/async_hooks.html#initasyncid-type-triggerasyncid-resource)에 전달될 수 있습니다.
-   `[in] async_resource_name`: `async_hooks` API를 통해 노출되는 진단 정보를 위한 리소스 종류를 식별하는 값입니다.
-   `[in] execute`: 비동기적으로 실행될 로직을 담은 네이티브 함수입니다. 이 함수는 워커 풀 스레드에서 호출되며, 메인 이벤트 루프 스레드와 병렬로 실행될 수 있습니다.
-   `[in] complete`: 비동기 로직이 완료되거나 취소될 때 호출될 네이티브 함수입니다. 이 함수는 메인 이벤트 루프 스레드에서 호출됩니다. 자세한 내용은 [`napi_async_complete_callback`](https://nodejs.org/docs/latest/api/n-api.html#napi_async_complete_callback)을 참조하세요.
-   `[in] data`: 사용자가 제공한 데이터 컨텍스트입니다. 이 데이터는 execute와 complete 함수에 다시 전달됩니다.
-   `[out] result`: 새로 생성된 비동기 작업의 핸들을 나타내는 `napi_async_work*`입니다.

API가 성공적으로 실행되면 `napi_ok`를 반환합니다.

이 API는 비동기적으로 로직을 실행하기 위한 작업 객체를 할당합니다. 작업이 더 이상 필요하지 않을 때는 [`napi_delete_async_work`](https://nodejs.org/docs/latest/api/n-api.html#napi_delete_async_work)를 사용하여 해제해야 합니다.

`async_resource_name`은 null로 종료되는 UTF-8 인코딩 문자열이어야 합니다.

`async_resource_name` 식별자는 사용자가 제공하며, 수행 중인 비동기 작업의 타입을 대표해야 합니다. 또한 식별자에 네임스페이스를 적용하는 것이 좋습니다. 예를 들어 모듈 이름을 포함할 수 있습니다. 자세한 내용은 [`async_hooks` 문서](https://nodejs.org/docs/latest/api/async_hooks.html#type)를 참조하세요.


#### `napi_delete_async_work`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_delete_async_work)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_delete_async_work(napi_env env, napi_async_work work);
```

-   `[in] env`: API가 호출된 환경을 나타내는 객체
-   `[in] work`: `napi_create_async_work` 호출로 반환된 핸들

API가 성공적으로 실행되면 `napi_ok`를 반환합니다.

이 API는 이전에 할당된 작업 객체를 해제합니다.

이 API는 JavaScript 예외가 발생한 상태에서도 호출할 수 있습니다.


#### `napi_queue_async_work`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_queue_async_work)

추가된 버전: v8.0.0 N-API 버전: 1

```c
napi_status napi_queue_async_work(node_api_basic_env env, napi_async_work work);
```

-   `[in] env`: API가 호출되는 환경
-   `[in] work`: `napi_create_async_work` 호출로 반환된 핸들

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 이전에 할당된 작업이 실행되도록 스케줄링을 요청합니다. 성공적으로 반환된 후, 동일한 `napi_async_work` 항목으로 이 API를 다시 호출하면 결과가 정의되지 않습니다.


#### `napi_cancel_async_work`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_cancel_async_work)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_cancel_async_work(node_api_basic_env env, napi_async_work work);
```

-   `[in] env`: API가 호출된 환경
-   `[in] work`: `napi_create_async_work` 호출 시 반환된 핸들

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 아직 시작되지 않은 작업을 큐에서 취소합니다. 이미 실행 중인 작업은 취소할 수 없으며, 이 경우 `napi_generic_failure`가 반환됩니다. 성공적으로 취소되면 `complete` 콜백이 `napi_cancelled` 상태 값과 함께 호출됩니다. 작업이 성공적으로 취소되었더라도 `complete` 콜백이 호출되기 전에는 작업을 삭제해서는 안 됩니다.

이 API는 보류 중인 JavaScript 예외가 있는 경우에도 호출할 수 있습니다.


### 커스텀 비동기 작업

위에서 설명한 간단한 비동기 작업 API가 모든 상황에 적합하지 않을 수 있습니다. 다른 비동기 메커니즘을 사용할 때, 런타임이 비동기 작업을 올바르게 추적할 수 있도록 다음 API가 필요합니다.


#### `napi_async_init`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_async_init)

추가된 버전: v8.6.0 N-API 버전: 1

```c
napi_status napi_async_init(napi_env env, napi_value async_resource, napi_value async_resource_name, napi_async_context* result)
```

-   `[in] env`: API가 호출되는 환경.
-   `[in] async_resource`: 비동기 작업과 연결된 객체로, `async_hooks`의 [`init` 훅](https://nodejs.org/docs/latest/api/async_hooks.html#initasyncid-type-triggerasyncid-resource)에 전달될 수 있으며 [`async_hooks.executionAsyncResource()`](https://nodejs.org/docs/latest/api/async_hooks.html#async_hooksexecutionasyncresource)를 통해 접근 가능.
-   `[in] async_resource_name`: `async_hooks` API가 제공하는 진단 정보를 위한 리소스 종류 식별자.
-   `[out] result`: 초기화된 비동기 컨텍스트.

API가 성공하면 `napi_ok`를 반환.

`async_resource` 객체는 `async_hooks` 관련 API가 올바르게 동작하도록 [`napi_async_destroy`](https://nodejs.org/docs/latest/api/n-api.html#napi_async_destroy)가 호출될 때까지 유지되어야 함. 이전 버전과의 ABI 호환성을 유지하기 위해 `napi_async_context`는 `async_resource` 객체에 대한 강한 참조를 유지하지 않아 메모리 누수를 방지함. 그러나 `napi_async_context`가 `napi_async_destroy`로 제거되기 전에 `async_resource`가 JavaScript 엔진에 의해 가비지 컬렉션되면, [`napi_open_callback_scope`](https://nodejs.org/docs/latest/api/n-api.html#napi_open_callback_scope)나 [`napi_make_callback`](https://nodejs.org/docs/latest/api/n-api.html#napi_make_callback) 같은 `napi_async_context` 관련 API를 호출할 때 `AsyncLocalStorage` API 사용 중 비동기 컨텍스트가 손실되는 등의 문제가 발생할 수 있음.

이전 버전과의 ABI 호환성을 유지하기 위해 `async_resource`에 `NULL`을 전달해도 오류가 발생하지 않음. 그러나 이는 `async_hooks`의 [`init` 훅](https://nodejs.org/docs/latest/api/async_hooks.html#initasyncid-type-triggerasyncid-resource)과 `async_hooks.executionAsyncResource()`에서 원치 않는 동작을 초래할 수 있으므로 권장되지 않음. 이제 `async_hooks` 구현에서는 비동기 콜백 간의 연결을 제공하기 위해 리소스가 필요함.


#### `napi_async_destroy`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_async_destroy)

추가된 버전: v8.6.0  
N-API 버전: 1

```c
napi_status napi_async_destroy(napi_env env, napi_async_context async_context);
```

-   `[in] env`: API가 호출되는 환경
-   `[in] async_context`: 제거할 비동기 컨텍스트

API가 성공적으로 실행되면 `napi_ok`를 반환합니다.

이 API는 JavaScript 예외가 발생한 상태에서도 호출할 수 있습니다.


#### `napi_make_callback`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_make_callback)

```c
NAPI_EXTERN napi_status napi_make_callback(napi_env env, napi_async_context async_context, napi_value recv, napi_value func, size_t argc, const napi_value* argv, napi_value* result);
```

-   `[in] env`: API가 호출되는 환경을 나타냅니다.
-   `[in] async_context`: 콜백을 호출하는 비동기 작업의 컨텍스트입니다. 일반적으로 [`napi_async_init`](https://nodejs.org/docs/latest/api/n-api.html#napi_async_init)에서 이전에 얻은 값을 사용해야 합니다. 이전 버전과의 ABI 호환성을 유지하기 위해 `async_context`에 `NULL`을 전달해도 오류가 발생하지 않습니다. 하지만 이 경우 `AsyncLocalStorage` API를 사용할 때 비동기 컨텍스트가 손실되는 등 잘못된 동작이 발생할 수 있습니다.
-   `[in] recv`: 호출된 함수에 전달될 `this` 값입니다.
-   `[in] func`: 호출할 JavaScript 함수를 나타내는 `napi_value`입니다.
-   `[in] argc`: `argv` 배열의 요소 개수입니다.
-   `[in] argv`: 함수의 인자로 전달될 JavaScript 값들의 배열입니다. `argc`가 0인 경우 이 매개변수는 `NULL`을 전달하여 생략할 수 있습니다.
-   `[out] result`: 반환된 JavaScript 객체를 나타내는 `napi_value`입니다.

API가 성공하면 `napi_ok`를 반환합니다.

이 메서드는 네이티브 애드온에서 JavaScript 함수 객체를 호출할 수 있게 해줍니다. 이 API는 `napi_call_function`과 유사하지만, 비동기 작업에서 반환된 후 (스택에 다른 스크립트가 없는 경우) 네이티브 코드에서 다시 JavaScript로 호출할 때 사용됩니다. 이는 `node::MakeCallback`을 간단히 감싼 래퍼입니다.

`napi_async_complete_callback` 내부에서 `napi_make_callback`을 사용할 필요는 없습니다. 해당 상황에서는 콜백의 비동기 컨텍스트가 이미 설정되어 있으므로, `napi_call_function`을 직접 호출하는 것이 충분하고 적절합니다. `napi_make_callback` 함수는 `napi_create_async_work`를 사용하지 않는 커스텀 비동기 동작을 구현할 때 필요할 수 있습니다.

콜백 중에 JavaScript가 마이크로태스크 큐에 예약한 `process.nextTick`이나 Promise는 C/C++로 돌아가기 전에 실행됩니다.


#### `napi_open_callback_scope`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_open_callback_scope)

추가된 버전: v9.6.0 N-API 버전: 3

```c
NAPI_EXTERN napi_status napi_open_callback_scope(napi_env env, napi_value resource_object, napi_async_context context, napi_callback_scope* result)
```

-   `[in] env`: API가 호출되는 환경
-   `[in] resource_object`: `async_hooks`의 [`init` 훅](https://nodejs.org/docs/latest/api/async_hooks.html#initasyncid-type-triggerasyncid-resource)에 전달될 비동기 작업과 관련된 객체. 이 매개변수는 더 이상 사용되지 않으며 런타임에서 무시됩니다. 대신 [`napi_async_init`](https://nodejs.org/docs/latest/api/n-api.html#napi_async_init)의 `async_resource` 매개변수를 사용하세요.
-   `[in] context`: 콜백을 호출하는 비동기 작업의 컨텍스트. 이 값은 이전에 [`napi_async_init`](https://nodejs.org/docs/latest/api/n-api.html#napi_async_init)에서 얻은 값이어야 합니다.
-   `[out] result`: 새로 생성된 스코프

Promise를 해결하는 경우와 같이, 특정 Node-API 호출을 할 때 콜백과 관련된 스코프가 필요할 때가 있습니다. 스택에 다른 스크립트가 없는 경우, [`napi_open_callback_scope`](https://nodejs.org/docs/latest/api/n-api.html#napi_open_callback_scope)와 [`napi_close_callback_scope`](https://nodejs.org/docs/latest/api/n-api.html#napi_close_callback_scope) 함수를 사용하여 필요한 스코프를 열고 닫을 수 있습니다.


#### `napi_close_callback_scope`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_close_callback_scope)

추가된 버전: v9.6.0  
N-API 버전: 3

```c
NAPI_EXTERN napi_status napi_close_callback_scope(napi_env env, napi_callback_scope scope)
```

-   `[in] env`: API가 호출되는 환경
-   `[in] scope`: 닫을 스코프

이 API는 JavaScript 예외가 발생한 상태에서도 호출할 수 있습니다.


### Version management[#](https://nodejs.org/docs/latest/api/n-api.html#version-management)





#### `napi_get_node_version`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_node_version)

추가된 버전: v8.4.0 N-API 버전: 1

```c
typedef struct {
    uint32_t major;
    uint32_t minor;
    uint32_t patch;
    const char* release;
} napi_node_version;

napi_status napi_get_node_version(node_api_basic_env env, const napi_node_version** version);
```

-   `[in] env`: API가 호출된 환경
-   `[out] version`: 현재 실행 중인 Node.js의 버전 정보를 가리키는 포인터

API가 성공적으로 실행되면 `napi_ok`를 반환합니다.

이 함수는 현재 실행 중인 Node.js의 주 버전(major), 부 버전(minor), 패치 버전(patch)을 `version` 구조체에 채우고, `release` 필드에는 [`process.release.name`](https://nodejs.org/docs/latest/api/process.html#processrelease)의 값을 설정합니다.

반환된 버퍼는 정적으로 할당되어 있으며, 해제할 필요가 없습니다.


#### `napi_get_version`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_version)

추가된 버전: v8.0.0  
N-API 버전: 1

```c
napi_status napi_get_version(node_api_basic_env env, uint32_t* result);
```

-   `[in] env`: API가 호출되는 환경
-   `[out] result`: 지원되는 Node-API의 최신 버전

API가 성공하면 `napi_ok`를 반환합니다.

이 API는 Node.js 런타임이 지원하는 최신 Node-API 버전을 반환합니다. Node-API는 추가적인 기능을 제공할 수 있도록 설계되었기 때문에, 새로운 Node.js 릴리스에서는 추가 API 함수를 지원할 수 있습니다. 이를 통해 Node.js 버전이 특정 함수를 지원할 때는 해당 함수를 사용하고, 지원하지 않을 때는 대체 동작을 제공할 수 있습니다.

-   `napi_get_version()`을 호출하여 API가 사용 가능한지 확인합니다.
-   사용 가능하다면, `uv_dlsym()`을 사용해 함수 포인터를 동적으로 로드합니다.
-   동적으로 로드된 포인터를 사용해 함수를 호출합니다.
-   함수를 사용할 수 없는 경우, 해당 함수를 사용하지 않는 대체 구현을 제공합니다.


### Memory management[#](https://nodejs.org/docs/latest/api/n-api.html#memory-management)





#### `napi_adjust_external_memory`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_adjust_external_memory)

추가된 버전: v8.5.0  
N-API 버전: 1

```c
NAPI_EXTERN napi_status napi_adjust_external_memory(node_api_basic_env env, int64_t change_in_bytes, int64_t* result);
```

-   `[in] env`: API가 호출되는 환경
-   `[in] change_in_bytes`: JavaScript 객체에 의해 유지되는 외부 할당 메모리의 변화량
-   `[out] result`: 조정된 값

API가 성공하면 `napi_ok`를 반환합니다.

이 함수는 JavaScript 객체에 의해 유지되는 외부 할당 메모리의 양을 V8에 알려줍니다. (예: 네이티브 애드온에 의해 할당된 메모리를 가리키는 JavaScript 객체) 외부 할당 메모리를 등록하면 전역 가비지 컬렉션이 더 자주 발생하게 됩니다.


### Promise[#](https://nodejs.org/docs/latest/api/n-api.html#promises)

Node-API는 ECMA 스펙의 [Section 25.4](https://tc39.github.io/ecma262/#sec-promise-objects)에 설명된 대로 `Promise` 객체를 생성하는 기능을 제공합니다. 이는 `Promise`를 두 개의 객체 쌍으로 구현합니다. `napi_create_promise()`를 통해 `Promise`를 생성하면, "deferred" 객체가 함께 생성되고 반환됩니다. 이 deferred 객체는 생성된 `Promise`에 바인딩되며, `napi_resolve_deferred()`나 `napi_reject_deferred()`를 사용해 `Promise`를 해결하거나 거부할 수 있는 유일한 수단입니다. `napi_create_promise()`로 생성된 deferred 객체는 `napi_resolve_deferred()`나 `napi_reject_deferred()`를 통해 해제됩니다. `Promise` 객체는 JavaScript로 반환될 수 있으며, 일반적인 방식으로 사용할 수 있습니다.

예를 들어, `Promise`를 생성하고 비동기 작업자에게 전달하는 방법은 다음과 같습니다:

```c
napi_deferred deferred;
napi_value promise;
napi_status status;

// Promise 생성
status = napi_create_promise(env, &deferred, &promise);
if (status != napi_ok) return NULL;

// 비동기 작업을 수행하는 함수에 deferred 전달
do_something_asynchronous(deferred);

// Promise를 JS로 반환
return promise;
```

위의 `do_something_asynchronous()` 함수는 비동기 작업을 수행한 후 deferred를 해결하거나 거부하여 `Promise`를 완료하고 deferred를 해제합니다:

```c
napi_deferred deferred;
napi_value undefined;
napi_status status;

// deferred를 완료할 값 생성
status = napi_get_undefined(env, &undefined);
if (status != napi_ok) return NULL;

// 비동기 작업의 성공 여부에 따라 deferred에 연결된 Promise 해결 또는 거부
if (asynchronous_action_succeeded) {
    status = napi_resolve_deferred(env, deferred, undefined);
} else {
    status = napi_reject_deferred(env, deferred, undefined);
}
if (status != napi_ok) return NULL;

// 이 시점에서 deferred는 해제되었으므로 NULL을 할당
deferred = NULL;
```


#### `napi_create_promise`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_promise)

추가된 버전: v8.5.0  
N-API 버전: 1

```c
napi_status napi_create_promise(napi_env env, napi_deferred* deferred, napi_value* promise);
```

-   `[in] env`: API가 호출되는 환경
-   `[out] deferred`: 새로 생성된 deferred 객체. 이 객체는 나중에 `napi_resolve_deferred()` 또는 `napi_reject_deferred()`에 전달되어 연결된 Promise를 해결하거나 거부하는 데 사용된다.
-   `[out] promise`: deferred 객체와 연결된 JavaScript Promise

API가 성공하면 `napi_ok`를 반환한다.

이 API는 deferred 객체와 JavaScript Promise를 생성한다.


#### `napi_resolve_deferred`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_resolve_deferred)

추가된 버전: v8.5.0 N-API 버전: 1

```c
napi_status napi_resolve_deferred(napi_env env, napi_deferred deferred, napi_value resolution);
```

-   `[in] env`: API가 호출되는 환경
-   `[in] deferred`: 연결된 Promise를 resolve할 deferred 객체
-   `[in] resolution`: Promise를 resolve할 값

이 API는 JavaScript Promise를 해당 deferred 객체를 통해 resolve합니다. 따라서 이 API는 해당 deferred 객체가 사용 가능한 JavaScript Promise에만 사용할 수 있습니다. 이는 Promise가 `napi_create_promise()`를 사용하여 생성되었고, 해당 호출에서 반환된 deferred 객체가 이 API에 전달되기 위해 유지되어야 함을 의미합니다.

deferred 객체는 성공적으로 완료되면 해제됩니다.


#### `napi_reject_deferred`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_reject_deferred)

추가된 버전: v8.5.0  
N-API 버전: 1

```c
napi_status napi_reject_deferred(napi_env env, napi_deferred deferred, napi_value rejection);
```

-   `[in] env`: API가 호출되는 환경
-   `[in] deferred`: 연관된 Promise를 거부할 deferred 객체
-   `[in] rejection`: Promise를 거부할 값

이 API는 연관된 deferred 객체를 통해 JavaScript Promise를 거부합니다. 따라서 이 API는 해당 deferred 객체가 존재하는 JavaScript Promise에만 사용할 수 있습니다. 이는 Promise가 `napi_create_promise()`를 사용해 생성되었고, 해당 호출에서 반환된 deferred 객체가 이 API에 전달되도록 유지되어야 함을 의미합니다.

deferred 객체는 성공적으로 완료되면 해제됩니다.


#### `napi_is_promise`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_is_promise)

추가된 버전: v8.5.0 N-API 버전: 1

```c
napi_status napi_is_promise(napi_env env, napi_value value, bool* is_promise);
```

-   `[in] env`: API가 호출되는 환경
-   `[in] value`: 검사할 값
-   `[out] is_promise`: `promise`가 네이티브 Promise 객체인지 여부를 나타내는 플래그 (즉, 기본 엔진에 의해 생성된 Promise 객체인지 여부)


### 스크립트 실행

Node-API는 기본 JavaScript 엔진을 사용하여 JavaScript 코드가 포함된 문자열을 실행할 수 있는 API를 제공합니다.


#### `napi_run_script`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_run_script)

추가된 버전: v8.5.0  
N-API 버전: 1

```c
NAPI_EXTERN napi_status napi_run_script(napi_env env, napi_value script, napi_value* result);
```

-   `[in] env`: API가 호출되는 환경
-   `[in] script`: 실행할 JavaScript 코드를 포함한 문자열
-   `[out] result`: 스크립트 실행 결과 값

이 함수는 JavaScript 코드 문자열을 실행하고 그 결과를 반환합니다. 단, 다음과 같은 주의사항이 있습니다:

-   `eval`과 달리, 이 함수는 스크립트가 현재 렉시컬 스코프에 접근하는 것을 허용하지 않습니다. 따라서 [모듈 스코프](https://nodejs.org/docs/latest/api/modules.html#the-module-scope)에도 접근할 수 없어, `require`와 같은 의사 전역 변수를 사용할 수 없습니다.
-   스크립트는 [전역 스코프](https://nodejs.org/docs/latest/api/globals.html)에 접근할 수 있습니다. 스크립트 내의 함수와 `var` 선언은 [`global`](https://nodejs.org/docs/latest/api/globals.html#global) 객체에 추가됩니다. `let`과 `const`로 선언된 변수는 전역적으로 보이지만, [`global`](https://nodejs.org/docs/latest/api/globals.html#global) 객체에는 추가되지 않습니다.
-   스크립트 내에서 `this`의 값은 [`global`](https://nodejs.org/docs/latest/api/globals.html#global)입니다.


### libuv 이벤트 루프

Node-API는 특정 `napi_env`와 연결된 현재 이벤트 루프를 가져오는 함수를 제공합니다.


#### `napi_get_uv_event_loop`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_uv_event_loop)

추가된 버전: v9.3.0, v8.10.0  
N-API 버전: 2

```c
NAPI_EXTERN napi_status napi_get_uv_event_loop(node_api_basic_env env, struct uv_loop_s** loop);
```

-   `[in] env`: API가 호출되는 환경
-   `[out] loop`: 현재 libuv 루프 인스턴스

참고: libuv는 시간이 지남에 따라 비교적 안정적이지만, ABI 안정성을 보장하지 않습니다. 이 함수의 사용은 피하는 것이 좋습니다. 이 함수를 사용하면 Node.js 버전 간에 동작하지 않는 애드온이 될 수 있습니다. [비동기 스레드 안전 함수 호출](https://nodejs.org/docs/latest/api/n-api.html#asynchronous-thread-safe-function-calls)은 많은 경우에 대안으로 사용할 수 있습니다.


### 비동기 스레드 안전 함수 호출

일반적으로 JavaScript 함수는 네이티브 애드온의 메인 스레드에서만 호출할 수 있습니다. 만약 애드온이 추가 스레드를 생성한다면, `napi_env`, `napi_value`, 또는 `napi_ref`가 필요한 Node-API 함수는 해당 스레드에서 호출해서는 안 됩니다.

애드온이 추가 스레드를 가지고 있고, 해당 스레드에서 처리 완료된 작업을 기반으로 JavaScript 함수를 호출해야 한다면, 해당 스레드는 애드온의 메인 스레드와 통신해야 합니다. 이를 통해 메인 스레드가 대신 JavaScript 함수를 호출할 수 있습니다. 스레드 안전 함수 API는 이를 쉽게 구현할 수 있는 방법을 제공합니다.

이 API는 `napi_threadsafe_function` 타입과 이 타입의 객체를 생성, 삭제, 호출하는 API를 제공합니다. `napi_create_threadsafe_function()`은 JavaScript 함수를 담고 있는 `napi_value`에 대한 영구적인 참조를 생성합니다. 이 함수는 여러 스레드에서 비동기적으로 호출될 수 있습니다. 즉, JavaScript 콜백에 전달될 값들은 큐에 추가되고, 큐에 있는 각 값에 대해 JavaScript 함수가 호출됩니다.

`napi_threadsafe_function`을 생성할 때 `napi_finalize` 콜백을 제공할 수 있습니다. 이 콜백은 스레드 안전 함수가 삭제되기 직전에 메인 스레드에서 호출됩니다. 이 콜백은 생성 시 제공된 컨텍스트와 파이널라이즈 데이터를 받으며, 예를 들어 `uv_thread_join()`을 호출하여 스레드 정리 작업을 수행할 수 있는 기회를 제공합니다. **메인 루프 스레드를 제외하고, 파이널라이즈 콜백이 완료된 후에는 어떤 스레드도 스레드 안전 함수를 사용해서는 안 됩니다.**

`napi_create_threadsafe_function()` 호출 시 제공된 `context`는 `napi_get_threadsafe_function_context()`를 호출하여 어떤 스레드에서든지 가져올 수 있습니다.


#### 스레드 안전 함수 호출하기

`napi_call_threadsafe_function()`은 JavaScript로의 호출을 시작하는 데 사용됩니다. 이 함수는 API가 블로킹 방식으로 동작할지 여부를 제어하는 매개변수를 받습니다. `napi_tsfn_nonblocking`으로 설정하면 API는 비블로킹 방식으로 동작하며, 큐가 가득 찼을 때 `napi_queue_full`을 반환하여 데이터가 큐에 성공적으로 추가되지 못하도록 합니다. `napi_tsfn_blocking`으로 설정하면 큐에 공간이 생길 때까지 API가 블로킹됩니다. 스레드 안전 함수가 최대 큐 크기 0으로 생성된 경우, `napi_call_threadsafe_function()`은 절대 블로킹되지 않습니다.

`napi_call_threadsafe_function()`을 JavaScript 스레드에서 `napi_tsfn_blocking`과 함께 호출해서는 안 됩니다. 큐가 가득 찼을 경우 JavaScript 스레드가 데드락에 빠질 수 있기 때문입니다.

JavaScript로의 실제 호출은 `call_js_cb` 매개변수를 통해 제공된 콜백에 의해 제어됩니다. `call_js_cb`는 `napi_call_threadsafe_function()`이 성공적으로 호출되어 큐에 추가된 각 값에 대해 메인 스레드에서 한 번씩 호출됩니다. 이러한 콜백이 제공되지 않으면 기본 콜백이 사용되며, 결과적으로 JavaScript 호출에는 인자가 없습니다. `call_js_cb` 콜백은 호출할 JavaScript 함수를 `napi_value`로 받으며, `napi_threadsafe_function`을 생성할 때 사용된 `void*` 컨텍스트 포인터와 보조 스레드 중 하나에 의해 생성된 다음 데이터 포인터도 받습니다. 이 콜백은 `napi_call_function()`과 같은 API를 사용하여 JavaScript를 호출할 수 있습니다.

콜백은 `env`와 `call_js_cb`가 모두 `NULL`로 설정된 상태로 호출될 수도 있습니다. 이는 JavaScript로의 호출이 더 이상 불가능하지만, 큐에 남아 있는 항목을 해제해야 할 필요가 있음을 나타냅니다. 이는 일반적으로 Node.js 프로세스가 종료될 때 스레드 안전 함수가 여전히 활성 상태인 경우에 발생합니다.

`napi_make_callback()`을 통해 JavaScript를 호출할 필요는 없습니다. Node-API는 `call_js_cb`를 콜백에 적합한 컨텍스트에서 실행하기 때문입니다.

이벤트 루프의 각 틱(tick)에서 큐에 있는 0개 이상의 항목이 호출될 수 있습니다. 애플리케이션은 콜백 호출이 진행되고 시간이 지남에 따라 이벤트가 호출된다는 점 외에 특정 동작에 의존해서는 안 됩니다.


#### 스레드 안전 함수의 참조 카운팅

`napi_threadsafe_function` 객체는 생성 이후에도 스레드를 추가하거나 제거할 수 있습니다. 따라서 초기 스레드 수를 지정하는 것 외에도, `napi_acquire_threadsafe_function`을 호출하여 새로운 스레드가 스레드 안전 함수를 사용하기 시작함을 나타낼 수 있습니다. 마찬가지로, `napi_release_threadsafe_function`을 호출하여 기존 스레드가 스레드 안전 함수 사용을 중지함을 나타낼 수 있습니다.

`napi_threadsafe_function` 객체는 해당 객체를 사용하는 모든 스레드가 `napi_release_threadsafe_function()`을 호출하거나 `napi_call_threadsafe_function` 호출에 대한 응답으로 `napi_closing` 상태를 받았을 때 파괴됩니다. `napi_threadsafe_function`이 파괴되기 전에 큐가 비워집니다. `napi_release_threadsafe_function()`은 주어진 `napi_threadsafe_function`과 관련된 마지막 API 호출이어야 합니다. 이 호출이 완료된 후에는 `napi_threadsafe_function`이 여전히 할당되어 있다는 보장이 없기 때문입니다. 같은 이유로, `napi_call_threadsafe_function` 호출에 대한 응답으로 `napi_closing` 반환 값을 받은 후에는 스레드 안전 함수를 사용하지 마세요. `napi_threadsafe_function`과 관련된 데이터는 `napi_create_threadsafe_function()`에 전달된 `napi_finalize` 콜백에서 해제할 수 있습니다. `napi_create_threadsafe_function`의 `initial_thread_count` 매개변수는 스레드 안전 함수의 초기 획득 횟수를 나타내며, 생성 시 `napi_acquire_threadsafe_function`을 여러 번 호출하는 대신 사용됩니다.

`napi_threadsafe_function`을 사용하는 스레드 수가 0이 되면, `napi_acquire_threadsafe_function()`을 호출하여 새로운 스레드가 이를 사용하기 시작할 수 없습니다. 사실, `napi_release_threadsafe_function()`을 제외한 모든 관련 API 호출은 `napi_closing` 오류 값을 반환합니다.

스레드 안전 함수는 `napi_release_threadsafe_function()`에 `napi_tsfn_abort` 값을 전달하여 "중단"할 수 있습니다. 이렇게 하면 참조 카운트가 0이 되기 전에도 스레드 안전 함수와 관련된 모든 API가 `napi_closing`을 반환합니다. 특히, `napi_call_threadsafe_function()`은 `napi_closing`을 반환하여 스레드 안전 함수에 비동기 호출을 더 이상 할 수 없음을 스레드에 알립니다. 이는 스레드를 종료하는 기준으로 사용할 수 있습니다. **`napi_call_threadsafe_function()`에서 `napi_closing` 반환 값을 받은 스레드는 스레드 안전 함수를 더 이상 사용해서는 안 됩니다. 해당 함수가 여전히 할당되어 있다는 보장이 없기 때문입니다.**


#### 프로세스 실행 유지 여부 결정하기

libuv 핸들(handle)과 마찬가지로, 스레드 안전 함수(thread-safe function)도 "참조(referenced)"되거나 "참조 해제(unreferenced)"될 수 있습니다. "참조된" 스레드 안전 함수는 해당 함수가 생성된 스레드의 이벤트 루프(event loop)가 스레드 안전 함수가 파괴될 때까지 계속 실행되도록 유지합니다. 반면, "참조 해제된" 스레드 안전 함수는 이벤트 루프가 종료되는 것을 막지 않습니다. 이를 위해 `napi_ref_threadsafe_function`과 `napi_unref_threadsafe_function` API가 제공됩니다.

`napi_unref_threadsafe_function`은 스레드 안전 함수를 파괴할 수 있는 상태로 표시하지 않으며, `napi_ref_threadsafe_function`도 함수가 파괴되는 것을 막지 않습니다.


#### `napi_create_threadsafe_function`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_create_threadsafe_function)

```c
NAPI_EXTERN napi_status napi_create_threadsafe_function(napi_env env, napi_value func, napi_value async_resource, napi_value async_resource_name, size_t max_queue_size, size_t initial_thread_count, void* thread_finalize_data, napi_finalize thread_finalize_cb, void* context, napi_threadsafe_function_call_js call_js_cb, napi_threadsafe_function* result);
```

-   `[in] env`: API가 호출되는 환경을 나타냅니다.
-   `[in] func`: 다른 스레드에서 호출할 수 있는 선택적인 JavaScript 함수입니다. `call_js_cb`에 `NULL`이 전달된 경우 반드시 제공되어야 합니다.
-   `[in] async_resource`: `async_hooks`의 [`init` hooks](https://nodejs.org/docs/latest/api/async_hooks.html#initasyncid-type-triggerasyncid-resource)에 전달될 수 있는 비동기 작업과 관련된 선택적 객체입니다.
-   `[in] async_resource_name`: `async_hooks` API에 의해 노출되는 진단 정보를 위한 리소스 종류를 식별하는 JavaScript 문자열입니다.
-   `[in] max_queue_size`: 큐의 최대 크기입니다. `0`은 제한 없음을 의미합니다.
-   `[in] initial_thread_count`: 초기 획득 횟수, 즉 이 함수를 사용할 초기 스레드 수를 나타냅니다. 메인 스레드도 포함됩니다.
-   `[in] thread_finalize_data`: `thread_finalize_cb`에 전달될 선택적 데이터입니다.
-   `[in] thread_finalize_cb`: `napi_threadsafe_function`이 파괴될 때 호출될 선택적 함수입니다.
-   `[in] context`: 결과로 생성된 `napi_threadsafe_function`에 첨부할 선택적 데이터입니다.
-   `[in] call_js_cb`: 다른 스레드에서 호출될 때 JavaScript 함수를 호출하는 선택적 콜백입니다. 이 콜백은 메인 스레드에서 호출됩니다. 제공되지 않으면 JavaScript 함수는 매개변수 없이 `undefined`를 `this` 값으로 호출됩니다. 자세한 내용은 [`napi_threadsafe_function_call_js`](https://nodejs.org/docs/latest/api/n-api.html#napi_threadsafe_function_call_js)를 참조하세요.
-   `[out] result`: 비동기 스레드 안전 JavaScript 함수입니다.

**변경 내역:**

-   실험적 (`NAPI_EXPERIMENTAL`이 정의된 경우):
    
    `call_js_cb`에서 발생한 처리되지 않은 예외는 무시되는 대신 [`'uncaughtException'`](https://nodejs.org/docs/latest/api/process.html#event-uncaughtexception) 이벤트로 처리됩니다.


#### `napi_get_threadsafe_function_context`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_get_threadsafe_function_context)

추가된 버전: v10.6.0  
N-API 버전: 4

```c
NAPI_EXTERN napi_status napi_get_threadsafe_function_context(napi_threadsafe_function func, void** result);
```

-   `[in] func`: 컨텍스트를 가져올 스레드 안전 함수
-   `[out] result`: 컨텍스트를 저장할 위치

이 API는 `func`를 사용하는 모든 스레드에서 호출할 수 있습니다.


#### `napi_call_threadsafe_function`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_call_threadsafe_function)

```c
NAPI_EXTERN napi_status napi_call_threadsafe_function(napi_threadsafe_function func, void* data, napi_threadsafe_function_call_mode is_blocking);
```

-   `[in] func`: 호출할 비동기 스레드 안전(thread-safe) 자바스크립트 함수
-   `[in] data`: 스레드 안전 자바스크립트 함수 생성 시 제공된 콜백 `call_js_cb`를 통해 자바스크립트로 전달할 데이터
-   `[in] is_blocking`: 큐가 가득 찼을 때 동작을 결정하는 플래그. `napi_tsfn_blocking`으로 설정하면 큐가 가득 찼을 때 호출이 블로킹되고, `napi_tsfn_nonblocking`으로 설정하면 큐가 가득 찼을 때 즉시 `napi_queue_full` 상태로 반환됨

이 API는 자바스크립트 스레드에서 `napi_tsfn_blocking`과 함께 호출하면 안 됩니다. 큐가 가득 찼을 경우 자바스크립트 스레드가 데드락에 빠질 수 있기 때문입니다.

이 API는 `napi_release_threadsafe_function()`이 `abort`를 `napi_tsfn_abort`로 설정한 상태로 호출된 경우 `napi_closing`을 반환합니다. API가 `napi_ok`를 반환할 때만 값이 큐에 추가됩니다.

이 API는 `func`를 사용하는 모든 스레드에서 호출할 수 있습니다.


#### `napi_acquire_threadsafe_function`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_acquire_threadsafe_function)

추가된 버전: v10.6.0  
N-API 버전: 4

```c
NAPI_EXTERN napi_status napi_acquire_threadsafe_function(napi_threadsafe_function func);
```

-   `[in] func`: 사용을 시작할 비동기 스레드 안전 JavaScript 함수

스레드는 `func`를 다른 스레드 안전 함수 API에 전달하기 전에 이 API를 호출해야 합니다. 이는 `func`를 사용할 것임을 나타내며, 다른 모든 스레드가 `func` 사용을 중단했을 때 `func`가 파괴되는 것을 방지합니다.

이 API는 `func`를 사용할 스레드에서 호출할 수 있습니다.


#### `napi_release_threadsafe_function`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_release_threadsafe_function)

추가된 버전: v10.6.0  
N-API 버전: 4

```c
NAPI_EXTERN napi_status napi_release_threadsafe_function(napi_threadsafe_function func, napi_threadsafe_function_release_mode mode);
```

-   `[in] func`: 참조 카운트를 감소시킬 비동기 스레드 안전 JavaScript 함수
-   `[in] mode`: 플래그 값으로, `napi_tsfn_release`는 현재 스레드가 스레드 안전 함수를 더 이상 호출하지 않음을 나타내고, `napi_tsfn_abort`는 현재 스레드뿐만 아니라 다른 스레드도 스레드 안전 함수를 더 이상 호출하지 않아야 함을 나타냅니다. `napi_tsfn_abort`로 설정된 경우, `napi_call_threadsafe_function()`을 호출하면 `napi_closing`이 반환되고, 큐에 더 이상 값이 추가되지 않습니다.

스레드가 `func`를 더 이상 사용하지 않을 때 이 API를 호출해야 합니다. 이 API를 호출한 후 `func`를 스레드 안전 API에 전달하면 정의되지 않은 결과가 발생할 수 있습니다. `func`가 이미 파괴되었을 가능성이 있기 때문입니다.

이 API는 `func`를 더 이상 사용하지 않을 스레드에서 호출할 수 있습니다.


#### `napi_ref_threadsafe_function`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_ref_threadsafe_function)

추가된 버전: v10.6.0  
N-API 버전: 4

```c
NAPI_EXTERN napi_status napi_ref_threadsafe_function(node_api_basic_env env, napi_threadsafe_function func);
```

-   `[in] env`: API가 호출되는 환경
-   `[in] func`: 참조할 스레드 안전 함수

이 API는 메인 스레드에서 실행 중인 이벤트 루프가 `func`가 파괴될 때까지 종료되지 않도록 지시하는 데 사용됩니다. [`uv_ref`](https://docs.libuv.org/en/v1.x/handle.html#c.uv_ref)와 유사하게 이 API도 멱등성을 가집니다.

`napi_unref_threadsafe_function`은 스레드 안전 함수를 파괴할 수 있도록 표시하지 않으며, `napi_ref_threadsafe_function`도 함수가 파괴되는 것을 막지 않습니다. 이를 위해 `napi_acquire_threadsafe_function`과 `napi_release_threadsafe_function`이 제공됩니다.

이 API는 메인 스레드에서만 호출할 수 있습니다.


#### `napi_unref_threadsafe_function`[#](https://nodejs.org/docs/latest/api/n-api.html#napi_unref_threadsafe_function)

추가된 버전: v10.6.0  
N-API 버전: 4

```c
NAPI_EXTERN napi_status napi_unref_threadsafe_function(node_api_basic_env env, napi_threadsafe_function func);
```

-   `[in] env`: API가 호출되는 환경
-   `[in] func`: 참조를 해제할 스레드 안전 함수

이 API는 `func`가 파괴되기 전에 메인 스레드에서 실행 중인 이벤트 루프가 종료될 수 있음을 나타내기 위해 사용됩니다. [`uv_unref`](https://docs.libuv.org/en/v1.x/handle.html#c.uv_unref)와 유사하게 이 API도 **멱등성**을 가집니다.

이 API는 **메인 스레드에서만 호출**할 수 있습니다.


### Miscellaneous utilities[#](https://nodejs.org/docs/latest/api/n-api.html#miscellaneous-utilities)





#### `node_api_get_module_file_name`[#](https://nodejs.org/docs/latest/api/n-api.html#node_api_get_module_file_name)

추가된 버전: v15.9.0, v14.18.0, v12.22.0  
N-API 버전: 9

```c
NAPI_EXTERN napi_status node_api_get_module_file_name(node_api_basic_env env, const char** result);
```

-   `[in] env`: API가 호출된 환경을 나타냅니다.
-   `[out] result`: 애드온이 로드된 위치의 절대 경로를 포함하는 URL입니다. 로컬 파일 시스템에 있는 파일의 경우 `file://`로 시작합니다. 이 문자열은 null로 종료되며 `env`가 소유하므로 수정하거나 해제해서는 안 됩니다.

애드온 로딩 과정에서 파일 이름을 확인하지 못한 경우, `result`는 빈 문자열일 수 있습니다.


